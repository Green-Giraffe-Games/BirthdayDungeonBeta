<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Happy Birthday</title>
<style title="Twine CSS">@-webkit-keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes appear{0%{opacity:0}to{opacity:1}}@-webkit-keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@-webkit-keyframes rumble{50%{-webkit-transform:translateY(-0.2em);transform:translateY(-0.2em)}}@keyframes rumble{50%{-webkit-transform:translateY(-0.2em);transform:translateY(-0.2em)}}@-webkit-keyframes shudder{50%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@keyframes shudder{50%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@-webkit-keyframes box-flash{0%{background-color:white;color:white}}@keyframes box-flash{0%{background-color:white;color:white}}@-webkit-keyframes pulse{0%{-webkit-transform:scale(0, 0);transform:scale(0, 0)}20%{-webkit-transform:scale(1.2, 1.2);transform:scale(1.2, 1.2)}40%{-webkit-transform:scale(0.9, 0.9);transform:scale(0.9, 0.9)}60%{-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05)}80%{-webkit-transform:scale(0.925, 0.925);transform:scale(0.925, 0.925)}to{-webkit-transform:scale(1, 1);transform:scale(1, 1)}}@keyframes pulse{0%{-webkit-transform:scale(0, 0);transform:scale(0, 0)}20%{-webkit-transform:scale(1.2, 1.2);transform:scale(1.2, 1.2)}40%{-webkit-transform:scale(0.9, 0.9);transform:scale(0.9, 0.9)}60%{-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05)}80%{-webkit-transform:scale(0.925, 0.925);transform:scale(0.925, 0.925)}to{-webkit-transform:scale(1, 1);transform:scale(1, 1)}}@-webkit-keyframes shudder-in{0%, to{-webkit-transform:translateX(0em);transform:translateX(0em)}5%, 25%, 45%{-webkit-transform:translateX(-1em);transform:translateX(-1em)}15%, 35%, 55%{-webkit-transform:translateX(1em);transform:translateX(1em)}65%{-webkit-transform:translateX(-0.6em);transform:translateX(-0.6em)}75%{-webkit-transform:translateX(0.6em);transform:translateX(0.6em)}85%{-webkit-transform:translateX(-0.2em);transform:translateX(-0.2em)}95%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@keyframes shudder-in{0%, to{-webkit-transform:translateX(0em);transform:translateX(0em)}5%, 25%, 45%{-webkit-transform:translateX(-1em);transform:translateX(-1em)}15%, 35%, 55%{-webkit-transform:translateX(1em);transform:translateX(1em)}65%{-webkit-transform:translateX(-0.6em);transform:translateX(-0.6em)}75%{-webkit-transform:translateX(0.6em);transform:translateX(0.6em)}85%{-webkit-transform:translateX(-0.2em);transform:translateX(-0.2em)}95%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}.debug-mode tw-expression[type=hookref]{background-color:rgba(115,123,140,0.15)}.debug-mode tw-expression[type=hookref]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"?" attr(name)}.debug-mode tw-expression[type=variable]{background-color:rgba(140,128,115,0.15)}.debug-mode tw-expression[type=variable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=macro]:nth-of-type(4n+0){background-color:rgba(136,153,102,0.15)}.debug-mode tw-expression[type=macro]:nth-of-type(2n+1){background-color:rgba(102,153,102,0.15)}.debug-mode tw-expression[type=macro]:nth-of-type(4n+2){background-color:rgba(102,153,136,0.15)}.debug-mode tw-expression[type=macro][name="display"]{background-color:rgba(0,170,255,0.1) !important}.debug-mode tw-expression[type=macro][name="if"],.debug-mode tw-expression[type=macro][name="if"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="unless"],.debug-mode tw-expression[type=macro][name="unless"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="elseif"],.debug-mode tw-expression[type=macro][name="elseif"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="else"],.debug-mode tw-expression[type=macro][name="else"]+tw-hook:not([name]){background-color:rgba(0,255,0,0.1) !important}.debug-mode tw-expression[type=macro].false{background-color:rgba(255,0,0,0.2) !important}.debug-mode tw-expression[type=macro].false+tw-hook:not([name]){display:none}.debug-mode tw-expression[type=macro][name="a"],.debug-mode tw-expression[type=macro][name="array"],.debug-mode tw-expression[type=macro][name="datamap"],.debug-mode tw-expression[type=macro][name="dataset"],.debug-mode tw-expression[type=macro][name="colour"],.debug-mode tw-expression[type=macro][name="color"],.debug-mode tw-expression[type=macro][name="num"],.debug-mode tw-expression[type=macro][name="number"],.debug-mode tw-expression[type=macro][name="text"],.debug-mode tw-expression[type=macro][name="print"]{background-color:rgba(255,255,0,0.2) !important}.debug-mode tw-expression[type=macro][name="put"],.debug-mode tw-expression[type=macro][name="set"]{background-color:rgba(255,128,0,0.2) !important}.debug-mode tw-expression[type=macro][name="script"]{background-color:rgba(255,191,0,0.2) !important}.debug-mode tw-expression[type=macro][name="style"]{background-color:rgba(185,198,198,0.2) !important}.debug-mode tw-expression[type=macro][name^="link"],.debug-mode tw-expression[type=macro][name^="click"],.debug-mode tw-expression[type=macro][name^="mouseover"],.debug-mode tw-expression[type=macro][name^="mouseout"]{background-color:rgba(128,223,32,0.2) !important}.debug-mode tw-expression[type=macro][name^="replace"],.debug-mode tw-expression[type=macro][name^="prepend"],.debug-mode tw-expression[type=macro][name^="append"],.debug-mode tw-expression[type=macro][name^="remove"]{background-color:rgba(223,96,32,0.2) !important}.debug-mode tw-expression[type=macro][name="live"]{background-color:rgba(32,96,223,0.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 0.5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,0.5)}.debug-mode tw-hook{background-color:rgba(0,85,255,0.1) !important}.debug-mode tw-hook::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,0.1) !important}.debug-mode tw-collapsed::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 50%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, rgba(255,204,189,0.25) 0%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 100%)}.debug-mode p{background-color:rgba(255,213,0,0.1)}.debug-mode tw-enchantment{animation:enchantment 0.5s infinite;-webkit-animation:enchantment 0.5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,0.1)}.debug-mode tw-include::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(type) ' "' attr(title) '"'}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}@-webkit-keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:1em;font-size:1.5em;border-left:solid #000 2px;border-top:solid #000 2px;border-top-left-radius:0.5em;background:#fff;transition:opacity 0.2s;-webkit-transition:opacity 0.2s;opacity:0.8}@media screen and (max-width: 1280px){tw-debugger{font-size:1.25em}}@media screen and (max-width: 960px){tw-debugger{font-size:1em}}@media screen and (max-width: 640px){tw-debugger{font-size:0.8em}}tw-debugger:hover{opacity:1}.show-invisibles{border-radius:3px;border:solid #999 1px;background-color:#fff;font-size:inherit}.debug-mode .show-invisibles{background-color:#eee;box-shadow:inset #ddd 3px 5px 0.5em}tw-link,.link,tw-icon{cursor:pointer}tw-link,.enchantment-link{color:#4169E1;font-weight:bold;text-decoration:none;transition:color 0.2s ease-in-out}tw-link:hover,.enchantment-link:hover{color:DeepSkyBlue}tw-link:active,.enchantment-link:active{color:#DD4B39}.visited{color:#6941e1}.visited:hover{color:#E3E}tw-broken-link{color:#993333;border-bottom:2px solid #993333;cursor:not-allowed}.enchantment-mouseover{border-bottom:1px dashed #666}.enchantment-mouseout{border:rgba(64,149,191,0.25) 1px solid}.enchantment-mouseout:hover{background-color:rgba(64,149,191,0.25);border:transparent 1px solid;border-radius:0.2em}html{font:100% Georgia, serif;margin:0;background-color:transparent;color:#000;height:100%;overflow-x:hidden;box-sizing:border-box}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;background-color:transparent}tw-storydata{display:none}tw-story{display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:60%;font-size:1.5em;line-height:1.5em;margin:5% auto}@media screen and (max-width: 1024px){tw-story{font-size:1.2em}}@media screen and (max-width: 896px){tw-story{font-size:1.05em}}@media screen and (max-width: 768px){tw-story{font-size:.9em}}tw-passage{display:block}tw-sidebar{left:-5em;width:3em;position:absolute;text-align:center;display:block}tw-icon{display:block;margin:0.5em 0;opacity:0.1;font-size:2.75em}tw-icon:hover{opacity:0.3}tw-error{display:inline-block;border-radius:0.2em;padding:0.2em;font-size:1rem;cursor:help}tw-error.error{background-color:rgba(223,58,190,0.4);color:black}tw-error.warning{background-color:rgba(223,140,58,0.4);color:black;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:0.8rem;line-height:1rem}tw-error-explanation-button{cursor:pointer;line-height:0em;border-radius:1px;border:1px solid black;font-size:0.8rem;margin:0 0.4rem;opacity:0.5}tw-error-explanation-button .folddown-arrowhead{display:inline-block}tw-notifier{border-radius:0.2em;padding:0.2em;font-size:1rem;background-color:rgba(223,182,58,0.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid black;display:inline-block;width:1em;height:1em}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:0.6em 0}pre{font-size:1rem}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,0.6);background-color:#ff9}ins{color:rgba(0,0,0,0.6);background-color:rgba(255,242,204,0.5);border-radius:0.5em;box-shadow:0em 0em 0.2em #ffe699;text-decoration:none}del{background-color:#000;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate;-webkit-animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-outline{color:white;text-shadow:-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000}tw-shadow{text-shadow:0.08em 0.08em 0.08em #000}tw-emboss{text-shadow:0.08em 0.08em 0em #000;color:white}tw-condense{letter-spacing:-0.08em}tw-expand{letter-spacing:0.1em}tw-blur{color:transparent;text-shadow:0em 0em 0.08em #000}tw-blurrier{color:transparent;text-shadow:0em 0em 0.2em #000}tw-blurrier::selection{background-color:transparent;color:transparent}tw-blurrier::-moz-selection{background-color:transparent;color:transparent}tw-smear{color:transparent;text-shadow:0em 0em 0.02em rgba(0,0,0,0.75),-0.2em 0em 0.5em rgba(0,0,0,0.5),0.2em 0em 0.5em rgba(0,0,0,0.5)}tw-mirror{display:inline-block;transform:scaleX(-1);-webkit-transform:scaleX(-1)}tw-upside-down{display:inline-block;transform:scaleY(-1);-webkit-transform:scaleY(-1)}tw-fade-in-out{text-decoration:none;animation:fade-in-out 2s ease-in-out infinite alternate;-webkit-animation:fade-in-out 2s ease-in-out infinite alternate}tw-rumble{-webkit-animation:rumble linear 0.1s 0s infinite;animation:rumble linear 0.1s 0s infinite;display:inline-block}tw-shudder{-webkit-animation:shudder linear 0.1s 0s infinite;animation:shudder linear 0.1s 0s infinite;display:inline-block}tw-shudder-in{animation:shudder-in 1s ease-out;-webkit-animation:shudder-in 1s ease-out}.transition-in{-webkit-animation:appear 0ms step-start;animation:appear 0ms step-start}.transition-out{-webkit-animation:appear 0ms step-end;animation:appear 0ms step-end}[data-t8n^=fade-in].transition-in,.transition-in[data-t8n^=dissolve]{-webkit-animation:appear 0.8s;animation:appear 0.8s}[data-t8n^=dissolve].transition-out{-webkit-animation:appear 0.8s reverse;animation:appear 0.8s reverse}[data-t8n^=shudder-in].transition-in,.transition-in[data-t8n^=shudder]{display:inline-block;-webkit-animation:shudder-in 0.8s;animation:shudder-in 0.8s}[data-t8n^=shudder-out].transition-out,.transition-out[data-t8n^=shudder]{display:inline-block;-webkit-animation:shudder-out 0.8s;animation:shudder-out 0.8s}[data-t8n^=boxflash].transition-in{-webkit-animation:box-flash 0.8s;animation:box-flash 0.8s}[data-t8n^=pulse].transition-in{-webkit-animation:pulse 0.8s;animation:pulse 0.8s}[data-t8n^=pulse].transition-out{-webkit-animation:pulse 0.8s reverse;animation:pulse 0.8s reverse}[data-t8n$=fast]{animation-duration:0.4s;-webkit-animation-duration:0.4s}[data-t8n$=slow]{animation-duration:1.2s;-webkit-animation-duration:1.2s}
</style>
</head>

<body>

<tw-story></tw-story>

<tw-storydata name="Happy Birthday" startnode="156" creator="Twine" creator-version="2.2.1" ifid="369C1ECA-B407-407D-B348-4BBFFD2528C3" zoom="0.6" format="Harlowe" format-version="1.2.4" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">#fade p {
    -webkit-animation: fadein 2s; /* Safari, Chrome and Opera > 12.1 */
       -moz-animation: fadein 2s; /* Firefox < 16 */
        -ms-animation: fadein 2s; /* Internet Explorer */
         -o-animation: fadein 2s; /* Opera < 12.1 */
            animation: fadein 2s;
}

@keyframes fadein {
    from { opacity: 0; }
    to   { opacity: 1; }
}

@font-face {
  font-family: 'Shadows Into Light';
  src: url('shadowsintolight.ttf');
}

@font-face {
  font-family: 'underdog';
  src: url('underdog.ttf');
}

@font-face {
  font-family: 'VT323';
  src: url('vt323-regular.ttf');
}

@font-face {
  font-family: 'Amatic';
  src: url('amatic.ttf');
}

@import url('https://fonts.googleapis.com/css?family=Special+Elite');

tw-passage {
  	font-size: 120%;
    font-family: 'VT323', monospace;
    -moz-user-select: -moz-none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -o-user-select: none;
    user-select: none;
}

tw-passage tw-include[title="Sidebar"] {
  	height: 100%;	
  	position: fixed;
	width: 6.8em;
	left: 0;
	top: 0;
	padding-top: 1.5em;
  	padding-left: 0.4em;
  	padding-right: 0.4em;
	text-align: center;
	background-color: #111;
	text-overflow: clip;
  text-decoration: none;
  color: #818181;
  font-family: 'VT323', monospace;
      pointer-events: none;
    -moz-user-select: -moz-none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -o-user-select: none;
  user-select: none;
  pointer-events: none;
  font-size: 100%;
}

.yesClick {
  pointer-events: auto;
}

.achieve {
  color: gold;
  margin-left: 1em;
  margin-right: 1em;
  margin-top: 1em;
  margin-bottom: 0px;
  padding: 0.3em;
  text-align: center;
  font-size: 120%;
}

html.footer {
    -moz-user-select: none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -o-user-select: none;
    user-select: none;
}

tw-story {
	width: 90%;
	padding-left: 8.6em;
  	padding-right: 1.8em;
  	padding-top: 1em;
  	margin-top: 2.5%;
}

html.space {
	background-color: #111;
  color: #3F3;
}

html.space tw-link, enchantment-link {
	color: #0F0;
}

html.space tw-link:hover, enchantment-link:hover { 
  color: #3F3; 
}

html.sidequest {
  	background-color: #cbd1d7;
 	color: #59687D;
}

html.sidequest tw-passage {
   	font-family: 'Amatic', monospace;
}

html.crab {
    background-color: #0A1621;
 	color: #ACB9B1;	
}

html.crab tw-passage {
   	font-family: 'underdog', monospace; 
}

html.crab tw-link, enchantment-link {
	color: #c4cec8;
}

html.crab tw-link:hover, enchantment-link:hover { 
  color: white; 
}

html.deathly {
  	color: #610533;
}

html.deathly tw-link, enchantment-link {
	color: #aa0909;
}

html.deathly tw-link:hover, enchantment-link:hover { 
  color: #da0b0b; 
}

html.demon {
	background-color: #b30000;
  	color: #ffffff;
}

html.demon tw-link, enchantment-link {
	color: white;
}

html.pirate tw-link, enchantment-link {
	color: #dddddd;
}

html.demon tw-link:hover, enchantment-link:hover /* sets both hover link colors */
{ color: #dddddd; }

html.blessings {
	background-color: #F7DC6F;
}

tw-sidebar tw-icon.undo, tw-icon.redo {
	display: none;
}

html.hide-footer tw-include[title="StoryFooter"] {
	display: none;
}

html.achievements {
	background-color: #111;
 	color: #818181;
}

html.mist {
	background-color: #eee;
 	color: #ad9de2;
}

html.pirates {
	background-color: #111;
 	color: white;
}
  
html.achievements tw-include[title="Sidebar"] {
	display: none;
}

html.achievements tw-link {
	color: #dddddd;
}

html.achievements tw-link:hover, enchantment-link:hover
{ color: #ffffff; }

html.pirates tw-link {
	color: #dddddd;
}

html.pirates tw-link:hover, enchantment-link:hover
{ color: #ffffff; }

html.watermelon {
	background-color: #ffccff;
  	color: red;
}

html.watermelon tw-link {
	color: green;
}

tw-passage tw-include[title="Sidebar"] tw-link{
  	color: #818181;
	font-size: 80%; 
	font-weight: normal;
}

tw-link, enchantment-link /* sets both base link colors */
{ color: #2471A3; }
tw-link:hover, enchantment-link:hover /* sets both hover link colors */
{ color: #2E86C1; }
.visited /* all visited links */
{ color: #2471A3; }
.visited:hover /* all visited hover links */
{ color: #2E86C1; }

html.About tw-include[title="Sidebar"] {
	display: none;
}

.transition-in[data-t8n^=dissolve] {
	-webkit-animation:appear 0ms step-start;
	animation:appear 0ms step-start
}
















</style><script role="script" id="twine-user-script" type="text/twine-javascript">/*!
 *  howler.js v2.0.0
 *  howlerjs.com
 *
 *  (c) 2013-2016, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */

(function() {

  'use strict';

  /** Global Methods **/
  /***************************************************************************/

  /**
   * Create the global controller. All contained methods and properties apply
   * to all sounds that are currently playing or will be in the future.
   */
  var HowlerGlobal = function() {
    this.init();
  };
  HowlerGlobal.prototype = {
    /**
     * Initialize the global Howler object.
     * @return {Howler}
     */
    init: function() {
      var self = this || Howler;

      // Internal properties.
      self._codecs = {};
      self._howls = [];
      self._muted = false;
      self._volume = 1;
      self._canPlayEvent = 'canplaythrough';
      self._navigator = (typeof window !== 'undefined' && window.navigator) ? window.navigator : null;

      // Public properties.
      self.masterGain = null;
      self.noAudio = false;
      self.usingWebAudio = true;
      self.autoSuspend = true;
      self.ctx = null;

      // Set to false to disable the auto iOS enabler.
      self.mobileAutoEnable = true;

      // Setup the various state values for global tracking.
      self._setup();

      return self;
    },

    /**
     * Get/set the global volume for all sounds.
     * @param  {Float} vol Volume from 0.0 to 1.0.
     * @return {Howler/Float}     Returns self or current volume.
     */
    volume: function(vol) {
      var self = this || Howler;
      vol = parseFloat(vol);

      // If we don't have an AudioContext created yet, run the setup.
      if (!self.ctx) {
        setupAudioContext();
      }

      if (typeof vol !== 'undefined' && vol >= 0 && vol <= 1) {
        self._volume = vol;

        // Don't update any of the nodes if we are muted.
        if (self._muted) {
          return self;
        }

        // When using Web Audio, we just need to adjust the master gain.
        if (self.usingWebAudio) {
          self.masterGain.gain.value = vol;
        }

        // Loop through and change volume for all HTML5 audio nodes.
        for (var i=0; i<self._howls.length; i++) {
          if (!self._howls[i]._webAudio) {
            // Get all of the sounds in this Howl group.
            var ids = self._howls[i]._getSoundIds();

            // Loop through all sounds and change the volumes.
            for (var j=0; j<ids.length; j++) {
              var sound = self._howls[i]._soundById(ids[j]);

              if (sound && sound._node) {
                sound._node.volume = sound._volume * vol;
              }
            }
          }
        }

        return self;
      }

      return self._volume;
    },

    /**
     * Handle muting and unmuting globally.
     * @param  {Boolean} muted Is muted or not.
     */
    mute: function(muted) {
      var self = this || Howler;

      // If we don't have an AudioContext created yet, run the setup.
      if (!self.ctx) {
        setupAudioContext();
      }

      self._muted = muted;

      // With Web Audio, we just need to mute the master gain.
      if (self.usingWebAudio) {
        self.masterGain.gain.value = muted ? 0 : self._volume;
      }

      // Loop through and mute all HTML5 Audio nodes.
      for (var i=0; i<self._howls.length; i++) {
        if (!self._howls[i]._webAudio) {
          // Get all of the sounds in this Howl group.
          var ids = self._howls[i]._getSoundIds();

          // Loop through all sounds and mark the audio node as muted.
          for (var j=0; j<ids.length; j++) {
            var sound = self._howls[i]._soundById(ids[j]);

            if (sound && sound._node) {
              sound._node.muted = (muted) ? true : sound._muted;
            }
          }
        }
      }

      return self;
    },

    /**
     * Unload and destroy all currently loaded Howl objects.
     * @return {Howler}
     */
    unload: function() {
      var self = this || Howler;

      for (var i=self._howls.length-1; i>=0; i--) {
        self._howls[i].unload();
      }

      // Create a new AudioContext to make sure it is fully reset.
      if (self.usingWebAudio && typeof self.ctx.close !== 'undefined') {
        self.ctx.close();
        self.ctx = null;
        setupAudioContext();
      }

      return self;
    },

    /**
     * Check for codec support of specific extension.
     * @param  {String} ext Audio file extention.
     * @return {Boolean}
     */
    codecs: function(ext) {
      return (this || Howler)._codecs[ext];
    },

    /**
     * Setup various state values for global tracking.
     * @return {Howler}
     */
    _setup: function() {
      var self = this || Howler;

      // Keeps track of the suspend/resume state of the AudioContext.
      self.state = self.ctx ? self.ctx.state || 'running' : 'running';

      // Automatically begin the 30-second suspend process
      self._autoSuspend();

      // Check for supported codecs.
      if (!self.noAudio) {
        self._setupCodecs();
      }

      return self;
    },

    /**
     * Check for browser support for various codecs and cache the results.
     * @return {Howler}
     */
    _setupCodecs: function() {
      var self = this || Howler;
      var audioTest = (typeof Audio !== 'undefined') ? new Audio() : null;

      if (!audioTest || typeof audioTest.canPlayType !== 'function') {
        return self;
      }

      var mpegTest = audioTest.canPlayType('audio/mpeg;').replace(/^no$/, '');

      // Opera version <33 has mixed MP3 support, so we need to check for and block it.
      var checkOpera = self._navigator && self._navigator.userAgent.match(/OPR\/([0-6].)/g);
      var isOldOpera = (checkOpera && parseInt(checkOpera[0].split('/')[1], 10) < 33);

      self._codecs = {
        mp3: !!(!isOldOpera && (mpegTest || audioTest.canPlayType('audio/mp3;').replace(/^no$/, ''))),
        mpeg: !!mpegTest,
        opus: !!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/, ''),
        ogg: !!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ''),
        oga: !!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ''),
        wav: !!audioTest.canPlayType('audio/wav; codecs="1"').replace(/^no$/, ''),
        aac: !!audioTest.canPlayType('audio/aac;').replace(/^no$/, ''),
        caf: !!audioTest.canPlayType('audio/x-caf;').replace(/^no$/, ''),
        m4a: !!(audioTest.canPlayType('audio/x-m4a;') || audioTest.canPlayType('audio/m4a;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),
        mp4: !!(audioTest.canPlayType('audio/x-mp4;') || audioTest.canPlayType('audio/mp4;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),
        weba: !!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ''),
        webm: !!audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, ''),
        dolby: !!audioTest.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/, '')
      };

      return self;
    },

    /**
     * Mobile browsers will only allow audio to be played after a user interaction.
     * Attempt to automatically unlock audio on the first user interaction.
     * Concept from: http://paulbakaus.com/tutorials/html5/web-audio-on-ios/
     * @return {Howler}
     */
    _enableMobileAudio: function() {
      var self = this || Howler;

      // Only run this on mobile devices if audio isn't already eanbled.
      var isMobile = /iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(self._navigator && self._navigator.userAgent);
      var isTouch = !!(('ontouchend' in window) || (self._navigator && self._navigator.maxTouchPoints > 0) || (self._navigator && self._navigator.msMaxTouchPoints > 0));
      if (self._mobileEnabled || !self.ctx || (!isMobile && !isTouch)) {
        return;
      }

      self._mobileEnabled = false;

      // Some mobile devices/platforms have distortion issues when opening/closing tabs and/or web views.
      // Bugs in the browser (especially Mobile Safari) can cause the sampleRate to change from 44100 to 48000.
      // By calling Howler.unload(), we create a new AudioContext with the correct sampleRate.
      if (!self._mobileUnloaded && self.ctx.sampleRate !== 44100) {
        self._mobileUnloaded = true;
        self.unload();
      }

      // Scratch buffer for enabling iOS to dispose of web audio buffers correctly, as per:
      // http://stackoverflow.com/questions/24119684
      self._scratchBuffer = self.ctx.createBuffer(1, 1, 22050);

      // Call this method on touch start to create and play a buffer,
      // then check if the audio actually played to determine if
      // audio has now been unlocked on iOS, Android, etc.
      var unlock = function() {
        // Create an empty buffer.
        var source = self.ctx.createBufferSource();
        source.buffer = self._scratchBuffer;
        source.connect(self.ctx.destination);

        // Play the empty buffer.
        if (typeof source.start === 'undefined') {
          source.noteOn(0);
        } else {
          source.start(0);
        }

        // Setup a timeout to check that we are unlocked on the next event loop.
        source.onended = function() {
          source.disconnect(0);

          // Update the unlocked state and prevent this check from happening again.
          self._mobileEnabled = true;
          self.mobileAutoEnable = false;

          // Remove the touch start listener.
          document.removeEventListener('touchend', unlock, true);
        };
      };

      // Setup a touch start listener to attempt an unlock in.
      document.addEventListener('touchend', unlock, true);

      return self;
    },

    /**
     * Automatically suspend the Web Audio AudioContext after no sound has played for 30 seconds.
     * This saves processing/energy and fixes various browser-specific bugs with audio getting stuck.
     * @return {Howler}
     */
    _autoSuspend: function() {
      var self = this;

      if (!self.autoSuspend || !self.ctx || typeof self.ctx.suspend === 'undefined' || !Howler.usingWebAudio) {
        return;
      }

      // Check if any sounds are playing.
      for (var i=0; i<self._howls.length; i++) {
        if (self._howls[i]._webAudio) {
          for (var j=0; j<self._howls[i]._sounds.length; j++) {
            if (!self._howls[i]._sounds[j]._paused) {
              return self;
            }
          }
        }
      }

      if (self._suspendTimer) {
        clearTimeout(self._suspendTimer);
      }

      // If no sound has played after 30 seconds, suspend the context.
      self._suspendTimer = setTimeout(function() {
        if (!self.autoSuspend) {
          return;
        }

        self._suspendTimer = null;
        self.state = 'suspending';
        self.ctx.suspend().then(function() {
          self.state = 'suspended';

          if (self._resumeAfterSuspend) {
            delete self._resumeAfterSuspend;
            self._autoResume();
          }
        });
      }, 30000);

      return self;
    },

    /**
     * Automatically resume the Web Audio AudioContext when a new sound is played.
     * @return {Howler}
     */
    _autoResume: function() {
      var self = this;

      if (!self.ctx || typeof self.ctx.resume === 'undefined' || !Howler.usingWebAudio) {
        return;
      }

      if (self.state === 'running' && self._suspendTimer) {
        clearTimeout(self._suspendTimer);
        self._suspendTimer = null;
      } else if (self.state === 'suspended') {
        self.state = 'resuming';
        self.ctx.resume().then(function() {
          self.state = 'running';
        });

        if (self._suspendTimer) {
          clearTimeout(self._suspendTimer);
          self._suspendTimer = null;
        }
      } else if (self.state === 'suspending') {
        self._resumeAfterSuspend = true;
      }

      return self;
    }
  };

  // Setup the global audio controller.
  var Howler = new HowlerGlobal();

  /** Group Methods **/
  /***************************************************************************/

  /**
   * Create an audio group controller.
   * @param {Object} o Passed in properties for this group.
   */
  var Howl = function(o) {
    var self = this;

    // Throw an error if no source is provided.
    if (!o.src || o.src.length === 0) {
      console.error('An array of source files must be passed with any new Howl.');
      return;
    }

    self.init(o);
  };
  Howl.prototype = {
    /**
     * Initialize a new Howl group object.
     * @param  {Object} o Passed in properties for this group.
     * @return {Howl}
     */
    init: function(o) {
      var self = this;

      // If we don't have an AudioContext created yet, run the setup.
      if (!Howler.ctx) {
        setupAudioContext();
      }

      // Setup user-defined default properties.
      self._autoplay = o.autoplay || false;
      self._format = (typeof o.format !== 'string') ? o.format : [o.format];
      self._html5 = o.html5 || false;
      self._muted = o.mute || false;
      self._loop = o.loop || false;
      self._pool = o.pool || 5;
      self._preload = (typeof o.preload === 'boolean') ? o.preload : true;
      self._rate = o.rate || 1;
      self._sprite = o.sprite || {};
      self._src = (typeof o.src !== 'string') ? o.src : [o.src];
      self._volume = o.volume !== undefined ? o.volume : 1;

      // Setup all other default properties.
      self._duration = 0;
      self._state = 'unloaded';
      self._sounds = [];
      self._endTimers = {};
      self._queue = [];

      // Setup event listeners.
      self._onend = o.onend ? [{fn: o.onend}] : [];
      self._onfade = o.onfade ? [{fn: o.onfade}] : [];
      self._onload = o.onload ? [{fn: o.onload}] : [];
      self._onloaderror = o.onloaderror ? [{fn: o.onloaderror}] : [];
      self._onpause = o.onpause ? [{fn: o.onpause}] : [];
      self._onplay = o.onplay ? [{fn: o.onplay}] : [];
      self._onstop = o.onstop ? [{fn: o.onstop}] : [];
      self._onmute = o.onmute ? [{fn: o.onmute}] : [];
      self._onvolume = o.onvolume ? [{fn: o.onvolume}] : [];
      self._onrate = o.onrate ? [{fn: o.onrate}] : [];
      self._onseek = o.onseek ? [{fn: o.onseek}] : [];

      // Web Audio or HTML5 Audio?
      self._webAudio = Howler.usingWebAudio && !self._html5;

      // Automatically try to enable audio on iOS.
      if (typeof Howler.ctx !== 'undefined' && Howler.ctx && Howler.mobileAutoEnable) {
        Howler._enableMobileAudio();
      }

      // Keep track of this Howl group in the global controller.
      Howler._howls.push(self);

      // Load the source file unless otherwise specified.
      if (self._preload) {
        self.load();
      }

      return self;
    },

    /**
     * Load the audio file.
     * @return {Howler}
     */
    load: function() {
      var self = this;
      var url = null;

      // If no audio is available, quit immediately.
      if (Howler.noAudio) {
        self._emit('loaderror', null, 'No audio support.');
        return;
      }

      // Make sure our source is in an array.
      if (typeof self._src === 'string') {
        self._src = [self._src];
      }

      // Loop through the sources and pick the first one that is compatible.
      for (var i=0; i<self._src.length; i++) {
        var ext, str;

        if (self._format && self._format[i]) {
          // If an extension was specified, use that instead.
          ext = self._format[i];
        } else {
          // Make sure the source is a string.
          str = self._src[i];
          if (typeof str !== 'string') {
            self._emit('loaderror', null, 'Non-string found in selected audio sources - ignoring.');
            continue;
          }

          // Extract the file extension from the URL or base64 data URI.
          ext = /^data:audio\/([^;,]+);/i.exec(str);
          if (!ext) {
            ext = /\.([^.]+)$/.exec(str.split('?', 1)[0]);
          }

          if (ext) {
            ext = ext[1].toLowerCase();
          }
        }

        // Check if this extension is available.
        if (Howler.codecs(ext)) {
          url = self._src[i];
          break;
        }
      }

      if (!url) {
        self._emit('loaderror', null, 'No codec support for selected audio sources.');
        return;
      }

      self._src = url;
      self._state = 'loading';

      // If the hosting page is HTTPS and the source isn't,
      // drop down to HTML5 Audio to avoid Mixed Content errors.
      if (window.location.protocol === 'https:' && url.slice(0, 5) === 'http:') {
        self._html5 = true;
        self._webAudio = false;
      }

      // Create a new sound object and add it to the pool.
      new Sound(self);

      // Load and decode the audio data for playback.
      if (self._webAudio) {
        loadBuffer(self);
      }

      return self;
    },

    /**
     * Play a sound or resume previous playback.
     * @param  {String/Number} sprite   Sprite name for sprite playback or sound id to continue previous.
     * @param  {Boolean} internal Internal Use: true prevents event firing.
     * @return {Number}          Sound ID.
     */
    play: function(sprite, internal) {
      var self = this;
      var id = null;

      // Determine if a sprite, sound id or nothing was passed
      if (typeof sprite === 'number') {
        id = sprite;
        sprite = null;
      } else if (typeof sprite === 'string' && self._state === 'loaded' && !self._sprite[sprite]) {
        // If the passed sprite doesn't exist, do nothing.
        return null;
      } else if (typeof sprite === 'undefined') {
        // Use the default sound sprite (plays the full audio length).
        sprite = '__default';

        // Check if there is a single paused sound that isn't ended.
        // If there is, play that sound. If not, continue as usual.
        var num = 0;
        for (var i=0; i<self._sounds.length; i++) {
          if (self._sounds[i]._paused && !self._sounds[i]._ended) {
            num++;
            id = self._sounds[i]._id;
          }
        }

        if (num === 1) {
          sprite = null;
        } else {
          id = null;
        }
      }

      // Get the selected node, or get one from the pool.
      var sound = id ? self._soundById(id) : self._inactiveSound();

      // If the sound doesn't exist, do nothing.
      if (!sound) {
        return null;
      }

      // Select the sprite definition.
      if (id && !sprite) {
        sprite = sound._sprite || '__default';
      }

      // If we have no sprite and the sound hasn't loaded, we must wait
      // for the sound to load to get our audio's duration.
      if (self._state !== 'loaded' && !self._sprite[sprite]) {
        self._queue.push({
          event: 'play',
          action: function() {
            self.play(self._soundById(sound._id) ? sound._id : undefined);
          }
        });

        return sound._id;
      }

      // Don't play the sound if an id was passed and it is already playing.
      if (id && !sound._paused) {
        // Trigger the play event, in order to keep iterating through queue.
        if (!internal) {
          setTimeout(function() {
            self._emit('play', sound._id);
          }, 0);
        }

        return sound._id;
      }

      // Make sure the AudioContext isn't suspended, and resume it if it is.
      if (self._webAudio) {
        Howler._autoResume();
      }

      // Determine how long to play for and where to start playing.
      var seek = sound._seek > 0 ? sound._seek : self._sprite[sprite][0] / 1000;
      var duration = ((self._sprite[sprite][0] + self._sprite[sprite][1]) / 1000) - seek;
      var timeout = (duration * 1000) / Math.abs(sound._rate);

      // Update the parameters of the sound
      sound._paused = false;
      sound._ended = false;
      sound._sprite = sprite;
      sound._seek = seek;
      sound._start = self._sprite[sprite][0] / 1000;
      sound._stop = (self._sprite[sprite][0] + self._sprite[sprite][1]) / 1000;
      sound._loop = !!(sound._loop || self._sprite[sprite][2]);

      // Begin the actual playback.
      var node = sound._node;
      if (self._webAudio) {
        // Fire this when the sound is ready to play to begin Web Audio playback.
        var playWebAudio = function() {
          self._refreshBuffer(sound);

          // Setup the playback params.
          var vol = (sound._muted || self._muted) ? 0 : sound._volume;
          node.gain.setValueAtTime(vol, Howler.ctx.currentTime);
          sound._playStart = Howler.ctx.currentTime;

          // Play the sound using the supported method.
          if (typeof node.bufferSource.start === 'undefined') {
            sound._loop ? node.bufferSource.noteGrainOn(0, seek, 86400) : node.bufferSource.noteGrainOn(0, seek, duration);
          } else {
            sound._loop ? node.bufferSource.start(0, seek, 86400) : node.bufferSource.start(0, seek, duration);
          }

          // Start a new timer if none is present.
          if (timeout !== Infinity) {
            self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);
          }

          if (!internal) {
            setTimeout(function() {
              self._emit('play', sound._id);
            }, 0);
          }
        };

        if (self._state === 'loaded') {
          playWebAudio();
        } else {
          // Wait for the audio to load and then begin playback.
          self.once('load', playWebAudio, sound._id);

          // Cancel the end timer.
          self._clearTimer(sound._id);
        }
      } else {
        // Fire this when the sound is ready to play to begin HTML5 Audio playback.
        var playHtml5 = function() {
          node.currentTime = seek;
          node.muted = sound._muted || self._muted || Howler._muted || node.muted;
          node.volume = sound._volume * Howler.volume();
          node.playbackRate = sound._rate;

          setTimeout(function() {
            node.play();

            // Setup the new end timer.
            if (timeout !== Infinity) {
              self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);
            }

            if (!internal) {
              self._emit('play', sound._id);
            }
          }, 0);
        };

        // Play immediately if ready, or wait for the 'canplaythrough'e vent.
        var loadedNoReadyState = (self._state === 'loaded' && (window && window.ejecta || !node.readyState && Howler._navigator.isCocoonJS));
        if (node.readyState === 4 || loadedNoReadyState) {
          playHtml5();
        } else {
          var listener = function() {
            // Begin playback.
            playHtml5();

            // Clear this listener.
            node.removeEventListener(Howler._canPlayEvent, listener, false);
          };
          node.addEventListener(Howler._canPlayEvent, listener, false);

          // Cancel the end timer.
          self._clearTimer(sound._id);
        }
      }

      return sound._id;
    },

    /**
     * Pause playback and save current position.
     * @param  {Number} id The sound ID (empty to pause all in group).
     * @return {Howl}
     */
    pause: function(id) {
      var self = this;

      // If the sound hasn't loaded, add it to the load queue to pause when capable.
      if (self._state !== 'loaded') {
        self._queue.push({
          event: 'pause',
          action: function() {
            self.pause(id);
          }
        });

        return self;
      }

      // If no id is passed, get all ID's to be paused.
      var ids = self._getSoundIds(id);

      for (var i=0; i<ids.length; i++) {
        // Clear the end timer.
        self._clearTimer(ids[i]);

        // Get the sound.
        var sound = self._soundById(ids[i]);

        if (sound && !sound._paused) {
          // Reset the seek position.
          sound._seek = self.seek(ids[i]);
          sound._rateSeek = 0;
          sound._paused = true;

          // Stop currently running fades.
          self._stopFade(ids[i]);

          if (sound._node) {
            if (self._webAudio) {
              // make sure the sound has been created
              if (!sound._node.bufferSource) {
                return self;
              }

              if (typeof sound._node.bufferSource.stop === 'undefined') {
                sound._node.bufferSource.noteOff(0);
              } else {
                sound._node.bufferSource.stop(0);
              }

              // Clean up the buffer source.
              self._cleanBuffer(sound._node);
            } else if (!isNaN(sound._node.duration) || sound._node.duration === Infinity) {
              sound._node.pause();
            }
          }

          // Fire the pause event, unless `true` is passed as the 2nd argument.
          if (!arguments[1]) {
            self._emit('pause', sound._id);
          }
        }
      }

      return self;
    },

    /**
     * Stop playback and reset to start.
     * @param  {Number} id The sound ID (empty to stop all in group).
     * @param  {Boolean} internal Internal Use: true prevents event firing.
     * @return {Howl}
     */
    stop: function(id, internal) {
      var self = this;

      // If the sound hasn't loaded, add it to the load queue to stop when capable.
      if (self._state !== 'loaded') {
        self._queue.push({
          event: 'stop',
          action: function() {
            self.stop(id);
          }
        });

        return self;
      }

      // If no id is passed, get all ID's to be stopped.
      var ids = self._getSoundIds(id);

      for (var i=0; i<ids.length; i++) {
        // Clear the end timer.
        self._clearTimer(ids[i]);

        // Get the sound.
        var sound = self._soundById(ids[i]);

        if (sound && !sound._paused) {
          // Reset the seek position.
          sound._seek = sound._start || 0;
          sound._rateSeek = 0;
          sound._paused = true;
          sound._ended = true;

          // Stop currently running fades.
          self._stopFade(ids[i]);

          if (sound._node) {
            if (self._webAudio) {
              // make sure the sound has been created
              if (!sound._node.bufferSource) {
                return self;
              }

              if (typeof sound._node.bufferSource.stop === 'undefined') {
                sound._node.bufferSource.noteOff(0);
              } else {
                sound._node.bufferSource.stop(0);
              }

              // Clean up the buffer source.
              self._cleanBuffer(sound._node);
            } else if (!isNaN(sound._node.duration) || sound._node.duration === Infinity) {
              sound._node.currentTime = sound._start || 0;
              sound._node.pause();
            }
          }
        }

        if (sound && !internal) {
          self._emit('stop', sound._id);
        }
      }

      return self;
    },

    /**
     * Mute/unmute a single sound or all sounds in this Howl group.
     * @param  {Boolean} muted Set to true to mute and false to unmute.
     * @param  {Number} id    The sound ID to update (omit to mute/unmute all).
     * @return {Howl}
     */
    mute: function(muted, id) {
      var self = this;

      // If the sound hasn't loaded, add it to the load queue to mute when capable.
      if (self._state !== 'loaded') {
        self._queue.push({
          event: 'mute',
          action: function() {
            self.mute(muted, id);
          }
        });

        return self;
      }

      // If applying mute/unmute to all sounds, update the group's value.
      if (typeof id === 'undefined') {
        if (typeof muted === 'boolean') {
          self._muted = muted;
        } else {
          return self._muted;
        }
      }

      // If no id is passed, get all ID's to be muted.
      var ids = self._getSoundIds(id);

      for (var i=0; i<ids.length; i++) {
        // Get the sound.
        var sound = self._soundById(ids[i]);

        if (sound) {
          sound._muted = muted;

          if (self._webAudio && sound._node) {
            sound._node.gain.setValueAtTime(muted ? 0 : sound._volume, Howler.ctx.currentTime);
          } else if (sound._node) {
            sound._node.muted = Howler._muted ? true : muted;
          }

          self._emit('mute', sound._id);
        }
      }

      return self;
    },

    /**
     * Get/set the volume of this sound or of the Howl group. This method can optionally take 0, 1 or 2 arguments.
     *   volume() -> Returns the group's volume value.
     *   volume(id) -> Returns the sound id's current volume.
     *   volume(vol) -> Sets the volume of all sounds in this Howl group.
     *   volume(vol, id) -> Sets the volume of passed sound id.
     * @return {Howl/Number} Returns self or current volume.
     */
    volume: function() {
      var self = this;
      var args = arguments;
      var vol, id;

      // Determine the values based on arguments.
      if (args.length === 0) {
        // Return the value of the groups' volume.
        return self._volume;
      } else if (args.length === 1) {
        // First check if this is an ID, and if not, assume it is a new volume.
        var ids = self._getSoundIds();
        var index = ids.indexOf(args[0]);
        if (index >= 0) {
          id = parseInt(args[0], 10);
        } else {
          vol = parseFloat(args[0]);
        }
      } else if (args.length >= 2) {
        vol = parseFloat(args[0]);
        id = parseInt(args[1], 10);
      }

      // Update the volume or return the current volume.
      var sound;
      if (typeof vol !== 'undefined' && vol >= 0 && vol <= 1) {
        // If the sound hasn't loaded, add it to the load queue to change volume when capable.
        if (self._state !== 'loaded') {
          self._queue.push({
            event: 'volume',
            action: function() {
              self.volume.apply(self, args);
            }
          });

          return self;
        }

        // Set the group volume.
        if (typeof id === 'undefined') {
          self._volume = vol;
        }

        // Update one or all volumes.
        id = self._getSoundIds(id);
        for (var i=0; i<id.length; i++) {
          // Get the sound.
          sound = self._soundById(id[i]);

          if (sound) {
            sound._volume = vol;

            // Stop currently running fades.
            if (!args[2]) {
              self._stopFade(id[i]);
            }

            if (self._webAudio && sound._node && !sound._muted) {
              sound._node.gain.setValueAtTime(vol, Howler.ctx.currentTime);
            } else if (sound._node && !sound._muted) {
              sound._node.volume = vol * Howler.volume();
            }

            self._emit('volume', sound._id);
          }
        }
      } else {
        sound = id ? self._soundById(id) : self._sounds[0];
        return sound ? sound._volume : 0;
      }

      return self;
    },

    /**
     * Fade a currently playing sound between two volumes (if no id is passsed, all sounds will fade).
     * @param  {Number} from The value to fade from (0.0 to 1.0).
     * @param  {Number} to   The volume to fade to (0.0 to 1.0).
     * @param  {Number} len  Time in milliseconds to fade.
     * @param  {Number} id   The sound id (omit to fade all sounds).
     * @return {Howl}
     */
    fade: function(from, to, len, id) {
      var self = this;
      var diff = Math.abs(from - to);
      var dir = from > to ? 'out' : 'in';
      var steps = diff / 0.01;
      var stepLen = len / steps;

      // If the sound hasn't loaded, add it to the load queue to fade when capable.
      if (self._state !== 'loaded') {
        self._queue.push({
          event: 'fade',
          action: function() {
            self.fade(from, to, len, id);
          }
        });

        return self;
      }

      // Set the volume to the start position.
      self.volume(from, id);

      // Fade the volume of one or all sounds.
      var ids = self._getSoundIds(id);
      for (var i=0; i<ids.length; i++) {
        // Get the sound.
        var sound = self._soundById(ids[i]);

        // Create a linear fade or fall back to timeouts with HTML5 Audio.
        if (sound) {
          // Stop the previous fade if no sprite is being used (otherwise, volume handles this).
          if (!id) {
            self._stopFade(ids[i]);
          }

          // If we are using Web Audio, let the native methods do the actual fade.
          if (self._webAudio && !sound._muted) {
            var currentTime = Howler.ctx.currentTime;
            var end = currentTime + (len / 1000);
            sound._volume = from;
            sound._node.gain.setValueAtTime(from, currentTime);
            sound._node.gain.linearRampToValueAtTime(to, end);
          }

          var vol = from;
          sound._interval = setInterval(function(soundId, sound) {
            // Update the volume amount.
            vol += (dir === 'in' ? 0.01 : -0.01);

            // Make sure the volume is in the right bounds.
            vol = Math.max(0, vol);
            vol = Math.min(1, vol);

            // Round to within 2 decimal points.
            vol = Math.round(vol * 100) / 100;

            // Change the volume.
            if (self._webAudio) {
              if (typeof id === 'undefined') {
                self._volume = vol;
              }

              sound._volume = vol;
            } else {
              self.volume(vol, soundId, true);
            }

            // When the fade is complete, stop it and fire event.
            if (vol === to) {
              clearInterval(sound._interval);
              sound._interval = null;
              self.volume(vol, soundId);
              self._emit('fade', soundId);
            }
          }.bind(self, ids[i], sound), stepLen);
        }
      }

      return self;
    },

    /**
     * Internal method that stops the currently playing fade when
     * a new fade starts, volume is changed or the sound is stopped.
     * @param  {Number} id The sound id.
     * @return {Howl}
     */
    _stopFade: function(id) {
      var self = this;
      var sound = self._soundById(id);

      if (sound && sound._interval) {
        if (self._webAudio) {
          sound._node.gain.cancelScheduledValues(Howler.ctx.currentTime);
        }

        clearInterval(sound._interval);
        sound._interval = null;
        self._emit('fade', id);
      }

      return self;
    },

    /**
     * Get/set the loop parameter on a sound. This method can optionally take 0, 1 or 2 arguments.
     *   loop() -> Returns the group's loop value.
     *   loop(id) -> Returns the sound id's loop value.
     *   loop(loop) -> Sets the loop value for all sounds in this Howl group.
     *   loop(loop, id) -> Sets the loop value of passed sound id.
     * @return {Howl/Boolean} Returns self or current loop value.
     */
    loop: function() {
      var self = this;
      var args = arguments;
      var loop, id, sound;

      // Determine the values for loop and id.
      if (args.length === 0) {
        // Return the grou's loop value.
        return self._loop;
      } else if (args.length === 1) {
        if (typeof args[0] === 'boolean') {
          loop = args[0];
          self._loop = loop;
        } else {
          // Return this sound's loop value.
          sound = self._soundById(parseInt(args[0], 10));
          return sound ? sound._loop : false;
        }
      } else if (args.length === 2) {
        loop = args[0];
        id = parseInt(args[1], 10);
      }

      // If no id is passed, get all ID's to be looped.
      var ids = self._getSoundIds(id);
      for (var i=0; i<ids.length; i++) {
        sound = self._soundById(ids[i]);

        if (sound) {
          sound._loop = loop;
          if (self._webAudio && sound._node && sound._node.bufferSource) {
            sound._node.bufferSource.loop = loop;
          }
        }
      }

      return self;
    },

    /**
     * Get/set the playback rate of a sound. This method can optionally take 0, 1 or 2 arguments.
     *   rate() -> Returns the first sound node's current playback rate.
     *   rate(id) -> Returns the sound id's current playback rate.
     *   rate(rate) -> Sets the playback rate of all sounds in this Howl group.
     *   rate(rate, id) -> Sets the playback rate of passed sound id.
     * @return {Howl/Number} Returns self or the current playback rate.
     */
    rate: function() {
      var self = this;
      var args = arguments;
      var rate, id;

      // Determine the values based on arguments.
      if (args.length === 0) {
        // We will simply return the current rate of the first node.
        id = self._sounds[0]._id;
      } else if (args.length === 1) {
        // First check if this is an ID, and if not, assume it is a new rate value.
        var ids = self._getSoundIds();
        var index = ids.indexOf(args[0]);
        if (index >= 0) {
          id = parseInt(args[0], 10);
        } else {
          rate = parseFloat(args[0]);
        }
      } else if (args.length === 2) {
        rate = parseFloat(args[0]);
        id = parseInt(args[1], 10);
      }

      // Update the playback rate or return the current value.
      var sound;
      if (typeof rate === 'number') {
        // If the sound hasn't loaded, add it to the load queue to change playback rate when capable.
        if (self._state !== 'loaded') {
          self._queue.push({
            event: 'rate',
            action: function() {
              self.rate.apply(self, args);
            }
          });

          return self;
        }

        // Set the group rate.
        if (typeof id === 'undefined') {
          self._rate = rate;
        }

        // Update one or all volumes.
        id = self._getSoundIds(id);
        for (var i=0; i<id.length; i++) {
          // Get the sound.
          sound = self._soundById(id[i]);

          if (sound) {
            // Keep track of our position when the rate changed and update the playback
            // start position so we can properly adjust the seek position for time elapsed.
            sound._rateSeek = self.seek(id[i]);
            sound._playStart = self._webAudio ? Howler.ctx.currentTime : sound._playStart;
            sound._rate = rate;

            // Change the playback rate.
            if (self._webAudio && sound._node && sound._node.bufferSource) {
              sound._node.bufferSource.playbackRate.value = rate;
            } else if (sound._node) {
              sound._node.playbackRate = rate;
            }

            // Reset the timers.
            var seek = self.seek(id[i]);
            var duration = ((self._sprite[sound._sprite][0] + self._sprite[sound._sprite][1]) / 1000) - seek;
            var timeout = (duration * 1000) / Math.abs(sound._rate);

            // Start a new end timer if sound is already playing.
            if (self._endTimers[id[i]] || !sound._paused) {
              self._clearTimer(id[i]);
              self._endTimers[id[i]] = setTimeout(self._ended.bind(self, sound), timeout);
            }

            self._emit('rate', sound._id);
          }
        }
      } else {
        sound = self._soundById(id);
        return sound ? sound._rate : self._rate;
      }

      return self;
    },

    /**
     * Get/set the seek position of a sound. This method can optionally take 0, 1 or 2 arguments.
     *   seek() -> Returns the first sound node's current seek position.
     *   seek(id) -> Returns the sound id's current seek position.
     *   seek(seek) -> Sets the seek position of the first sound node.
     *   seek(seek, id) -> Sets the seek position of passed sound id.
     * @return {Howl/Number} Returns self or the current seek position.
     */
    seek: function() {
      var self = this;
      var args = arguments;
      var seek, id;

      // Determine the values based on arguments.
      if (args.length === 0) {
        // We will simply return the current position of the first node.
        id = self._sounds[0]._id;
      } else if (args.length === 1) {
        // First check if this is an ID, and if not, assume it is a new seek position.
        var ids = self._getSoundIds();
        var index = ids.indexOf(args[0]);
        if (index >= 0) {
          id = parseInt(args[0], 10);
        } else {
          id = self._sounds[0]._id;
          seek = parseFloat(args[0]);
        }
      } else if (args.length === 2) {
        seek = parseFloat(args[0]);
        id = parseInt(args[1], 10);
      }

      // If there is no ID, bail out.
      if (typeof id === 'undefined') {
        return self;
      }

      // If the sound hasn't loaded, add it to the load queue to seek when capable.
      if (self._state !== 'loaded') {
        self._queue.push({
          event: 'seek',
          action: function() {
            self.seek.apply(self, args);
          }
        });

        return self;
      }

      // Get the sound.
      var sound = self._soundById(id);

      if (sound) {
        if (typeof seek === 'number' && seek >= 0) {
          // Pause the sound and update position for restarting playback.
          var playing = self.playing(id);
          if (playing) {
            self.pause(id, true);
          }

          // Move the position of the track and cancel timer.
          sound._seek = seek;
          sound._ended = false;
          self._clearTimer(id);

          // Restart the playback if the sound was playing.
          if (playing) {
            self.play(id, true);
          }

          // Update the seek position for HTML5 Audio.
          if (!self._webAudio && sound._node) {
            sound._node.currentTime = seek;
          }

          self._emit('seek', id);
        } else {
          if (self._webAudio) {
            var realTime = self.playing(id) ? Howler.ctx.currentTime - sound._playStart : 0;
            var rateSeek = sound._rateSeek ? sound._rateSeek - sound._seek : 0;
            return sound._seek + (rateSeek + realTime * Math.abs(sound._rate));
          } else {
            return sound._node.currentTime;
          }
        }
      }

      return self;
    },

    /**
     * Check if a specific sound is currently playing or not (if id is provided), or check if at least one of the sounds in the group is playing or not.
     * @param  {Number}  id The sound id to check. If none is passed, the whole sound group is checked.
     * @return {Boolean} True if playing and false if not.
     */
    playing: function(id) {
      var self = this;

      // Check the passed sound ID (if any).
      if (typeof id === 'number') {
        var sound = self._soundById(id);
        return sound ? !sound._paused : false;
      }

      // Otherwise, loop through all sounds and check if any are playing.
      for (var i=0; i<self._sounds.length; i++) {
        if (!self._sounds[i]._paused) {
          return true;
        }
      }

      return false;
    },

    /**
     * Get the duration of this sound. Passing a sound id will return the sprite duration.
     * @param  {Number} id The sound id to check. If none is passed, return full source duration.
     * @return {Number} Audio duration in seconds.
     */
    duration: function(id) {
      var self = this;
      var duration = self._duration;

      // If we pass an ID, get the sound and return the sprite length.
      var sound = self._soundById(id);
      if (sound) {
        duration = self._sprite[sound._sprite][1] / 1000;
      }

      return duration;
    },

    /**
     * Returns the current loaded state of this Howl.
     * @return {String} 'unloaded', 'loading', 'loaded'
     */
    state: function() {
      return this._state;
    },

    /**
     * Unload and destroy the current Howl object.
     * This will immediately stop all sound instances attached to this group.
     */
    unload: function() {
      var self = this;

      // Stop playing any active sounds.
      var sounds = self._sounds;
      for (var i=0; i<sounds.length; i++) {
        // Stop the sound if it is currently playing.
        if (!sounds[i]._paused) {
          self.stop(sounds[i]._id);
          self._emit('end', sounds[i]._id);
        }

        // Remove the source or disconnect.
        if (!self._webAudio) {
          // Set the source to 0-second silence to stop any downloading.
          sounds[i]._node.src = 'data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=';

          // Remove any event listeners.
          sounds[i]._node.removeEventListener('error', sounds[i]._errorFn, false);
          sounds[i]._node.removeEventListener(Howler._canPlayEvent, sounds[i]._loadFn, false);
        }

        // Empty out all of the nodes.
        delete sounds[i]._node;

        // Make sure all timers are cleared out.
        self._clearTimer(sounds[i]._id);

        // Remove the references in the global Howler object.
        var index = Howler._howls.indexOf(self);
        if (index >= 0) {
          Howler._howls.splice(index, 1);
        }
      }

      // Delete this sound from the cache (if no other Howl is using it).
      var remCache = true;
      for (i=0; i<Howler._howls.length; i++) {
        if (Howler._howls[i]._src === self._src) {
          remCache = false;
          break;
        }
      }

      if (cache && remCache) {
        delete cache[self._src];
      }

      // Clear out `self`.
      self._state = 'unloaded';
      self._sounds = [];
      self = null;

      return null;
    },

    /**
     * Listen to a custom event.
     * @param  {String}   event Event name.
     * @param  {Function} fn    Listener to call.
     * @param  {Number}   id    (optional) Only listen to events for this sound.
     * @param  {Number}   once  (INTERNAL) Marks event to fire only once.
     * @return {Howl}
     */
    on: function(event, fn, id, once) {
      var self = this;
      var events = self['_on' + event];

      if (typeof fn === 'function') {
        events.push(once ? {id: id, fn: fn, once: once} : {id: id, fn: fn});
      }

      return self;
    },

    /**
     * Remove a custom event. Call without parameters to remove all events.
     * @param  {String}   event Event name.
     * @param  {Function} fn    Listener to remove. Leave empty to remove all.
     * @param  {Number}   id    (optional) Only remove events for this sound.
     * @return {Howl}
     */
    off: function(event, fn, id) {
      var self = this;
      var events = self['_on' + event];
      var i = 0;

      if (fn) {
        // Loop through event store and remove the passed function.
        for (i=0; i<events.length; i++) {
          if (fn === events[i].fn && id === events[i].id) {
            events.splice(i, 1);
            break;
          }
        }
      } else if (event) {
        // Clear out all events of this type.
        self['_on' + event] = [];
      } else {
        // Clear out all events of every type.
        var keys = Object.keys(self);
        for (i=0; i<keys.length; i++) {
          if ((keys[i].indexOf('_on') === 0) && Array.isArray(self[keys[i]])) {
            self[keys[i]] = [];
          }
        }
      }

      return self;
    },

    /**
     * Listen to a custom event and remove it once fired.
     * @param  {String}   event Event name.
     * @param  {Function} fn    Listener to call.
     * @param  {Number}   id    (optional) Only listen to events for this sound.
     * @return {Howl}
     */
    once: function(event, fn, id) {
      var self = this;

      // Setup the event listener.
      self.on(event, fn, id, 1);

      return self;
    },

    /**
     * Emit all events of a specific type and pass the sound id.
     * @param  {String} event Event name.
     * @param  {Number} id    Sound ID.
     * @param  {Number} msg   Message to go with event.
     * @return {Howl}
     */
    _emit: function(event, id, msg) {
      var self = this;
      var events = self['_on' + event];

      // Loop through event store and fire all functions.
      for (var i=events.length-1; i>=0; i--) {
        if (!events[i].id || events[i].id === id || event === 'load') {
          setTimeout(function(fn) {
            fn.call(this, id, msg);
          }.bind(self, events[i].fn), 0);

          // If this event was setup with `once`, remove it.
          if (events[i].once) {
            self.off(event, events[i].fn, events[i].id);
          }
        }
      }

      return self;
    },

    /**
     * Queue of actions initiated before the sound has loaded.
     * These will be called in sequence, with the next only firing
     * after the previous has finished executing (even if async like play).
     * @return {Howl}
     */
    _loadQueue: function() {
      var self = this;

      if (self._queue.length > 0) {
        var task = self._queue[0];

        // don't move onto the next task until this one is done
        self.once(task.event, function() {
          self._queue.shift();
          self._loadQueue();
        });

        task.action();
      }

      return self;
    },

    /**
     * Fired when playback ends at the end of the duration.
     * @param  {Sound} sound The sound object to work with.
     * @return {Howl}
     */
    _ended: function(sound) {
      var self = this;
      var sprite = sound._sprite;

      // Should this sound loop?
      var loop = !!(sound._loop || self._sprite[sprite][2]);

      // Fire the ended event.
      self._emit('end', sound._id);

      // Restart the playback for HTML5 Audio loop.
      if (!self._webAudio && loop) {
        self.stop(sound._id, true).play(sound._id);
      }

      // Restart this timer if on a Web Audio loop.
      if (self._webAudio && loop) {
        self._emit('play', sound._id);
        sound._seek = sound._start || 0;
        sound._rateSeek = 0;
        sound._playStart = Howler.ctx.currentTime;

        var timeout = ((sound._stop - sound._start) * 1000) / Math.abs(sound._rate);
        self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);
      }

      // Mark the node as paused.
      if (self._webAudio && !loop) {
        sound._paused = true;
        sound._ended = true;
        sound._seek = sound._start || 0;
        sound._rateSeek = 0;
        self._clearTimer(sound._id);

        // Clean up the buffer source.
        self._cleanBuffer(sound._node);

        // Attempt to auto-suspend AudioContext if no sounds are still playing.
        Howler._autoSuspend();
      }

      // When using a sprite, end the track.
      if (!self._webAudio && !loop) {
        self.stop(sound._id);
      }

      return self;
    },

    /**
     * Clear the end timer for a sound playback.
     * @param  {Number} id The sound ID.
     * @return {Howl}
     */
    _clearTimer: function(id) {
      var self = this;

      if (self._endTimers[id]) {
        clearTimeout(self._endTimers[id]);
        delete self._endTimers[id];
      }

      return self;
    },

    /**
     * Return the sound identified by this ID, or return null.
     * @param  {Number} id Sound ID
     * @return {Object}    Sound object or null.
     */
    _soundById: function(id) {
      var self = this;

      // Loop through all sounds and find the one with this ID.
      for (var i=0; i<self._sounds.length; i++) {
        if (id === self._sounds[i]._id) {
          return self._sounds[i];
        }
      }

      return null;
    },

    /**
     * Return an inactive sound from the pool or create a new one.
     * @return {Sound} Sound playback object.
     */
    _inactiveSound: function() {
      var self = this;

      self._drain();

      // Find the first inactive node to recycle.
      for (var i=0; i<self._sounds.length; i++) {
        if (self._sounds[i]._ended) {
          return self._sounds[i].reset();
        }
      }

      // If no inactive node was found, create a new one.
      return new Sound(self);
    },

    /**
     * Drain excess inactive sounds from the pool.
     */
    _drain: function() {
      var self = this;
      var limit = self._pool;
      var cnt = 0;
      var i = 0;

      // If there are less sounds than the max pool size, we are done.
      if (self._sounds.length < limit) {
        return;
      }

      // Count the number of inactive sounds.
      for (i=0; i<self._sounds.length; i++) {
        if (self._sounds[i]._ended) {
          cnt++;
        }
      }

      // Remove excess inactive sounds, going in reverse order.
      for (i=self._sounds.length - 1; i>=0; i--) {
        if (cnt <= limit) {
          return;
        }

        if (self._sounds[i]._ended) {
          // Disconnect the audio source when using Web Audio.
          if (self._webAudio && self._sounds[i]._node) {
            self._sounds[i]._node.disconnect(0);
          }

          // Remove sounds until we have the pool size.
          self._sounds.splice(i, 1);
          cnt--;
        }
      }
    },

    /**
     * Get all ID's from the sounds pool.
     * @param  {Number} id Only return one ID if one is passed.
     * @return {Array}    Array of IDs.
     */
    _getSoundIds: function(id) {
      var self = this;

      if (typeof id === 'undefined') {
        var ids = [];
        for (var i=0; i<self._sounds.length; i++) {
          ids.push(self._sounds[i]._id);
        }

        return ids;
      } else {
        return [id];
      }
    },

    /**
     * Load the sound back into the buffer source.
     * @param  {Sound} sound The sound object to work with.
     * @return {Howl}
     */
    _refreshBuffer: function(sound) {
      var self = this;

      // Setup the buffer source for playback.
      sound._node.bufferSource = Howler.ctx.createBufferSource();
      sound._node.bufferSource.buffer = cache[self._src];

      // Connect to the correct node.
      if (sound._panner) {
        sound._node.bufferSource.connect(sound._panner);
      } else {
        sound._node.bufferSource.connect(sound._node);
      }

      // Setup looping and playback rate.
      sound._node.bufferSource.loop = sound._loop;
      if (sound._loop) {
        sound._node.bufferSource.loopStart = sound._start || 0;
        sound._node.bufferSource.loopEnd = sound._stop;
      }
      sound._node.bufferSource.playbackRate.value = sound._rate;

      return self;
    },

    /**
     * Prevent memory leaks by cleaning up the buffer source after playback.
     * @param  {Object} node Sound's audio node containing the buffer source.
     * @return {Howl}
     */
    _cleanBuffer: function(node) {
      var self = this;

      if (self._scratchBuffer) {
        node.bufferSource.onended = null;
        node.bufferSource.disconnect(0);
        try { node.bufferSource.buffer = self._scratchBuffer; } catch(e) {}
      }
      node.bufferSource = null;

      return self;
    }
  };

  /** Single Sound Methods **/
  /***************************************************************************/

  /**
   * Setup the sound object, which each node attached to a Howl group is contained in.
   * @param {Object} howl The Howl parent group.
   */
  var Sound = function(howl) {
    this._parent = howl;
    this.init();
  };
  Sound.prototype = {
    /**
     * Initialize a new Sound object.
     * @return {Sound}
     */
    init: function() {
      var self = this;
      var parent = self._parent;

      // Setup the default parameters.
      self._muted = parent._muted;
      self._loop = parent._loop;
      self._volume = parent._volume;
      self._muted = parent._muted;
      self._rate = parent._rate;
      self._seek = 0;
      self._paused = true;
      self._ended = true;
      self._sprite = '__default';

      // Generate a unique ID for this sound.
      self._id = Math.round(Date.now() * Math.random());

      // Add itself to the parent's pool.
      parent._sounds.push(self);

      // Create the new node.
      self.create();

      return self;
    },

    /**
     * Create and setup a new sound object, whether HTML5 Audio or Web Audio.
     * @return {Sound}
     */
    create: function() {
      var self = this;
      var parent = self._parent;
      var volume = (Howler._muted || self._muted || self._parent._muted) ? 0 : self._volume;

      if (parent._webAudio) {
        // Create the gain node for controlling volume (the source will connect to this).
        self._node = (typeof Howler.ctx.createGain === 'undefined') ? Howler.ctx.createGainNode() : Howler.ctx.createGain();
        self._node.gain.setValueAtTime(volume, Howler.ctx.currentTime);
        self._node.paused = true;
        self._node.connect(Howler.masterGain);
      } else {
        self._node = new Audio();

        // Listen for errors (http://dev.w3.org/html5/spec-author-view/spec.html#mediaerror).
        self._errorFn = self._errorListener.bind(self);
        self._node.addEventListener('error', self._errorFn, false);

        // Listen for 'canplaythrough' event to let us know the sound is ready.
        self._loadFn = self._loadListener.bind(self);
        self._node.addEventListener(Howler._canPlayEvent, self._loadFn, false);

        // Setup the new audio node.
        self._node.src = parent._src;
        self._node.preload = 'auto';
        self._node.volume = volume * Howler.volume();

        // Begin loading the source.
        self._node.load();
      }

      return self;
    },

    /**
     * Reset the parameters of this sound to the original state (for recycle).
     * @return {Sound}
     */
    reset: function() {
      var self = this;
      var parent = self._parent;

      // Reset all of the parameters of this sound.
      self._muted = parent._muted;
      self._loop = parent._loop;
      self._volume = parent._volume;
      self._muted = parent._muted;
      self._rate = parent._rate;
      self._seek = 0;
      self._rateSeek = 0;
      self._paused = true;
      self._ended = true;
      self._sprite = '__default';

      // Generate a new ID so that it isn't confused with the previous sound.
      self._id = Math.round(Date.now() * Math.random());

      return self;
    },

    /**
     * HTML5 Audio error listener callback.
     */
    _errorListener: function() {
      var self = this;

      if (self._node.error && self._node.error.code === 4) {
        Howler.noAudio = true;
      }

      // Fire an error event and pass back the code.
      self._parent._emit('loaderror', self._id, self._node.error ? self._node.error.code : 0);

      // Clear the event listener.
      self._node.removeEventListener('error', self._errorListener, false);
    },

    /**
     * HTML5 Audio canplaythrough listener callback.
     */
    _loadListener: function() {
      var self = this;
      var parent = self._parent;

      // Round up the duration to account for the lower precision in HTML5 Audio.
      parent._duration = Math.ceil(self._node.duration * 10) / 10;

      // Setup a sprite if none is defined.
      if (Object.keys(parent._sprite).length === 0) {
        parent._sprite = {__default: [0, parent._duration * 1000]};
      }

      if (parent._state !== 'loaded') {
        parent._state = 'loaded';
        parent._emit('load');
        parent._loadQueue();
      }

      if (parent._autoplay) {
        parent.play();
      }

      // Clear the event listener.
      self._node.removeEventListener(Howler._canPlayEvent, self._loadFn, false);
    }
  };

  /** Helper Methods **/
  /***************************************************************************/

  var cache = {};

  /**
   * Buffer a sound from URL, Data URI or cache and decode to audio source (Web Audio API).
   * @param  {Howl} self
   */
  var loadBuffer = function(self) {
    var url = self._src;

    // Check if the buffer has already been cached and use it instead.
    if (cache[url]) {
      // Set the duration from the cache.
      self._duration = cache[url].duration;

      // Load the sound into this Howl.
      loadSound(self);

      return;
    }

    if (/^data:[^;]+;base64,/.test(url)) {
      // Decode the base64 data URI without XHR, since some browsers don't support it.
      var data = atob(url.split(',')[1]);
      var dataView = new Uint8Array(data.length);
      for (var i=0; i<data.length; ++i) {
        dataView[i] = data.charCodeAt(i);
      }

      decodeAudioData(dataView.buffer, self);
    } else {
      // Load the buffer from the URL.
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'arraybuffer';
      xhr.onload = function() {
        // Make sure we get a successful response back.
        var code = (xhr.status + '')[0];
        if (code !== '0' && code !== '2' && code !== '3') {
          self._emit('loaderror', null, 'Failed loading audio file with status: ' + xhr.status + '.');
          return;
        }

        decodeAudioData(xhr.response, self);
      };
      xhr.onerror = function() {
        // If there is an error, switch to HTML5 Audio.
        if (self._webAudio) {
          self._html5 = true;
          self._webAudio = false;
          self._sounds = [];
          delete cache[url];
          self.load();
        }
      };
      safeXhrSend(xhr);
    }
  };

  /**
   * Send the XHR request wrapped in a try/catch.
   * @param  {Object} xhr XHR to send.
   */
  var safeXhrSend = function(xhr) {
    try {
      xhr.send();
    } catch (e) {
      xhr.onerror();
    }
  };

  /**
   * Decode audio data from an array buffer.
   * @param  {ArrayBuffer} arraybuffer The audio data.
   * @param  {Howl}        self
   */
  var decodeAudioData = function(arraybuffer, self) {
    // Decode the buffer into an audio source.
    Howler.ctx.decodeAudioData(arraybuffer, function(buffer) {
      if (buffer && self._sounds.length > 0) {
        cache[self._src] = buffer;
        loadSound(self, buffer);
      }
    }, function() {
      self._emit('loaderror', null, 'Decoding audio data failed.');
    });
  };

  /**
   * Sound is now loaded, so finish setting everything up and fire the loaded event.
   * @param  {Howl} self
   * @param  {Object} buffer The decoded buffer sound source.
   */
  var loadSound = function(self, buffer) {
    // Set the duration.
    if (buffer && !self._duration) {
      self._duration = buffer.duration;
    }

    // Setup a sprite if none is defined.
    if (Object.keys(self._sprite).length === 0) {
      self._sprite = {__default: [0, self._duration * 1000]};
    }

    // Fire the loaded event.
    if (self._state !== 'loaded') {
      self._state = 'loaded';
      self._emit('load');
      self._loadQueue();
    }

    // Begin playback if specified.
    if (self._autoplay) {
      self.play();
    }
  };

  /**
   * Setup the audio context when available, or switch to HTML5 Audio mode.
   */
  var setupAudioContext = function() {
    Howler.noAudio = false;

    // Check if we are using Web Audio and setup the AudioContext if we are.
    try {
      if (typeof AudioContext !== 'undefined') {
        Howler.ctx = new AudioContext();
      } else if (typeof webkitAudioContext !== 'undefined') {
        Howler.ctx = new webkitAudioContext();
      } else {
        Howler.usingWebAudio = false;
      }
    } catch(e) {
      Howler.usingWebAudio = false;
    }

    if (!Howler.usingWebAudio) {
      // No audio is available on this system if noAudio is set to true.
      if (typeof Audio !== 'undefined') {
        try {
          var test = new Audio();

          // Check if the canplaythrough event is available.
          if (typeof test.oncanplaythrough === 'undefined') {
            Howler._canPlayEvent = 'canplay';
          }
        } catch(e) {
          Howler.noAudio = true;
        }
      } else {
        Howler.noAudio = true;
      }
    }

    // Test to make sure audio isn't disabled in Internet Explorer
    try {
      var test = new Audio();
      if (test.muted) {
        Howler.noAudio = true;
      }
    } catch (e) {}

    // Check if a webview is being used on iOS8 or earlier (rather than the browser).
    // If it is, disable Web Audio as it causes crashing.
    var iOS = (/iP(hone|od|ad)/.test(Howler._navigator && Howler._navigator.platform));
    var appVersion = Howler._navigator && Howler._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);
    var version = appVersion ? parseInt(appVersion[1], 10) : null;
    if (iOS && version && version < 9) {
      var safari = /safari/.test(Howler._navigator && Howler._navigator.userAgent.toLowerCase());
      if (Howler._navigator && Howler._navigator.standalone && !safari || Howler._navigator && !Howler._navigator.standalone && !safari) {
        Howler.usingWebAudio = false;
      }
    }

    // Create and expose the master GainNode when using Web Audio (useful for plugins or advanced usage).
    if (Howler.usingWebAudio) {
      Howler.masterGain = (typeof Howler.ctx.createGain === 'undefined') ? Howler.ctx.createGainNode() : Howler.ctx.createGain();
      Howler.masterGain.gain.value = 1;
      Howler.masterGain.connect(Howler.ctx.destination);
    }

    // Re-run the setup on Howler.
    Howler._setup();
  };

  // Add support for AMD (Asynchronous Module Definition) libraries such as require.js.
  if (typeof define === 'function' && define.amd) {
    define('Howler', [], function() {
      return {
        Howler: Howler,
        Howl: Howl
      };
    });
  }

  // Add support for CommonJS libraries such as browserify.
  if (typeof exports !== 'undefined') {
    exports.Howler = Howler;
    exports.Howl = Howl;
  }

  // Define globally in case AMD is not available or unused.
  if (typeof window !== 'undefined') {
    window.HowlerGlobal = HowlerGlobal;
    window.Howler = Howler;
    window.Howl = Howl;
    window.Sound = Sound;
  } else if (typeof global !== 'undefined') { // Add to global in Node.js (for testing, etc).
    global.HowlerGlobal = HowlerGlobal;
    global.Howler = Howler;
    global.Howl = Howl;
    global.Sound = Sound;
  }
})();


/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.0.0
 *  howlerjs.com
 *
 *  (c) 2013-2016, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */

(function() {

  'use strict';

  // Setup default properties.
  HowlerGlobal.prototype._pos = [0, 0, 0];
  HowlerGlobal.prototype._orientation = [0, 0, -1, 0, 1, 0];
  
  /** Global Methods **/
  /***************************************************************************/

  /**
   * Helper method to update the stereo panning position of all current Howls.
   * Future Howls will not use this value unless explicitly set.
   * @param  {Number} pan A value of -1.0 is all the way left and 1.0 is all the way right.
   * @return {Howler/Number}     Self or current stereo panning value.
   */
  HowlerGlobal.prototype.stereo = function(pan) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self.ctx || !self.ctx.listener) {
      return self;
    }

    // Loop through all Howls and update their stereo panning.
    for (var i=self._howls.length-1; i>=0; i--) {
      self._howls[i].stereo(pan);
    }

    return self;
  };

  /**
   * Get/set the position of the listener in 3D cartesian space. Sounds using
   * 3D position will be relative to the listener's position.
   * @param  {Number} x The x-position of the listener.
   * @param  {Number} y The y-position of the listener.
   * @param  {Number} z The z-position of the listener.
   * @return {Howler/Array}   Self or current listener position.
   */
  HowlerGlobal.prototype.pos = function(x, y, z) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self.ctx || !self.ctx.listener) {
      return self;
    }

    // Set the defaults for optional 'y' & 'z'.
    y = (typeof y !== 'number') ? self._pos[1] : y;
    z = (typeof z !== 'number') ? self._pos[2] : z;

    if (typeof x === 'number') {
      self._pos = [x, y, z];
      self.ctx.listener.setPosition(self._pos[0], self._pos[1], self._pos[2]);
    } else {
      return self._pos;
    }

    return self;
  };

  /**
   * Get/set the direction the listener is pointing in the 3D cartesian space.
   * A front and up vector must be provided. The front is the direction the
   * face of the listener is pointing, and up is the direction the top of the
   * listener is pointing. Thus, these values are expected to be at right angles
   * from each other.
   * @param  {Number} x   The x-orientation of the listener.
   * @param  {Number} y   The y-orientation of the listener.
   * @param  {Number} z   The z-orientation of the listener.
   * @param  {Number} xUp The x-orientation of the top of the listener.
   * @param  {Number} yUp The y-orientation of the top of the listener.
   * @param  {Number} zUp The z-orientation of the top of the listener.
   * @return {Howler/Array}     Returns self or the current orientation vectors.
   */
  HowlerGlobal.prototype.orientation = function(x, y, z, xUp, yUp, zUp) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self.ctx || !self.ctx.listener) {
      return self;
    }

    // Set the defaults for optional 'y' & 'z'.
    var or = self._orientation;
    y = (typeof y !== 'number') ? or[1] : y;
    z = (typeof z !== 'number') ? or[2] : z;
    xUp = (typeof xUp !== 'number') ? or[3] : xUp;
    yUp = (typeof yUp !== 'number') ? or[4] : yUp;
    zUp = (typeof zUp !== 'number') ? or[5] : zUp;

    if (typeof x === 'number') {
      self._orientation = [x, y, z, xUp, yUp, zUp];
      self.ctx.listener.setOrientation(x, y, z, xUp, yUp, zUp);
    } else {
      return or;
    }

    return self;
  };

  /** Group Methods **/
  /***************************************************************************/

  /**
   * Add new properties to the core init.
   * @param  {Function} _super Core init method.
   * @return {Howl}
   */
  Howl.prototype.init = (function(_super) {
    return function(o) {
      var self = this;

      // Setup user-defined default properties.
      self._orientation = o.orientation || [1, 0, 0];
      self._stereo = o.stereo || null;
      self._pos = o.pos || null;
      self._pannerAttr = {
        coneInnerAngle: typeof o.coneInnerAngle !== 'undefined' ? o.coneInnerAngle : 360,
        coneOuterAngle: typeof o.coneOuterAngle !== 'undefined' ? o.coneOuterAngle : 360,
        coneOuterGain: typeof o.coneOuterGain !== 'undefined' ? o.coneOuterGain : 0,
        distanceModel: typeof o.distanceModel !== 'undefined' ? o.distanceModel : 'inverse',
        maxDistance: typeof o.maxDistance !== 'undefined' ? o.maxDistance : 10000,
        panningModel: typeof o.panningModel !== 'undefined' ? o.panningModel : 'HRTF',
        refDistance: typeof o.refDistance !== 'undefined' ? o.refDistance : 1,
        rolloffFactor: typeof o.rolloffFactor !== 'undefined' ? o.rolloffFactor : 1
      };

      // Setup event listeners.
      self._onstereo = o.onstereo ? [{fn: o.onstereo}] : [];
      self._onpos = o.onpos ? [{fn: o.onpos}] : [];
      self._onorientation = o.onorientation ? [{fn: o.onorientation}] : [];

      // Complete initilization with howler.js core's init function.
      return _super.call(this, o);
    };
  })(Howl.prototype.init);

  /**
   * Get/set the stereo panning of the audio source for this sound or all in the group.
   * @param  {Number} pan  A value of -1.0 is all the way left and 1.0 is all the way right.
   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.
   * @return {Howl/Number}    Returns self or the current stereo panning value.
   */
  Howl.prototype.stereo = function(pan, id) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self._webAudio) {
      return self;
    }

    // If the sound hasn't loaded, add it to the load queue to change stereo pan when capable.
    if (self._state !== 'loaded') {
      self._queue.push({
        event: 'stereo',
        action: function() {
          self.stereo(pan, id);
        }
      });

      return self;
    }

    // Check for PannerStereoNode support and fallback to PannerNode if it doesn't exist.
    var pannerType = (typeof Howler.ctx.createStereoPanner === 'undefined') ? 'spatial' : 'stereo';

    // Setup the group's stereo panning if no ID is passed.
    if (typeof id === 'undefined') {
      // Return the group's stereo panning if no parameters are passed.
      if (typeof pan === 'number') {
        self._stereo = pan;
        self._pos = [pan, 0, 0];
      } else {
        return self._stereo;
      }
    }

    // Change the streo panning of one or all sounds in group.
    var ids = self._getSoundIds(id);
    for (var i=0; i<ids.length; i++) {
      // Get the sound.
      var sound = self._soundById(ids[i]);

      if (sound) {
        if (typeof pan === 'number') {
          sound._stereo = pan;
          sound._pos = [pan, 0, 0];

          if (sound._node) {
            // If we are falling back, make sure the panningModel is equalpower.
            sound._pannerAttr.panningModel = 'equalpower';

            // Check if there is a panner setup and create a new one if not.
            if (!sound._panner || !sound._panner.pan) {
              setupPanner(sound, pannerType);
            }

            if (pannerType === 'spatial') {
              sound._panner.setPosition(pan, 0, 0);
            } else {
              sound._panner.pan.value = pan;
            }
          }

          self._emit('stereo', sound._id);
        } else {
          return sound._stereo;
        }
      }
    }

    return self;
  };

  /**
   * Get/set the 3D spatial position of the audio source for this sound or
   * all in the group. The most common usage is to set the 'x' position for
   * left/right panning. Setting any value higher than 1.0 will begin to
   * decrease the volume of the sound as it moves further away.
   * @param  {Number} x  The x-position of the audio from -1000.0 to 1000.0.
   * @param  {Number} y  The y-position of the audio from -1000.0 to 1000.0.
   * @param  {Number} z  The z-position of the audio from -1000.0 to 1000.0.
   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.
   * @return {Howl/Array}    Returns self or the current 3D spatial position: [x, y, z].
   */
  Howl.prototype.pos = function(x, y, z, id) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self._webAudio) {
      return self;
    }

    // If the sound hasn't loaded, add it to the load queue to change position when capable.
    if (self._state !== 'loaded') {
      self._queue.push({
        event: 'pos',
        action: function() {
          self.pos(x, y, z, id);
        }
      });

      return self;
    }

    // Set the defaults for optional 'y' & 'z'.
    y = (typeof y !== 'number') ? 0 : y;
    z = (typeof z !== 'number') ? -0.5 : z;

    // Setup the group's spatial position if no ID is passed.
    if (typeof id === 'undefined') {
      // Return the group's spatial position if no parameters are passed.
      if (typeof x === 'number') {
        self._pos = [x, y, z];
      } else {
        return self._pos;
      }
    }

    // Change the spatial position of one or all sounds in group.
    var ids = self._getSoundIds(id);
    for (var i=0; i<ids.length; i++) {
      // Get the sound.
      var sound = self._soundById(ids[i]);

      if (sound) {
        if (typeof x === 'number') {
          sound._pos = [x, y, z];

          if (sound._node) {
            // Check if there is a panner setup and create a new one if not.
            if (!sound._panner || sound._panner.pan) {
              setupPanner(sound, 'spatial');
            }

            sound._panner.setPosition(x, y, z);
          }

          self._emit('pos', sound._id);
        } else {
          return sound._pos;
        }
      }
    }

    return self;
  };

  /**
   * Get/set the direction the audio source is pointing in the 3D cartesian coordinate
   * space. Depending on how direction the sound is, based on the `cone` attributes,
   * a sound pointing away from the listener can be quiet or silent.
   * @param  {Number} x  The x-orientation of the source.
   * @param  {Number} y  The y-orientation of the source.
   * @param  {Number} z  The z-orientation of the source.
   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.
   * @return {Howl/Array}    Returns self or the current 3D spatial orientation: [x, y, z].
   */
  Howl.prototype.orientation = function(x, y, z, id) {
    var self = this;

    // Stop right here if not using Web Audio.
    if (!self._webAudio) {
      return self;
    }

    // If the sound hasn't loaded, add it to the load queue to change orientation when capable.
    if (self._state !== 'loaded') {
      self._queue.push({
        event: 'orientation',
        action: function() {
          self.orientation(x, y, z, id);
        }
      });

      return self;
    }

    // Set the defaults for optional 'y' & 'z'.
    y = (typeof y !== 'number') ? self._orientation[1] : y;
    z = (typeof z !== 'number') ? self._orientation[2] : z;

    // Setup the group's spatial orientation if no ID is passed.
    if (typeof id === 'undefined') {
      // Return the group's spatial orientation if no parameters are passed.
      if (typeof x === 'number') {
        self._orientation = [x, y, z];
      } else {
        return self._orientation;
      }
    }

    // Change the spatial orientation of one or all sounds in group.
    var ids = self._getSoundIds(id);
    for (var i=0; i<ids.length; i++) {
      // Get the sound.
      var sound = self._soundById(ids[i]);

      if (sound) {
        if (typeof x === 'number') {
          sound._orientation = [x, y, z];

          if (sound._node) {
            // Check if there is a panner setup and create a new one if not.
            if (!sound._panner) {
              // Make sure we have a position to setup the node with.
              if (!sound._pos) {
                sound._pos = self._pos || [0, 0, -0.5];
              }

              setupPanner(sound, 'spatial');
            }

            sound._panner.setOrientation(x, y, z);
          }

          self._emit('orientation', sound._id);
        } else {
          return sound._orientation;
        }
      }
    }

    return self;
  };

  /**
   * Get/set the panner node's attributes for a sound or group of sounds.
   * This method can optionall take 0, 1 or 2 arguments.
   *   pannerAttr() -> Returns the group's values.
   *   pannerAttr(id) -> Returns the sound id's values.
   *   pannerAttr(o) -> Set's the values of all sounds in this Howl group.
   *   pannerAttr(o, id) -> Set's the values of passed sound id.
   *
   *   Attributes:
   *     coneInnerAngle - (360 by default) There will be no volume reduction inside this angle.
   *     coneOuterAngle - (360 by default) The volume will be reduced to a constant value of
   *                      `coneOuterGain` outside this angle.
   *     coneOuterGain - (0 by default) The amount of volume reduction outside of `coneOuterAngle`.
   *     distanceModel - ('inverse' by default) Determines algorithm to use to reduce volume as audio moves
   *                      away from listener. Can be `linear`, `inverse` or `exponential`.
   *     maxDistance - (10000 by default) Volume won't reduce between source/listener beyond this distance.
   *     panningModel - ('HRTF' by default) Determines which spatialization algorithm is used to position audio.
   *                     Can be `HRTF` or `equalpower`.
   *     refDistance - (1 by default) A reference distance for reducing volume as the source
   *                    moves away from the listener.
   *     rolloffFactor - (1 by default) How quickly the volume reduces as source moves from listener.
   * 
   * @return {Howl/Object} Returns self or current panner attributes.
   */
  Howl.prototype.pannerAttr = function() {
    var self = this;
    var args = arguments;
    var o, id, sound;

    // Stop right here if not using Web Audio.
    if (!self._webAudio) {
      return self;
    }

    // Determine the values based on arguments.
    if (args.length === 0) {
      // Return the group's panner attribute values.
      return self._pannerAttr;
    } else if (args.length === 1) {
      if (typeof args[0] === 'object') {
        o = args[0];

        // Set the grou's panner attribute values.
        if (typeof id === 'undefined') {
          self._pannerAttr = {
            coneInnerAngle: typeof o.coneInnerAngle !== 'undefined' ? o.coneInnerAngle : self._coneInnerAngle,
            coneOuterAngle: typeof o.coneOuterAngle !== 'undefined' ? o.coneOuterAngle : self._coneOuterAngle,
            coneOuterGain: typeof o.coneOuterGain !== 'undefined' ? o.coneOuterGain : self._coneOuterGain,
            distanceModel: typeof o.distanceModel !== 'undefined' ? o.distanceModel : self._distanceModel,
            maxDistance: typeof o.maxDistance !== 'undefined' ? o.maxDistance : self._maxDistance,
            panningModel: typeof o.panningModel !== 'undefined' ? o.panningModel : self._panningModel,
            refDistance: typeof o.refDistance !== 'undefined' ? o.refDistance : self._refDistance,
            rolloffFactor: typeof o.rolloffFactor !== 'undefined' ? o.rolloffFactor : self._rolloffFactor
          };
        }
      } else {
        // Return this sound's panner attribute values.
        sound = self._soundById(parseInt(args[0], 10));
        return sound ? sound._pannerAttr : self._pannerAttr;
      }
    } else if (args.length === 2) {
      o = args[0];
      id = parseInt(args[1], 10);
    }

    // Update the values of the specified sounds.
    var ids = self._getSoundIds(id);
    for (var i=0; i<ids.length; i++) {
      sound = self._soundById(ids[i]);

      if (sound) {
        // Merge the new values into the sound.
        var pa = sound._pannerAttr;
        pa = {
          coneInnerAngle: typeof o.coneInnerAngle !== 'undefined' ? o.coneInnerAngle : pa.coneInnerAngle,
          coneOuterAngle: typeof o.coneOuterAngle !== 'undefined' ? o.coneOuterAngle : pa.coneOuterAngle,
          coneOuterGain: typeof o.coneOuterGain !== 'undefined' ? o.coneOuterGain : pa.coneOuterGain,
          distanceModel: typeof o.distanceModel !== 'undefined' ? o.distanceModel : pa.distanceModel,
          maxDistance: typeof o.maxDistance !== 'undefined' ? o.maxDistance : pa.maxDistance,
          panningModel: typeof o.panningModel !== 'undefined' ? o.panningModel : pa.panningModel,
          refDistance: typeof o.refDistance !== 'undefined' ? o.refDistance : pa.refDistance,
          rolloffFactor: typeof o.rolloffFactor !== 'undefined' ? o.rolloffFactor : pa.rolloffFactor
        };

        // Update the panner values or create a new panner if none exists.
        var panner = sound._panner;
        if (panner) {
          panner.coneInnerAngle = pa.coneInnerAngle;
          panner.coneOuterAngle = pa.coneOuterAngle;
          panner.coneOuterGain = pa.coneOuterGain;
          panner.distanceModel = pa.distanceModel;
          panner.maxDistance = pa.maxDistance;
          panner.panningModel = pa.panningModel;
          panner.refDistance = pa.refDistance;
          panner.rolloffFactor = pa.rolloffFactor;
        } else {
          // Make sure we have a position to setup the node with.
          if (!sound._pos) {
            sound._pos = self._pos || [0, 0, -0.5];
          }

          // Create a new panner node.
          setupPanner(sound, 'spatial');
        }
      }
    }

    return self;
  };

  /** Single Sound Methods **/
  /***************************************************************************/

  /**
   * Add new properties to the core Sound init.
   * @param  {Function} _super Core Sound init method.
   * @return {Sound}
   */
  Sound.prototype.init = (function(_super) {
    return function() {
      var self = this;
      var parent = self._parent;

      // Setup user-defined default properties.
      self._orientation = parent._orientation;
      self._stereo = parent._stereo;
      self._pos = parent._pos;
      self._pannerAttr = parent._pannerAttr;

      // Complete initilization with howler.js core Sound's init function.
      _super.call(this);

      // If a stereo or position was specified, set it up.
      if (self._stereo) {
        parent.stereo(self._stereo);
      } else if (self._pos) {
        parent.pos(self._pos[0], self._pos[1], self._pos[2], self._id);
      }
    };
  })(Sound.prototype.init);

  /**
   * Override the Sound.reset method to clean up properties from the spatial plugin.
   * @param  {Function} _super Sound reset method.
   * @return {Sound}
   */
  Sound.prototype.reset = (function(_super) {
    return function() {
      var self = this;
      var parent = self._parent;

      // Reset all spatial plugin properties on this sound.
      self._orientation = parent._orientation;
      self._pos = parent._pos;
      self._pannerAttr = parent._pannerAttr;

      // Complete resetting of the sound.
      return _super.call(this);
    };
  })(Sound.prototype.reset);

  /** Helper Methods **/
  /***************************************************************************/

  /**
   * Create a new panner node and save it on the sound.
   * @param  {Sound} sound Specific sound to setup panning on.
   * @param {String} type Type of panner to create: 'stereo' or 'spatial'.
   */
  var setupPanner = function(sound, type) {
    type = type || 'spatial';

    // Create the new panner node.
    if (type === 'spatial') {
      sound._panner = Howler.ctx.createPanner();
      sound._panner.coneInnerAngle = sound._pannerAttr.coneInnerAngle;
      sound._panner.coneOuterAngle = sound._pannerAttr.coneOuterAngle;
      sound._panner.coneOuterGain = sound._pannerAttr.coneOuterGain;
      sound._panner.distanceModel = sound._pannerAttr.distanceModel;
      sound._panner.maxDistance = sound._pannerAttr.maxDistance;
      sound._panner.panningModel = sound._pannerAttr.panningModel;
      sound._panner.refDistance = sound._pannerAttr.refDistance;
      sound._panner.rolloffFactor = sound._pannerAttr.rolloffFactor;
      sound._panner.setPosition(sound._pos[0], sound._pos[1], sound._pos[2]);
      sound._panner.setOrientation(sound._orientation[0], sound._orientation[1], sound._orientation[2]);
    } else {
      sound._panner = Howler.ctx.createStereoPanner();
      sound._panner.pan.value = sound._stereo;
    }

    sound._panner.connect(sound._node);

    // Update the connections.
    if (!sound._paused) {
      sound._parent.pause(sound._id, true).play(sound._id);
    }
  };
})();

















































































</script><tw-passagedata pid="1" name="init" tags="hide-footer" position="630,687" size="100,100">(set: $turns to 0)\
(set: $HP to 50)\
(set: $sanity to 50)\
(set: $satiety to 50)\
(set: $energy to 50)\
(set: $mushroomCooldown to 0)\
(set: $showSidebar to true)\
(set: $hunger to 1)\
(set: $delayExecute to false)\
(set: $fleeBonus to 0)\
(set: $ankh to 0)\
(set: $trash to 0)\
(set: $ended to false)\
(set: $drink to 0)\
(set: $curses to (array: &quot;&quot;))\
(set: $ghostFriend to 0)\
(set: $slimeEnemy to 0)\
(set: $inventory to false)\
(if: $inherit is true)[(set: $inheritKeys to $keys)(set: $cards to it + (array: &quot;inherit&quot;, &quot;inherit&quot;, &quot;inherit&quot;))]\
(set: $keys to 0)(set: $inherit to false)\
(set: $inventory to (array: &quot;soul&quot;))\
(set: $blessings to (array: &quot;&quot;))\
(set: $blessingsCount to 0)\
(set: $scanner to 0)\
(set: $nextBlessing to 14)\
(set: $doorBreak to 1)\
(set: $gorgonKey to true)\
(set: $s to (color: #818181))\
(set: $testIslandKey to 0)\
(set: $cudgelCount to 0)\
(set: $sergeGuide to 1)\
(set: $diceCooldown to 9999)\
(set: $statMax to 100)\
(set: $inklings to 0)\
(set: $loaded to false)\
(set: $descension to 0)\
(set: $saveTimer to 22)\
(set: $catKey to 0)\
(set: $strangeBrew to 0)\
(set: $hats to 0)\
(set: $teaTally to 0)\
(set: $tentacled to 0)\
(set: $keysOld to 0)\
(set: $repeatExecute to (array: &quot;&quot;))\
(set: $poopKey to 0)\
(set: $zombieVisits to 0)\
(set: $zombieFleeChance to 80)\
(set: $shuffleCooldown to 0)\
(set: $weird to 0)\
(set: $sergeGuide2 to 1)\
(set: $words to false)\
(set: $marked to (array: &quot;&quot;))\
(set: $tornado to -1)\
(set: $runBonus to 15)\
(set: $cardRepeat to false)\
(set: $tickBomb to false)\
(set: $curseGame to false)\
(set: $plant to &quot;none&quot;)\
(set: $damageModify to 1)\
(set: $cardHistory to (array: &quot;blank&quot;, &quot;blank&quot;, &quot;blank&quot;, &quot;blank&quot;, &quot;blank&quot;))\
(set: $god to &quot;Nothing&quot;)\
(set: $inventoryCheck to false)\
(set: $crumbed to (array:))\
(set: $icons to (array:))\
(set: $sidequest to (shuffled: ... (array: 1,2,3,4)))\
(set: $freeze to (datamap: &quot;stat&quot;, &quot;none&quot;, &quot;value&quot;, &quot;none&quot;, &quot;timer&quot;, 0))\
(set: $finalExecute to (array: &#39;(replace: ?Health)[(color: white)[$HP]](replace: ?Sanity)[(color: white)[$sanity]](replace: ?Energy)[(color: white)[$energy]](replace: ?Satiety)[(color: white)[$satiety]]&#39;))\
(set: $direction to (datamap: &quot;north&quot;, 0, &quot;east&quot;, 0, &quot;direction&quot;, &quot;none&quot;))\
(if: $achievements is not (array: &quot;&quot;))[(save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))]\
(set: $ally to (datamap: &quot;type&quot;, &quot;none&quot;, &quot;health&quot;, 0))\
(set: $cookies to (datamap: &quot;basic&quot;, 0, &quot;rainbow&quot;, 0, &quot;eldritch&quot;, 0, &quot;healthful&quot;, 0, &quot;disappearing&quot;, 0, &quot;arcane&quot;, 0))\
(set: $cards to (array: &quot;ghost&quot;, &quot;poop&quot;, &quot;badFood&quot;, &quot;watermelon&quot;, &quot;energy&quot;, &quot;satan&quot;, &quot;potion&quot;, &quot;altar&quot;, &quot;presents&quot;, &quot;tiles&quot;, &quot;hunger&quot;, &quot;slime&quot;, &quot;monsters1&quot;, &quot;doors&quot;, &quot;rat&quot;, &quot;treasureChest&quot;, &quot;memory&quot;, &quot;memory&quot;))\
(set: $uncommonCards to (array: &quot;catFoe&quot;, &quot;sidequest&quot;, &quot;well&quot;))\
(set: $rareishCards to (array: &quot;ethicsTome&quot;, &quot;Compass&quot;, &quot;confide&quot;))\
(set: $rareCards to (array: &quot;jargo&quot;, &quot;bibleopoly&quot;, &quot;Painting&quot;, &quot;Candies&quot;, &quot;tornado&quot;, &quot;fairy&quot;, &quot;hatFind&quot;, &quot;Convention&quot;, &quot;deathDoor&quot;, &quot;elephant&quot;, &quot;spikes&quot;, &quot;dog&quot;, &quot;library&quot;, &quot;guitar&quot;, &quot;sloth&quot;, &quot;troupe&quot;, &quot;bugs&quot;, &quot;balls&quot;, &quot;church&quot;, &quot;crossroads&quot;, &quot;treadmill&quot;, &quot;holeKey&quot;, &quot;headband&quot;, &quot;statue&quot;, &quot;cards&quot;, &quot;jar&quot;, &quot;banquet&quot;, &quot;eyeballNote&quot;, &quot;crumbs&quot;, &quot;button&quot;, &quot;clock&quot;, &quot;plant1&quot;, &quot;sphynx&quot;, &quot;armor&quot;, &quot;bomb&quot;, &quot;gas&quot;, &quot;space&quot;, &quot;wizard&quot;, &quot;Skeleton&quot;, &quot;mawbeast&quot;, &quot;badPotions&quot;, &quot;preCraft&quot;, &quot;fountain&quot;, &quot;fish&quot;, &quot;pantry&quot;, &quot;roundbird&quot;, &quot;heistIntro&quot;, &quot;lion&quot;))\
(set: $socks to (datamap: &quot;armor&quot;, 0, &quot;cookie&quot;, 0, &quot;blessing&quot;, 0))\
(set: $allBlessings to (array: &quot;fitness&quot;, &quot;mindfulness&quot;, &quot;gluttony&quot;, &quot;blessedness&quot;, &quot;maturity&quot;, &quot;digestion&quot;, &quot;discovery&quot;, &quot;laughter&quot;, &quot;endurance&quot;, &quot;sacrifice&quot;, &quot;snacking&quot;, &quot;inheritance&quot;, &quot;shuffling&quot;, &quot;wellness&quot;, &quot;mindlessness&quot;, &quot;consumption&quot;, &quot;explosiveness&quot;,  &quot;opening&quot;, &quot;stability&quot;))\
(set: $repeatBlessings to (array: &quot;boundaries&quot;, &quot;acquisition&quot;, &quot;speed&quot;))\
(set: $roomExecute to (array: &#39;(if: $keys &gt;=5 and $sergeGuide is 1)[(set: $rareishCards to it + (array: &quot;sergeGuide&quot;))]&#39;))\
(set: $execute to (array: &quot;&quot;))\
(set: $updates to (array: 0, &#39;(set: $finalExecute to (array: &quot;&quot;))&#39;, 10, &#39;(set: $cards to it + (array: &quot;photocopier&quot;))(set: $rareishCards to it + (array: &quot;crabs&quot;))&#39;, 20, &#39;(set: $cards to it + (array: &quot;Tea Ceremony&quot;))(set: $uncommonCards to it + (array: &quot;monsters2&quot;))(set: $rareishCards to it + (array: &quot;eyeball&quot;))&#39;, 28, &#39;(set: $rareishCards to it + (array: &quot;wasp&quot;))&#39;, 35, &#39;(set: $uncommonCards to it + (array: &quot;trap&quot;, &quot;Glimpse&quot;))(set: $rareishCards to it + (array: &quot;mushrooms&quot;))&#39;, 40, &#39;(if: $descension is 0)[(set: $cards to it + (array: &quot;exit&quot;))](set: $rareishCards to it + (array: &quot;skull&quot;))&#39;, 45, &#39;(set: $cards to it + (array: &quot;inventory&quot;, &quot;inventory&quot;, &quot;inventory&quot;))&#39;, 50, &#39;(set: $rareishCards to it + (array: &quot;cowboy&quot;))(set: $cards to it + (array: &quot;tree&quot;))&#39;, 60, &#39;(set: $cards to it + (array: &quot;demon&quot;, &quot;sergeHour&quot;, &quot;sergeHour&quot;, &quot;sergeHour&quot;, &quot;sergeHour&quot;, &quot;sergeHour&quot;, &quot;sergeHour&quot;))(set: $rareishCards to it + (array: &quot;fungli&quot;))(set: $uncommonCards to it + (array: &quot;grimoire&quot;))(display: &quot;achieveCheck&quot;)&#39;, 75, &#39;(set: $rareishCards to it + (array: &quot;Gorgon&quot;))&#39;, 90, &#39;(set: $rareishCards to it + (array: &quot;slimeMonster&quot;))&#39;, 120, &#39;(display: &quot;achieveCheck&quot;)&#39;, 150, &#39;(set: $rareishCards to it + (array: &quot;raptor&quot;))&#39;, 180, &#39;(display: &quot;achieveCheck&quot;)&#39;))\
(set: $tiles to (shuffled: ...(array: &quot;The Grey Wolf&quot;, &quot;The Sleeping Dragon&quot;, &quot;The Roaring Lion&quot;, &quot;The Blue-Skinned Kraken&quot;, &quot;The Quivering Squid&quot;, &quot;The Silver-Backed Bison&quot;, &quot;The Green Giraffe&quot;, &quot;The Winged Slug&quot;, &quot;The Obstinate Trout&quot;, &quot;The Pink-Dyed Sheep&quot;, &quot;The Illuminated Kitten&quot;, &quot;The Many-Eyed Toadbeast&quot;, &quot;The Highland Isopod&quot;, &quot;The Abyssal Wailingfish&quot;, &quot;The Gelatinous Cube&quot;, &quot;The Rat in Rags&quot;, &quot;The Morose Bloodhound&quot;, &quot;The Balding Porcupine&quot;, &quot;The Burrowing Mole&quot;, &quot;The Three-Legged Spider&quot;, &quot;The Bluebird&quot;, &quot;The Blackbird&quot;, &quot;The Redbird&quot;, &quot;The Greybird&quot;, &quot;The Gilled Antelope&quot;, &quot;The Bare-Fronted Hoodwink&quot;, &quot;The Lucky Mallard&quot;, &quot;The Unlucky Mallard&quot;, &quot;The Flightless Roundbird&quot;, &quot;The Pearl-Eyed Tigress&quot;, &quot;The Stretchy-Necked Buzzard&quot;, &quot;The Eye-Moth&quot;)))\
(set: $tiles to $tiles&#39;s (range:1,8))\
(set: $safeTiles to $tiles&#39;s (range:1,3))\
(if: $achievements contains &quot;Escape&quot;)[(set: $cards to it + (array: &quot;descentNote&quot;))]\
It is your eighteenth birthday. You have inherited the keys to a birthday (text-color: red)[dungeon]. The entry lies at your feet. (if: $achievements&#39;s length &gt;= 7)[Some suspicious shrubbery grows a little to the right.](if: $achievements is not (array: &quot;&quot;))[

A nearby sign lists the accomplishments of those who have entered before you.]

[[Descend.|Main]](if: $achievements&#39;s length &gt;= 7)[
[[Look behind the bushes.|altEntrance]]](if: $achievements is not (array: &quot;&quot;))[
[[Read of your predecessors&#39; achievements.|Achievements]]](save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))
[[Walk away, to safety.]](replace: ?Health)[(color: white)[$HP]](replace: ?Sanity)[(color: white)[$sanity]](replace: ?Energy)[(color: white)[$energy]](replace: ?Satiety)[(color: white)[$satiety]]</tw-passagedata><tw-passagedata pid="2" name="Main" tags="" position="628,812" size="100,100">(display: &quot;updates&quot;)\
(if: $energy &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $HP &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $satiety &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $sanity &lt;1)[(go-to: &quot;You are insane&quot;)]\
(else-if: $HP &gt;$statMax)[(go-to: &quot;HPMax&quot;)]\
(else-if: $sanity &gt;$statMax)[(go-to: &quot;sanityMax&quot;)]\
(else-if: $energy &gt;$statMax)[(go-to: &quot;energyMax&quot;)]\
(else-if: $satiety &gt;$statMax)[(go-to: &quot;satietyMax&quot;)]\
(else:)[(set: $cardSelect to it - (array: $cardHistory&#39;s last, $cardHistory&#39;s 2ndlast, $cardHistory&#39;s 3rdlast, $cardHistory&#39;s 4thlast))\
	$delayExecute (set: $delayExecute to false)\
	(set: $card to $cardSelect&#39;s 1st)\
	(display: &quot;achievementDisplay&quot;)(display: $card)(set: $cardHistory to it + (array: $card))
(live: 0.5s)[(display: &quot;actions&quot;)(stop:)]]</tw-passagedata><tw-passagedata pid="3" name="Startup" tags="startup" position="251,196" size="100,100">&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;(set: $inherit to false)\
(set: $achievements to (array: &quot;&quot;))\
(set: $achievementsOld to $achievements)\
(set: $untouchables to (array: &quot;couch&quot;, &quot;peckishCure&quot;, &quot;debugMenagerie&quot;, &quot;ethicsTome&quot;, &quot;pirates&quot;, &quot;Blessed&quot;, &quot;headband&quot;, &quot;blessings&quot;, &quot;saveGame&quot;, &quot;keyFind&quot;, &quot;Painting&quot;, &quot;tornado&quot;, &quot;confide&quot;, &quot;sergeGuide&quot;, &quot;fairy&quot;, &quot;fairy2&quot;, &quot;demon&quot;, &quot;strangeBrew&quot;, &quot;descentNote&quot;, &quot;speedUp&quot;, &quot;speedDown&quot;, &quot;slow&quot;, &quot;antidote&quot;, &quot;dog&quot;, &quot;tornadoEnd&quot;, &quot;southBound&quot;, &quot;watermelonBird&quot;, &quot;sergeHour&quot;, &quot;tentacles&quot;, &quot;moth2&quot;, &quot;plant1&quot;, &quot;heist&quot;, &quot;visions&quot;, &quot;sidequest&quot;, &quot;portal1&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;1b&quot;, &quot;2b&quot;, &quot;3b&quot;, &quot;4b&quot;, &quot;none&quot;, &quot;snake1&quot;, &quot;snake2&quot;, &quot;snake3&quot;, &quot;memory&quot;, &quot;amulet&quot;, &quot;inventory&quot;, &quot;dynamite&quot;, &quot;inherit&quot;, &quot;archaeologist&quot;))\
(set: $monsters to (array: &quot;rat&quot;, &quot;elephant&quot;, &quot;skull&quot;, &quot;cowboy&quot;, &quot;fungli&quot;, &quot;slimeMonster&quot;, &quot;armor&quot;, &quot;raptor&quot;, &quot;wasp&quot;, &quot;fish&quot;, &quot;mawbeast&quot;, &quot;snake1&quot;, &quot;snake2&quot;, &quot;snake3&quot;, &quot;skeleton&quot;, &quot;monsters2&quot;, &quot;monsters1&quot;, &quot;Gorgon&quot;, &quot;eyeball&quot;, &quot;red dragon&quot;, &quot;green dragon&quot;, &quot;white dragon&quot;, &quot;catFoe&quot;, &quot;lion&quot;))\
(set: $foodTypes to (array: &quot;bowl of dhal&quot;, &quot;potato&quot;, &quot;bowl of melted ice-cream cake&quot;, &quot;stew&quot;, &quot;bowl of dragonfruit&quot;, &quot;bowl of curry&quot;, &quot;bowl of soup&quot;, &quot;bowl of muesli&quot;, &quot;slice of pizza&quot;, &quot;burrito bowl&quot;, &quot;bowl of roasted capsicums&quot;, &quot;bowl of pumpkin soup&quot;, &quot;chicken dinner&quot;, &quot;bowl of tofu&quot;))\
(set: $colours to (array: &quot;#F00&quot;, &quot;#F10&quot;, &quot;#F10&quot;, &quot;#F10&quot;, &quot;#F10&quot;, &quot;#F20&quot;, &quot;#F20&quot;, &quot;#F30&quot;, &quot;#F30&quot;, &quot;#F30&quot;, &quot;#F40&quot;, &quot;#F40&quot;, &quot;#F50&quot;, &quot;#F50&quot;, &quot;#F50&quot;, &quot;#F60&quot;, &quot;#F60&quot;, &quot;#F70&quot;, &quot;#F70&quot;, &quot;#F70&quot;, &quot;#F80&quot;, &quot;#F80&quot;, &quot;#F90&quot;, &quot;#F90&quot;, &quot;#F90&quot;, &quot;#FA0&quot;, &quot;#FA0&quot;, &quot;#FA0&quot;, &quot;#FA0&quot;, &quot;#FB0&quot;, &quot;grey&quot;, &quot;#BF0&quot;, &quot;#AF0&quot;, &quot;#AF0&quot;, &quot;#AF0&quot;, &quot;#AF0&quot;, &quot;#9F0&quot;, &quot;#9F0&quot;, &quot;#9F0&quot;, &quot;#8F0&quot;, &quot;#8F0&quot;, &quot;#7F0&quot;, &quot;#7F0&quot;, &quot;#7F0&quot;, &quot;#6F0&quot;, &quot;#6F0&quot;, &quot;#5F0&quot;, &quot;#5F0&quot;, &quot;#5F0&quot;, &quot;#4F0&quot;, &quot;#4F0&quot;, &quot;#3F0&quot;, &quot;#3F0&quot;, &quot;#3F0&quot;, &quot;#2F0&quot;, &quot;#2F0&quot;, &quot;#1F0&quot;, &quot;#1F0&quot;, &quot;#1F0&quot;, &quot;#1F0&quot;, &quot;#0F0&quot;))\
(set: $godArray to (array: &#39;(set: $HP to it + (5 * (max: 0, (sign: $HP - $HPOld))))&#39;, &#39;(set: $HP to it + (5 * (min: 0, (sign: $HP - $HPOld - 1))))&#39;, &#39;(set: $sanity to it + (5 * (max: 0, (sign: $sanity - $sanityOld))))&#39;, &#39;(set: $sanity to it + (5 * (min: 0, (sign: $sanity - $sanityOld))))&#39;, &#39;(set: $satiety to it + (5 * (max: 0, (sign: $satiety - $satietyOld))))(set: $energy to (min: $energy, $energyOld + 5))&#39;,&#39;(set: $HP to it - (round: ($HPOld - $HP)/3))(set: $sanity to it - (round: ($sanityOld - $sanity)/3))(set: $energy to it - (round: ($energyOld - $energy)/3))(set: $satiety to it - (round: ($satietyOld - $satiety)/3))&#39;))\
&lt;script&gt;
var audio = {};

audio.theme = new Howl({
	src: [&#39;theme.mp3&#39;],
	html5: true,
    loop: false,
});

audio.themeAlt = new Howl({
	src: [&#39;themeAlt.mp3&#39;],
	html5: true,
    loop: false,
});

audio.themeOld = new Howl({
	src: [&#39;themeOld.mp3&#39;],
	html5: true,
    loop: false,
});

audio.achieve = new Howl({
	src: [&#39;achieveNew.wav&#39;],
	html5: true,
    loop: false,
});

audio.exit = new Howl({
	src: [&#39;exit.mp3&#39;],
	html5: true,
    loop: true,
});

audio.generic = new Howl({
	src: [&#39;generic.mp3&#39;],
	html5: true,
    loop: true,
});

audio.sadEnd = new Howl({
	src: [&#39;sadEnd.mp3&#39;],
	html5: true,
    loop: false,
});

audio.otherworld = new Howl({
	src: [&#39;otherworld.mp3&#39;],
	html5: true,
    loop: false,
});

audio.calm = new Howl({
	src: [&#39;calm.mp3&#39;],
	html5: true,
    loop: true,
});

audio.peaceful = new Howl({
	src: [&#39;peaceful.mp3&#39;],
	html5: true,
    loop: true,
});

audio.determined = new Howl({
	src: [&#39;determined.mp3&#39;],
	html5: true,
    loop: false,
});

audio.determined2 = new Howl({
	src: [&#39;determined2.mp3&#39;],
	html5: true,
    loop: false,
});

audio.slimy = new Howl({
	src: [&#39;slimy.mp3&#39;],
	html5: true,
    loop: false,
});

audio.blessed = new Howl({
	src: [&#39;blessed.mp3&#39;],
	html5: true,
    loop: false,
});

audio.blessingLong = new Howl({
	src: [&#39;blessingLong.mp3&#39;],
	html5: true,
    loop: false,
});

audio.blessingAlt = new Howl({
	src: [&#39;blessingAlt.mp3&#39;],
	html5: true,
    loop: false,
});

audio.sinister = new Howl({
	src: [&#39;sinister.mp3&#39;],
	html5: true,
    loop: true,
});

audio.sinisterShort = new Howl({
	src: [&#39;sinisterShort.mp3&#39;],
	html5: true,
    loop: false,
});

audio.adrenaline = new Howl({
	src: [&#39;adrenaline.mp3&#39;],
	html5: true,
    loop: false,
});

audio.adrenalineLoop = new Howl({
	src: [&#39;adrenaline.mp3&#39;],
	html5: true,
    loop: true,
});

audio.archibald = new Howl({
	src: [&#39;archibald.mp3&#39;],
	html5: true,
    loop: false,
});

audio.spooky = new Howl({
	src: [&#39;spooky.mp3&#39;],
	html5: true,
    loop: true,
});

audio.spookyShort = new Howl({
	src: [&#39;spookyShort.mp3&#39;],
	html5: true,
    loop: false,
});

audio.happiest = new Howl({
	src: [&#39;happy.mp3&#39;],
	html5: true,
    loop: true,
});

audio.happiestOnce = new Howl({
	src: [&#39;happy.mp3&#39;],
	html5: true,
    loop: false,
});

audio.descent = new Howl({
	src: [&#39;descent.mp3&#39;],
	html5: true,
    loop: true,
});

audio.keyGet = new Howl({
	src: [&#39;keyGet.wav&#39;],
	html5: true,
    loop: false,
});

audio.happyEnd = new Howl({
	src: [&#39;happyBirthday.mp3&#39;],
	html5: true,
    loop: false,
});

audio.ouch = new Howl({
	src: [&#39;ouch.mp3&#39;],
	html5: true,
    loop: false,
});

audio.happy = new Howl({
	src: [&#39;loopingHappy.mp3&#39;],
	html5: true,
    loop: true,
});

audio.storm = new Howl({
	src: [&#39;storm.mp3&#39;],
	html5: true,
    loop: true,
});

audio.smashmouth = new Howl({
	src: [&#39;90s.mp3&#39;],
	html5: true,
    loop: false,
});

audio.curse1 = new Howl({
	src: [&#39;curse1.mp3&#39;],
	html5: true,
    loop: false,
});

audio.curse2 = new Howl({
	src: [&#39;curse2.mp3&#39;],
	html5: true,
    loop: false,
});

audio.curseLong = new Howl({
	src: [&#39;curseLong.mp3&#39;],
	html5: true,
    loop: false,
});

audio.sidequest = new Howl({
	src: [&#39;sidequest.mp3&#39;],
	html5: true,
    loop: true,
});

audio.distortion = new Howl({
	src: [&#39;distortion.mp3&#39;],
	html5: true,
    loop: true,
});

audio.sadGhost = new Howl({
	src: [&#39;sad.mp3&#39;],
	html5: true,
    loop: false,
});

audio.crabs = new Howl({
	src: [&#39;crabs.mp3&#39;],
	html5: true,
    loop: true,
});

audio.heist = new Howl({
	src: [&#39;heist.mp3&#39;],
	html5: true,
    loop: true,
});

audio.space = new Howl({
	src: [&#39;space.mp3&#39;],
	html5: true,
    loop: true,
});

audio.subdungeon = new Howl({
	src: [&#39;subdungeon.mp3&#39;],
	html5: true,
    loop: false,
});

audio.shop = new Howl({
	src: [&#39;shop.mp3&#39;],
	html5: true,
    loop: true,
});

audio.loveRobots = new Howl({
	src: [&#39;loveRobots.mp3&#39;],
	html5: true,
    loop: true,
});

audio.sad = new Howl({
	src: [&#39;loopingSad.mp3&#39;],
	html5: true,
    loop: true,
});

audio.exercise = new Howl({
	src: [&#39;exercise.mp3&#39;],
	html5: true,
    loop: true,
});

audio.pirate = new Howl({
	src: [&#39;pirate.mp3&#39;],
	html5: true,
    loop: false,
});

audio.drain = new Howl({
	src: [&#39;drain.wav&#39;],
	html5: true,
    loop: false,
});

audio.ascending = new Howl({
	src: [&#39;ascending.wav&#39;],
	html5: true,
    loop: true,
});

audio.blessingSub = new Howl({
	src: [&#39;blessingSub.mp3&#39;],
	html5: true,
    loop: false,
});

audio.blessingSub2 = new Howl({
	src: [&#39;blessingSub2.mp3&#39;],
	html5: true,
    loop: false,
});

audio.subSave = new Howl({
	src: [&#39;subSave.mp3&#39;],
	html5: true,
    loop: false,
});

audio.squash1 = new Howl({
	src: [&#39;squash1.mp3&#39;],
	html5: true,
    loop: false,
});

audio.squash2 = new Howl({
	src: [&#39;squash2.mp3&#39;],
	html5: true,
    loop: false,
});

audio.squash3 = new Howl({
	src: [&#39;squash3.mp3&#39;],
	html5: true,
    loop: false,
});

audio.freeze = new Howl({
	src: [&#39;freeze.wav&#39;],
	html5: true,
    loop: false,
});

audio.whine = new Howl({
	src: [&#39;whine.wav&#39;],
	html5: true,
    loop: false,
});

audio.bad = new Howl({
	src: [&#39;bad.wav&#39;],
	html5: true,
    loop: false,
});

audio.boom = new Howl({
	src: [&#39;boom.wav&#39;],
	html5: true,
    loop: false,
});

function stopaudio() {
	for(keybar in audio) {
		audio[keybar].stop();
	}
}
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="4" name="ghost" tags="" position="973,405" size="100,100">A spectral presence wafts down the passageway towards you. Ectoplasm (or is it blood?) drips from its mouth.

&lt;img src=&quot;ghost.png&quot;&gt;

[[Run|runghost]](if: $ghostFriend &gt;=1)[
[[Stand your ground]]](if: $ghostFriend &gt;=2)[
[[Become more intimately acquainted|Consolidate your relationship]]](if: $ghostFriend &gt;=3)[
[[Ask a favour|Propose a trade]]](if: $ghostFriend &gt;=4)[
[[Grant a request|Accept a request]]]</tw-passagedata><tw-passagedata pid="5" name="Run" tags="" position="1172,1054" size="100,100">(set: $energy to it - $runDrain)(if: (random: 1, 100) &lt;= ($monster&#39;s fleeChance + $fleeBonus))[(if: $monster&#39;s type is &quot;rat&quot; and (random: 1,3) is 1 and not ($blessings contains &quot;rattiness&quot;))[(display: &quot;ratKing&quot;)](else:)[You escape(if: $inventory contains &quot;cookieClogs&quot;)[, and your enchanted clogs reward you with a chocolate-chip cookie(set: $cookies&#39;s basic to it + 1)].(set: $nextBlessing to it - $socks&#39;s blessing)

[[Onwards!|Main]]]]\
(else-if: (random: 1,5) &lt;=2 and not ($monster&#39;s fleeChance is -1000) and not ($energy &lt; 1))[Though you haven&#39;t yet escaped, the monster hasn&#39;t yet caught up.

[[Keep running|Run]]
(link: &quot;Slow down&quot;)[(set: $monster&#39;s fleeChance to -1000)(set: $runDrain to 0)(go-to: &quot;Run&quot;)]]\
(else:)[(if: $monster&#39;s type is &quot;slime&quot;)[(go-to: &quot;slimeAttack&quot;)](if: $monster&#39;s type is &quot;skull&quot;)[(go-to: &quot;skullAttack&quot;)](if: $monster&#39;s type is &quot;fish&quot;)[(display: &quot;fishAttack&quot;)](if: $monster&#39;s type is &quot;eyeball&quot;)[Though you try to run, you cannot escape the eyeball.

It stares malevolently at you and flops weakly against your chest, leaving a light bruise and a yellowish stain.(set: $sanity to it - $monster&#39;s damage)(set: $HP to it - 1)

[[Gross.|Main]]](else:)[Your attempt to flee was unsuccessful. You are now tired *and* injured.(set: $HP to it - ($monster&#39;s damage))(if: $monster&#39;s type is &quot;mawbeast&quot;)[(set: $satiety to it - 10)] (if: $monster&#39;s type is &quot;poison&quot; and not ($blessings contains &quot;rattiness&quot;))[

To make matters worse, you were poisoned during the attack.(set: $inventory to it + (array: &quot;poisoned&quot;))(if: not($cards contains &quot;antidote&quot;))[(set: $cards to it + (array: &quot;antidote&quot;, &quot;antidote&quot;))]](if: $monster&#39;s type is &quot;wasp&quot;)[

The dungeon seems plasticky and unreal. The wasp&#39;s sting might be beginning to affect you.(set: $sanity to it - 1)(set: $cards to it - (array: &quot;wasp&quot;))(set: $cards to it + (array: &quot;visions&quot;, &quot;visions&quot;, &quot;visions&quot;))(if: not ($icons contains &#39;&lt;img src=&quot;sVisions.png&quot;&gt;&#39;))[(set: $icons to it + (array: &#39;&lt;img src=&quot;sVisions.png&quot;&gt;&#39;))]]

[[Limp on.|Main]]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="6" name="Pat" tags="" position="1164,671" size="100,100">(if: (random: 1,100) &lt;= 80)[There is a moment of soft cuddly contentment. This is followed by searing pain as its claws rend your flesh.
(set: $HP to it - $monster&#39;s damage)(set: $sanity to it + 5)\
&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;
*The creature may react differently next time.*

[[Onwards!|Main]]]\
(else:)[The cat purrs and rubs against your leg. It looks like you&#39;ve made a friend.

(set: $uncommonCards to it + (array: &quot;catFriend&quot;))\
(set: $uncommonCards to it - (array: &quot;catFoe&quot;))\
(set: $sanity to it + 10)\
(if: not ($achievements contains &quot;Befriend a cat&quot;))[(set: $achievements to it + (array: &quot;Befriend a cat&quot;))]\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="7" name="monsters2" tags="" position="1412,930" size="100,100">(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;damage&quot;, 18, &quot;bonus&quot;, &quot;Feed them&quot;, &quot;type&quot;, &quot;pigeons&quot;))\
Carnivorous pigeons are perched on the rafters. They cock their heads and stare at you through malevolent red eyes.(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

These ones look unusually docile.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

These ones look unusually aggressive.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;pigeon.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="8" name="poop" tags="" position="890,735" size="100,100">An enormous spiderweb spans this section of hallway. Whatever spun the web is nowhere in sight.

&lt;img src=&quot;web.png&quot;&gt;
(if: (random: 1,24) &lt;= (1 + ($decesion * 3)))[
(link: &quot;Creep through, with the web brushing against your face&quot;)[(set: $sanity to it - 12)(go-to: &quot;spider&quot;)]]\
(else-if: (random: 1,4) is 1)[
(link: &quot;Creep through, with the web brushing against your face&quot;)[(set: $sanity to it - 12)(go-to: &quot;Web2&quot;)]]\
(else:)[
(link: &quot;Creep through, with the web brushing against your face&quot;)[(set: $sanity to it - 12)(go-to: &quot;Main&quot;)]](if: $descension &gt; 0)[
(link: &quot;Push through quickly&quot;)[(set: $sanity to it - 5)(set: $energy to it - 5)(if: (random:1,24) &lt;= 4)[(goto: &quot;spider&quot;)](else:)[(goto: &quot;Push through quickly&quot;)]]]</tw-passagedata><tw-passagedata pid="9" name="badFood" tags="" position="2573,1496" size="100,100">(if: $descension is 1 and (random: 1,3) is 1)[You find (either: &quot;a writhing&quot;) (print: 1st of (shuffled: ...$foodTypes)) on the dungeon floor.

&lt;img src=&quot;gruel.png&quot;&gt;

(link: &quot;Eat it.&quot;)[(set: $sanity to it - 8)(set: $satiety to it + 15)(go-to: &quot;Main&quot;)]
[[Don&#39;t eat it.|Main]]]\
(else-if: (random: 1,10) is 1)[You find a bowl of bland-looking greyberries on the dungeon floor.

&lt;img src=&quot;gruel.png&quot;&gt;

[[Eat it.|Eat the greyberries]]
[[Don&#39;t eat it.|Main]]](else-if: (random: 1,5) &gt; 2)[You find (either: &quot;a rancid&quot;, &quot;an odoursome&quot;, &quot;a questionable&quot;) (print: 1st of (shuffled: ...$foodTypes)) on the dungeon floor.

&lt;img src=&quot;gruel.png&quot;&gt;

(link: &quot;Eat it.&quot;)[(if: not ($blessings contains &quot;rattiness&quot;))[(set: $HP to it - 8)](set: $satiety to it + 15)(go-to: &quot;Main&quot;)]
[[Don&#39;t eat it.|Main]]]\
(else-if: (random: 1,4) is 1)[You find a solitary cookie in a large bowl on the dungeon floor.

&lt;img src=&quot;gruelB.png&quot;&gt;

(link: &quot;Take it.&quot;)[(set: $cookies&#39;s basic to it + 1)(goto: &quot;Main&quot;)]
[[Don&#39;t take it.|Main]]]\
(else:)[You find a (either: &quot;wholesome&quot;, &quot;fragrant&quot;) (print: 1st of (shuffled: ...$foodTypes)) on the dungeon floor.

&lt;img src=&quot;gruel.png&quot;&gt;

(link: &quot;Eat it.&quot;)[(set: $HP to it + 5)(set: $satiety to it + 15)(go-to: &quot;Main&quot;)]
[[Don&#39;t eat it.|Main]]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Allow your pigeons to feed.]]]</tw-passagedata><tw-passagedata pid="10" name="watermelon" tags="" position="633,1282" size="100,100">A watermelon sits atop a pedestal. (if: $curses contains &quot;prophecyBird&quot;)[The room is bare of cudgels.](else:)[A cudgel leans rakishly against the wall.]

&lt;img src=&quot;WatermelonWhite.png&quot;&gt;

[[Eat the watermelon.]](if: not($curses contains &quot;prophecyBird&quot;))[
[[Cudgel the watermelon.]](if: $inventory contains &quot;cudgel&quot;)[
[[Cudgel the watermelon using your deluxe cudgel|cudgelDeluxe]]]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Feed the watermelon to your pigeons.]]]</tw-passagedata><tw-passagedata pid="11" name="Eat the watermelon." tags="" position="562,1172" size="100,100">(if: not ($cards contains &quot;peckish&quot;))[The watermelon&#39;s flesh is crisp and invigorating. Pink juice drips down your chin. You feel wonderful.

(set: $HP to it + 15)\
(set: $energy to it + 10)\
(set: $satiety to it + 15)\
(set: $cards to it + (array: &quot;peckish&quot;))(set: $uncommonCards to it + (array: &quot;peckish&quot;))\
[[But now all the watermelon has been consumed.|Main]]]\
(else:)[The watermelon&#39;s flesh is crisp and invigorating. Pink juice drips down your chin. Yet compared to the first watermelon you ate this one is strangely unsatisfying.

(set: $satiety to it + ($hunger + 1))\
[[Where can you find more?|Main]]]</tw-passagedata><tw-passagedata pid="12" name="Cudgel the watermelon." tags="" position="675,1169" size="100,100">(if: $descension &gt; 0 and (random: 1,5) &lt;=3)[You lower the cudgel. Your nerve has failed you. The watermelon belongs, here in the sub-dungeon, in precisely the same way that you don&#39;t. (set: $sanity to it - 2)

[[Try again|Cudgel the watermelon.]]
[[Eat the watermelon.]] ](else:)[When you come to you are drenched in watermelon juice. Red chunks drip from your clothing. Pinkish water drips from the pedestal. Green fragments of shell litter the floor. &lt;script&gt;audio.whine.play();&lt;/script&gt;

(set: $sanity to it - 10)\
(set: $energy to it - 10)\
(set: $cudgelCount to it + 1)(if: $cudgelCount &gt; 4 and not ($achievements contains &quot;Cudgel many watermelons&quot;))[(set: $achievements to it + (array: &quot;Cudgel many watermelons&quot;))]\
[[What have you done?|Main]]]</tw-passagedata><tw-passagedata pid="13" name="peckish2" tags="watermelon" position="304,684" size="100,100">The thought of eating another watermelon unexpectedly crosses your mind. 

Soon you can think of nothing else. You are gravid with hungers. You are tumescent with craving. 

You look carefully around you but there are no watermelons here for you to consume.

*The hungrier you are the faster your satiety will degrade, and the more things in the birthday dungeon you will be able to eat.*
(set: $hunger to it + 1)(display: &quot;hungerIcons&quot;)\
(set: $uncommonCards to it + (array: &quot;peckishCure&quot;))\

[[Press on, though your hunger grows|Main]](set: $uncommonCards to it - (array: &quot;peckish&quot;))</tw-passagedata><tw-passagedata pid="14" name="energy" tags="" position="148,743" size="100,100">It&#39;s an energy drink! In pristine condition! How did it get here?

(if: $descension &gt; 0)[The label warns of a small but non-trivial risk that the beverage contains Strychnine.

&lt;img src=&quot;energyBad.png&quot;&gt;](else:)[&lt;img src=&quot;energy.png&quot;&gt;]
(if: $decesion &gt; 0 and (random: 1,10) is 1)[
[[Drink a little|poisonDrink]]
[[Drink a lot|poisonDrink]]](else:)[
[[Drink a little]]
[[Drink it all]]]
[[Abstain]]</tw-passagedata><tw-passagedata pid="15" name="Drink a little" tags="" position="146,870" size="100,100">The sugar and caffeine invigorates you.
(set: $energy to it + 5)\

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="16" name="Drink it all" tags="" position="264,930" size="100,100">(if: (random: 1,2) is 1)[How invigorating!(set: $energy to it + 20)

[[Onwards!!|Main]]](else:)[You&#39;re more awake. 

But your mind jitters. 

Like marbles on glass.

(set: $energy to it + 20)(set: $sanity to it - 20)\
[[What&#39;s next?|Main]]]</tw-passagedata><tw-passagedata pid="17" name="satan" tags="" position="863,608" size="100,100">A battered copy of a satanic bible scuttles across the floor like a crab.

&lt;img src=&quot;book2.png&quot;&gt;

[[Sweet, a free book]]
(link: &quot;Walk briskly away&quot;)[(set: $energy to it - 5)(go-to:&quot;Main&quot;)](if: $hunger &gt; 1)[
[[Eat it|EatPeckish]]]</tw-passagedata><tw-passagedata pid="18" name="Sweet, a free book" tags="" position="997,652" size="100,100">(if: $cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;)[It scuttles away before you can reach it.

[[Onwards!|Main]]]\
(if: (random: 1, 5) is 1 and not ($inventory contains &quot;godStains&quot;))[As soon as you open the book a chill wind blows through the chamber.

You slam the book shut. What have you unleashed?

(set: $sanity to it - 10)&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $cards to it + (array: &quot;displeasedGod&quot;))(set: $cards to it - (array: &quot;satan&quot;))\
[[Onwards!|Main]]]\
(else:)[You skim through a few pages(if: $descension &gt; 0)[, and oh, the things you learn.

(either: &quot;The text speaks of the God-beneath-Gods. She is in the bloom of algae and the beginnings of decay. She sleeps in the mildewey blackness at the base of all things, though her tendrils extend far beyond the cavity where she has cloistered herself. 

Her followers leave presents for her, sometimes, in the deepest recesses of caves.&quot;, &quot;The text gives instructions on the mixing of candle wax, the preparation of human sacrifices, and the baking of cakes.&quot;)

Reading about such things proves oddly restful.](else:)[. Reading it is a restful activity.]

(set: $sanity to it + 12)\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="19" name="EatPeckish" tags="" position="723,517" size="100,100">It tastes almost exactly nothing like watermelon. You are still hungry.
(set: $satiety to it + 10)\
(set: $sanity to it - 10)\

[[Maybe you will find another watermelon soon.|Main]]</tw-passagedata><tw-passagedata pid="20" name="Stand your ground" tags="" position="1067,536" size="100,100">Blood drips down and splatters on your shoes, but you are otherwise left unharmed.

(set: $sanity to it - 10)\
(if: $ghostFriend is 1)[(set: $ghostFriend to 2)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="21" name="potion" tags="" position="187,491" size="100,100">Three potions sit on a wooden shelf. (if: $descension &lt; 1)[Which will you drink?(set: $r to 25)

&lt;img src=&quot;potions.png&quot;&gt;](else:)[These bottles are covered in dust, the colours of the liquids faded; they have lost some of their potency.(set: $r to 20)

&lt;img src=&quot;potionsOld.png&quot;&gt;]

(set: $potions to (shuffled: ...(array: &quot;[[The sparkling red one]]&quot;,&quot;[[The dull green one]]&quot;,&quot;[[The bright pink one]]&quot;,&quot;[[The thick white one]]&quot;)))(if: $inventory contains &quot;poisoned&quot;)[(set: $potions to it + (array: &quot;[[The antidotical one]]&quot;))]\
[(print: $potions&#39;s 1st)]&lt;potion1|
[(print: $potions&#39;s 2nd)]&lt;potion2|
[(print: $potions&#39;s 3rd)]&lt;potion3|
(if: (random: 1,100) &lt;=15)[(set: $replacePotion to (either: &quot;?potion1&quot;, &quot;?potion2&quot;, &quot;?potion3&quot;))(replace: $replacePotion)[[[The clear colourless one]]]]\
(if: (random: 1,100) &lt;=14)[(set: $replacePotion to (either: &quot;?potion1&quot;, &quot;?potion2&quot;, &quot;?potion3&quot;))(replace: $replacePotion)[[[The sleek grey one]]]]\
[[All of them, mixed together|All of them]]</tw-passagedata><tw-passagedata pid="22" name="The sparkling red one" tags="" position="38,529" size="100,100">You feel healthier. Your cuts and grazes have partly healed. Even your eyesight seems sharper than usual. What&#39;s in this stuff?

(set: $HP to it + $r)\
[[Onwards!|Main]]
</tw-passagedata><tw-passagedata pid="23" name="The thick white one" tags="" position="359,471" size="100,100">It tastes of nothing much as it slides lumpily down your throat. You feel blandly nourished.

(set: $satiety to it + $r)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="24" name="Is there more?" tags="" position="16,703" size="100,100">You drain the bottle faster than usual. Your hands are clammy; your muscles are cramping; your teeth clench. It wasn&#39;t enough.

(set: $HPdrain to 1)\
[[Onwards?|Main]]</tw-passagedata><tw-passagedata pid="25" name="altar" tags="" position="1075,1329" size="100,100">You encounter a shrine dedicated to a squid-faced god-thing.(if: $descension &gt; 0)[ The shrine appears poorly maintained; (if: not ($cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;))[the candles are unlit, and ]blood has seeped too deeply into the stone to ever be scrubbed clean.(set: $sanity to it -1)](set: $r to (random: 1,5))(if: $r is 1 and not ($cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;))[

Somebody has left a cookie on the altar.(set: $r to 10)]

(if: $cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;)[&lt;img src=&quot;shrineBad.png&quot;&gt;](else-if: $descension &gt; 0)[&lt;img src=&quot;shrine2.png&quot;&gt;](else:)[&lt;img src=&quot;shrine.png&quot;&gt;]
(if: $cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;)[
[[Appease it with a sacrifice]](if: $inventory contains &quot;soul&quot;)[
[[Offer it your soul in apology]] *You can only do this once*]
[[Defy it once more|Knock the shrine over]]]\
(else:)[
[[Pray]]
[[Spit on the statue]]](if: $hunger &gt; 1)[
[[Eat the candles]]](if: $hunger &gt; 2)[
[[Eat the statue|EatStatue]]](if: $r is 10)[
[[Take the cookie]]](if: $ankh &gt; 0)[
[[Place your ankh on the altar]]](if: $cookies&#39;s basic &gt; 0)[
[[Place a chocolate chip cookie on the altar]]](if: $inventory contains &quot;socks&quot;)[
[[Place your socks on the altar]]]
[[Move on]]</tw-passagedata><tw-passagedata pid="26" name="All of them" tags="" position="148,618" size="100,100">(set: $HP to it + (random: -23, 25))\
(set: $sanity to it + (random: -23, 25))\
(set: $energy to it + (random: -23, 25))\
(set: $satiety to it + (random: -23,25))\
[[Was that wise?|Main]]</tw-passagedata><tw-passagedata pid="27" name="Pray" tags="" position="959,1453" size="100,100">(if: $inventory contains &quot;godStains&quot;)[You have eaten the only one who could answer your prayer.

[[Oh well.|Main]]]\
(else-if: $tentacled &gt;=4)[You kneel before the altar. One hand clasps the other; your tentacles likewise pair up and press together.

You sacrifice some sanity but are richly rewarded. (set: $HP to it + 30)(set: $sanity to it - 20)]\
(else:)[You sacrifice some sanity but are rewarded in other ways.

(set: $sanity to it - 15)\
(set: $HP to it + 15)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="28" name="Move on" tags="" position="1087,1204" size="100,100">You feel the statue&#39;s eyes following you as you walk away.

(set: $sanity to it - 5)\
[[Onwards?|Main]]</tw-passagedata><tw-passagedata pid="29" name="EatStatue" tags="" position="1222,1304" size="100,100">(if: $inventory contains &quot;godStains&quot;)[Nothing bad will come of this. There is no deity left to punish you for what you have done.

(set: $satiety to it + 5)\
[[Hooray.|Main]]]\
(else:)[As parts of the statue disappear down your throat -- the fingers first, then the ears, then the face -- you can&#39;t shake the feeling that something vast and ancient is becoming increasingly angry. But at least you feel less hungry.

(set: $satiety to it + 5)\
(if: not ($cards contains &quot;displeasedGod&quot;))[&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $cards to it + (array: &quot;furiousGod&quot;))](else:)[&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $cards to it + (array: &quot;displeasedGod&quot;))]\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="30" name="displeasedGod2" tags="demon" position="332,1514" size="100,100">You double over in pain, terror and exhaustion. Some ancient deity must be displeased with you.

(link: &quot;There&#39;s nothing to be done.&quot;)[(set: $HP to it - 8)(set: $sanity to it - 8)(set: $satiety to it -8)(set: $energy to it -8)&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="31" name="Spit on the statue" tags="" position="960,1328" size="100,100">(if: $inventory contains &quot;godStains&quot;)[Nothing bad will come of this. There is no deity left to punish you for what you have done.

(set: $sanity to it + 5)\
[[Hooray.|Main]]]\
(else:)[Spitting on the statue makes you feel brave. This was an excellent idea.

(set: $sanity to it + 10)\
(if: (random:1,3) is 1)[&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $cards to it + (array: &quot;displeasedGod&quot;))]\
[[Surely nothing bad will come of it.|Main]]]</tw-passagedata><tw-passagedata pid="32" name="Propose a trade" tags="" position="1156,303" size="100,100">It leans in close and does... something... with its bloody mouth.

By the time it finishes you feel healthier, though also horrified.

(set: $HP to it + 15)\
(set: $sanity to it - 8)\
(if: $ghostFriend is 3)[(set: $ghostFriend to 4)]\
[[Seems fair|Main]]</tw-passagedata><tw-passagedata pid="33" name="You are dead" tags="" position="118,1243" size="100,100">&lt;script&gt;
stopaudio();
&lt;/script&gt;(if: $inventory contains &quot;boatNote&quot;)[(display: &quot;boatNote&quot;)](if: $inventory contains &quot;soulless&quot;)[You are dead. But you once struck a bargain with the boatman; your soul in exchange for passage back to the land of the living.(set: $HP to 40)(set: $energy to 40)(set: $satiety to (40 + $hunger))(set: $sanity to 40)(set: $inventory to it - (array: &quot;soulless&quot;))

[[The deal is concluded|Main]]](else-if: $inventory contains &quot;diamond&quot;)[Oars pull through black water. A small lantern has been affixed to the boat&#39;s prow. It casts a faint white light; all else is darkness.

The boatman&#39;s face is in shadow. He says nothing.

(link: &quot;Barter your diamond for passage back to the dungeon&quot;)[(set: $HP to 60)(set: $energy to 60)(set: $satiety to (60 + $hunger))(set: $sanity to 60)(set: $delayExecute to false)(set: $inventory to it - (array: &quot;diamond&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sDiamond.png&quot;&gt;&#39;))(set: $rareCards to it + (array: &quot;heist&quot;))(if: not ($achievements contains &quot;Sell a diamond&quot;))[(set: $achievements to it + (array: &quot;Sell a diamond&quot;))](go-to: &quot;Main&quot;)]](else:)[You are extremely, irrevocably dead. This has been a disappointing birthday.

&lt;img src=&quot;skull.png&quot;&gt;

(if: $ankh is 1 and not ($descension &gt; 1))[Fortunately, you have something that can help in situations such as these.

(if: not ($achievements contains &quot;Come back from the dead&quot;))[(set: $achievements to it + (array: &quot;Come back from the dead&quot;))]\
(link: &quot;Give up your ankh to return to the dungeon&quot;)[(set: $HP to 40)(set: $energy to 40)(set: $satiety to (40 + $hunger))(set: $sanity to 40)(set: $ankh to 0)(set: $icons to it - (array: &#39;&lt;img src=&quot;sAnkh.png&quot;&gt;&#39;))(set: $delayExecute to false)(go-to: &quot;Main&quot;)]]\
(else:)[&lt;script&gt;
audio.sadEnd.play();
&lt;/script&gt;(set: $finalExecute to &#39;(display: &quot;ended&quot;)&#39;)(display: &quot;GameOver&quot;)]]</tw-passagedata><tw-passagedata pid="34" name="You are insane" tags="" position="1,1249" size="100,100">&lt;script&gt;
stopaudio();
&lt;/script&gt;(if: $loaded is true)[(go-to: &quot;init&quot;)]\
Your body may still be alive, but whatever you once understood yourself to be is gone. (if: $blessings contains &quot;mindlessness&quot;)[Luckily, there&#39;s still a chance you can recover.

&lt;img src=&quot;brain.png&quot;&gt;

(link: &quot;Try to shake off this madness&quot;)[(if: (random: 1, 100)&lt;=66)[(set: $sanity to 20)(go-to: &quot;insaneFix&quot;)](else:)[(go-to: &quot;insane2&quot;)]]](else:)[

Happy birthday.

&lt;img src=&quot;brain.png&quot;&gt;

(set: $finalExecute to &#39;(display: &quot;ended&quot;)&#39;)&lt;script&gt;
audio.sadEnd.play();
&lt;/script&gt;(display: &quot;GameOver&quot;)]</tw-passagedata><tw-passagedata pid="35" name="peckishCure" tags="" position="1674,524" size="100,100">A damp mime lurks in the corner of the room. He gestures for you to come closer.

&quot;I know that look in your eyes&quot; he whispers. &quot;The hunger. I can take it away.&quot;

He pauses. A droplet of water falls from his nose and splashes into the puddle at his feet.

&quot;You won&#39;t have to suffer anymore.&quot;

&lt;img src=&quot;mime.png&quot;&gt;

[[Thank him.]]
[[Eat him.]]</tw-passagedata><tw-passagedata pid="36" name="Thank him." tags="" position="1480,550" size="100,100">&quot;All shall be well.&quot;

(set: $hunger to 1)(display: &quot;hungerIcons&quot;)\
(set: $uncommonCards to it - (array: &quot;peckishCure&quot;))\
(set: $uncommonCards to it - (array: &quot;peckish&quot;))(set: $cards to it - (array: &quot;peckish&quot;))\
[[Your hunger is dimished.|Main]]</tw-passagedata><tw-passagedata pid="37" name="Eat him." tags="" position="1525,420" size="100,100">He doesn&#39;t resist. But you are still hungry. 

(if: not ($achievements contains &quot;Refuse a cure&quot;))[(set: $achievements to it + (array: &quot;Refuse a cure&quot;))]\
(set: $satiety to it + 5)\
[[Nothing is left for you here.|Main]]</tw-passagedata><tw-passagedata pid="38" name="presents" tags="" position="387,1665" size="100,100">(if: $descension &gt; 0)[A glowering sub-dungeon slime (if: $card is &quot;trap&quot;)[emerges from the wardrobe and ]demands you choose a present. There are three options, each wrapped in recycled paper and bound in austere lengths of twine.](else:)[(either: &quot;A bashful&quot;, &quot;A brash&quot;, &quot;An enigmatic&quot;, &quot;A glistening&quot;, &quot;A translucent&quot;, &quot;An energetic&quot;, &quot;A shy&quot;, &quot;A cantankerous&quot;, &quot;An enthusiastic&quot;, &quot;A soft-spoken&quot;, &quot;A gregarious&quot;, &quot;A brusque&quot;, &quot;An agile&quot;, &quot;A friendly&quot;, &quot;A cautious&quot;, &quot;A recalcitrant&quot;) dungeon slime (if: $card is &quot;trap&quot;)[emerges from the wardrobe and ]offers you a choice of birthday presents.]
(set: $gift to (array: &quot;[[The gift of health]]&quot;,&quot;[[The gift of lucidity]]&quot;,&quot;[[The gift of energy]]&quot;,&quot;[[The gift of chocolate]]&quot;,&quot;[[A well-rounded gift]]&quot;))\
(if: (random: 1,5) &gt;=3)[(set: $gift to it + (array: &quot;[[Average juice]]&quot;))]\
(if: (random: 1,5) &gt;=3)[(set: $gift to it + (array: &quot;[[Dynamite]]&quot;))]\
(if: (random: 1,5) &gt;=3)[(set: $gift to it + (array: &quot;[[Breadcrumbs]]&quot;))]\
(if: $ankh is 0 and (random: 1,5) &gt;=2)[(set: $gift to it + (array: &quot;[[A metal cross with a handle]]&quot;))]\
(if: (random: 1,4) is 1)[(set: $gift to it + (array: &quot;[[A key]]&quot;))]\
(if: (random: 1,3) is 1)[(set: $gift to it + (array: &quot;[[A hat]]&quot;, &quot;[[A box full of live snakes]]&quot;))]\
(if: (random: 1,5) &gt;=2)[(set: $gift to it + (array: &quot;[[A cookie]]&quot;))]\
(if: $descension &gt; 0)[(set: $gift to it + (array: &quot;[[An enigma]]&quot;, &quot;[[An extra-enigmatic enigma]]&quot;))]\
(if: $crumbed&#39;s length &gt; 0 and (random: 1,2) is 1 and not ($inventory contains &quot;amulet&quot;))[(set: $gift to it + (array: &quot;[[A gleaming beige amulet]]&quot;))]\
(if: (random: 1,5) &gt;=4 and not ($inventory contains &quot;runners&quot;))[(set: $gift to it + (array: &quot;[[New runners]]&quot;))]\
(if: (random: 1,5) &gt;=3 and not ($inventory contains &quot;socks&quot;))[(set: $gift to it + (array: &quot;[[Running socks]]&quot;))]\
(if: $curses contains &quot;badCat&quot;)[(set: $gift to it + (array: &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;))]\
(set: $gift to (shuffled: ...$gift))\

(if: $descension &gt; 0)[&lt;img src = &quot;presentBrown.png&quot;&gt;](else:)[(if: (random:1,3) is 3)[&lt;img src=&quot;present.png&quot;&gt;](else-if: (random:1,2) is 2)[&lt;img src=&quot;present2.png&quot;&gt;](else:)[&lt;img src=&quot;present3.png&quot;&gt;]]

(print: 1st of $gift)
(print: 2nd of $gift)
(print: 3rd of $gift)(if: $inventory contains &quot;photocopies&quot;)[

[[Hand the gift-giver a photocopy of the Treatise on the Treachery of Crabs|Share the treatise]]]</tw-passagedata><tw-passagedata pid="39" name="The gift of health" tags="" position="386,1793" size="100,100">You receive a box of (either: &quot;dinosaur&quot;,&quot;space&quot;,&quot;pirate&quot;)-themed bandaids. These will come in handy.

(set: $HP to it + 35)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="40" name="The gift of lucidity" tags="" position="510,1790" size="100,100">The box is empty, but it comes accompanied by a loving card. Reading it makes you feel safe and calm.

(set: $sanity to it + 35)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="41" name="The gift of energy" tags="" position="260,1790" size="100,100">Amphetamines! How thoughtful! You feel more energised than ever.

(set: $energy to it + 35)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="42" name="The gift of chocolate" tags="" position="262,1665" size="100,100">It&#39;s delicious.

(set: $satiety to it + 35)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="43" name="New runners" tags="" position="387,1915" size="100,100">It&#39;s a new pair of runners! They fit snugly on your feet.

&lt;img src=&quot;shoe.png&quot;&gt;

*These will increase your chance of succesfully fleeing any monsters you encounter, especially when running very fast. (if: $inventory contains &quot;cookieClogs&quot;)[The runners have replaced the enchanted clogs.(set: $inventory to it - (array: &quot;cookieClogs&quot;))]*

(set: $inventory to it + (array: &quot;runners&quot;))(set: $icons to it + (array: &quot;&lt;img src = &#39;sRunners.png&#39;&gt;&quot;))\
(set: $fleeBonus to it + 10)(set: $runBonus to it + 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="44" name="HPMax" tags="" position="1855,1470" size="100,100">Although you feel healthier than ever, the rest of you begins to suffer.

*Careful! If any stat gets too high it may have a detrimental effect on the others.*

(set: $HP to $statMax)(set: $sanity to it - 15)(set: $energy to it - 15)(set: $satiety to it - 15)\
(if: $strangeBrew is 1)[(set: $strangeBrew to 0)[[I understand.|strangeBrew]]](else:)[[[I understand|Main]]]</tw-passagedata><tw-passagedata pid="45" name="sanityMax" tags="" position="1836,1600" size="100,100">Your mind feels clear and sharp, but the rest of you feels worse than ever.

*Careful! If any stat gets too high it may have a detrimental effect on the others.*

(set: $sanity to $statMax)\
(set: $HP to it - 15)\
(set: $energy to it - 15)\
(set: $satiety to it - 15)\
[[I understand|Main]]</tw-passagedata><tw-passagedata pid="46" name="satietyMax" tags="" position="1972,1503" size="100,100">While your hunger is finally sated, you are beginning to notice the ill effects of your diet.

*Careful! If any stat gets too high it may have a detrimental effect on the others.*

(set: $satiety to $statMax)\
(set: $HP to it - 15)\
(set: $energy to it - 15)\
(set: $sanity to it - 15)\
[[I understand|Main]]</tw-passagedata><tw-passagedata pid="47" name="energyMax" tags="" position="1958,1608" size="100,100">You are alert to the point of skittishness, but the rest of you feels worse than ever.

*Careful! If any stat gets too high it may have a detrimental effect on the others.*

(set: $energy to $statMax)\
(set: $HP to it - 15)\
(set: $sanity to it - 15)\
(set: $satiety to it - 15)\
[[I understand|Main]](set: $roomExecute to it - (array: &#39;(set: $energy to it + 1)&#39;))\</tw-passagedata><tw-passagedata pid="48" name="spikes" tags="" position="1052,786" size="100,100">(if: $cardHistory contains &quot;spikes&quot;)[You are beginning to notice things about this dungeon that you didn&#39;t before. For instance: there is almost certainly a spike pit hidden under that rug.

&lt;img src=&quot;spikes.png&quot;&gt;

[[Walk around it]]
[[Step on it anyway]]]\
(else:)[The soles of your feet are impaled on a cleverly-hidden spike trap.

&lt;img src=&quot;spikes.png&quot;&gt;

(set: $HP to it - 10)\
[[Calamity!|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="49" name="Appease it with a sacrifice" tags="" position="1214,1459" size="100,100">You place a hand on the shrine. When you lift it back up you feel weaker. Wearier. Your bones ache; your gums bleed. But the sensation of being watched by some ancient power is gone.

(set: $HP to it - 18)(set: $energy to it - 18)\
(set: $cards to it - (array: &quot;displeasedGod&quot;))(set: $cards to it - (array: &quot;furiousGod&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="50" name="Try to bat it away" tags="" position="1788,796" size="100,100">It flops wetly and disgustingly against your hand.

(set: $sanity to it - $monster&#39;s damage)\
[[Gross.|Main]]</tw-passagedata><tw-passagedata pid="51" name="couch" tags="" position="1786,1050" size="100,100">Your legs ache. You need a rest.

A couch is in the middle of the room. It looks comfortably plush. 

*Careful! Your energy is getting low*

&lt;img src=&quot;couch.png&quot;&gt;

[[Rest a while]]
(link: &quot;Push on&quot;)[(set: $energy to it - 5)(go-to: &quot;Main&quot;)](if: $poopKey is 1)[
[[Search for an item you know to be hidden in the room|couchKey]]]</tw-passagedata><tw-passagedata pid="52" name="Rest a while" tags="" position="1887,1218" size="100,100">(if: (random: 1, 2) is 1)[No sooner do you sit down than the couch begins to fold in on itself. You feel something hard and piercing beneath the cushions. Teeth!

You barely manage to  wrench your arm out from between the cushions before the couch clamps shut completely.

*Some options may have different effects each time you play them. This was an unlucky outcome.*(set: $HP to it - 15)&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;

[[Onwards!|Main]]]\
(else:)[You rest for a pleasant interlude. By the time you rise up you feel somewhat refreshed.

*Some options may have different effects each time you play them. This was a lucky outcome.*

(set: $energy to it + 10)\
[[Time to move on|Main]]]</tw-passagedata><tw-passagedata pid="53" name="hunger" tags="" position="895,498" size="100,100">(if: $direction&#39;s direction is not &quot;north&quot;)[The room smells like cookies. (if: (random: 1,8) &gt; 3)[(link: &quot;Your stomach rumbles.&quot;)[(set: $satiety to it - (3+ (floor: 1.5 * $hunger)))(go-to: &quot;Main&quot;)]](else:)[You think you can sense where the smell is coming from.

[[Investigate]]
(link: &quot;Move on&quot;)[(set: $satiety to it - (3+ (floor: 1.5 * $hunger)))(go-to: &quot;Main&quot;)]]]\
(else:)[This room smells like cookies. 

With your mind fixated on the North, you barely notice. 

(set: $satiety to it - 1)\
[[North.|Main]]]</tw-passagedata><tw-passagedata pid="54" name="dice" tags="" position="488,933" size="100,100">(set: $satiety to it + $hunger)(set: $diceCooldown to $turns + 1)\
(display: &quot;Main&quot;)</tw-passagedata><tw-passagedata pid="55" name="Step on it anyway" tags="" position="1053,913" size="100,100">Your feet hurt terribly.

(if: not ($achievements contains &quot;Make the same mistake twice&quot;))[(set: $achievements to it + (array: &quot;Make the same mistake twice&quot;))]\
(set: $HP to it - 12)\
[[Onwards!|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="56" name="A metal cross with a handle" tags="" position="512,1665" size="100,100">It is a metal cross with a handle.

This may save you should you ever find yourself being rowed across a sunless river.

(set: $ankh to 1)\
[[But let&#39;s hope it doesn&#39;t come to that.|Main]](set: $icons to it + (array: &#39;&lt;img src=&quot;sAnkh.png&quot;&gt;&#39;))</tw-passagedata><tw-passagedata pid="57" name="slime" tags="" position="1908,1353" size="100,100">(set: $r to (random: 1,10))\
You find a vial of gelatinous slime. (if: $r is 1 and $cardHistory contains &quot;slime&quot;)[This vial shakes especially violently. It&#39;s almost as though the slime is trying to escape.](else:)[It seems to be quivering of its own accord.]

(set: $slimeVisit to true)\
(if: $descension is 0)[&lt;img src=&quot;vial.png&quot;&gt;](else:)[&lt;img src=&quot;vial2.png&quot;&gt;]

[[Smell it.]]
[[Rub it on your wounds.]](if: $hunger &gt; 1)[
[[Eat it.|EatPeckish]]](if: $r is 1 and $cardHistory contains &quot;slime&quot;)[
[[Release it.]]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Allow your pigeons to feed.|slimeFeed]]]
[[No. Don&#39;t do any of those things.]]</tw-passagedata><tw-passagedata pid="58" name="Smell it." tags="" position="1708,1434" size="100,100">(if: $descension &gt; 0)[The liquid has the comforting aroma of home: of starlight and star-gas; of the gentle shaping influence of the flute-kings; of loneless solitude and shapeless roiling unity with innumerable brethren.

You are far from home. (Are you?) These memories will sustain you through your peregrinations. (Will they?)

Some of the liquid splashes on your skin. You barely notice.(set: $sanity to it + 18)(set: $HP to it - 10)

]\
(else:)[(set: $HP to it - 10)(set: $energy to it + 18)(if: (random: 1,10) is 1)[It smells lemony and caustic and bracing. You feel alert and energised.

Some splashes on your legs. It stings, but beneath the pain you sense the slime coalesce with you, and you with it.

Your muscles unstich and re-knit. You are faster than before. (You are also less yourself; but maybe that doesn&#39;t matter.) (set: $fleeBonus to it + 10) 

]\
(else:)[It smells lemony and bitter and caustic. When some splashes on you it burns like acid. (Was this caused by clumsiness on your part, or is the stuff inside the vial trying to escape?)

The scent is bracing, in its own way. You feel alert and energised.

]]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="59" name="Rub it on your wounds." tags="" position="1561,1322" size="100,100">(set: $tentacled to it + (either: 0,0,1,1,2,3))(if: $tentacled &gt;=4)[(if: not ($achievements contains &quot;Grow your very own tentacles&quot;))[(set: $achievements to it + (array: &quot;Grow your very own tentacles&quot;))]\
(if: not($cards contains &quot;tentacles&quot;))[(set: $cards to it + (array: &quot;tentacles&quot;))]\
You are beginning to quite look forward to applying the slime to your wounds. Your tentacles quiver with anticipation.

(Have you always had tentacles? You&#39;re not sure, but you don&#39;t think so. Could their recent growth have anything to do with your use of the slime? It&#39;s an unsettling thought. But surely not.)

&lt;img src=&quot;tentacle.png&quot;&gt;]\
(else:)[The jelly burns, but it also seems to help your wounds. The muscles stitch together and your skin regrows. Only it regrows strangely; you might not be hurt anymore, but these parts of your body feel rubbery and misshapen.]\


(set: $HP to it + 15)\
(set: $sanity to it - 10)\
[[So it goes.|Main]]</tw-passagedata><tw-passagedata pid="60" name="Dynamite" tags="" position="137,1915" size="100,100">Dynamite! You&#39;ll be able to blow something up using this.

&lt;img src=&quot;dynamite.png&quot;&gt;

(set: $trash to it + 1)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="61" name="remove this location from the dungeon" tags="" position="742,928" size="100,100">(if: $card is &quot;exit&quot; and not ($achievements contains &quot;Destroy the exit&quot;))[(set: $achievements to it + (array: &quot;Destroy the exit&quot;))]\
(if: $card is &quot;crabRoom&quot; and not ($achievements contains &quot;Foil a conspiracy&quot;))[(set: $achievements to it + (array: &quot;Foil a conspiracy&quot;))]\
(set: $cards to it - (array: $card))\
(set: $uncommonCards to it - (array: $card))\
(set: $rareCards to it - (array: $card))\
(set: $crumbed to it - (array: $card))\
(set: $trash to it - 1)\
(set: $delayExecute to false)\
(if: $card is &quot;altar&quot;)[(go-to: &quot;furiousGod&quot;)]\
A sharp explosion and the room is gone(if: $cards is &quot;crabRoom&quot;)[, destroying the crabs in the process]. You&#39;ll never see this part of the dungeon again.(if: $blessings contains &quot;explosiveness&quot;)[

Explodia approves of your actions. She blesses your body and mind(set: $HP to it + 10)(set: $sanity to it + 10)(set: $energy to it + 10)(set: $satiety to it + 10)(if: (random: 1,3) is 1)[, and even replaces your used stick of dynamite with a fresh one(set: $trash to it + 1)].]

*You have (print: $trash) dynamite remaining.*

(if: (random: 1,5) is 1)[The blast has broken a hole in the back wall, revealing a lightless chamber and an undamaged treasure chest.(display: &quot;stockGifts&quot;)

[[What&#39;s inside?|(print: 1st of (shuffled: ...$gift))]]](else:)[[[Onwards!|Main]]]&lt;script&gt;audio.boom.play();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="62" name="Eat them all, including the bottles" tags="" position="424,344" size="100,100">(set: $HP to it + (random: -25, -1))\
(set: $sanity to it + (random: -25, 25))\
(set: $energy to it + (random: -25, 25))\
(set: $satiety to it + (random: 10, 30))\
You are less hungry. But the glass sits uncomfortably in your stomach.

[[Was that wise?|Main]]</tw-passagedata><tw-passagedata pid="63" name="No. Don&#39;t do any of those things." tags="" position="1668,1323" size="100,100">(if: $descension &lt; 1)[(set: $sanity to it + 5)\
[[That&#39;s probably wise.|Main]]]\
(else:)[The slime quavers reproachfully as you leave. (set: $sanity to it + 3)

[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="64" name="monsters1" tags="" position="1287,936" size="100,100">It&#39;s a horde of zombies! They shuffle slowly yet inexorably toward you.

(set: $zombieVisits to it + 1)\
(if: $zombieVisits &gt; 1)[They have become more numerous, and correspondingly more difficult to outrun, since last time you saw them.

(if: ($monster&#39;s fleeChance + $fleeBonus) &gt; 100)[(set: $zombieFleeChance to 100 - $fleeBonus)]\
(set: $zombieFleeChance to it - (random: 1,5))]\
(set: $monster to (datamap: &quot;fleeChance&quot;, $zombieFleeChance, &quot;damage&quot;, 7, &quot;type&quot;, &quot;poison&quot;))\
&lt;img src=&quot;zombies.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="65" name="Average juice" tags="" position="123,1662" size="100,100">Average juice! It&#39;s a slimy grey colour.

&lt;img src=&quot;juice.png&quot;&gt;

(set: $drink to it + 1)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="66" name="A well-rounded gift" tags="" position="132,1790" size="100,100">The box contains a small sampling of all the dungeon&#39;s finest offerings. How nice.

(set: $HP to it + 5)\
(set: $sanity to it + 5)\
(set: $satiety to it + 5)\
(set: $energy to it + 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="67" name="Place your ankh on the altar" tags="" position="1084,1454" size="100,100">(if: $dice is 0)[Nothing seems to happen when you leave your ankh on the altar.

But when you later place your hands in your pocket your fingers curl around a metallic 20-sided dice that wasn&#39;t there before. It feels curiously warm to the touch.

&lt;img src=&quot;twentysided.png&quot;&gt;

(set: $ankh to 0)(set: $icons to it - (array: &#39;&lt;img src=&quot;sAnkh.png&quot;&gt;&#39;))\
(set: $diceCooldown to $turns)\
(if: not ($achievements contains &quot;Upgrade an item&quot;))[(set: $achievements to it + (array: &quot;Upgrade an item&quot;))]\
[[The dice giveth and the dice taketh away.|Main]]]\
(else:)[Nothing happens when you leave your ankh on the altar.

(set: $ankh to 0)\
[[So it goes.|Main]]]</tw-passagedata><tw-passagedata pid="68" name="monster" tags="" position="1314,1056" size="100,100">(set: $monster&#39;s damage to (round: it * $damageModify))\
(set: $delayExecute to &quot;(set: $cardSelect to it - $monsters)&quot;)\
(if: (random: 1,6) is 1)[You&#39;re in an awkward position, and your foe is close by. The odds of escape are worse than usual.
(set: $monster&#39;s fleeChance to it - (15 + (round:$fleeBonus/2)))
]\
(else-if: $descension is 0 and (random: 1,6) is 1)[You&#39;re right near the door, and your foe is not especially close by. You have a better chance of escape than usual.
(set: $monster&#39;s fleeChance to it + (10 + (round: $fleeBonus /2)))
]\
(link: &quot;Run&quot;)[(set: $runDrain to 5)(go-to: &quot;Run&quot;)] *(|r&gt;[(min: 100, (max: 0, (abs: $monster&#39;s fleeChance + $fleeBonus)))]% chance of success)*
(link: &quot;Run extra fast&quot;)[(if: $blessings contains &quot;rattiness&quot;)[(set: $runDrain to 10)](else:)[(set: $runDrain to 15)](set: $monster&#39;s fleeChance to it + $runBonus)(go-to: &quot;Run&quot;)]*(|r&gt;[(min: 100, (max: 0, (abs: $monster&#39;s fleeChance + $fleeBonus + $runBonus)))]% chance of success)*(if: $monster contains &quot;bonus&quot;)[
[[(print: $monster&#39;s bonus)]]](if: $hunger &gt; 2 and not ($monster&#39;s type is &quot;skeleton&quot;))[
[[Feast|EatMonster]]](if: not($monster contains &quot;wait&quot;) and not ($monster&#39;s type is &quot;eyeball&quot;) and not ($hunger &gt; 2))[
[[Curl up in a ball on the floor|Wait, defenceless]]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Ask your pigeons to attack]] *((print: $ally&#39;s health)% health)*](if: $inventory contains &quot;arrow&quot;)[
(link: &quot;Wield your spear and attack&quot;)[(set: $monster&#39;s fleeChance to it - 25)(go-to: &quot;arrow&quot;)]*((if: ($monster&#39;s fleeChance + $fleeBonus - 25) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus - 25 &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus - 25))]% chance of success)*](if: $inventory contains &quot;dog&quot;)[
[[Use your dog to cause a distraction]]](if: $inventory contains &quot;freezeRay&quot;)[
(link-replace: &quot;Fire your freezeray&quot;)[&lt;script&gt;audio.freeze.play();&lt;/script&gt;(if: (random: 1,2) is 1)[*Your aim is true! The threat is frozen in place. For now.*(set: $fleeChance to 500)(replace: ?r)[100]](else:)[*You miss*]]]</tw-passagedata><tw-passagedata pid="69" name="EatMonster" tags="" position="1242,1172" size="100,100">Your meal doesn&#39;t go down easy.

(set: $HP to it - (floor: $monster&#39;s damage * 1.2))(set: $satiety to it + 10)\
[[Endure.|Main]]</tw-passagedata><tw-passagedata pid="70" name="Running socks" tags="" position="262,1915" size="100,100">(either: &quot;New&quot;, &quot;Used&quot;) running socks! They are off-white, and feature a repeating pattern of (either: &quot;triangles&quot;, &quot;squares&quot;, &quot;polka-dots&quot;, &quot;kittens&quot;, &quot;newspapers&quot;, &quot;christmas trees&quot;, &quot;party hats&quot;, &quot;flowers&quot;, &quot;mermaids&quot;, &quot;pots and pans&quot;, &quot;baseball gloves&quot;, &quot;watermelon slices&quot;, &quot;crabs&quot;).

&lt;img src=&quot;sock.png&quot;&gt;

(set: $inventory to it + (array: &quot;socks&quot;))(set: $icons to it + (array: &quot;&lt;img src=&#39;sSock.png&#39;&gt;&quot;))(set: $socks to (datamap: &quot;speed&quot;, 10, &quot;cookie&quot;, 0, &quot;blessing&quot;, 0))(set: $fleeBonus to it + 10)\
*These will increase your chance of succesfully fleeing any monsters you encounter*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="71" name="crabs" tags="" position="1167,1886" size="100,100">You find a solitary manilla folder on a rotting writing desk. Inside it are photographs of crabs, printouts from carcinology journals, anatomical illustrations of decapods, and a crumpled ink-stained note.

It is titled *A Treatise on the Treachery of Crabs.* The handwriting is neat but the text is fragmented to the point of being nearly indecipherable. It ends by claiming that &quot;the crabs are, and have always been, our enemies. Until we unite against them any one of us might be the next victim.&quot;

&lt;img src=&quot;note.png&quot;&gt;

[[Laugh]]
[[Crumple it up]]
[[Nod sagely and place the note in your pocket]](if: $hunger &gt; 1)[
[[Eat the note]]]</tw-passagedata><tw-passagedata pid="72" name="Laugh" tags="" position="1232,2039" size="100,100">You laugh until your sides ache. The laughter wears you out, but it also does wonders for your mood.

(set: $sanity to it + 20)\
(set: $energy to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="73" name="Crumple it up" tags="" position="1037,1905" size="100,100">The note is unsettling and you want nothing more to do with it.

(set: $sanity to it - 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="74" name="Nod sagely and place the note in your pocket" tags="" position="1275,1921" size="100,100">It all makes sense. You must find a way to spread this vital information.

(set: $rareishCards to it - (array: &quot;crabs&quot;))(set: $rareishCards to it + (array: &quot;crabRoom&quot;))\
(set: $inventory to it + (array: &quot;crabNote&quot;))\
(set: $sanity to it - (ceil: $sanity / 2))\
(set: $sanity to it - 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="75" name="Wait, defenceless" tags="" position="1385,1292" size="100,100">(if: $monster&#39;s type is &quot;slime&quot;)[(go-to: &quot;slimeAttack&quot;)]It takes a full minute before the savaging finishes and you can rise unsteadily to your feet.&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;

(set: $HP to it - ($monster&#39;s damage))(if: $monster&#39;s type is &quot;mawbeast&quot;)[(set: $satiety to it - 10)](if: $monster&#39;s type is &quot;skull&quot;)[(set: $sanity to it - ($monster&#39;s damage))](if: $monster&#39;s type is &quot;fish&quot;)[(set: $sanity to it - (round: $monster&#39;s damage / 2.5))](if: $monster&#39;s type is &quot;poison&quot; and not ($blessings contains &quot;rattiness&quot;))[To make matters even worse, you&#39;ve been poisoned.

(set: $inventory to it + (array: &quot;poisoned&quot;))(if: not($cards contains &quot;antidote&quot;))[(set: $cards to it + (array: &quot;antidote&quot;, &quot;antidote&quot;))]](if: $monster&#39;s type is &quot;wasp&quot;)[The dungeon seems plasticky and unreal. The wasp&#39;s sting might be beginning to affect you.

(set: $cards to it - (array: &quot;wasp&quot;))(set: $sanity to it - 1)(set: $cards to it + (array: &quot;visions&quot;, &quot;visions&quot;, &quot;visions&quot;))(if: not ($icons contains &#39;&lt;img src=&quot;sVisions.png&quot;&gt;&#39;))[(set: $icons to it + (array: &#39;&lt;img src=&quot;sVisions.png&quot;&gt;&#39;))]]\
[[... onwards|Main]]</tw-passagedata><tw-passagedata pid="76" name="The bright pink one" tags="" position="38,406" size="100,100">You feel a surge of energy. You should go do things! Right now!

(set: $energy to it + $r)\
[[Onwards!!!|Main]]</tw-passagedata><tw-passagedata pid="77" name="The dull green one" tags="" position="314,349" size="100,100">Your mind slows; your panic congeals. You feel lucid and steady.

(set: $sanity to it + $r)\
[[Onwards.|Main]]</tw-passagedata><tw-passagedata pid="78" name="Accept a request" tags="" position="1031,290" size="100,100">This will end your relationship with your ectoplasmic beloved. Do you want to continue?

[[Yes|Requst2]]
[[No|ghost]]</tw-passagedata><tw-passagedata pid="79" name="updates" tags="" position="753,815" size="100,100">(print: $roomExecute.join(&quot;&quot;))\
(set: $turns to it + 1)\
(set: $satiety to it - $hunger)\
(if: $inventory contains &quot;poisoned&quot;)[(set: $HP to it - 1)]\
(set: $s to (color: #818181))\
(if: $blessings contains &quot;endurance&quot; and $energy &lt;= 1)[(set: $energy to 1)(set: $HP to it - 1)(set: $sanity to it - 1)]\
(if: $turns &gt; $updates&#39;s 1st)[(print: $updates&#39;s 2nd)(set: $updates to it - $updates&#39;s (array: 1,2))]\
(if: $turns &gt;= $saveTimer)[(set: $rareishCards to it + (array: &quot;saveGame&quot;))]\
(if: $turns &gt;= $nextBlessing)[(set: $cards to it + (array: &quot;blessings&quot;))]\
(if: (random: 1,10) is 1)[(set: $cardSelect to $rareCards)]\
(else:)[(set: $cardSelect to $cards + $cards + $cards + $uncommonCards + $uncommonCards + $rareishCards)\
	(if: $energy &lt;20)[(set: $cardSelect to it + (array: &quot;couch&quot;, &quot;couch&quot;, &quot;couch&quot;, &quot;couch&quot;, &quot;couch&quot;, &quot;couch&quot;))]\
	(if: $energy &lt; 20)[(set: $cardSelect to it + (array: &quot;slow&quot;, &quot;slow&quot;))]\
	(if: $sanity &lt;20)[(set: $cardSelect to it + (array: &quot;debugMenagerie&quot;, &quot;debugMenagerie&quot;, &quot;debugMenagerie&quot;, &quot;debugMenagerie&quot;, &quot;debugMenagerie&quot;, &quot;debugMenagerie&quot;))]]\
	(if: ($HP + $sanity + $energy + $satiety) &lt; 100)[(set: $cardSelect to it + (array: &quot;candle&quot;, &quot;candle&quot;, &quot;candle&quot;, &quot;candle&quot;))]\
	(if: ($HP + $sanity + $energy + $satiety) &gt;= 200 and (random:1,150) is 1)[(set: $cardSelect to (array: &quot;pirates&quot;))]\
	(if: $freeze&#39;s timer &gt; $turns)[(set: $cardSelect to it - (array: &quot;Blessed&quot;, &quot;guitar&quot;, &quot;Tea Ceremony&quot;, &quot;cards&quot;))(print: $freeze&#39;s code)]\
(else-if: $tornado is 0)[(set: $cardSelect to (array: &quot;tornadoEnd&quot;))]\
(else-if: $strangeBrew is 1 and $teaTally &gt; (random: 35, 200))[(set: $cardSelect to (array: &quot;strangeBrew&quot;))]\
(else-if: (random: 1,500) is 1 and $descension is 0)[(set: $cardSelect to (array: &quot;minecraft&quot;))]\
(else-if: (random: 1,250) is 1)[(set: $cardSelect to (array: &quot;keyFind&quot;,&quot;keyFind&quot;))]\
(else:)[(set: $cardSelect to (shuffled: ...$cardSelect))]</tw-passagedata><tw-passagedata pid="80" name="photocopier" tags="" position="898,1764" size="100,100">(if: $sanity &lt; 20)[This room contains a photocopier.

*Careful! Your sanity is getting perilously low*

&lt;img src=&quot;copier.png&quot;&gt;
(set: $s to (text-style: &quot;upside-down&quot;))(if: $direction&#39;s direction is &quot;east&quot;)[
(link: &quot;You are heading east. No photocopier can deter you.&quot;)[(set: $energy to it - 5)(go-to: &quot;Main&quot;)]](else:)[
[[Stare at the photocopier]]
[[Photocopy your eyes]]
(link: &quot;Run away as fast as you can&quot;)[(set: $energy to it - 10)(go-to: &quot;Main&quot;)]]]\
(else-if: (random: 1,9) is 1)[This room contains a photocopier.

The output tray contains photocopies of some ancient text. You don&#39;t recognise the language they are written in.

&lt;img src=&quot;copier.png&quot;&gt;

[[Read the words out loud]]
[[Leave the photocopies unread|Main]]]\
(else:)[This room contains a photocopier. (if: $descension &lt; 1)[It is reassuringly banal.(set: $r to 1)](else:)[It&#39;s a different model to the ones upstairs. It&#39;s not plugged in to anything; nonetheless, light shines from below its glass.(set: $r to -1)]

&lt;img src=&quot;copier.png&quot;&gt;

(if: $inventory contains &quot;crabNote&quot; and not($inventory contains &quot;photocopies&quot;))[[[Photocopy the treatise on the treachery of crabs]]
]\
(link: &quot;Move on&quot;)[(set: $sanity to it + $r)(goto: &quot;Main&quot;)]]</tw-passagedata><tw-passagedata pid="81" name="Stare at the photocopier" tags="" position="707,1902" size="100,100">You stare at the photocopier. It doesn&#39;t make any sudden movements.

(set: $sanity to 1)\
[[Tear your eyes away.|Main]]</tw-passagedata><tw-passagedata pid="82" name="Photocopy your eyes" tags="" position="845,1902" size="100,100">There&#39;s nothing quite like the blinding light.

(set: $HP to it - 10)\
(if: not ($achievements contains &quot;Make a bright decision&quot;))[(set: $achievements to it + (array: &quot;Make a bright decision&quot;))]\
[[But it&#39;s time to leave the photocopier now|Main]]</tw-passagedata><tw-passagedata pid="83" name="doors" tags="" position="1819,1880" size="100,100">(set: $playerVariables to (shuffled: ...(array: &quot;HP&quot;, &quot;sanity&quot;, &quot;energy&quot;, &quot;satiety&quot;)))\
(set: $door to (array: 5*(random: 1,5),-5*(random: 1,4),5*(random: 1,5),-5*(random: 1,4)))\
(if: (random: 1,8) is 1)[(if: (random:1,2) is 1)[(set: $playerVariables&#39;s 1st to &quot;speed&quot;)(set: $door&#39;s 1st to (random: 3,12))](else:)[(set: $playerVariables&#39;s 2nd to &quot;speed&quot;)(set: $door&#39;s 2nd to (random: -10,-3))]]\
(if: (random: 1,8) is 1)[(set: $playerVariables&#39;s 3rd to (either: &quot;dynamite&quot;, &quot;breadcrumbs&quot;, &quot;average juice&quot;))(set: $door&#39;s 3rd to 1)]\
(if: (random: 1,15) is 1)[(set: $playerVariables&#39;s 3rd to &quot;key&quot;)(set: $door&#39;s 3rd to 1)(set: $door&#39;s 4th to (random: -20, -30))]\
You come to (if: $doorBreak &gt; 1)[three](else:)[two] doors. A highly specific prophecy is carved above (if: $doorBreak &gt; 1)[two of them.](else:)[each one.]

The message above the left door reads: +(print: $door&#39;s 1st) (print: $playerVariables&#39;s 1st) (print: $door&#39;s 2nd) (print: $playerVariables&#39;s 2nd).(if: $doorBreak &gt; 1)[
(set: $playerVariables to it + (array: (either: &quot;HP&quot;, &quot;sanity&quot;, &quot;energy&quot;, &quot;satiety&quot;)))The message above the middle door reads: -5 (print: $playerVariables&#39;s 5th).]
The message above the right door reads: +(print: $door&#39;s 3rd) (print: $playerVariables&#39;s 3rd) (print: $door&#39;s 4th) (print: $playerVariables&#39;s 4th).

(display: &quot;doorIcons&quot;)(display: &quot;doorIcons&quot;)(if: $doorBreak &gt; 1)[(display: &quot;doorIcons&quot;)]

(link: &quot;Choose the left door&quot;)[(set: $r to 1)(goto: &quot;doorOutcome&quot;)](if: $doorBreak &gt; 1)[
[[Choose the middle door]]]
(link: &quot;Choose the right door&quot;)[(set: $r to 3)(goto: &quot;doorOutcome&quot;)]</tw-passagedata><tw-passagedata pid="84" name="Photocopy the treatise on the treachery of crabs" tags="" position="753,2027" size="100,100">You will spread the word.

(set: $sanity to it - 11)\
(set: $inventory to it + (array: &quot;photocopies&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="85" name="Knock the shrine over" tags="" position="1085,1579" size="100,100">You upend the shrine before you leave the room. The statue shatters when it hits the ground.

You&#39;ve done it now. This thing is furious.

&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $cards to it + (array:&quot;furiousGod&quot;))\
[[Onwards|Main]]</tw-passagedata><tw-passagedata pid="86" name="furiousGodMenu" tags="demon" position="1414,1832" size="100,100">Something winged and tentacled alights in front of you. It stares with cold angry eyes.

[[Beg|furiousGod2]]
[[Shout|furiousGod2]]
[[Cry|furiousGod2]]
(if: $hunger &gt; 2)[*[[Feast|EatDeity]]*]</tw-passagedata><tw-passagedata pid="87" name="furiousGod2" tags="demon" position="1380,1716" size="100,100">It has no mercy.

(set: $HP to it - 15)\
(set: $energy to it - 15)\
(set: $satiety to it - 15)\
(set: $sanity to it - 15)\
(link: &quot;But at least it&#39;s gone.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="88" name="EatDeity" tags="demon" position="1339,1571" size="100,100">Somewhere in the procecss of consuming the deity you notice that it had a key concealed in its waistcoat.

You pocket the key. This could come in handy later.

(set: $cards to it - (array: &quot;displeasedGod&quot;))\
(set: $cards to it - (array: &quot;furiousGod&quot;))\
(set: $inventory to it + (array: &quot;godStains&quot;))\
(set: $uncommonCards to it + (array: &quot;fairy&quot;))\
(set: $keys to it + 1)\
(if: not ($achievements contains &quot;Eat a God&quot;))[(set: $achievements to it + (array: &quot;Eat a God&quot;))]\
[[Onwards!|Main]]&lt;script&gt;
stopaudio();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="89" name="blessings2" tags="blessings" position="1586,174" size="100,100">Choose a blessing!
(set: $nextBlessing to $turns + 16 + (round: $turns/8))\
(if: $blessings contains &quot;blessedness&quot;)[(set: $nextBlessing to it - 2 - (round: $turns/35))]\
(set: $cards to it - (array: &quot;blessings&quot;))\

(set: $availableBlessings to $allBlessings - $blessings)(set: $availableBlessings to (shuffled: ... $availableBlessings + $repeatBlessings))\
(if: $availableBlessings&#39;s length &lt; 4)[(set: $availableBlessings to it + (array: &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;))]\
|b1&gt;[[[Blessing of (print: $availableBlessings&#39;s 1st)]]]
|b2&gt;[[[Blessing of (print: $availableBlessings&#39;s 2nd)]]](if: $inventory contains &quot;crabNote&quot; and not ($blessings contains &quot;crabbiness&quot;) and $turns &gt; 30 and (random: 1,4) is 1)[(replace: (either: ?b1, ?b2))[[[Blessing of crabbiness]]]]
[[Blessing of (print: $availableBlessings&#39;s 3rd)]](if: $blessings contains &quot;blessedness&quot;)[
[[Blessing of (print: $availableBlessings&#39;s 4th)]]](if: $blessings&#39;s length &gt; 0)[

(set: $b1 to 0)*You are already blessed with (display: &quot;crudeCounter&quot;)*]</tw-passagedata><tw-passagedata pid="90" name="Blessing of fitness" tags="blessings" position="1717,178" size="100,100">Some of the energy you expend will be returned to you in the form of health.

(set: $blessings to it + (array: &quot;fitness&quot;))\
(set: $execute to it + (array: &#39;(set: $HP to it + (max: 0, (ceil: ($energyOld - $energy)/2.5)))&#39;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="91" name="Blessing of gluttony" tags="blessings" position="1595,43" size="100,100">Food is now extra filling; you gain more satiety with each meal.

(set: $blessings to it + (array: &quot;gluttony&quot;))\
(set: $execute to it + (array: &#39;(set: $satiety to it + (max: 0, (round: ($satiety - $satietyOld)/2)))&#39;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="92" name="Blessing of speed" tags="blessings" position="1461,169" size="100,100">You can run faster now.

(set: $fleeBonus to it + 10)(set: $runBonus to it + 5)(set: $blessings to it + (array: &quot;speed&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="93" name="treasureChest" tags="" position="304,2207" size="100,100">(set: $chest to (either:&quot;an angry snake&quot;, &quot;a hungry hippo&quot;, &quot;a raving monkey&quot;, &quot;a sleepy sloth&quot;, &quot;an angry snake&quot;, &quot;a hungry hippo&quot;, &quot;a raving monkey&quot;, &quot;a sleepy sloth&quot;, &quot;a lazy lizard&quot;))\
A treasure chest squats on the dungeon floor. It is decorated with a carving of (print: $chest).

&lt;img src=&quot;chest.png&quot;&gt;

(display: &quot;stockGifts&quot;)\
[[Claim a treasure]]
(if: $hunger &gt; 2)[[[Eat the chest, contents and all|EatPeckish]]
]\
[[Leave the chest undisturbed|Main]]</tw-passagedata><tw-passagedata pid="94" name="Breadcrumbs" tags="" position="513,1915" size="100,100">Breadcrumbs! You can use these to increase your chances of coming across any given room in the dungeon again.(set: $scanner to it + 1)

&lt;img src=&quot;sackPlain.png&quot;&gt;

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="95" name="Claim a treasure" tags="" position="39,2227" size="100,100">(if: $doorBreak &gt; 1 and (random: 1,3) is 1)[You open the chest with delicate care, and manage to avoid triggering any ill effects.

You really are excellent at opening things.]\
(else-if: $chest is &quot;an angry snake&quot;)[(set: $HP to it - 25)Pain wracks your body when you open the chest.]\
(else-if: $chest is &quot;a hungry hippo&quot;)[(set: $satiety to it - 25)Hunger settles in your stomach as you open the chest.]\
(else-if: $chest is &quot;a raving monkey&quot;)[(set: $sanity to it - 25)Your grip on reality weakens as you open the chest.]\
(else-if: $chest is &quot;a sleepy sloth&quot;)[(set: $energy to it - 25)You yawn widely as you open the chest.]\
(else-if: $chest is &quot;a lazy lizard&quot;)[(set: $fleeBonus to it - 10)Your legs ache with tiredness as you open the chest. You move more sluggishly than before.]

[[But what&#39;s this inside?|(print: 1st of (shuffled: ...$gift))]]</tw-passagedata><tw-passagedata pid="96" name="Key" tags="" position="179,2207" size="100,100">It&#39;s a key! How did that get in there?

(set: $keys to it + 1)\
*You now have $keys keys*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="97" name="debugMenagerie" tags="mist" position="2165,398" size="100,100">(go-to: &quot;debugMenagerie2&quot;)</tw-passagedata><tw-passagedata pid="98" name="Talk to the haunted-looking one" tags="mist" position="2164,516" size="100,100">(if: $testIslandKey is 1)[She pauses his muttering to nod hello. Her eyes are bloodshot and unsettling.

(set: $sanity to it - 5)\
[[Leave this place.|Main]]]\
(else:)[(set: $sanity to it - 5)She mutters something urgent but indistinct about crabs. More disturbing than her words are her eyes; they are bloodshot and unfocused.
(if: $testIslandKey is 0)[(if: $inventory contains &quot;crabNote&quot;)[
[[Show her the treatise on the treachery of crabs]] (if: $inventory contains &quot;photocopies&quot;)[
[[Show her your photocopies of the treatise]]]]]
[[Leave this place|Main]]]</tw-passagedata><tw-passagedata pid="99" name="Talk to the hungry-looking one" tags="mist" position="2280,517" size="100,100">He has a plump waistline but is raving about watermelons and an unsateable hunger. Listening to him makes your stomach growl.

(set: $satiety to it - 15)\
[[Leave this place|Main]](if: $inventory contains &quot;photocopies&quot;)[
[[Give him a copy of the Treatise on the Treachery of Crabs|Share the treatise with hungry man]]](if: $cookies&#39;s basic &gt; 0)[
[[Offer him a chocolate chip cookie]]]</tw-passagedata><tw-passagedata pid="100" name="Show her the treatise on the treachery of crabs" tags="mist" position="2139,630" size="100,100">She reads it closely, nodding and muttering as he does.

When she&#39;s finished she hands it back to you. &#39;You must spread the word,&#39; she says. &#39;The crabs must be stopped.&#39;

[[Onwards!|Main]](if: $inventory contains &quot;photocopies&quot;)[
[[Show her your photocopies of the treatise]]]</tw-passagedata><tw-passagedata pid="101" name="Share the treatise" tags="" position="7,1789" size="100,100">They edge slowly away from you.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="102" name="Blessing of blessedness" tags="blessings" position="1720,44" size="100,100">You will receive blessings slightly more frequently, and when you do there will be more blessings to choose from.

(set: $blessings to it + (array: &quot;blessedness&quot;))\
(set: $nextBlessing to it - 5)\
[[Hallelujah!|Main]]</tw-passagedata><tw-passagedata pid="103" name="Blessing of mindfulness" tags="blessings" position="1470,44" size="100,100">Your sanity automatically regenerates when it gets low.

(set: $blessings to it + (array: &quot;mindfulness&quot;))(set: $roomExecute to it + (array: &#39;(set: $sanity to (max: $sanity, (min: $sanity + (either: 1,2), 33)))&#39;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="104" name="Show her your photocopies of the treatise" tags="mist" position="2258,634" size="100,100">&#39;Good job,&#39; she says. &#39;You should share this as widely as you can.&#39;

&#39;Here,&#39; she adds, handing you a key. &#39;This might help you reach the people in the world above this dungeon.&#39;

(set: $keys to it + 1)\
*You now have $keys keys!*

(if: not ($achievements contains &quot;Campaign for a noble cause&quot;))[(set: $achievements to it + (array: &quot;Campaign for a noble cause&quot;))]\
(set: $testIslandKey to 1)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="105" name="exit" tags="" position="2096,882" size="100,100">You reach a door clearly labelled &#39;exit&#39;. An overly conscientious locksmith has installed five locks. You will need 5 keys to unlock them.

There is an unattended snack stand next to the exit.

&lt;img src=&quot;exit.png&quot;&gt;

(if: $keys &lt;5)[Unlock the door (click-replace: &quot;Unlock the door&quot;)[(color: red)[&#39;&#39;You need (abs: 5 - $keys) more keys&#39;&#39;]]]\
(else:)[(link:&quot;Unlock the door&quot;)[(set: $keys to it - 5)(go-to: &quot;The End&quot;)]]
[[Kick the door]] (if: $doorBreak &gt;0)[*(you have a $doorBreak% chance of knocking it down)*](if: $inventory contains &quot;lockpick&quot;)[
[[Pick the lock]] *(you have a 40% chance of success)*](if: $hunger &gt; 3)[
(link: &quot;Eat the door&quot;)[(if: $hunger &lt; 7)[You need to be hungrier to manage that.](else:)[(go-to: &quot;eatExit&quot;)]]]
(link: &quot;Grab a handful of snacks and return to the dungeon proper&quot;)[(set: $satiety to it + 15)(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="106" name="Kick the door" tags="" position="2095,1007" size="100,100">(if: $doorBreak &gt; (random: 1,110))[[[The door falls over.|The End]]
]\
(else:)[You stub your toe.

(set: $HP to it - 5)\
(if: $HP &lt; 1 and not ($achievements contains &quot;Kick the bucket kicking a door&quot;))[(set: $achievements to it + (array: &quot;Kick the bucket kicking a door&quot;))]\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="107" name="The End" tags="" position="2280,941" size="100,100">(if: $achievements contains &quot;Escape&quot;)[On the other side of the door is a staircase. You can see daylight at the top of the stairs. You can see sheer blackness below.

[[Go up, to safety]]
[[Go down]]]\
(else:)[(if: not ($achievements contains &quot;Escape&quot;))[(set: $achievements to it + (array: &quot;Escape&quot;))You climb up the stairs and out of the birthday dungeon. You are hurt, traumatised, and hungry. You will never completely recover.

Happy birthday!(save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))

&lt;img src=&quot;outside.png&quot;&gt;

*The dungeon has expanded! New content will be available the next time you visit the dungeon*

]\
&lt;script&gt;
stopaudio();
audio.happyEnd.play();
&lt;/script&gt;(display: &quot;GameOver&quot;)]</tw-passagedata><tw-passagedata pid="108" name="Blessing of digestion" tags="blessings" position="1462,294" size="100,100">Your satiety only sometimes degenerates.

(set: $blessings to it + (array: &quot;digestion&quot;))(set: $roomExecute to it + (array: &#39;(set: $satiety to it + (either: 0, $hunger))&#39;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="109" name="Blessing of discovery" tags="blessings" position="1587,294" size="100,100">Adds a rare but highly useful location to the dungeon.

(set: $blessings to it + (array: &quot;discovery&quot;))(set: $rareishCards to it + (array: &quot;Blessed&quot;))\
[[Rejoice!|Blessed]]</tw-passagedata><tw-passagedata pid="110" name="Blessed" tags="" position="1154,42" size="100,100">This room sparkles and glows with incandescence. Worry not; all shall be well.

&lt;img src=&quot;sparkles.png&quot;&gt;

(live: 0.6s)[(set: $HP to it + (either: 0,0,1,2))(set: $energy to it + (either: 0,0,1,2))(set: $sanity to it + (either: 0,0,1,2))(set: $satiety to it + (either: 0,0,1,2))\
(if: $HP is $HPOld)[(replace: ?Health)[(color: #818181)[$HP]]]\
(else-if: $HP is $HPOld + 1)[(replace: ?Health)[(color: #80e619)[$HP]]]\
(else-if: $HP is $HPOld + 2)[(replace: ?Health)[(color: #19e619)[$HP]]]\
(if: $sanity is $sanityOld)[(replace: ?Sanity)[(color: #818181)[$sanity]]]\
(else-if: $sanity is $sanityOld + 1)[(replace: ?Sanity)[(color: #80e619)[$sanity]]]\
(else-if: $sanity is $sanityOld + 2)[(replace: ?Sanity)[(color: #19e619)[$sanity]]]\
(if: $energy is $energyOld)[(replace: ?Energy)[(color: #818181)[$energy]]]\
(else-if: $energy is $energyOld + 1)[(replace: ?Energy)[(color: #80e619)[$energy]]]\
(else-if: $energy is $energyOld + 2)[(replace: ?Energy)[(color: #19e619)[$energy]]]\
(if: $satiety is $satietyOld)[(replace: ?Satiety)[(color: #818181)[$satiety]]]\
(else-if: $satiety is $satietyOld + 1)[(replace: ?Satiety)[(color: #80e619)[$satiety]]]\
(else-if: $satiety is $satietyOld + 2)[(replace: ?Satiety)[(color: #19e619)[$satiety]]]\
(set: $HPOld to $HP)(set: $sanityOld to $sanity)(set: $energyOld to $energy)(set: $satietyOld to $satiety)\
(if: $HP &gt; $statMax or $energy &gt; $statMax or $sanity &gt; $statMax or $satiety&gt; $statMax)[(stop:)]]&lt;script&gt;
stopaudio();
audio.peaceful.play();
&lt;/script&gt;(link: &quot;Leave now&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="111" name="Tea Ceremony" tags="" position="2165,1747" size="100,100">Three dungeon slimes are holding a tea ceremony. They invite you to join them.

&lt;img src=&quot;tea.png&quot;&gt;

(if: $slimeEnemy is 1)[This time, however, they are skittish; they look at you sideways and whisper furtively among themselves. They must have heard about your crimes against slimes at previous tea ceremonies.

It&#39;s discomfiting. 

(live: 1.7s)[(set: $sanity to it - 1)(replace: ?Sanity)[(color: orange)[$sanity]]]\
(if: not ($achievements contains &quot;Experience an awkward situation&quot;))[(set: $achievements to it + (array: &quot;Experience an awkward situation&quot;))]]\
(if: (random: 1,9) is 1)[Today they are brewing an unusual foul-smelling brew. One furtively pushes a cup towards you.

[[Take the foul-smelling brew]]
]\
(link: &quot;Drink the tea&quot;)[(set: $energy to it + 15)(goto: &quot;Main&quot;)]
(link: &quot;Eat the snacks&quot;)[(set: $satiety to it + 15)(goto: &quot;Main&quot;)](if: $hunger &gt; 1)[
[[Eat the snacks and the slimes]]](if: $inventory contains &quot;photocopies&quot;)[
[[Hand each slime a photocopy of the Treatise on the Treachery of Crabs|Share the treatise]]]</tw-passagedata><tw-passagedata pid="112" name="Attack the slimes" tags="" position="2298,1821" size="100,100">You emerge victorious but not unscathed. 

(set: $HP to it - 10)\
(set: $slimeEnemy to 1)\
(set: $s to (color: #818181))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="113" name="Eat the snacks and the slimes" tags="" position="2167,1946" size="100,100">They put up a fight, but you eat them all in the end.

(set: $HP to it - 15)\
(set: $satiety to it + 30)\
(set: $slimeEnemy to 1)\
(set: $s to (color: #818181))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="114" name="Skeleton" tags="" position="761,4333" size="100,100">Wesley J Skelliman walks down the corridor towards you. He is wearing neither clothes nor flesh. (either: &quot;Tinsel is wrapped around his ribs.&quot;, &quot;He is, however, wearing a sombrero atop his skull.&quot;, &quot;He is holding a religious text.&quot;, &quot;A fez is perhched atop his skull.&quot;) 

His bones gleam whitely in the candlelight. He is, frankly, terrifying.

&lt;img src=&quot;skeleton.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 40, &quot;type&quot;, &quot;skeleton&quot;, &quot;damage&quot;, 15))\
(if: not ($achievements contains &quot;Meet Wesley J Skelliman&quot;))[(set: $achievements to it + (array: &quot;Meet Wesley J Skelliman&quot;))]\
(display: &quot;monster&quot;)(if: $hunger &gt; 1 and $sanity &lt;=20)[
[[Gnaw on Wesley&#39;s bones|EatSkeleton]]]</tw-passagedata><tw-passagedata pid="115" name="EatSkeleton" tags="" position="1669,1188" size="100,100">The bones of Wesley J Skelliman taste of almonds and vanilla. It&#39;s not a very filling meal, but it is something.

(set: $s to (text-style: &quot;upside-down&quot;))(set: $satiety to it + 6)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="116" name="Glimpse" tags="" position="2183,1297" size="100,100">You glimpse something shiny at the end of the corridor. It turns the corner and disappears from sight. 

(set: $monster to (datamap: &quot;fleeChance&quot;,-5))\
[[Chase it]] *((if: ($monster&#39;s fleeChance + $fleeBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus))]% chance of success)*
(link: &quot;Run extra fast&quot;)[(set: $monster&#39;s fleeChance to it + $runBonus)(set: $energy to it - 10)(go-to: &quot;Chase it&quot;)]*((if: ($monster&#39;s fleeChance + $fleeBonus + $runBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus + $runBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus + $runBonus))]% chance of success)*
[[Leave it be|Main]]</tw-passagedata><tw-passagedata pid="117" name="Chase it" tags="" position="2125,1431" size="100,100">(set: $energy to it - 5)\
(if: (random: 1, 100) &lt;= ($monster&#39;s fleeChance + $fleeBonus))[(if: $inventory contains &quot;wingKey&quot;)[It&#39;s a flying chocolate-chip cookie! You thrust it unceremoniously into your pocket.

&lt;img src=&quot;glimpseCookie.png&quot;&gt;(set: $cookies&#39;s basic to it + 1)(if: not ($uncommonCards contains &quot;toToShop&quot;))[(set: $uncommonCards to it + (array: &quot;toToShop&quot;))]](else:)[It&#39;s a winged key! You thrust it unceremoniously into your pocket. 

&lt;img src=&quot;glimpseKey.png&quot;&gt;

(set: $keys to it + 1)(set: $inventory to it + (array: &quot;wingKey&quot;))\
*You now have $keys keys*]

[[Onwards!|Main]]]\
(else:)[You run after it as fast as you can but don&#39;t catch sight of it again. It must be long gone by now.

[[Onwards.|Main]]]</tw-passagedata><tw-passagedata pid="118" name="Blessing of laughter" tags="blessings" position="1712,294" size="100,100">You can laugh at anything in this dungeon, albeit at a cost to your sanity.

(set: $blessings to it + (array: &quot;laughter&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="119" name="lol" tags="" position="494,808" size="100,100">(set: $delayExecute to false)\
(set: $sanity to it - 12)\
(either: &quot;Ahahaha&quot;, &quot;Ahahahahahaaa&quot;, &quot;Ahahahahahaha&quot;) (either: &quot;hahaha&quot;, &quot;ahahahaha&quot;, &quot;haha&quot;) (either: &quot;aha&quot;, &quot;ahahaha&quot;) (either: &quot;hahahaa&quot;, &quot;hahahahahaha&quot;).

[[What&#39;s next?|Main]]</tw-passagedata><tw-passagedata pid="120" name="Blessing of opening" tags="blessings" position="1840,48" size="100,100">(if: $doorBreak &gt; 1)[You have an increased chance of kicking down the door at the dungeon&#39;s exit.

(set: $doorBreak to it + 5)\
[[Rejoice!|Main]]](else:)[New doors have appeared in the dungeon, you have an increased chance of kicking down the door at the dungeon&#39;s exit, and you have a 1 in 3 chance of opening treasure chests without triggering any ill effects.

(set: $doorBreak to it + 5)\
[[Rejoice!|Main]]](set: $blessings to it + (array: &quot;opening&quot;))</tw-passagedata><tw-passagedata pid="121" name="pirates" tags="pirates" position="1538,1910" size="100,100">(go-to: &quot;pirates2&quot;)</tw-passagedata><tw-passagedata pid="122" name="runghost" tags="" position="896,298" size="100,100">You run away from whatever that thing was.

It makes a sad noise as you leave.

(set: $energy to it - (random:5,8))\
(if: $ghostFriend is 0)[(set: $ghostFriend to 1)]\
[[Onwards!|Main]]&lt;script&gt;
audio.sadGhost.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="123" name="Feed them" tags="" position="1539,930" size="100,100">(if: $catKey &gt;0)[They ignore the food and attack you instead.

After their encounter with the cat it&#39;s unlikely they&#39;ll ever trust you again.

(set: $HP to it - $monster&#39;s damage)\
[[Onwards!|Main]]]\
(else:)[What will you feed them?
(if: $cookies&#39;s basic &gt; 0)[
[[Feed them a chocolate chip cookie]]](if: $scanner &gt; 0 and not ($ally&#39;s type is &quot;pigeons&quot;))[
[[Feed them some breadcrumbs]]]
(link: &quot;Feed them your flesh&quot;)[&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;(set: $HP to it - $monster&#39;s damage)(go-to: &quot;Main&quot;)]]</tw-passagedata><tw-passagedata pid="124" name="Ask your pigeons to attack" tags="" position="996,1076" size="100,100">(if: $card is &quot;monsters2&quot; and not ($achievements contains &quot;Fight pigeons with pigeons&quot;))[(set: $achievements to it + (array: &quot;Fight pigeons with pigeons&quot;))]\
(set: $ally&#39;s health to it - (random: ($monster&#39;s damage),($monster&#39;s damage * 3)))\
(if: $ally&#39;s health &lt; 0)[The pigeons battle valiantly, and even manage to drive back your foe. But there are no survivors.

(set: $ally&#39;s type to &quot;dead&quot;)\
(set: $cards to it - (array: &quot;pigeons&quot;, &quot;watermelonBird&quot;))\
[[Onwards!|Main]]]\
(else:)[When the bloodbath is over your pigeons emerge victorious but not unscathed. They coo softly. (if: $ally&#39;s health &lt; 40)[You&#39;re not sure they can take much more of this.]

Your pigeons&#39; health is now (print: $ally&#39;s health)%.

[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="125" name="Allow your pigeons to feed." tags="" position="2441,1458" size="100,100">|text&gt;[They eat messily. Once they are done your (print: $ally&#39;s type) look healthier and readier for battle.](set: $ally&#39;s health to it + (random: 3,15))(if: $ally&#39;s health &gt; $ally&#39;s maxHealth)[(set: $ally&#39;s health to $ally&#39;s maxHealth)]

Their health is now (print: $ally&#39;s health)%

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="126" name="Achievements" tags="achievements hide-sidebar" position="375,75" size="100,100">&lt;div class=&quot;achieve&quot;&gt;&lt;img src=&quot;trophy.png&quot;&gt; Achievements &lt;img src=&quot;trophy.png&quot;&gt;&lt;/div&gt;\
(css: &quot;font-size: 80%;&quot;)[(if: $achievements contains &quot;Survive an hour&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Survive an hour.]
(if: $achievements contains &quot;Survive two hours&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Survive two hours.]
(if: $achievements contains &quot;Survive three hours&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Survive three hours.]
(if: $achievements contains &quot;Restore the statue&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Restore the statue. *(x(count: $achievements, &quot;Restore the statue&quot;))*]
(if: $achievements contains &quot;Fail spectacularly&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Fail spectacularly.]
(if: $achievements contains &quot;Escape&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Escape.](if: $achievements contains &quot;Escape&quot;)[
(if: $achievements contains &quot;Escape within 90 minutes of entering the dungeon&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Escape within 90 minutes of entering the dungeon.]]
(if: $achievements contains &quot;Eat your way to freedom&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Eat your way to freedom.]
(if: $achievements contains &quot;Escape after entering via the secret entrance&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Escape after entering via the secret entrance.]
(if: $achievements contains &quot;Destroy the exit&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Destroy the exit.]
(if: $achievements contains &quot;Be inconvenienced&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Be inconvenienced.]
(if: $achievements contains &quot;Refuse a cure&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Refuse a cure.]
(if: $achievements contains &quot;Eat a God&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Eat a God.]
(if: $achievements contains &quot;Come back from the dead&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Come back from the dead.]
(if: $achievements contains &quot;Upgrade an item&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Upgrade an item.]
(if: $achievements contains &quot;Befriend a cat&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Befriend a cat.]
(if: $achievements contains &quot;Experience an awkward situation&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Experience an awkward situation.]
(if: $achievements contains &quot;Campaign for a noble cause&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Campaign for a noble cause.]
(if: $achievements contains &quot;Consumate a relationship&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Consumate a relationship.]
(if: $achievements contains &quot;Possess -1 cookies&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Possess -1 cookies.]
(if: $achievements contains &quot;Grow your very own tentacles&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Grow your very own tentacles.]
(if: $achievements contains &quot;Feed your pets&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Feed your pets.]
(if: $achievements contains &quot;Solve the sphynx&#39;s riddle&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Solve the sphynx&#39;s riddle.]
(if: $achievements contains &quot;Fight pigeons with pigeons&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Defeat pigeons using pigeons.]
(if: $achievements contains &quot;Meet Wesley J Skelliman&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Meet Wesley J Skelliman.]
(if: $achievements contains &quot;Be still for a little while&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Be still for a little while.]
(if: $achievements contains &quot;Cudgel many watermelons&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Cudgel many watermelons.]
(if: $achievements contains &quot;Foil a conspiracy&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Foil a conspiracy.]
(if: $achievements contains &quot;Discover an unexpected corpse&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Discover an unexpected corpse.]
(if: $achievements contains &quot;Stay hydrated&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Stay hydrated.]
(if: $achievements contains &quot;Wear many hats&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Wear many hats.]
(if: $achievements contains &quot;Kill your darlings&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Kill your darlings.]
(if: $achievements contains &quot;Fall for an obvious trap&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Fall for an obvious trap.]
(if: $achievements contains &quot;Make a bright decision&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Make a bright decision.]
(if: $achievements contains &quot;Buy an expensive box&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Buy an expensive box.]
(if: $achievements contains &quot;Reach the far North&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the far North.]
(if: $achievements contains &quot;Reach the far East&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the far East.]
(if: $achievements contains &quot;Reach the far South&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the far South.]
(if: $achievements contains &quot;Reach the far West&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the far West.]
(if: $achievements contains &quot;Instigate a bloodbath&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Instigate a bloodbath.]
(if: $achievements contains &quot;Consume vital correspondence&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Consume vital correspondence.]
(if: $achievements contains &quot;Feed the hungry&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Feed the hungry.]
(if: $achievements contains &quot;Sell a diamond&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Sell a diamond.]
(if: $achievements contains &quot;Choose the box of snakes&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Choose the box of snakes.]
(if: $achievements contains &quot;Kick the bucket kicking a door&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Kick the bucket kicking a door.]
(if: $achievements contains &quot;Make the same mistake twice&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Make the same mistake twice.]
(if: $achievements contains &quot;Be reunited with an old friend&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Be reunited with an old friend.]
(if: $achievements contains &quot;Adopt a cunning disguise&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Adopt a cunning disguise.]
(if: $achievements contains &quot;Kick the bucket kicking a door&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Kick the bucket kicking a door.]
(if: $achievements contains &quot;Pull off an audacious heist&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Pull off an audacious heist.]
(if: $achievements contains &quot;Find the sub-dungeon&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Find the sub-dungeon.]
(if: $achievements contains &quot;Attack a fellow dungeon-dweller&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Attack a fellow dungeon-dweller.]
(if: $achievements contains &quot;Bring glory to Sidequestia&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Bring glory to Sidequestia.]
(if: $achievements contains &quot;Be glomped by a shoggoth&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Be glomped by a shoggoth.]
(if: $achievements contains &quot;Discover hidden depths&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Discover hidden depths.]
(if: $achievements contains &quot;Suffer a birthday curse&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Suffer a birthday curse.]
(if: $achievements contains &quot;Become maximally cursed&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Become maximally cursed.]
(if: $achievements contains &quot;Reach the content boundary&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the content boundary.]
(if: $achievements contains &quot;Reach the content boundary while cursed&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Reach the content boundary while cursed.]
(if: $achievements contains &quot;Stand vigil over the end of the world&quot;)[(set: $x to (color: yellow))](else:)[(set: $x to (color: #818181))]
$x[Stand vigil over the end of the world.]]
&lt;script&gt;
stopaudio();
audio.loveRobots.play();
&lt;/script&gt;
=&gt;&lt;=
(link: &quot;Continue&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;init&quot;)]</tw-passagedata><tw-passagedata pid="127" name="Header" tags="header" position="250,82" size="100,100">{
(print: &quot;&lt;script&gt;$(&#39;html&#39;).removeClass(\)&lt;/script&gt;&quot;)
(if: (passage:)&#39;s tags&#39;s length &gt; 0)[
(print: &quot;&lt;script&gt;$(&#39;html&#39;).addClass(&#39;&quot; + (passage:)&#39;s tags.join(&#39; &#39;) + &quot;&#39;\)&lt;/script&gt;&quot;)
]
}</tw-passagedata><tw-passagedata pid="128" name="Gorgon" tags="" position="1279,803" size="100,100">(if: $descension is 1)[There&#39;s nothing here.

[[Strange.|Main]](set: $rareishCards to it - (array: &quot;Gorgon&quot;))](else:)[It&#39;s a gorgon! Luckily it hasn&#39;t yet caught your eye. (if: $gorgonKey is true)[It wears a key on a chain around its neck.

&lt;img src=&quot;gorgon.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;damage&quot;, 20, &quot;bonus&quot;, &quot;Steal the key&quot;, &quot;type&quot;, &quot;gorgon&quot;))\
(display: &quot;monster&quot;)]\
(else:)[
It looks angrier than ever since you stole its key.

&lt;img src=&quot;gorgonMad.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;damage&quot;, 20, &quot;bonus&quot;, &quot;Let it look you in the eyes&quot;, &quot;type&quot;, &quot;gorgon&quot;))\
(display: &quot;monster&quot;)]]</tw-passagedata><tw-passagedata pid="129" name="Steal the key" tags="" position="1404,805" size="100,100">Are you sure that you want to do this? You are unlikely to emerge unscathed.

[[Yes|Gorgon2]]
[[No|Gorgon]]</tw-passagedata><tw-passagedata pid="130" name="Gorgon2" tags="" position="1529,805" size="100,100">You succesfully retrieve the key, but the gorgon looks you in the eyes before you can flee. You feel your limbs stiffen and harden.

(set: $gorgonFlee to 1)\
(set: $keys to it + 1)\
(set: $gorgonKey to false)\
*You now have (print: $keys) keys*

(link: &quot;You are a statue&quot;)[&lt;script&gt;
stopaudio();
audio.adrenalineLoop.play();
&lt;/script&gt;(go-to:&quot;You are a statue&quot;)]</tw-passagedata><tw-passagedata pid="131" name="You are a statue" tags="" position="1668,792" size="100,100">(set: $HP to it - (either: 1,1,1,2,2))\
(set: $energy to it - (either: 1,1,1,2,2))\
(set: $sanity to it - (either: 1,1,1,2,2))\
(set: $satiety to it - (either: 1,1,1,2,2))\
(if: $energy &lt;1)[[[You are dead]]]\
(elseif: $HP &lt;1)[[[You are dead]]]\
(elseif: $satiety &lt;1)[[[You are dead]]]\
(elseif: $sanity &lt;1)[[[You are insane]]]\
(else:)[[[Struggle]] ($gorgonFlee% chance of success)]</tw-passagedata><tw-passagedata pid="132" name="Struggle" tags="" position="1664,1054" size="100,100">(if: (random: 1,100) &lt;= $gorgonFlee)[You shed your hardening stone skin. You are free!

(if: not ($achievements contains &quot;Be still for a little while&quot;))[(set: $achievements to it + (array: &quot;Be still for a little while&quot;))]\
[[Onwards!|Main]]&lt;script&gt;
stopaudio();
&lt;/script&gt;]\
(else:)[(set: $gorgonFlee to it + 1)\
(display: &quot;You are a statue&quot;)]</tw-passagedata><tw-passagedata pid="133" name="Consolidate your relationship" tags="" position="1127,426" size="100,100">You kiss the ghost and the ghost kisses you. It is an invigorating and unsettling kiss.

When you pull away your lips are stained and your heart is pounding. 

(if: $ghostFriend is 2)[(set: $ghostFriend to 3)]\
(set: $energy to it + 15)(set: $sanity to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="134" name="Requst2" tags="" position="975,143" size="100,100">(set: $ghostFriend to 4)\
(set: $keys to it + 1)\
(set: $cards to it - (array: &quot;ghost&quot;))\
(set: $HP to 1)\
(set: $sanity to (ceil: $sanity/2))\
(replace: ?Health)[(color: red)[(text-style: &quot;smear&quot;)[$HP]]]\
(if: not ($achievements contains &quot;Consumate a relationship&quot;))[(set: $achievements to it + (array: &quot;Consumate a relationship&quot;))]\
It leans in close to you once more. This time, though, you feel something seep out of your mouth. Your knees buckle; your vision blears; your ears ring. The pain begins to fade into blankness.

And then, abruptly, it stops. You hear footsteps - real footsteps! - walk away from you. The ghost with the bleeding mouth took almost everything, but it left just enough for you to survive.

When you wake you find a note thanking you for your donation and a key placed on the ground in front of you.

*You now have $keys keys.*

[[Pick yourself up off the ground|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="135" name="A key" tags="" position="12,1917" size="100,100">It&#39;s a key! (if: $card is &quot;presents&quot;)[What a thoughtful present.](else:)[It might just be the key to your escape.]

(set: $keys to it + 1)\
*You now have $keys keys*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="136" name="Blessing of endurance" tags="blessings" position="1847,178" size="100,100">You will no longer perish if you run out of energy. However, your health and sanity will slowly degrade when your energy is fully depleted.

(set: $blessings to it + (array: &quot;endurance&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="137" name="pigeons" tags="" position="1397,2246" size="100,100">The pigeons eye you hungrily and coo conspiratorially.

&lt;img src=&quot;pigeon.png&quot;&gt;
(if: $scanner &gt; 0)[
[[Offer them some breadcrumbs]]]
[[Let them feed on your flesh]]
[[Refuse]](if: $hunger &gt; 1)[
[[Eat the birds]]]</tw-passagedata><tw-passagedata pid="138" name="Eat the birds" tags="" position="1504,2190" size="100,100">They make a satisfactory if flappy meal.

(set: $satiety to it + 30)\
(set: $cards to it - (array: &quot;pigeons&quot;, &quot;watermelonBird&quot;))\
(set: $ally&#39;s type to &quot;eaten&quot;)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="139" name="Let them feed on your flesh" tags="" position="1278,2261" size="100,100">It only hurts a little bit.

(if: not ($achievements contains &quot;Feed your pets&quot;))[(set: $achievements to it + (array: &quot;Feed your pets&quot;))]\
(set: $HP to it - 5)\
(set: $ally&#39;s health to it + (random: 5,20))(if: $ally&#39;s health &gt; $ally&#39;s maxHealth)[(set: $ally&#39;s health to $ally&#39;s maxHealth)]\
*Your pigeons&#39; health is now (print: $ally&#39;s health)%.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="140" name="blessings" tags="" position="1837,294" size="100,100">Something (if: $descension &gt; 0)[glimmers faintly](else:)[sparkles] in the dungeon ahead.(set: $blessings to it - (array: &quot;&quot;))

&lt;img src=&quot;blessing.png&quot;&gt;

(if: $inventory contains &quot;90s&quot;)[(link: &quot;Proceed&quot;)[&lt;script&gt;
stopaudio();
audio.smashmouth.play();
&lt;/script&gt;(goto: &quot;blessings2&quot;)]](else-if: $descension &gt; 0)[(link: &quot;Proceed&quot;)[(either: &#39;&lt;script&gt;
stopaudio();
audio.blessingSub.play();
&lt;/script&gt;&#39;,&#39;&lt;script&gt;
stopaudio();
audio.blessingSub2.play();
&lt;/script&gt;&#39;)(goto: &quot;blessings2&quot;)]](else-if: (random: 1,2) is 1)[(link: &quot;Proceed&quot;)[(either: &#39;&lt;script&gt;
stopaudio(); audio.blessingLong.play();&lt;/script&gt;&#39;,&#39;&lt;script&gt;
stopaudio(); audio.blessingLong.play();&lt;/script&gt;&#39;)(go-to: &quot;blessings2&quot;)]](else:)[(link: &quot;Proceed&quot;)[&lt;script&gt;
stopaudio();
audio.blessingAlt.play();
&lt;/script&gt;(go-to: &quot;blessings2&quot;)]]</tw-passagedata><tw-passagedata pid="141" name="displeasedGod" tags="" position="319,1405" size="100,100">&lt;script&gt;
stopaudio();
audio.sinister.play();
&lt;/script&gt;
(go-to: &quot;displeasedGod2&quot;)</tw-passagedata><tw-passagedata pid="142" name="furiousGod" tags="" position="1415,1940" size="100,100">&lt;script&gt;
stopaudio();
audio.sinister.play();
&lt;/script&gt;
(go-to: &quot;furiousGodMenu&quot;)</tw-passagedata><tw-passagedata pid="143" name="Blessing of acquisition" tags="blessings" position="1964,50" size="100,100">In the very next room you find a collection of useful things. This time your haul includes:

- A cookie (set: $cookies&#39;s basic to it + 1)
(if: (random: 1,2) is 1)[- Average juice (set: $drink to it + 1)
](if: (random: 1,2) is 2)[- Breadcrumbs(set: $scanner to it + 1)
](if: (random: 1,2) is 2)[- Dynamite(set: $trash to it + 1)
](if: (random: 1,3) is 3)[- A hat(set: $hats to it + 1)
](if: (random: 1,4) is 4)[- A key (set: $keys to  it + 1)
]\

[[Rejoice!|Main]](set: $blessings to it + (array: &quot;acquisition&quot;))</tw-passagedata><tw-passagedata pid="144" name="peckish" tags="" position="305,791" size="100,100">(go-to: &quot;peckish2&quot;)</tw-passagedata><tw-passagedata pid="145" name="Let it look you in the eyes" tags="" position="1393,695" size="100,100">Its eyes are hard, and presently so too is your skin.

[[You are a statue]]</tw-passagedata><tw-passagedata pid="146" name="Refuse" tags="" position="1390,2368" size="100,100">Your flappy carnivorous friends fly away. You may never see them again.

(set: $ally&#39;s type to &quot;gone&quot;)(set: $cards to it - (array: &quot;pigeons&quot;, &quot;watermelonBird&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="147" name="keyFind" tags="" position="1694,1895" size="100,100">(if: $curses contains &quot;kikimora&quot; and $keys &gt; 0)[You seem to have lost a key. What are the odds? (The odds are 1 in 250.)(set: $keys to it - 1)

*You now have $keys keys*

[[Onwards!|Main]]](else:)[You find a key on the dungeon floor! What are the odds? (The odds are 1 in 250.)

(set: $keys to it + 1)\
*You now have $keys keys*

&lt;img src=&quot;key.png&quot;&gt;

[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="148" name="Blessing of sacrifice" tags="blessings" position="1961,170" size="100,100">You may sacrifice keys to reset your health, sanity, energy and satiety.

(set: $blessings to it + (array: &quot;sacrifice&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="149" name="Debug-startup" tags="debug-startup" position="492,78" size="100,100">(display: &quot;init&quot;)(set: $crumbed to (array: &quot;altar&quot;, &quot;altar&quot;))(set: $turns to 30)(set: $saveTimer to 20)(set: $inventory to (array: &quot;crabNote&quot;, &quot;freezeRay&quot;, &quot;soul&quot;, &quot;socks&quot;))(set: $keys to 5)(set: $cookies&#39;s eldritch to 5)(set: $execute to (array: &quot;&quot;))(set: $achievements to (array: &quot;Restore the statue&quot;, &quot;Restore the statue&quot;))(set: $inventoryCheck to true)(set: $descension to 1)(set: $ankh to 1)(set: $socks to (datamap: &quot;speed&quot;, 0, &quot;cookie&quot;, 0, &quot;blessing&quot;, 0))</tw-passagedata><tw-passagedata pid="150" name="Eat the note" tags="" position="1099,2051" size="100,100">You feel much better now that you&#39;ve put these things out of your mind and in to your stomach.

(set: $satiety to it + 10)\
(set: $sanity to it + 10)\
(set: $cards to it - (array: &quot;crabs&quot;))\
(if: not ($achievements contains &quot;Consume vital correspondence&quot;))[(set: $achievements to it + (array: &quot;Consume vital correspondence&quot;))]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="151" name="Share the treatise with hungry man" tags="mist" position="2371,635" size="100,100">His eyes widen as he reads the photocopied treatise.

&quot;Crab&quot;, he says. &quot;Do you have any crab for me to eat?&quot;

&quot;Or any watermelon?&quot; he adds hopefully.

[[Leave him|Main]]</tw-passagedata><tw-passagedata pid="152" name="sergeGuide" tags="" position="804,1466" size="100,100">A strange man enters the room. He is carrying a jar full of bugs and smells faintly of bacon.

&quot;I&#39;ve survived in this dungeon longer than most,&quot; he says, &quot;and I know the way to the exit. Want me to take you?&quot;

&lt;img src=&quot;serge.png&quot;&gt;

(set: $sergeGuide to 0)\
(set: $rareishCards to it - (array: &quot;sergeGuide&quot;))\
[[Yes|YesSerge]]
[[No|Main]]</tw-passagedata><tw-passagedata pid="153" name="YesSerge" tags="" position="756,1590" size="100,100">The journey passess uneventfully. When you reach the exit he offers his hand.

&quot;Good luck out there,&quot; he says.

[[Shake his hand|exit]](if: $hunger &gt; 1)[
[[Eat his hand]]]
</tw-passagedata><tw-passagedata pid="154" name="Eat his hand" tags="" position="741,1692" size="100,100">You override his objections. After all, this might be the last time you get to do something like this.

(set: $satiety to it + 5)\
[[Delicious.|exit]]</tw-passagedata><tw-passagedata pid="155" name="You have **$keys** keys]&lt;keyCount|" tags="" position="288,1124" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="156" name="trueInit" tags="hide-sidebar achievements" position="648,405" size="100,100">&lt;h3&gt;[The Birthday (color:red)[Dungeon]]&lt;title| (css: &quot;font-size: 40%;&quot;)[(color: grey + black)[version 0.9.1]]&lt;/h3&gt;(if: $glory is true)[&lt;img src=&quot;sidequestia2.png&quot;&gt;(replace: ?title)[All Glory to
Sidequestia]](else:)[(set: $r to (random: 1,4))(if: $r is 1)[&lt;img src=&quot;key.png&quot;&gt;](else:)[&lt;img src=&quot;Watermelon.png&quot;&gt;]]
(if: (saved-games:) contains &quot;Slot A&quot;)[Save file found.

(link: &quot;Restore progress&quot;)[(go-to: &quot;savedInit&quot;)]
(link:&quot;Erase progress and start again&quot;)[Are you sure? [[Yes|init]]]](else:)[
(link: &quot;Begin&quot;)[(go-to: &quot;init&quot;)]]
[[About]]
(if: $r is 1)[&lt;script&gt;
audio.themeAlt.play();
&lt;/script&gt;](else:)[&lt;script&gt;
audio.theme.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="157" name="mushrooms" tags="" position="2869,716" size="100,100">The room drips with moisture and smells of soil. Luminous mushrooms have sprouted from the floor.

&lt;img src=&quot;mushroom.png&quot;&gt;

[[Eat the mushrooms]]
(if: $ally&#39;s type is &quot;pigeons&quot;)[[[Encourage your pigeons to eat the mushrooms|Allow your pigeons to feed.]]
]\
[[Don&#39;t eat the mushrooms|Main]]</tw-passagedata><tw-passagedata pid="158" name="Eat the mushrooms" tags="" position="2865,842" size="100,100">They affect you strangely. But at least you&#39;re less hungry.

(set: $satiety to it + 15)\
(set: $mushroomCooldown to $turns + (random: 3,7))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="159" name="descentNote" tags="" position="2695,1350" size="100,100">You find a crisp white envelope on the floor. It contains a key and birthday card, which conveys the following message:

*Renovations on the sub-dungeon are now complete. It can be reached via the stairs that lie beyond the exit door. We look forward to your company.*

What horrors await you downstairs? Your mind whirls with possibilities.

&lt;img src=&quot;envelope.png&quot;&gt;

(set: $sanity to it - 5)(set: $keys to it + 1)\
(set: $cards to it - (array: &quot;descentNote&quot;))\
[[But more pressing matters currently demand your attention|Main]]</tw-passagedata><tw-passagedata pid="160" name="Go up, to safety" tags="" position="2448,842" size="100,100">(if: $turns &lt;= 90 and not ($achievements contains &quot;Escape within 90 minutes of entering the dungeon&quot;))[(set: $achievements to it + (array: &quot;Escape within 90 minutes of entering the dungeon&quot;))(display: &quot;achievementDisplay&quot;)]\
(if: $curseGame is true and not ($achievements contains &quot;Escape after entering via the secret entrance&quot;))[(set: $achievements to it + (array: &quot;Escape after entering via the secret entrance&quot;))(display: &quot;achievementDisplay&quot;)]\
You climb up the stairs and into the sunshine. You are hurt, traumatised, and hungry. You will never completely recover.

Happy birthday!(save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))

&lt;img src=&quot;outside.png&quot;&gt;

[[Achievements]]
[[Begin again|init]]&lt;script&gt;
stopaudio();
audio.happyEnd.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="161" name="Go down" tags="" position="2438,994" size="100,100">You descend into the velvety blackness and the sheer unknown.

*Your progress has been saved.*

(if: not ($achevements contains &quot;Find the sub-dungeon&quot;))[(set: $achievements to it + (array: &quot;Find the sub-dungeon&quot;))]\
(set: $cards to it - (array: &quot;exit&quot;, &quot;Gorgon&quot;, &quot;sergeGuide&quot;))(set: $uncommonCards to it - (array: &quot;Gorgon&quot;))\
(set: $cards to it + (array: &quot;hole&quot;, &quot;hole&quot;, &quot;EnergyGraffiti&quot;, &quot;HealthGraffiti&quot;, &quot;SanityGraffiti&quot;, &quot;SatietyGraffiti&quot;))\
(set: $uncommonCards to it + (array: &quot;lockedChest&quot;, &quot;frog&quot;))\
(set: $rareishCards to it + (array: &quot;red dragon&quot;, &quot;green dragon&quot;))\
(set: $rareCards to it + (array: &quot;white dragon&quot;, &quot;crabPortal&quot;))\
(set: $sergeGuide to 0)\
(set: $descension to 1)\
(set: $r to (shuffled: ...(array: &quot;The Subterranean Vole&quot;, &quot;The Subterranean Swoop-Bat&quot;, &quot;The Subterranean Squid-Fish&quot;, &quot;The Subterranean Blood-Beetle&quot;, &quot;The Subterranean Basilisk&quot;, &quot;The Subterranean Cave-Tern&quot;, &quot;The Subterranean Grootslang&quot;, &quot;The Subterranean Mole-Snail&quot;, &quot;The Subterranean Stoneworm&quot;, &quot;The Subterranean Dread-Moth&quot;)))\
(set: $tiles to it + $r&#39;s (range:2,3))\
(set: $safeTiles to it + (array: 1st of $r))\
(set: $roomExecute to it - (array: &#39;(if: $keys &gt;=5 and $sergeGuide is 1)[(set: $rareishCards to it + (array: &quot;sergeGuide&quot;))]&#39;))\
(set: $roomExecute to it + (array: &#39;(if: $inklings &gt;=18 and $sergeGuide2 is 1)[(set: $rareishCards to it + (array: &quot;sergeGuide2&quot;))]&#39;))\
(save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))\
[[Down, down, down.|Main]]&lt;script&gt;
stopaudio();
audio.otherworld.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="162" name="Blessing of snacking" tags="blessings" position="2084,54" size="100,100">You&#39;re not sure why, but whenever you reach into your pockets you find chocolate-coated coffee beans.

(set: $blessings to it + (array: &quot;snacking&quot;))\
[[Yum.|Main]]</tw-passagedata><tw-passagedata pid="163" name="hole" tags="" position="2977,1193" size="100,100">A spiral staircase leads down  to lower levels still. The spirals become smaller and tighter as the staircase coils downwards. You know with fractured certainty that if you dropped something down the gap you would never hear it hit the bottom.

And for a brief moment the stone dungeon seems no more than a house of cards, moments before the wind.

[[Look down]]
(link: &quot;Shake off your malaise&quot;)[(set: $sanity to it - 10)(go-to: &quot;Main&quot;)](if: $hats &gt; 0)[
[[Throw a hat down the hole]]](if: $inklings &gt; 0 and $inklings &lt; 18)[
(link: &quot;Go down the stairs&quot;)[(colour: &quot;#197fe6&quot;)[&#39;&#39;You need (text: 18 - $inklings) more Inklings of a deeper purpose&#39;&#39;]]](else-if: $inklings &gt;=18)[
[[Go down the stairs]]]</tw-passagedata><tw-passagedata pid="164" name="catFriend" tags="" position="168,2384" size="100,100">A cat - it looks like the one you befriended earlier - approaches you from across the room.

&lt;img src=&quot;cat.png&quot;&gt;

(if: $catKey is 1)[It purrs deeply and drops a rusted key at your feet. Could this be its way of expressing gratitude for the pigeons you so generously fed to it?

(set: $catKey to 2)(set: $keys to it + 1)(set: $cards to it - (array: &quot;catFriend&quot;))\
*You now have (print: $keys) keys*

[[Onwards!|Main]]]\
(else:)[It drops a dead mouse at your feet.

[[Yay! A cute cat!]]
(if: $hunger &gt; 1)[[[Yum. A dead mouse.]]
]\
[[Ew. A dead mouse.]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Feed your pigeons to your cat]]]]</tw-passagedata><tw-passagedata pid="165" name="Yum. A dead mouse." tags="" position="276,2434" size="100,100">Are you really doing this?

Yes. You are.

It is a small and nauseating meal.

(set: $satiety to it + 10)(set: $sanity to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="166" name="Yay! A cute cat!" tags="" position="37,2496" size="100,100">It allows you to pat it for a full minute before it stalks back into the dungeon.

(set: $sanity to it + 5)\
(either: &#39;[[Aw.|Main]]&#39;, &#39;[[Cute.|Main]]&#39;, &#39;[[Adorable|Main]]&#39;)</tw-passagedata><tw-passagedata pid="167" name="Ew. A dead mouse." tags="" position="165,2510" size="100,100">You push it away with your foot.

(set: $sanity to it - 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="168" name="red dragon" tags="" position="2547,475" size="100,100">It&#39;s a red sub-dungeon dragon! (if: $inventory contains &quot;arrow&quot;)[Its chest is scarred.](else:)[A spear has been lodged in its breastbone by some previous adventurer.]

&lt;img src=&quot;dragon.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;damage&quot;, 20, &quot;type&quot;, &quot;basic&quot;))\
(display: &quot;monster&quot;)\
(if: not($inventory contains &quot;arrow&quot;))[
[[Pull the spear from its chest]] *((if: (10 + $fleeBonus) &gt; 100)[100](elseif: 10 + $fleeBonus &lt; 0)[0](else:)[(round: (10 + $fleeBonus))]% chance of success)*]</tw-passagedata><tw-passagedata pid="169" name="green dragon" tags="" position="2803,163" size="100,100">It&#39;s a green sub-dungeon dragon! It has already spotted you. It looks like it&#39;s about to strike.

&lt;img src=&quot;dragonGreen.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 25, &quot;damage&quot;, 20, &quot;type&quot;, &quot;basic&quot;))\
(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="170" name="white dragon" tags="" position="2872,318" size="100,100">It&#39;s a white dragon!

Or is it? Where you thought you saw the dragon is a blank wall. Are you seeing things?

(set: $monster to (datamap: &quot;fleeChance&quot;, 30, &quot;damage&quot;, 20, &quot;type&quot;, &quot;basic&quot;))\
[[Proceed cautiously]]
[[Proceed nonchalantly|Proceed cautiously]]
[[Run away, just in case|Run]] *((if: ($monster&#39;s fleeChance + $fleeBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus))]% chance of success)*</tw-passagedata><tw-passagedata pid="171" name="Proceed cautiously" tags="" position="2886,456" size="100,100">Nothing happens. Did you imagine a dragon where there was none?

(set: $sanity to it - 15)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="172" name="Blessing of boundaries" tags="blessings" position="2083,172" size="100,100">(set: $statMax to it + 25)\
(set: $HP to it + 15)(set: $sanity to it + 15)(set: $energy to it + 15)(set: $satiety to it + 15)\
(set: $blessings to it + (array: &quot;boundaries&quot;))\
Increases your health, sanity, energy and satiety, and also increases the maximum value they can reach without penalty to &#39;&#39;(print: $statMax)&#39;&#39;.

[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="173" name="headband" tags="" position="726,2246" size="100,100">A repulsive orange hobgoblin rants and raves in the corner of the room. He catches your eye and belligerates towards you. 

&quot;Let&#39;s make a deal,&quot; he says, pulling a cheap strip of polyester from his pocket. &quot;Want this headband?&quot; he asks, waving it in front of your face. &quot;It will cost you a key.&quot;

*The headband very slightly increases your chance of succesfully fleeing any monsters you might encounter*

&lt;img src=&quot;trump.png&quot;&gt;

(link: &quot;Make the trade&quot;)[(if: $keys &lt; 1)[You have no keys to trade.](else:)[(go-to: &quot;Make the trade&quot;)]]
[[Refuse|Main]]
[[Steal the headband]]</tw-passagedata><tw-passagedata pid="174" name="Make the trade" tags="" position="910,2330" size="100,100">The pugnacious orange hobgoblin takes your key and leaves. 

The headband itches unpleasantly. But maybe you&#39;ll run marginally faster now.

(set: $keys to it - 1)\
*You now have (print: $keys) keys.*

(set: $inventory to it + (array: &quot;headband&quot;))(set: $rareCards to it - (array: &quot;headband&quot;))\
(set: $fleeBonus to it + 3)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="175" name="HealthGraffiti" tags="" position="2670,1753" size="100,100">You notice some graffiti gouged deeply into the dungeon wall. The text is illustrated with images of soldiers and gravestones.

&lt;img src=&quot;graffitiSoldier.png&quot;&gt;

[[Inspect|InspectHealth]]
[[Leave it unread]]</tw-passagedata><tw-passagedata pid="176" name="SanityGraffiti" tags="" position="2787,1753" size="100,100">You notice some graffiti scrawled in red on the dungeon wall. The writing is jagged, and the text is adorned with illustrations of tiny demons.

&lt;img src=&quot;graffitiDemon.png&quot;&gt;

[[Inspect|InspectSanity]]
[[Leave it unread]]</tw-passagedata><tw-passagedata pid="177" name="EnergyGraffiti" tags="" position="2556,1755" size="100,100">You notice some graffiti written in chalk on the dungeon wall. The writing droops downwards at the end of each line. There are no illustrations.

[[Inspect|InspectEnergy]]
[[Leave it unread]]</tw-passagedata><tw-passagedata pid="178" name="SatietyGraffiti" tags="" position="2905,1754" size="100,100">You notice some graffiti on the dungeon wall. The writing is loopy and bulbous, and the images depict various edible things.

&lt;img src=&quot;graffitiFood.png&quot;&gt;

[[Inspect|InspectSatiety]]
[[Leave it unread]]</tw-passagedata><tw-passagedata pid="179" name="InspectSatiety" tags="" position="2901,2003" size="100,100">There are images of cupcakes and ginger drinks and snakes eating their own tails. The text disjointedly describes the qualities of different varieties of watermelon and the horrors of unsateable hungers. You can sense some more deeply submerged meaning, but you can&#39;t quite pull it into focus.

(set: $inklings to it + (random: 1,4))\
(set: $satiety to it - ((round: $satiety / 2)+5))\
*You now have (print: $inklings) Inklings of a deeper purpose.*

[[Onwards!|Main]]&lt;script&gt;
audio.drain.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="180" name="Leave it unread" tags="" position="2725,1601" size="100,100">Something about the graffiti was discomfiting. Leaving it unread feels like an eminently sensible choice.

(set: $sanity to it + 3)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="181" name="InspectSanity" tags="" position="2780,2004" size="100,100">The writing describes the laws of thermodynamics in terms of a host of tiny demons directing the flow of molecules in every part of the universe. It further attributes all wrongdoing in the world to these tiny demons.

The argument is compelling enough that for a moment the thought of these demons (in the air; in the vacuum of space; in your very body) fills you with dread. But no. There&#39;s another meaning underneath this one - one you can faintly detect, but don&#39;t yet understand.

(set: $inklings to it + (random: 1,4))\
(set: $sanity to it - ((round: $sanity / 2)+5))\
*You now have (print: $inklings) Inklings of a deeper purpose.*

[[Onwards!|Main]]&lt;script&gt;
audio.drain.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="182" name="jargoOld" tags="" position="2578,749" size="100,100">You find some pants on the dungeon floor. It&#39;s unclear whether they are cargo pants, jeans, or some combination of the two.

&lt;img src=&quot;jargo.png&quot;&gt;

[[Put them on|jargoWear]]
[[Leave them there|Main]]</tw-passagedata><tw-passagedata pid="183" name="jargoWear" tags="" position="1812,4479" size="100,100">They look fabulous!

&lt;img src=&quot;jargo.png&quot;&gt;

(set: $sanity to it + 20)(set: $inventory to it + (array: &quot;jargo&quot;))\
[[Onwards, with style.|Main]]</tw-passagedata><tw-passagedata pid="184" name="InspectHealth" tags="" position="2660,2007" size="100,100">The graffiti chronicles a series of clashes between humans and otherworldly creatures with too many tentacles and too few eyes. The illustrations depict heads skewered on polies and limbs removed from bodies. You flinch sympathetically.

Maybe not sympathetically. There is blood on your hands. How is this possible?

(set: $inklings to it + (random: 1,4))\
(set: $HP to it - ((round: $HP / 2) + 5))\
*You now have (print: $inklings) Inklings of a deeper purpose.*

[[Onwards!|Main]]&lt;script&gt;
audio.drain.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="185" name="InspectEnergy" tags="" position="2549,2007" size="100,100">You try reading the text but quickly lose interest. You try rereading it, but get even less far through the message than on your first attempt.

You have the sense that something important is inscribed here. If only you could focus just a little bit harder.

(set: $inklings to it + (random: 1,4))\
(set: $energy to it - ((round: $energy / 2) + 5))\
*You now have (print: $inklings) Inklings of a deeper purpose.*

[[Onwards!|Main]]&lt;script&gt;
audio.drain.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="186" name="lockedChest" tags="" position="523,2174" size="100,100">You find a locked treasure chest. (if: $keys &gt; 0)[You have a key that would fit perfectly.]

&lt;img src=&quot;chest2.png&quot;&gt;

(set: $gift to (array: &quot;[[inkling]]&quot;, &quot;[[relic]]&quot;, &quot;[[crampedSerge]]&quot;))\
(if: $keys &gt; 0)[(link: &quot;Unlock the chest&quot;)[(set: $keys to it - 1)(replace: ?leave)[]Your key jams and can&#39;t be removed. [[But what&#39;s this inside?|(print: 1st of (shuffled: ...$gift))]]]
]\
[[[Leave|Main]]]&lt;leave|</tw-passagedata><tw-passagedata pid="187" name="Go down the stairs" tags="" position="2925,1341" size="100,100">The hints you have gathered coalesce into a single undeniable truth: you must go down the stairs.

Do you want to leave now? The journey will not be easy, so be sure you are in a position to take it.

(link: &quot;Yes. This is your anagnorisis.&quot;)[&lt;script&gt;
stopaudio();
audio.adrenalineLoop.play();
&lt;/script&gt;
(go-to: &quot;Descend.&quot;)]
[[Not now. But soon.|Main]]</tw-passagedata><tw-passagedata pid="188" name="Descend." tags="" position="3078,1587" size="100,100">(if: $descension &gt; 317)[(go-to: &quot;TrueEnd&quot;)]\
(set: $descendDisplay to (either: &quot;descendHealth&quot;, &quot;descendEnergy&quot;, &quot;descendSanity&quot;, &quot;descendSatiety&quot;))\
(display: $descendDisplay)\
(set: $descension to it + (random: 1,15))\
*You have descended $descension floors*

(if: $energy &lt;1)[(go-to: &quot;You are dead&quot;)]\
(if: $HP &lt;1)[(go-to: &quot;You are dead&quot;)]\
(if: $satiety &lt;1)[(go-to: &quot;You are dead&quot;)]\
(if: $sanity &lt;1)[(go-to: &quot;You are insane&quot;)]\
[[Go further.|Descend.]]</tw-passagedata><tw-passagedata pid="189" name="descendEnergy" tags="" position="3232,1586" size="100,100">(either: &quot;You go down yet another flight of stairs. How much longer can you keep this up?&quot;, &quot;There&#39;s a stitch in your chest. You push through it.&quot;)

(set: $energy to it - (random: 1,5))</tw-passagedata><tw-passagedata pid="190" name="descendHealth" tags="" position="3232,1475" size="100,100">(either: &quot;Your heart pounds. Your ears ring. Your feet ache.&quot;, &quot;Your heart pounds. Your ears ring. Your feet ache.&quot;, &quot;There&#39;s a sudden cramping pain in your left leg. Did you strain your quadriceps? Is your rectus femoris tendon inflamed?&quot;, &quot;There&#39;s a sudden cramping pain in your right leg. Did you strain your quadriceps? Is your rectus femoris tendon inflamed?&quot;)

(set: $HP to it - (random: 1,5))</tw-passagedata><tw-passagedata pid="191" name="descendSatiety" tags="" position="3233,1697" size="100,100">(either: &quot;Your stomach rumbles. How long has it been since you&#39;ve eaten?&quot;, &quot;You notice a growing hunger. If only you had brought a snack.&quot;, &quot;Down, down, down you go, with nothing left to eat.&quot;)

(set: $satiety to it - (random: 1,5))</tw-passagedata><tw-passagedata pid="192" name="descendSanity" tags="" position="3235,1808" size="100,100">(either: &quot;The darkness is oppresive. There is no sound but the echo of your footsteps and the rush of blood in your ears.&quot;, &quot;How much further can you go before you pass the point of no return? Or have you already passed it?&quot;)

(set: $sanity to it - (random: 1,5))</tw-passagedata><tw-passagedata pid="193" name="TrueEnd" tags="" position="3080,1703" size="100,100">You see a glimmer of light far below you.

You begin to bound down the stairs two or three at a time, depleting reserves of energy that you didn&#39;t know you had.

When you reach the bottom you find the source of the light: a solitary candle, planted firmly in a chocolate birthday cake.

[[Feast.|TrueEnd2]]</tw-passagedata><tw-passagedata pid="194" name="TrueEnd2" tags="" position="3079,1814" size="100,100">Once you are done you will attempt to return the way you came. It will be no easy task; it is more tiring to climb up stairs than down them, and you don&#39;t know what you will encounter when you return to the dungeon proper. 

If you even make it that far. If there even is still a dungeon above you. You feel disconnected from everything burried this deep below the earth, and you are acutely aware of the architectural impossibility of the staircase you just finished descending. You&#39;re not sure if it even returns to the same place you came from.

But these problems are to be tackled later. You are here. You have made it. And there is cake to be eaten.

&lt;img src=&quot;cake.png&quot;&gt;

Happy birthday.

(if: not ($achievements contains &quot;Reach the content boundary&quot;))[(set: $achievements to it + (array: &quot;Reach the content boundary&quot;))]\
(if: not ($curses is (array: &quot;&quot;)) and ($achievements contains &quot;Reach the content boundary while cursed&quot;))[(set: $achievements to it + (array: &quot;Reach the content boundary while cursed&quot;))]\
(display: &quot;GameOver&quot;)&lt;script&gt;
stopaudio();
audio.happiest.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="195" name="Wave the arrow threateningly" tags="" position="2668,492" size="100,100">The dragon backs off immediately.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="196" name="Pull the spear from its chest" tags="" position="2548,589" size="100,100">(if: (random: 1, 100) &lt;= (10 + $fleeBonus))[You pull firmly on the spear. THe dragon roars; it bellows; it flaps its wings and frantically tries to pursue you down the corridor.

But you escape. And you hold the spear tightly in your hand.

(set: $inventory to it + (array: &quot;arrow&quot;))\
[[Onwards!|Main]]]\
(else:)[You don&#39;t even get close before the dragon intercepts you. It claws your chest; it roars fire from above; it drives you further and further away, until you collapse, singed, in the corridor outside the chamber.

(set: $energy to it - 5)(set: $HP to it - ($monster&#39;s damage))\
[[Limp on.|Main]]]</tw-passagedata><tw-passagedata pid="197" name="ethicsTome" tags="" position="2181,2157" size="100,100">You find a bookshelf. It carries a solitary book - a hardcover tome titled *The Ethics of Dungeoneering: Interdisciplinary Perspectives.*

&lt;img src=&quot;book.png&quot;&gt;

(set: $badTome to 0)\
(link: &quot;Read&quot;)[&lt;script&gt;
stopaudio();
audio.calm.play();
&lt;/script&gt;(go-to: &quot;Read&quot;)]
[[Leave it to the bookworms|Main]]</tw-passagedata><tw-passagedata pid="198" name="The sleek grey one" tags="" position="304,601" size="100,100">You double over in pain. The muscles in your legs are unknotting and reknitting over and over again. It feels like crabs are scuttling under your skin until.

When your ordeal is finally over your legs feel stronger and more agile. You can run faster now.

(set: $fleeBonus to it + 8)\
[[Huzzah!|Main]]</tw-passagedata><tw-passagedata pid="199" name="Read" tags="" position="2208,2313" size="100,100">(set: $badTome to it + 1)\
(set: $sanity to it + 1)\
(if: $badTome &gt;=100)[(go-to: &quot;Finish reading&quot;)]\
(if: (random: 1,125) is 1 and $poopKey is 0)[This page yields some unexpected and highly valuable information: there is a key carefully concealed in the wall behind one of the dungeon&#39;s couches, just ready for the taking.

And now you know where to look.(set: $poopKey to 1)

*You have learned something new of the birthday dungeon*]\
(else:)[(either: &quot;How interesting!&quot;, &quot;You never knew that!&quot;, &quot;What a cogent argument!&quot;, &quot;You find yourself agreeing with this chapter&#39;s thesis.&quot;, &quot;You find yourself disagreeing with this chapter&#39;s thesis.&quot;, &quot;Another page?&quot;, &quot;Fascinating!&quot;, &quot;What a well-chosen collection of papers.&quot;, &quot;This author&#39;s institutional affiliation is especially impressive.&quot;, &quot;What an under-appreciated field of study.&quot;, &quot;What a well-chosen quotation!&quot;, &quot;This section has an especially strong concluding paragraph.&quot;, &quot;You find yourself wanting to learn more about the ethics of dungeoneering.&quot;, &quot;You would normally only expect this kind of quality from a university press.&quot;, &quot;This chapter contains at least five neologisms. And they&#39;re all amazing!&quot;, &quot;The pages fly by.&quot;,&quot;This page was written entirely in the passive voice.&quot;, &quot;How erudite!&quot;, &quot;This footnote contains an especially interesting digression.&quot;)]

[[Continue reading|Read]] 
[[Finish reading]] *(There is a (print: $badTome)% chance this will have a bad outcome.)*</tw-passagedata><tw-passagedata pid="200" name="Finish reading" tags="" position="2066,2417" size="100,100">(if: $badTome &lt;= (random: 1, 100))[You put the book down. What a pleasant interlude.

[[Onwards!|Main]]]\
(else:)[You put the book down, but you can&#39;t stop turning its ideas around in your head. Could Arrowson&#39;s defence of Novick succeed? Is Wellington interpreting Foxbridge charitably?

You feel more confused than ever.(set: $sanity to 1)

[[Onwards!|Main]]]&lt;script&gt;
stopaudio();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="201" name="demon" tags="" position="1090,2314" size="100,100">(set: $drainValue to (random: 10,30))\
(set: $playerVariables to (shuffled: ...(array: &quot;health&quot;, &quot;sanity&quot;, &quot;energy&quot;, &quot;satiety&quot;)))\
(if: (random: 1,10) is 1)[(set: $drainValue to (either: 2,4,6,8,10))(set: $playerVariables to (array: &quot;speed&quot;) + $playerVariables)]\
(set: $drainType to 1st of $playerVariables)\
A (either: &quot;tiny&quot;, &quot;fuzzy&quot;, &quot;huge&quot;, &quot;large&quot;, &quot;medium-sized&quot;, &quot;glowering&quot;, &quot;purple-skinned&quot;, &quot;tentacled&quot;) demon buzzes towards you. It asks you to sacrifice (print: $drainValue) (print: $drainType).

&lt;img src=&quot;demon.png&quot;&gt;

[[Comply.]]
[[Refuse.]](if: $inventory contains &quot;soul&quot;)[
[[Barter your soul instead]]* - you can only do this once.*] (if: $inventory contains &quot;godStains&quot;)[
[[Inform it that its master is no more.]]]</tw-passagedata><tw-passagedata pid="202" name="Comply." tags="" position="966,2462" size="100,100">(if: $drainType is &quot;health&quot;)[(set: $HP to it - $drainValue)]\
(if: $drainType is &quot;energy&quot;)[(set: $energy to it - $drainValue)]\
(if: $drainType is &quot;sanity&quot;)[(set: $sanity to it - $drainValue)]\
(if: $drainType is &quot;satiety&quot;)[(set: $satiety to it - $drainValue)]\
(if: $drainType is &quot;speed&quot;)[(set: $fleeBonus to it - $drainValue)]\
[[It is done.|Main]]</tw-passagedata><tw-passagedata pid="203" name="Refuse." tags="" position="1242,2497" size="100,100">(set: $drainValue to (random: 10,30))\
(set: $drainType to 2nd of $playerVariables)\
(if: (random: 1,12) is 1)[(set: $drainValue to (either: 2,4,6,8,10))(set: $drainType to &quot;speed&quot;))]\
(if: $drainType is &quot;health&quot;)[(set: $HP to it - $drainValue)]\
(if: $drainType is &quot;energy&quot;)[(set: $energy to it - $drainValue)]\
(if: $drainType is &quot;sanity&quot;)[(set: $sanity to it - $drainValue)]\
(if: $drainType is &quot;satiety&quot;)[(set: $satiety to it - $drainValue)]\
(if: $drainType is &quot;speed&quot;)[(set: $fleeBonus to it - $drainValue)]\
It takes (print: $drainValue) (print: $drainType) instead.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="204" name="Inform it that its master is no more." tags="" position="1093,2456" size="100,100">Having learned that you ate its master, the demon decides to leave you alone.

You wonder what it will do now.

(set: $cards to it - (array: &quot;demon&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="205" name="GameOver" tags="" position="120,1368" size="100,100">(if: $turns &lt;= 10 and not ($achievements contains &quot;Fail spectacularly&quot;))[(set: $achievements to it + (array: &quot;Fail spectacularly&quot;))]\
(display: &quot;achievementDisplay&quot;)\
(save-game: &quot;Slot A&quot;, (text: &quot;(set: $achievements to &quot;) + (text: &quot;(array: &#39;&quot;) + (text: $achievements.join(&quot;&#39;,&#39;&quot;)) + (text: &quot;&#39;))&quot;))\
(set: $mushroomCooldown to -10)(set: $strangeBrew to 0)\
[[Begin again|init]] *(Your progress and achievements have been saved.)*(set: $inventoryCheck to false)</tw-passagedata><tw-passagedata pid="206" name="bibleopoly" tags="" position="2451,1176" size="100,100">You enter a cozy den. Embers glow within a stone hearth. A half-played game of *DungeonDeity-Opoly* lies abandoned on a small wooden table.

&lt;img src=&quot;dice.png&quot;&gt;

[[Read the instructions.]]
[[Feed the pieces to the flames.]]</tw-passagedata><tw-passagedata pid="207" name="Read the instructions." tags="" position="2384,1320" size="100,100">The manual is decorated with horrific illustrations. The very first page depicts a tentacled deity feasting on worshipers. Surely this game can&#39;t be intended for children?

(set: $sanity to it - 20)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="208" name="Feed the pieces to the flames." tags="" position="2520,1320" size="100,100">(if: not ($inventory contains &quot;godStains&quot;))[You feed the pieces to the flames, one at a time. They burn merrily.

You experience the curious sensation of some great cosmic eye shifting to focus on you alone.

(set: $cards to it + (array: &quot;furiousGod&quot;))&lt;script&gt;audio.bad.play();&lt;/script&gt;\
[[Onwards!|Main]]]\
(else:)[The rekindled flames warm your hands nicely.

(set: $sanity to it + 5)\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="209" name="Painting" tags="" position="2680,992" size="100,100">A painting is hung on the wall here. It is titled *Flowers and Towers and Rolling.* It is composed of a bewildering array of shapes. It is the kind of painting you imagine might shuffle the order of your stats if you touch it.

&lt;img src=&quot;painting.png&quot;&gt;

[[Touch the painting.]]
[[Move on.|Main]]</tw-passagedata><tw-passagedata pid="210" name="Touch the painting." tags="" position="2680,1142" size="100,100">(set: $shuffler to (rotated: (random: 1,3), ...(array: $HP, $sanity, $energy, $satiety)))\
(set: $HP to 1st of $shuffler)\
(set: $sanity to 2nd of $shuffler)\
(set: $energy to 3rd of $shuffler)\
(set: $satiety to 4th of $shuffler)\
You were right! Your stats have been shuffled.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="211" name="Blessing of inheritance" tags="" position="1962,300" size="100,100">Your successor will inherit any keys you possess at the time of your death.

(set: $blessings to it + (array: &quot;inheritance&quot;))\
(set: $inherit to true)\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="212" name="savedInit" tags="achievements" position="740,697" size="100,100">Loading...
(if: (saved-games:)&#39;s &quot;Slot A&quot; is &quot;in progress&quot;)[(load-game: &quot;Slot A&quot;)]
(else:)[(print: (saved-games:)&#39;s &quot;Slot A&quot;)(set: $achievementsOld to $achievements)(goto: &quot;init&quot;)]</tw-passagedata><tw-passagedata pid="213" name="saveGame2" tags="" position="1255,532" size="100,100">Something vast and unknowable has noted your progress.(save-game:&quot;Slot A&quot;, &quot;in progress&quot;)

(if: $descension &lt; 1)[&lt;img src=&quot;eyeSave.png&quot;&gt;](else:)[&lt;img src=&quot;eyeSave2.png&quot;&gt;]

*Your game has been saved.*

[[Head deeper into the dungeon|gods]]
(link: &quot;Imagine yourself elsewhere&quot;)[*This will* (link: &quot;*close the game*&quot;)[&lt;script&gt;window.close()&lt;/script&gt;]](if: $inventory contains &quot;90s&quot;)[&lt;script&gt;
stopaudio();
audio.smashmouth.play();
&lt;/script&gt;](else-if: $descension &gt; 0)[(if: (random:1,2) is 1)[&lt;script&gt;
stopaudio();
audio.subdungeon.play();
&lt;/script&gt;](else:)[&lt;script&gt;
stopaudio();
audio.subSave.play();
&lt;/script&gt;]](else-if: (random: 1,2) is 1)[&lt;script&gt;
stopaudio();
audio.determined2.play();
&lt;/script&gt;](else:)[&lt;script&gt;
stopaudio();
audio.determined.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="214" name="saveGame" tags="" position="1326,427" size="100,100">(if: $saveTimer &gt; $turns)[(set: $rareishCards to it - (array: &quot;saveGame&quot;))(goto: &quot;Main&quot;)](else:)[Something vast and unknowable has noted your progress.(set: $saveTimer to $turns + (random: 18,30))(set: $r to (random: 1,6))(set: $rareishCards to it - (array: &quot;saveGame&quot;))

(link: &quot;Oh?&quot;)[(if: $curseGame is false or $curses contains &quot;clean&quot;)[(go-to:&quot;saveGame2&quot;)](else:)[(go-to: &quot;curses&quot;)]]]</tw-passagedata><tw-passagedata pid="215" name="Feed your pigeons to your cat" tags="" position="291,2557" size="100,100">For a brief moment they eye each other with hostility. Each party soon decides to attack the other.

After a brief yet decisive battle the cat saunters away with several pigeons hanging limply in its mouth. The survivors promptly flap away.

(set: $ally&#39;s type to &quot;none&quot;)\
(set: $catKey to 1)\
(set: $sanity to it - 5)\
(set: $cards to it - (array: &quot;pigeons&quot;, &quot;watermelonBird&quot;))\
(if: not ($achievements contains &quot;Kill your darlings&quot;))[(set: $achievements to it + (array: &quot;Kill your darlings&quot;))]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="216" name="Eat the candles" tags="" position="976,1215" size="100,100">Surely no sane person would do this. But they look buttery and wholesome, and they smell so very sweet. 

The taste, oh god, is horrible. Your stomach cramps violently.

(set: $satiety to it + 15)\
(set: $sanity to it - 5)
(set: $HP to it - 20)\
[[Onwards.|Main]]</tw-passagedata><tw-passagedata pid="217" name="confide" tags="" position="1668,2393" size="100,100">(if: $descension &gt; 0)[(display: &quot;darkMirror&quot;)]\
(else:)[(if: (random: 1,9) is 1)[(display: &quot;confideAlt&quot;)](else:)[A mirror hangs on the wall. Your reflection demands that you confide something to it. (if: $direction&#39;s direction is &quot;east&quot;)[

But you are marching East. You have no time for chitchat.

&lt;img src=&quot;mirror.png&quot;&gt;

(link: &quot;March on.&quot;)[(set: $energy to it - 5)(go-to: &quot;Main&quot;)]]\
(else:)[

&lt;img src=&quot;mirror.png&quot;&gt;
[
[[Confide an old wound]] *- this will either somewhat reduce or significantly increase your health*]&lt;confide1|\
[
[[Confide a shameful secret]] *- this will either somewhat reduce or significantly increase your sanity*]&lt;confide2|\
[
[[Confide an abandoned ambition]] - *this will either somewhat reduce or significantly increase your energy*]&lt;confide3|\
[
[[Confide an episode of self-indulgence]] - *this will either somewhat reduce or significantly increase your satiety*]&lt;confide4| (if: $hunger &gt; 3)[
[[Eat your reflection]]](replace: (either: &quot;?confide1&quot;, &quot;?confide2&quot;, &quot;?confide3&quot;, &quot;?confide4&quot;))[]]]]</tw-passagedata><tw-passagedata pid="218" name="Confide an old wound" tags="" position="1513,2524" size="100,100">(if: (random: 1,2) is 1)[Even now the memory still hurts.

(set: $HP to it - 12)]\
(else:)[Painful though the memory is, it&#39;s from a long time ago. You&#39;re stronger now.

(set: $HP to it + 25)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="219" name="Confide a shameful secret" tags="" position="1623,2521" size="100,100">(if: (random: 1,2) is 1)[A familiar sense of shame settles over you.

(set: $sanity to it - 12)]\
(else:)[Speaking about it is unexpectedly cathartic. You feel a weight lift from your mind.

(set: $sanity to it + 25)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="220" name="Confide an abandoned ambition" tags="" position="1739,2523" size="100,100">(if: (random: 1,2) is 1)[Speaking about it reminds you of the effort you devoted to the task. 

Is this what awaits you should you escape the dungeon? More futile labours? More unmet ambitions?

Where will you find the strength?

(set: $energy to it - 12)\
[[Shake off your malaise|Main]]]\
(else:)[How could you ever have let this fall to the wayside? You need to continue! You must escape!

(set: $energy to it + 25)\
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="221" name="Confide an episode of self-indulgence" tags="" position="1863,2526" size="100,100">... and then you ate a pie, and then a pizza, and then another pie, and then some rice, and them some chocolate, and then some biscuits, and then...

(if: (random: 1,2) is 1)[... and oh god remembering it makes you hungrier than ever.

(set: $satiety to it - 12)]\
(else:)[...and you can taste the food in your mouth and feel it settle your stomach. Psychosomatic or not, you feel less hungry now.

(set: $satiety to it + 25)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="222" name="Candies" tags="" position="2444,2164" size="100,100">You find some candies.

&lt;img src=&quot;candies.png&quot;&gt;

(link: &quot;Eat them&quot;)[(set: $satiety to it + 12)(go-to: &quot;Main&quot;)]
[[Throw them on the ground]]</tw-passagedata><tw-passagedata pid="223" name="Throw them on the ground" tags="" position="2519,2305" size="100,100">[[You threw them on the ground.|Main]]</tw-passagedata><tw-passagedata pid="224" name="Take the foul-smelling brew" tags="" position="2403,1584" size="100,100">(set: $strangeBrew to 1)(set: $teaTally to 0)(set: $icons to it + (array: &#39;&lt;img src=&quot;sTea.png&quot;&gt;&#39;))\
It has the consistency of rubbery mud and a scent like ash, yet it tastes deeply wholesome. 

*You are now enjoying the effects of an unusual brew.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="225" name="strangeBrew" tags="" position="2399,1693" size="100,100">(set: $strangeBrew to 0)(set: $cards to it - (array: &quot;strangeBrew&quot;))\
The effects of the tea have worn off.

[[Oh well.|Main]](set: $icons to it - (array: &#39;&lt;img src=&quot;sTea.png&quot;&gt;&#39;))</tw-passagedata><tw-passagedata pid="226" name="tornado" tags="" position="775,2605" size="100,100">You are overcome by sudden sadness. You were once tournament champion in China. You were once a threat all over Europe. The world was once your playground.

There was a time when you were not trapped in this dungeon. A time when you were able to enjoy the sun. When you had a flawless complexion.

There was somebody who once meant a lot to you, and to whom you meant a lot in return.

Air currents begin to swirl around the room, with you at the centre. Tears roll freely down your cheeks. 

Wait. These memories aren&#39;t yours. What&#39;s happening? Whose grief is this?

&lt;img src=&quot;wind.png&quot;&gt;

[[Return to yourself|Main]]
[[Become one with the wind]]</tw-passagedata><tw-passagedata pid="227" name="tiles" tags="" position="490,2601" size="100,100">The room is bifurcated by a row of three large stone tiles. Each is inscribed with a symbol.

(if: $direction&#39;s direction is &quot;east&quot;)[But you have no time for riddles. You are headed East.

&lt;img src=&quot;tile.png&quot;&gt;&lt;img src=&quot;tile.png&quot;&gt;&lt;img src=&quot;tile.png&quot;&gt;

(link:&quot;Pick a tile at random&quot;)[(if: (random: 1,3 is 3))[(go-to: &quot;safeTile&quot;)](else:)[(go-to: &quot;unsafeTile&quot;)]]]\
(else:)[Which tile will you step on?

&lt;img src=&quot;tile.png&quot;&gt;&lt;img src=&quot;tile.png&quot;&gt;&lt;img src=&quot;tile.png&quot;&gt;

(set: $tiles to (shuffled: ... $tiles))\
[(link: $tiles&#39;s 1st)[(if: $safeTiles contains $tiles&#39;s 1st)[(go-to: &quot;safeTile&quot;)](else:)[(go-to: &quot;unsafeTile&quot;)]]]&lt;tile1|
[(link: $tiles&#39;s 2nd)[(if: $safeTiles contains $tiles&#39;s 2nd)[(go-to: &quot;safeTile&quot;)](else:)[(go-to: &quot;unsafeTile&quot;)]]]&lt;tile2|
[(link: $tiles&#39;s 3rd)[(if: $safeTiles contains $tiles&#39;s 3rd)[(go-to: &quot;safeTile&quot;)](else:)[(go-to: &quot;unsafeTile&quot;)]]]&lt;tile3|(if: (random: 1,15) is 1)[(replace: (either: &quot;?tile1&quot;, &quot;?tile2&quot;, &quot;?tile3&quot;))[[[The Obvious Trap]]]]]</tw-passagedata><tw-passagedata pid="228" name="safeTile" tags="" position="433,2727" size="100,100">You pass through the room without incident.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="229" name="unsafeTile" tags="" position="550,2725" size="100,100">The tile crumbles below you. Your feet are plunged into a shallow pit filled with (either: &quot;vampire fish&quot;, &quot;pirahnas&quot;, &quot;vipers&quot;, &quot;wasps&quot;, &quot;asps&quot;, &quot;electric eels&quot;, &quot;spikes&quot;, &quot;scorpions&quot;, &quot;sharpened carrots&quot;).&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;

(set: $HP to it - (random:10,15))\
[[Limp on.|Main]]</tw-passagedata><tw-passagedata pid="230" name="The Obvious Trap" tags="" position="503,2838" size="100,100">The tile concealed an obvious trap.

(if: not ($achievements contains &quot;Fall for an obvious trap&quot;))[(set: $achievements to it + (array: &quot;Fall for an obvious trap&quot;))]\
(set: $HP to it - 20)\
[[Onwards!|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="231" name="catFoe" tags="" position="1284,693" size="100,100">A monstrous cat stalks down the corridor. It lets out an unearthly high-pitched shriek.

&lt;img src=&quot;cat.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 65, &quot;damage&quot;, 12, &quot;bonus&quot;, &quot;Pat&quot;, &quot;type&quot;, &quot;basic&quot;))\
(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="232" name="Choose the middle door" tags="" position="1814,2030" size="100,100">(if: $playerVariables&#39;s 5th is &quot;HP&quot;)[(set: $HP to it - 5)]\
(elseif: $playerVariables&#39;s 5th is &quot;sanity&quot;)[(set: $sanity to it - 5)]\
(elseif: $playerVariables&#39;s 5th is &quot;energy&quot;)[(set: $energy to it - 5)]\
(elseif: $playerVariables&#39;s 5th is &quot;satiety&quot;)[(set: $satiety to it - 5)]\
(if: $playerVariables&#39;s 2nd is &quot;HP&quot;)[(set: $HP to it - $door&#39;s 2nd)]\
You lose 5 (print: $playerVariables&#39;s 5th).

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="233" name="fairy" tags="" position="2859,2244" size="100,100">An assortment of creatures in waistcoats and ballgowns are dancing to music. The room is lit by moonlight. (Moonlight? But how can that be this far underground?)

&lt;img src=&quot;moon.png&quot;&gt;

(set: $uncommonCards to it - (array: &quot;fairy&quot;))\
[[Eat the food.]]
[[Drink the wine.]](if: $inventory contains &quot;godStains&quot;)[
[[Boast of your epicurean accomplishments]]]
[[Take nothing. Eat nothing.]]&lt;script&gt;
stopaudio();
audio.themeOld.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="234" name="Eat the food." tags="" position="2719,2375" size="100,100">Everything here is delicious. You eat until you can eat no more. You eat until the music fades and the banquet is gone and you are back in the dungeon, the remains of your meal still clinging wetly to your chin.

(set: $satiety to $statMax)\
(set: $cards to it + (array: &quot;fairy2&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="235" name="Drink the wine." tags="" position="3008,2404" size="100,100">You drain it more easily than than than water. You drain your chalice time and time again. A feeling of profound wellbeing diffuses through you. 

By the time you finish your last glass the party is over, the guests are gone, and the plates are clean. There is, in fact, no evidence that there was ever a party here at all.

(set: $HP to $statMax)(set: $sanity to $statMax)\
(set: $cards to it + (array: &quot;fairy2&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="236" name="fairy2" tags="" position="3185,2075" size="100,100">You hear the strains of a familiar tune.

(if: $sanity &lt; 70)[You begin to follow it dreamily. (If you were more lucid you may have been able to resist.)

]&lt;img src=&quot;moon.png&quot;&gt;

[[Rejoin the ball.]](if: $sanity &gt;= 70)[
[[Ignore the music.]]]&lt;script&gt;
stopaudio();
audio.themeOld.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="237" name="Rejoin the ball." tags="" position="3134,2200" size="100,100">You dance with (either: &quot;an alluring&quot;, &quot;a lithe&quot;, &quot;a sensuous&quot;, &quot;an articulate&quot;, &quot;a gelatinous&quot;, &quot;a timid&quot;, &quot;a heavily-accented&quot;, &quot;a green&quot;) (either: &quot;gargoyle&quot;, &quot;troll&quot;, &quot;slime-temptress&quot;, &quot;serpent&quot;, &quot;fox&quot;, &quot;fairy&quot;) for what feels like hours, though when the ball finally ends no time at all appears to have passed.

(set: $energy to it - 12)(set: $delayExecute to &#39;(set: $turns to it - 1)&#39;)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="238" name="Ignore the music." tags="" position="3256,2200" size="100,100">Though it costs you dearly to do so, you exorcise all thought and memory of the ball from your mind.

You don&#39;t hear the music again.

(set: $sanity to (round: $sanity / 2))\
(set: $cards to it - (array: &quot;fairy2&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="239" name="Take nothing. Eat nothing." tags="" position="2853,2404" size="100,100">The dancers part to let you leave.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="240" name="Boast of your epicurean accomplishments" tags="" position="2742,2535" size="100,100">You speak of the things you have eaten in this dungeon. (A growing number of dangers listen with interest.) Some of these things were fruit. Like the watermelon you have consumed. (Your mouth begins to water.) Some of the things you have eaten were not food. Some of the things you have eaten were still living at the time you ate them. 

Some of them are - were - Gods. (By now you&#39;ve attracted quite a crowd.) You ask, rhetorically, whether the Gods you have eaten are part of you now, or if you are part of them. Have they been consumed or subsumed? Or both?

You speak of things you barely understand. And you speak of that which you understand all too well. How piquant the blood was; how delicately the bones did crunch. And, ah, oh, my, the things you have eaten. The things you could eat. The ears and the innards and the fruit and the hair and the glass and...

By the time you finish your pulse is thready and your breath is haggard. You are quietly but firmly escorted from the party.

(set: $sanity to it - 5)\
(set: $health to it - 5)\
(if: not ($achievements contains &quot;Be the life of the party&quot;))[(set: $achievements to it + (array: &quot;Be the life of the party&quot;))]\
[[At least you&#39;ve made an impression.|Main]]</tw-passagedata><tw-passagedata pid="241" name="badPotions" tags="" position="3332,799" size="100,100">Three potions sit on a rusted metal shelf. The glass of the bottles is chipped and cracked. Which potion will you drink?

&lt;img src=&quot;potionsBad.png&quot;&gt;

(set: $cards to it - (array: &quot;badPotions&quot;))\
(set: $potions to (shuffled: ...(array: &quot;[[The chalky beige one]]&quot;,&quot;[[The glimmering turquoise one]]&quot;,&quot;[[The brilliant bisque one]]&quot;,&quot;[[The lumpy taupe one]]&quot;, &quot;[[The oily black one]]&quot;)))\
(print: $potions&#39;s 1st)
(print: $potions&#39;s 2nd)
(print: $potions&#39;s 3rd)</tw-passagedata><tw-passagedata pid="242" name="The chalky beige one" tags="" position="3077,983" size="100,100">It tastes of almond and arsenic.

(set: $HP to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="243" name="The glimmering turquoise one" tags="" position="3218,983" size="100,100">It&#39;s sour with a chemical aftertaste.

(set: $sanity to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="244" name="The brilliant bisque one" tags="" position="3360,983" size="100,100">It tastes of salt and hunger.

(set: $satiety to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="245" name="The lumpy taupe one" tags="" position="3517,983" size="100,100">It tastes blandly lumpy. It seems to be laced with a sedative.

(set: $energy to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="246" name="hatFind" tags="" position="1100,2744" size="100,100">You find a (either: &quot;floppy&quot;, &quot;woolen&quot;, &quot;purple&quot;, &quot;yellow&quot;, &quot;orange&quot;, &quot;velvet&quot;, &quot;tartan&quot;, &quot;spotty&quot;, &quot;oversized&quot;, &quot;sequined&quot;, &quot;black&quot;, &quot;white&quot;, &quot;embroidered&quot;) (either: &quot;hat&quot;, &quot;fedora&quot;, &quot;trilby&quot;, &quot;pith helmet&quot;, &quot;baseball cap&quot;, &quot;barret&quot;, &quot;beanie&quot;, &quot;beret&quot;, &quot;bicorne&quot;, &quot;tricorne&quot;, &quot;chignon cap&quot;, &quot;top hat&quot;, &quot;bowler hat&quot;, &quot;derby hat&quot;, &quot;bonnet&quot;, &quot;panama hat&quot;, &quot;fez&quot;, &quot;papakha&quot;, &quot;kolpik&quot;, &quot;stovepipe&quot;, &quot;homburg&quot;, &quot;tyrolean&quot;, &quot;sombrero&quot;) on an otherwise empty hat stand.

&lt;img src=&quot;hatstand.png&quot;&gt;

(link: &quot;Put it on your head&quot;)[(set: $hats to it + 1)(if: $hats is 3 and not ($achievements contains &quot;Wear many hats&quot;))[(set: $achievements to it + (array: &quot;Wear many hats&quot;))](go-to: &quot;Main&quot;)]
[[Eat it]]</tw-passagedata><tw-passagedata pid="247" name="Eat it" tags="" position="977,2823" size="100,100">You eat the hat.

(set: $satiety to it + 12)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="248" name="Throw a hat down the hole" tags="" position="3597,1193" size="100,100">Make a wish!

[[Wish for good health]]
[[Wish for sound mind]]
[[Wish for boundless energy]]
[[Wish for a full stomach]]</tw-passagedata><tw-passagedata pid="249" name="Wish for good health" tags="" position="3415,1298" size="100,100">(set: $HP to it + 30)(display: &quot;hatDrop&quot;)</tw-passagedata><tw-passagedata pid="250" name="Wish for sound mind" tags="" position="3503,1411" size="100,100">(set: $sanity to it + 30)(display: &quot;hatDrop&quot;)</tw-passagedata><tw-passagedata pid="251" name="Wish for boundless energy" tags="" position="3655,1398" size="100,100">(set: $energy to it + 30)(display: &quot;hatDrop&quot;)</tw-passagedata><tw-passagedata pid="252" name="Wish for a full stomach" tags="" position="3810,1331" size="100,100">(set: $satiety to it + 30)(display: &quot;hatDrop&quot;)</tw-passagedata><tw-passagedata pid="253" name="hatDrop" tags="" position="3498,1564" size="100,100">You watch the hat fall until the darkness swallows it.

(set: $hats to it - 1)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="254" name="Convention" tags="" position="2334,2507" size="100,100">A gathering of squid-people in business suits have convened in this room. They have not yet noticed your presence.(set: $cards to it - (array: &quot;Convention&quot;))

&lt;img src=&quot;squidman.png&quot;&gt;

[[Walk rapidly away]](if: $tentacled &gt;=6)[
[[Wave a tentacle in greeting]]](else:)[
[[Pretend to be one of them]]]</tw-passagedata><tw-passagedata pid="255" name="Walk rapidly away" tags="" position="2259,2657" size="100,100">You make your exit before any of them notice you.

(set: $energy to it - 6)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="256" name="Pretend to be one of them" tags="" position="2409,2657" size="100,100">You flop your arms like tentacles and make squiddy noises as you move through the crowd.

Some watch you with pelagic eyes as you walk past. You sweat profusely. Your heart hammers in your chest. Have they noticed you?

They haven&#39;t. Nobody suspects a thing. 

You&#39;ve pulled it off.

(set: $sanity to it - 6)\
[[Onwards!|Main]](if: not ($achievements contains &quot;Adopt a cunning disguise&quot;))[(set: $achievements to it + (array: &quot;Adopt a cunning disguise&quot;))]</tw-passagedata><tw-passagedata pid="257" name="deathDoor" tags="" position="3089,120" size="100,100">You find a wooden door. It is inlaid with carvings of skulls and bones. A sign hanging next to it reads: &#39;Do Not Enter.&#39;(set: $rareishCards to it - (array: &quot;deathDoor&quot;))

&lt;img src=&quot;deathDoor.png&quot;&gt;

(link: &quot;Enter&quot;)[&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;(go-to: &quot;weirdGo&quot;)]
[[Do not enter|Main]]</tw-passagedata><tw-passagedata pid="258" name="fuck" tags="" position="3109,282" size="100,100">Impossibly far above you the sun sets and rises and sets again. Generations pass. At some point the entire dungeon is excavated,  ransacked, and concreted over. But your body is never recovered.

(set: $HP to 0)(set: $sanity to 0)(set: $energy to 0)(set: $satiety to 0)&lt;script&gt;
stopaudio();
audio.ouch.play();
&lt;/script&gt;(display: &quot;GameOver&quot;)</tw-passagedata><tw-passagedata pid="259" name="The oily black one" tags="" position="3652,984" size="100,100">It has a complex layered taste. Sickness, lethargy, charcoal.

(set: $HP to it - 3)(set: $sanity to it - 3)(set: $energy to it - 3)(set: $satiety to it - 3)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="260" name="Release it." tags="" position="1778,1329" size="100,100">At first nothing happens. But over time the puddle of slime becomes increasingly viscous and animated until, at last, it is capable of oozing away.

The gelatinous way it moves is repulsive and a more than a little unnerving.

(set: $sanity to it - 8)\
(set: $cards to it + (array: &quot;slimeGift&quot;))\
[[What have you released?|Main]]&lt;script&gt;
stopaudio();
audio.slimy.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="261" name="slimeGift" tags="" position="1695,1570" size="100,100">Somebody or something has left a birthday gift on the dungeon floor. The wrapping has been inexpertly applied, and the whole thing is cocooned in a sticky gelatinous membrane.

&lt;img src=&quot;giftSlime.png&quot;&gt;

(set: $cards to it - (array: &quot;slimeGift&quot;))\
(display: &quot;stockGifts&quot;)\
(set: $gift to (shuffled: ...$gift))\
[[What&#39;s inside?|(print: 1st of $gift)]]&lt;script&gt;
stopaudio();
audio.slimy.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="262" name="Wave a tentacle in greeting" tags="" position="2329,2800" size="100,100">They wave back. And why not? You are, after all, one of them now.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="263" name="Compass" tags="" position="1343,2769" size="100,100">(set: $cards to it - (array: &quot;southBound&quot;, &quot;northBound&quot;))(set: $roomExecute to it - (array: &#39;(set: $energy to it + 1)&#39;))(set: $execute to it - (array: &#39;(set: $sanity to it + (round: ($sanity - $sanityOld)/2))&#39;))(set: $direction&#39;s direction to &quot;none&quot;)This room is grander than the others. The ceiling is higher; the floor, though cracked and muddied, is made of marble.

A compass is embedded in a stone pedestal in the middle of the room. There is an exit in every cardinal direction.

&lt;img src=&quot;compass.png&quot;&gt;(if: $marked contains &quot;North&quot; or $marked contains &quot;East&quot; or $marked contains &quot;South&quot; or $marked contains &quot;West&quot;)[

&#39;&#39;You have previously reached:&#39;&#39; (if: $marked contains &quot;North&quot;)[The Far North. ](if: $marked contains &quot;East&quot;)[The Far East. ](if: $marked contains &quot;South&quot;)[The Far South. ](if: $marked contains &quot;West&quot;)[The Far West.]]

[[Smash the compass]](if: not ($direction&#39;s north &gt; 2))[
[[Go North, the direction of the unhinged and the obsessed]]](if: not ($direction&#39;s east &gt; 2))[
[[Go East, the direction of the industrious and unimaginative]]](if: not ($direction&#39;s north &lt; -2))[
[[Go South, the direction of the dreamers and the careless]]](if: not ($direction&#39;s east &lt; -2))[
[[Go West, the direction of the passionate and the zealous]]](if: $sanity &lt;= 10)[

[[*Go a different direction altogether*|exit5]](set: $s to (text-style: &quot;upside-down&quot;))](set: $icons to it - (array: &#39;&lt;img src=&quot;sNorth.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;sEast.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;sSouth.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;sWest.png&quot;&gt;&#39;))</tw-passagedata><tw-passagedata pid="264" name="Go North, the direction of the unhinged and the obsessed" tags="" position="1208,2923" size="100,100">Your feet take you North. Faster, now. And faster still.

The direction thrums in your ears and your blood. 

North. North. North.

*You will both lose and gain more sanity than usual while travelling North.*

(set: $execute to it + (array: &#39;(set: $sanity to it + (round: ($sanity - $sanityOld)/2))&#39;))\
(set: $energy to it + 10)(set: $icons to it + (array: &#39;&lt;img src=&quot;sNorth.png&quot;&gt;&#39;))(set: $cards to it + (array: &quot;northBound&quot;))\
(set: $direction&#39;s direction to &quot;north&quot;)(set: $direction&#39;s north to it + 1)\
(if: $direction&#39;s north &gt; 2)[(go-to: &quot;farNorth&quot;)]\
[[North.|Main]]</tw-passagedata><tw-passagedata pid="265" name="Go East, the direction of the industrious and unimaginative" tags="" position="1319,2924" size="100,100">You are heading diligently Eastward. Your legs are tired but your mind is clear.

(set: $sanity to it + 10)(set: $energy to it - 5)\
(set: $direction&#39;s direction to &quot;east&quot;)(set: $direction&#39;s east to it + 1)\
(set: $icons to it + (array: &#39;&lt;img src=&quot;sEast.png&quot;&gt;&#39;))\
(if: $direction&#39;s east &gt; 2)[(go-to: &quot;farEast&quot;)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="266" name="Go West, the direction of the passionate and the zealous" tags="" position="1549,2927" size="100,100">It occurs to you that West is clearly the best direction to go. Those who claim to believe otherwise must be foolish, misled, or dishonest.

Your confidence in your rightness in matters of direction-choosing galvanizes you.

(set: $roomExecute to it + (array: &#39;(set: $energy to it + 1)&#39;))\
(set: $direction&#39;s direction to &quot;west&quot;)(set: $direction&#39;s east to it - 1)\
(set: $icons to it + (array: &#39;&lt;img src=&quot;sWest.png&quot;&gt;&#39;))\
(if: $direction&#39;s east &lt;-2)[(go-to: &quot;farWest&quot;)]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="267" name="Go South, the direction of the dreamers and the careless" tags="" position="1431,2925" size="100,100">Though you can&#39;t articulate why, South feels like the right direction to go.

(set: $direction&#39;s direction to &quot;south&quot;)(set: $direction&#39;s north to it - 1)\
(if: $direction&#39;s north &lt; -2)[(go-to: &quot;farSouth&quot;)]\
(else:)[(set: $cards to it + (array: &quot;southBound&quot;))\
(set: $icons to it + (array: &#39;&lt;img src=&quot;sSouth.png&quot;&gt;&#39;))\
[[Onwards!|Main]]]
</tw-passagedata><tw-passagedata pid="268" name="A hat" tags="" position="13,1665" size="100,100">It&#39;s a (either: &quot;floppy&quot;, &quot;woolen&quot;, &quot;purple&quot;, &quot;yellow&quot;, &quot;velvet&quot;, &quot;tartan&quot;, &quot;spotty&quot;, &quot;oversized&quot;, &quot;sequined&quot;, &quot;black&quot;, &quot;white&quot;, &quot;rubber&quot;) (either: &quot;hat&quot;, &quot;fedora&quot;, &quot;trilby&quot;, &quot;pith helmet&quot;, &quot;baseball cap&quot;, &quot;barret&quot;, &quot;beanie&quot;, &quot;beret&quot;, &quot;bicorne&quot;, &quot;tricorne&quot;, &quot;chignon cap&quot;, &quot;top hat&quot;, &quot;bowler hat&quot;, &quot;derby hat&quot;, &quot;bonnet&quot;, &quot;panama hat&quot;, &quot;fez&quot;, &quot;papakha&quot;, &quot;kolpik&quot;, &quot;stovepipe&quot;, &quot;homburg&quot;, &quot;tyrolean&quot;, &quot;sombrero&quot;). It suits you perfectly.

(set: $hats to it + 1)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="269" name="sloth" tags="" position="704,3008" size="100,100">Something clings to one of the room&#39;s supporting pillars.

It&#39;s a sloth. How did it get down here? What does it eat? How can it surive this far underground?

And yet here it is. 

&lt;img src=&quot;sloth.png&quot;&gt;

[[Behold the sloth]]
(link: &quot;Run&quot;)[(set: $energy to it - 5)(go-to: &quot;Main&quot;)] *(100% chance of success)*(if: $hunger &gt; 1)[
[[Eat the sloth]]]</tw-passagedata><tw-passagedata pid="270" name="Behold the sloth" tags="" position="606,3141" size="100,100">As you watch it slowly closes its eyes. It does nothing else.

You feel happy and slothful.

(set: $sanity to it + 15)\
(set: $energy to it - 15)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="271" name="Eat the sloth" tags="" position="753,3136" size="100,100">You wouldn&#39;t. Would you?

You would.

If only you weren&#39;t so damned peckish.

(set: $satiety to it + 12)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="272" name="farNorth" tags="" position="1204,3039" size="100,100">You have reached the Northernmost reaches of the dungeon. There is nothing for you here.

(set: $marked to it + (array: &quot;North&quot;))(set: $direction&#39;s direction to &quot;none&quot;)\
(set: $rareishCards to it + (array: &quot;deathDoor&quot;))\
(if: not ($achievements contains &quot;Reach the far North&quot;))[(set: $achievements to it + (array: &quot;Reach the far North&quot;))]\
[[Leave|Main]]</tw-passagedata><tw-passagedata pid="273" name="farEast" tags="" position="1320,3036" size="100,100">You have reached the Easternmost part of the dungeon. You find nothing, but the sense of having diligently worked to achieve a goal is reward enough in its own right.

(set: $sanity to it + 25)(set: $marked to it + (array: &quot;East&quot;))(set: $direction&#39;s direction to &quot;none&quot;)\
(set: $rareishCards to it + (array: &quot;deathDoor&quot;))\
(if: not ($achievements contains &quot;Reach the far East&quot;))[(set: $achievements to it + (array: &quot;Reach the far East&quot;))]\
[[Leave|Main]]</tw-passagedata><tw-passagedata pid="274" name="guitar" tags="" position="1869,2976" size="100,100">Somebody has abandoned a weathered yet functional guitar in this room. You happen to know how to play.
(set: $r to (random: 1,3))(if: $r is 1)[
You hear a rattle when you touch the guitar. Something seems to be hidden inside.
]\

&lt;img src=&quot;guitar.png&quot;&gt;

[[Play a happy song]]
[[Play a sad song]](if: $r is 1)[
[[Smash the guitar]]]</tw-passagedata><tw-passagedata pid="275" name="southBound" tags="" position="1554,3148" size="100,100">You are daydreaming about the South when you stub your toe on a nondescriptly handsome bust.

&lt;img src = &quot;bust.png&quot;&gt;

(link: &quot;Ouch.&quot;)[&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;(set: $HP to it - 5)(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="276" name="farWest" tags="" position="1551,3037" size="100,100">There is nothing special about the Westernmost reaches of the dungeon. How could you have been so wrong?

(set: $sanity to it - 20)(set: $marked to it + (array: &quot;West&quot;))\
(if: not ($achievements contains &quot;Reach the far West&quot;))[(set: $achievements to it + (array: &quot;Reach the far West&quot;))]\
(set: $direction&#39;s direction to &quot;none&quot;)\
(set: $rareishCards to it + (array: &quot;deathDoor&quot;))\
[[Leave this place, your confidence shattered|Main]]</tw-passagedata><tw-passagedata pid="277" name="farSouth" tags="" position="1436,3037" size="100,100">This seems to be as far South as the dungeon extends. And look: a treasure chest, lying unlocked on the floor!

&lt;img src=&quot;chest.png&quot;&gt;

(set: $marked to it + (array: &quot;South&quot;))(set: $direction&#39;s direction to &quot;none&quot;)\
(if: not ($achievements contains &quot;Reach the far South&quot;))[(set: $achievements to it + (array: &quot;Reach the far South&quot;))]\
(set: $rareishCards to it + (array: &quot;deathDoor&quot;))\
(set: $gift to (array: &quot;[[Key]]&quot;, &quot;[[Key]]&quot;))\
[[What&#39;s this inside?|(print: 1st of (shuffled: ...$gift))]]</tw-passagedata><tw-passagedata pid="278" name="Web2" tags="" position="893,849" size="100,100">(display: &quot;stockGifts&quot;)\
(set: $gift to  (shuffled: ...$gift))\
You can spot something ensared even deeper within the web. It looks like (if: $gift&#39;s 1st is &quot;[[Average juice]]&quot;)[a flask of average juice.]\
(else-if: $gift&#39;s 1st is &quot;[[Dynamite]]&quot;)[a bundle of dynamite.]\
(else-if: $gift&#39;s 1st is &quot;[[Breadcrumbs]]&quot;)[a bag of breadcrumbs.]\
(else-if: $gift&#39;s 1st is &quot;[[A key]]&quot;)[a key.]\
(else-if: $gift&#39;s 1st is &quot;[[A hat]]&quot;)[a hat.]\
(else-if: $gift&#39;s 1st is &quot;[[New runners]]&quot;)[a pair of runners.]\
(else-if: $gift&#39;s 1st is &quot;[[Running socks]]&quot;)[a pair of running socks.]\
(else-if: $gift&#39;s 1st is &quot;[[A metal cross with a handle]]&quot;)[a metal cross with a handle.]\
(else-if: $gift&#39;s 1st is &quot;[[A gleaming beige amulet]]&quot;)[a gleaming beige amulet.]\
(else-if: $gift&#39;s 1st is &quot;[[A cat in a box]]&quot;)[a cat in a box.]

[[Try to reach it]]
[[Push on|Main]]</tw-passagedata><tw-passagedata pid="279" name="Try to reach it" tags="" position="860,1044" size="100,100">The web here is denser and stickier. Progress is difficult. With mounting dread you wonder what might be monitoring the increasingly frantic vibrations you must be causing.

With great effort you manage to grab your loot and extricate yourself from the web.
(set: $sanity to it - 8)(set: $energy to it - 5)\

[[Examine your prize|(print: $gift&#39;s 1st)]]</tw-passagedata><tw-passagedata pid="280" name="Play a happy song" tags="" position="1742,3111" size="100,100">You play an invigorating melody. With every passing moment you feel more resolute, more purposeful, more blinded by zeal.

(live: 0.6s)[(replace: ?Health)[(color: #818181)[$HP]]\
(replace: ?Satiety)[(color: #818181)[$satiety]]\
(set: $energy to it + (either: 0,1,2))(set: $sanity to it - (either: 0,1,2))\
(if: $sanity is $sanityOld)[(replace: ?Sanity)[(color: #818181)[$sanity]]]\
(else-if: $sanity is $sanityOld - 1)[(replace: ?Sanity)[(text-color: orange)[$sanity]]]\
(else-if: $sanity is $sanityOld - 2)[(replace: ?Sanity)[(text-color: red)[$sanity]]]\
(if: $energy is $energyOld)[(replace: ?Energy)[(color: #818181)[$energy]]]\
(else-if: $energy is $energyOld + 1)[(replace: ?Energy)[(color: #80e619)[$energy]]]\
(else-if: $energy is $energyOld + 2)[(replace: ?Energy)[(color: #19e619)[$energy]]]\
(set: $HPOld to $HP)(set: $sanityOld to $sanity)(set: $energyOld to $energy)(set: $satietyOld to $satiety)\
(if: $HP &gt; $statMax or $energy &gt; $statMax or $sanity &gt; $statMax or $satiety&gt; $statMax)[(stop:)]]&lt;script&gt;
stopaudio();
audio.happy.play();
&lt;/script&gt;(link: &quot;Play a rousing coda&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="281" name="Play a sad song" tags="" position="2005,3114" size="100,100">You strum a melancholy tune. The tension slowly drains from your body.

(live: 0.6s)[(replace: ?Health)[(color: #818181)[$HP]]\
(replace: ?Satiety)[(color: #818181)[$satiety]]\
(set: $energy to it - (either: 0,0,1,2))(set: $sanity to it + (either: 0,0,1,2))\
(if: $sanity is $sanityOld)[(replace: ?Sanity)[(color: #818181)[$sanity]]]\
(else-if: $sanity is $sanityOld + 1)[(replace: ?Sanity)[(text-color: lime)[$sanity]]]\
(else-if: $sanity is $sanityOld + 2)[(replace: ?Sanity)[(text-color: green)[$sanity]]]\
(if: $energy is $energyOld)[(replace: ?Energy)[(color: #818181)[$energy]]]\
(else-if: $energy is $energyOld - 1)[(replace: ?Energy)[(text-color: orange)[$energy]]]\
(else-if: $energy is $energyOld - 2)[(replace: ?Energy)[(text-color: red)[$energy]]]\
(set: $HPOld to $HP)(set: $sanityOld to $sanity)(set: $energyOld to $energy)(set: $satietyOld to $satiety)\
(if: $HP &gt; $statMax or $energy &gt; $statMax or $sanity &gt; $statMax or $satiety&gt; $statMax)[(stop:)]]&lt;script&gt;
stopaudio();
audio.sad.play();
&lt;/script&gt;(link: &quot;Play a bittersweet coda&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="282" name="Smash the guitar" tags="" position="1865,3117" size="100,100">Somebody stashed (if: (random: 1,3) is 1)[a bag of breadcrumbs(set: $scanner to it + 1)]\
(else-if: (random: 1,2) is 2)[a stick of dynamite(set: $trash to it + 1)]\
(else-if: (random: 1,3) &gt; 1)[a bottle of average juice(set:$drink to it + 1)]\
(else:)[a key(set: $keys to it + 1)]\
 inside the guitar. It&#39;s yours now.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="283" name="troupe" tags="" position="2586,2891" size="100,100">A travelling theatre troupe is preparing to perform for some of the local dungeon slimes. They offer to provide a hot meal if you play a small role.

&lt;img src=&quot;masks.png&quot;&gt;

[[Take to the stage]]
[[Take your leave instead|Main]]</tw-passagedata><tw-passagedata pid="284" name="minecraft" tags="" position="118,2747" size="100,100">A battered pickaxe is embedded in the floor. You can&#39;t manage to wrench it free. But no matter: its previous owner already made a jagged hole in the floor, leading to the lower depths of the dungeon.

&lt;img src=&quot;pickaxe.png&quot;&gt;

[[Climb down the hole.|Go down]]
[[No. You want to escape the dungeon, not descend  further into it.|Main]]</tw-passagedata><tw-passagedata pid="285" name="Take to the stage" tags="" position="2593,3029" size="100,100">(set: $randomiser to (random: 1,3))\
(if: $randomiser is 1)[The play - a tragedy - opens with your murder at the hands of a vociferant mob. The fight has barely been choreographed, and your fellow actors throw themselves into their roles with a little too much enthusiasm; soon you are bruised all over. The slimes in the audience quiver with what might be excitement.

After reaching the safety of backstage you are paid as promised.

(set: $HP to it - 12)(set: $satiety to it + 25)](else-if: $randomiser is 2)[&quot;Beware the grapes of wrath&quot;, one actor intones, &quot;for they will make your children grow strange and wrong.&quot;

&quot;The grapes! The grapes!&quot; an old woman shrieks, pointing a quivering finger at you. &quot;THEY ARE HERE.&quot;

The rest of the troupe stare silently at you. Each actor&#39;s face is frozen in a rictus of terror. The slimes in the audience quiver gelatinously.

The play promptly ends, and as promised you are taken backstage for your meal. Your sense of unease lingers after the food is gone.

(set: $sanity to it - 12)(set: $satiety to it + 25)](else:)[Your role is to lift a series of heavy objects and carry them over to the play&#39;s protagonists, who in turn pick them up and put them back down, commenting drily on the weight of these objects. The slimes watch the performance with avid concentration.

As promised, you are provided with a hearty meal after your brief role is over.

(set: $energy to it - 12)(set: $satiety to it + 25)][[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="286" name="Keep marching East, undeterred" tags="" position="837,1154" size="100,100">You march efficiently through the web.

You have neither the time nor the inclination to worry about spiders or other such inconsequential things. 

(set: $energy to it - 5)\
[[Eastwards!|Main]]</tw-passagedata><tw-passagedata pid="287" name="Blessing of maturity" tags="blessings" position="2200,55" size="100,100">Grants the ability to reverse (some of) the effects of actions taken in the previous room of the dungeon. 

This skill takes a little while to recharge.

(set: $maturity to (array: $HP, $sanity, $energy, $satiety))(set: $maturityCooldown to 2)(set: $roomExecute to it + (array: &#39;(set: $maturityOld to $maturity)(set: $maturity to (array: $HP, $sanity, $energy, $satiety))&#39;))(set: $blessings to it + (array: &quot;maturity&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="288" name="tapestry" tags="" position="3366,1996" size="100,100">A nearby wall-tapestry is embroidered with a quote from Simone de Beauvoir:

&#39;&#39;What is an adult? A child blown up by age.&#39;&#39;

(set: $delayExecute to &quot;(set: $sanity to it - 1)&quot;)
[[Cheery.|Main]]</tw-passagedata><tw-passagedata pid="289" name="balls" tags="" position="3497,343" size="100,100">This room is filled with playpen balls. As a grown up, you should probably just walk past.

&lt;img src=&quot;ball.png&quot;&gt;

(if: $direction&#39;s direction is &quot;east&quot;)[[[You are heading East. There&#39;s no time for frivolity.|Main]]](else:)[[[Ignore the playpen and move on|Ignore them]](if: not ($direction&#39;s direction is &quot;east&quot;))[
[[Frolic]] ](if: $hunger &gt; 1)[
[[Eat the balls|EatPeckish]]]]</tw-passagedata><tw-passagedata pid="290" name="Frolic" tags="" position="3473,485" size="100,100">It&#39;s your turn to define what adulthood means.

Frolicking in the ballpit is great fun.(if: (random: 1,4) is 1)[ You even find a key buried at the bottom!

(set: $keys to it + 1)*You now have (print: $keys) keys*]

(set: $sanity to it + 20)\
(set: $energy to it - 10)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="291" name="Ignore them" tags="" position="3325,406" size="100,100">A sensible choice. It&#39;s time to put these childish things behind you.

(set: $sanity to it + 5)\
[[Onwards.|Main]]</tw-passagedata><tw-passagedata pid="292" name="elephant" tags="" position="633,3729" size="100,100">You encounter an elemental elephant! It attacks using the power of carbon, hydrogen, nitrogen and oxygen.

&lt;img src=&quot;elephant.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 40, &quot;damage&quot;, 25, &quot;type&quot;, &quot;basic&quot;))\
(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="293" name="dog" tags="" position="226,2997" size="100,100">It&#39;s a (either: &quot;short-haired&quot;, &quot;long-haired&quot;) dungeon dog! It wags its tail and drops a bone at your feet.

&lt;img src=&quot;dog.png&quot;&gt;

[[Give it a pat]]
[[Frolic together]]
[[Eat the bone]](if: not ($inventory contains &quot;dog&quot;) and not ($rareishCards contains &quot;dog2&quot;))[
[[Adopt it as your own]]](if: $inventory contains &quot;dog&quot;)[
[[Introduce this new dungeon dog to your own pet]]]</tw-passagedata><tw-passagedata pid="294" name="Keep your distance" tags="" position="20,2994" size="100,100">A sensible decision. Who knows how it would have reacted?

(set: $sanity to it + 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="295" name="Give it a pat" tags="" position="423,3079" size="100,100">It wags its tail. Cute.

(set: $sanity to it + 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="296" name="slow" tags="" position="2336,3121" size="100,100">A solitary zombie creaks stiffly down the passageway. This one looks less bloodthirsty than the others. It calls raggedly out to you.

&quot;I can give you some of my energy&quot;, it says, &quot;but I&#39;ll need to borrow some of your speed. Just for a little while.&quot;

&lt;img src=&quot;zombieB.png&quot;&gt;

[[Accept|speedDown]]
[[Refuse|Main]]</tw-passagedata><tw-passagedata pid="297" name="speedDown" tags="" position="2336,3271" size="100,100">The exchange is made.

Sluggishly you walk towards the next room.

{(set: $fleeBonus to it - 20)
(set: $energy to it + 40)
(set: $cards to it + (array: &quot;speedUp&quot;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sSlow.png&quot;&gt;&#39;))}[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="298" name="speedUp" tags="" position="2475,3258" size="100,100">A deal has been concluded and a weight has lifted. Your speed is back to normal.

(set: $fleeBonus to it + 20)(set: $cards to it - (array: &quot;speedUp&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sSlow.png&quot;&gt;&#39;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="299" name="Eat the bone" tags="" position="107,3327" size="100,100">That can&#39;t be healthy.

(set: $satiety to it + 15)(set: $HP to it - 12)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="300" name="library" tags="" position="3204,2826" size="100,100">You enter a library. Ceiling-high shelves are laden with books.

&lt;img src=&quot;bookshelf.png&quot;&gt;

[[Browse.]]
[[Leave.|Main]]</tw-passagedata><tw-passagedata pid="301" name="Examine the titles more closely" tags="" position="3208,2994" size="100,100">(set: $randomiser to (random: 1,8))\
(if: $randomiser is 1)[This one looks easy. (set: $HP to it + 10)]\
(if: $randomiser is 2)[This one looks punishingly difficult. (set: $HP to it - 8)]\
(if: $randomiser is 3)[This one looks exciting. (set: $energy to it + 10)]\
(if: $randomiser is 4)[This one looks dull - a second-rate knockoff of a game that wasn&#39;t that good to begin with. (set: $energy to it - 8)]\
(if: $randomiser is 5)[This one looks unsettling. (set: $sanity to it - 8)]\
(if: $randomiser is 6)[This one looks comforting and familiar - a callback to the most keenly-remembered games of your childhood. (set: $sanity to it + 10)]\
(if: $randomiser is 7)[This one looks satisfying. (set: $satiety to it + 10)]\
(if: $randomiser is 8)[This one looks tantalisingly addictive.(set: $satiety to it - 8)]\

(display: &quot;deathable&quot;)
[[Keep browsing|Examine the titles more closely]]
[[Leave the library]]</tw-passagedata><tw-passagedata pid="302" name="Leave the library" tags="" position="3090,3138" size="100,100">You feel strangely changed by your time in the library.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="303" name="deathable" tags="" position="2827,3073" size="100,100">(if: $energy &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $HP &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $satiety &lt;1)[(go-to: &quot;You are dead&quot;)]\
(else-if: $sanity &lt;1)[(go-to: &quot;You are insane&quot;)]\
(else-if: $HP &gt;$statMax)[(go-to: &quot;HPMax&quot;)]\
(else-if: $sanity &gt;$statMax)[(go-to: &quot;sanityMax&quot;)]\
(else-if: $energy &gt;$statMax)[(go-to: &quot;energyMax&quot;)]\
(else-if: $satiety &gt;$statMax)[(go-to: &quot;satietyMax&quot;)]</tw-passagedata><tw-passagedata pid="304" name="Blessing of shuffling" tags="blessings" position="2310,57" size="100,100">You can, from time to time, randomly redistribute your stat points.

(set: $blessings to it + (array: &quot;shuffling&quot;))\
[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="305" name="Steal the headband" tags="" position="756,2374" size="100,100">Anger spreads across the orange hobgoblin&#39;s face.

&quot;Sad!&quot; he says. &quot;I will do something bad to you!&quot;

You flee before he can carry out his threat.

(set: $uncommonCards to it + (array: &quot;orangeMan&quot;))(set: $rareCards to it - (array: &quot;headband&quot;))(set: $energy to it - 5)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="306" name="orangeMan" tags="" position="998,3010" size="100,100">It&#39;s the awful orange hobgoblin from before. His face is rigid with anger. &quot;Bad!&quot; he intones, pointing a finger at you. He marches in your direction.

&lt;img src=&quot;trump.png&quot;&gt;

(link: &quot;Run!!&quot;)[(set: $energy to it - 5)(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="307" name="corridor" tags="" position="1150,3338" size="100,100">You stand in a narrow corridor. The corridor&#39;s walls extend infinitely upwards, but a sliver of sky studded with stars can be seen far above.</tw-passagedata><tw-passagedata pid="308" name="autumnal" tags="" position="1150,3464" size="100,100">This room is filled with a sprawling autumnal forest, the dungeon walls barely visible behind the irregular pattern of treetrunks and the floor entirely concealed by leaves. The branches are still in the stagnant air.</tw-passagedata><tw-passagedata pid="309" name="blinding" tags="" position="1142,4057" size="100,100">Your vision blears against blinding light. Squinting, you can just make out a coruscant ball of what might be fire suspended in the middle of the room. Your skin prickles with heat.</tw-passagedata><tw-passagedata pid="310" name="compassend" tags="" position="1126,4441" size="100,100">You are back in familiar surroundings. North, South, East and West hold true once more; there is no direction between them.

You regard the usual horrors of the dungeon with unhinged equanimity. (if: $sanity &gt; 1)[(set: $sanity to 1)](set: $inklings to it + 3)

*You now have (print: $inklings) Inklings of a deeper purpose.*

(link: &quot;Onwards.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="311" name="exit5" tags="" position="1153,3212" size="100,100">(set: $go to (shuffled: ...(array: &quot;blinding&quot;, &quot;london&quot;, &quot;autumnal&quot;, &quot;corridor&quot;, &quot;mirrors&quot;, &quot;monsterme&quot;, &quot;house&quot;, &quot;crabby&quot;)))(if: $go&#39;s 8th is &quot;house&quot;)[(set: $go to (rotated: 3, ...$go))](set: $go to it + (array: &quot;house2&quot;))(set: $sanity to 1)\
There are four doors that exit the room. Rather than taking any of them you angle yourself just... so... to walk in a direction that&#39;s neither North nor South nor East nor West.

The further you get the more the air resists. Silence colonises your ears. Your skin blisters with hot then cold then hot again.

And then you&#39;re through. [[But where are you?]]&lt;script&gt;
stopaudio();
audio.spooky.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="312" name="crabRoom" tags="" position="1691,3370" size="100,100">(set: $rareishCards to it - (array: &quot;crabRoom&quot;))It takes a moment for your mind to realise exactly what your eyes are looking at. Crabs occupy every inch of the room. They are on the floor, the table, the bookshelves, the chandelier - in short, they are everywhere.

The crabs cease their scurrying and stiffen into unnatural stillness as you enter the room. You feel hundreds of tiny eyes staring.

&lt;img src=&quot;crab.png&quot;&gt;

[[Carefully make your way across the room]]
[[Run away|fleeCrabs]](if: $hunger &gt; 1)[
[[Eat the crabs]]]</tw-passagedata><tw-passagedata pid="313" name="Carefully make your way across the room" tags="" position="1541,3520" size="100,100">You stalk through the room, careful not to squish any crabs underfoot. They don&#39;t move to let you pass, but nor do they move to stop you. In fact, they do nothing at all.

As soon as you leave the room and close the door you hear the crabs resume their scurrying activities. (set: $sanity to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="314" name="fleeCrabs" tags="" position="1691,3520" size="100,100">You flee the conspiracy of crabs as fast as your legs will carry you. (set: $energy to it - 5)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="315" name="Eat the crabs" tags="" position="1841,3520" size="100,100">They are delicious. You leave no survivors.

(set: $satiety to $statMax)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="316" name="cookies" tags="" position="787,3266" size="100,100">[*And you could*]&lt;cookiemessage| (link: &quot;*eat a cookie*&quot;)[(replace: ?cookiemessage)[]*What kind of cookie will you eat?* (if: $cookies&#39;s basic &gt;0)[
	(link: &quot;   Eat a chocolate chip cookie&quot;)[(set: $cookies&#39;s basic to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s basic)&#39;&#39; chocolate chip cookies left.)*(set: $satiety to it + 5)(if: $blessings contains &quot;consumption&quot;)[(set: $satiety to it + 5)](replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s healthful &gt; 0)[
	(link: &quot;   Eat a healthful cookie&quot;)[(set: $cookies&#39;s healthful to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s healthful)&#39;&#39; healthful cookies left.)*(set: $HP to it + 10)(set: $satiety to it + 5)(set: $inventory to it - (array: &quot;poisoned&quot;))(replace: ?Satiety)[(color: white)[$satiety]](replace: ?Health)[(color: white)[$HP]]]](if: $cookies&#39;s rainbow &gt; 0)[
    (link: &quot;   Eat a rainbow cookie&quot;)[(set: $cookies&#39;s rainbow to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s rainbow)&#39;&#39; rainbow cookies left.)*(set: $shuffleMax to $HP + $sanity + $energy + $satiety + 10)(set: $shuffleMin to (round: $shuffleMax/4))(set: $HP to (round: (random:$shuffleMin,$shuffleMax*2)/4))(replace: ?Health)[(color: white)[$HP]]\
(set: $sanity to (round: (random: $shuffleMin,(($shuffleMax-$HP)*2))/3))(replace: ?Sanity)[(color: white)[$sanity]]\
(set: $energy to (round: (random: $shuffleMin,($shuffleMax-($HP+$sanity)))/2))(replace: ?Energy)[(color: white)[$energy]]\
(set: $satiety to ($shuffleMax - ($HP + $sanity + $energy)))(replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s arcane &gt; 0)[
    (link: &quot;   Eat an arcane cookie&quot;)[(set: $cookies&#39;s arcane to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s arcane)&#39;&#39; arcane cookies left)*(set: $HP to $sanity)(set: $energy to $sanity)(set: $satiety to $sanity)(replace: ?Health)[(color: white)[$HP]](replace: ?Energy)[(color: white)[$energy]](replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s disappearing &gt; 0)[
    (link: &quot;   Eat a disappearing cookie&quot;)[(go-to: &quot;Eat a disappearing cookie&quot;)]](if: $cookies&#39;s eldritch &gt; 0)[
    (link: &quot;   Eat an eldritch cookie&quot;)[(if: $card is &quot;none&quot;)[You can&#39;t do that here.](else:)[(set: $cookies&#39;s eldritch to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s eldritch)&#39;&#39; eldritch cookies left.)*(set: $satiety to it + 5)(set: $cardRepeat to true)(set: $eldritchCard to $card)]]]]</tw-passagedata><tw-passagedata pid="317" name="Eat an eldritch cookie" tags="" position="604,3374" size="100,100">(if: $card is &quot;exit&quot; and not ($achievements contains &quot;Destroy the exit&quot;))[(set: $achievements to it + (array: &quot;Destroy the exit&quot;))]\
(set: $cards to it - (array: $card))\
(set: $uncommonCards to it - (array: $card))\
(set: $cookies&#39;s eldritch to it - 1)\
(set: $delayExecute to false)\
The cookie squirms uncomfortably in your mouth. Mist whirls around you as you chew; dim lumbering shapes move within it. When at last you finish the cookie the room you were standing in is gone, never to be seen again.

(set: $sanity to it - 10)(set: $satiety to it + 3)*You have &#39;&#39;(print: $cookies&#39;s eldritch)&#39;&#39; eldritch cookies left.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="318" name="Eat a disappearing cookie" tags="" position="845,3406" size="100,100">After you eat the cookie it disappears, taking you with it. 

Presently you reappear in a different part of the dungeon.(set: $satiety to it + 5)

(set: $delayExecute to false)(set: $cookies&#39;s disappearing to it - 1)*You have &#39;&#39;(print: $cookies&#39;s disappearing)&#39;&#39; disappearing cookies remaining.*

[[Delicious?|Main]]</tw-passagedata><tw-passagedata pid="319" name="Investigate" tags="" position="786,388" size="100,100">(set: $r to (random: 1,3))(if: $r is 1 and not ($blessings contains &quot;rattiness&quot;))[You search and you search, but you have nothing to show for your efforts besides an increasingly desperate hunger. The trail has gone cold. As, in all likelihood, have the cookies. (set: $satiety to it - (7+ (floor: 1.5 * $hunger)))

(link: &quot;Maybe you&#39;ll have better luck next time.&quot;)[(go-to: &quot;Main&quot;)]]\
(else:)[Aha! (if: $blessings contains &quot;rattiness&quot;)[ using your heightened ratty sense of smell, you&#39;ve](else:)[You&#39;ve] traced the smell back to its source: a large freshly-baked chocolate chip cookie, still warm to the touch, concealed in a hidden alcove. (set: $cookies&#39;s basic to it + 1)(set: $satiety to it - (3+ (floor: 1.5 * $hunger)))(if: not ($uncommonCards contains &quot;toToShop&quot;))[(set: $uncommonCards to it + (array: &quot;toToShop&quot;))]

&lt;img src=&quot;cookie.png&quot;&gt;

[[Pocket the cookie and be on your way|Main]]]</tw-passagedata><tw-passagedata pid="320" name="Place a chocolate chip cookie on the altar" tags="" position="963,1567" size="100,100">(set: $r to (random: 1,5))(set: $cookies&#39;s basic to it - 1)\
(if: $cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;)[Tentacles extrude from the cookie, which it then uses them to shuffle away, crab-like. It&#39;s gone forever now. (Set: $sanity to it - 1)(set: $r to 0)]\
(if: $r is 1)[The texture of the cookie becomes crumblier, and it begins to smell faintly of oats. (set: $cookies&#39;s healthful to it + 1)]\
(if: $r is 2)[The colour of the cookie slowly shifts, eventually settling on a discomfiting red.(set: $cookies&#39;s eldritch to it + 1)]\
(if: $r is 3)[The cookie flickers. First it&#39;s there; then it&#39;s not; and look -- now it&#39;s back again.(set: $cookies&#39;s disappearing to it + 1)]\
(if: $r is 4)[The cookie thrums with mystical energy.(set: $cookies&#39;s arcane to it + 1)]\
(if: $r is 5)[The cookie begins to shimmer with all the colours of the rainbow.(set: $cookies&#39;s rainbow to it + 1)]\


You have &#39;&#39;(print: $cookies&#39;s basic)&#39;&#39; chocolate chip cookies.(if: $cookies&#39;s basic &lt; 0)[ (The world shudders, very slightly.)(if: not ($achievements contains &quot;Possess -1 cookies&quot;))[(set: $achievements to it + (array: &quot;Possess -1 cookies&quot;))]](if: $cookies&#39;s healthful &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s healthful)&#39;&#39; healthful cookies.](if: $cookies&#39;s rainbow &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s rainbow)&#39;&#39; rainbow cookies.](if: $cookies&#39;s arcane &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s arcane)&#39;&#39; arcane cookies.](if: $cookies&#39;s disappearing &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s disappearing)&#39;&#39; disappearing cookies.](if: $cookies&#39;s eldritch &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s eldritch)&#39;&#39; eldritch cookies.]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="321" name="A cookie" tags="" position="9,2037" size="100,100">A chocolate chip cookie! How sweet. (set: $cookies&#39;s basic to it + 1)(if: not ($uncommonCards contains &quot;toToShop&quot;))[(set: $uncommonCards to it + (array: &quot;toToShop&quot;))]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="322" name="london" tags="" position="1138,3936" size="100,100">There is a window in this room that affords a view of the world outside. You see that the dungeon is suspended inside an enormous stalagtite. There is a city lit by gaslights far below, and a sunless ocean beyond that.</tw-passagedata><tw-passagedata pid="323" name="mirrors" tags="" position="1144,3586" size="100,100">You enter a hall of mirrors. Some versions of your reflection smile warmly at you; others scowl. One pounds desperately from behind the glass.</tw-passagedata><tw-passagedata pid="324" name="water" tags="" position="1138,3712" size="100,100">The room is filled to the ceiling with water. Tiny blind fish dart away from you. You cannot hold your breath for long, but it doesn&#39;t matter; you find that you can breathe the water as easily as air.</tw-passagedata><tw-passagedata pid="325" name="monsterme" tags="" position="1138,3826" size="100,100">You sense a monster in this room. The monster may or may not be you.</tw-passagedata><tw-passagedata pid="326" name="cowboy" tags="" position="748,3759" size="100,100">A robot wearing a cowboy outfit approaches. Its circuits are replete with hate. (set: $monster to (datamap: &quot;fleeChance&quot;, 50, &quot;damage&quot;, 20, &quot;type&quot;, &quot;westworld&quot;))(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually ferocious.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;robot.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="327" name="Frolic together" tags="" position="226,3147" size="100,100">You have a wonderful time.

(set: $energy to it - 5)(set: $sanity to it + 12)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="328" name="house" tags="" position="1057,4318" size="100,100">Children sit in rows at desks while a woman explains how when men and women used to build houses, they would first dig a hole, and inside that hole they would build a smaller windowless version of the house that would be built above. A cat or a child would be placed inside to live out its days in the house below the house. This was said to bring luck.</tw-passagedata><tw-passagedata pid="329" name="But where are you?" tags="" position="1291,3213" size="100,100">(display: $go&#39;s 1st)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 2nd)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 3rd)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 4th)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 5th)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 6th)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 7th)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 8th)

(link: &quot;Onwards!&quot;)[(display: $go&#39;s 9th)

[[Onwards!|compassend]]]]]]]]]]</tw-passagedata><tw-passagedata pid="330" name="house2" tags="" position="1182,4321" size="100,100">You are back in the classroom. One of the children asks whether there is such a house buried below this one. The woman says that this is the wrong question to ask.</tw-passagedata><tw-passagedata pid="331" name="bugs" tags="" position="2920,2826" size="100,100">This [room]&lt;w1| is [full]&lt;w2| of [bugs]&lt;w3|. You [will]&lt;w4| [never]&lt;w5| be [able]&lt;w6| to [squash]&lt;w7| [them]&lt;w8| [all]&lt;w9|.

&lt;img src=&quot;bug.png&quot;&gt;

(link-repeat: &quot;Squash a bug&quot;)[(either: &#39;&lt;script&gt;audio.squash1.play();&lt;/script&gt;&#39;, &#39;&lt;script&gt;audio.squash2.play();&lt;/script&gt;&#39;, &#39;&lt;script&gt;audio.squash3.play();&lt;/script&gt;&#39;){
	(set: $HP to it + (random: -11, 12))(replace: ?Health)[(color: (either: &quot;pink&quot;, &quot;purple&quot;, &quot;cyan&quot;))[$HP]]
	(set: $sanity to it + (random: -11, 12))(replace: ?Sanity)[(color: (either: &quot;pink&quot;, &quot;purple&quot;, &quot;cyan&quot;))[$sanity]]
	(set: $energy to it + (random: -11, 12))(replace: ?Energy)[(color: (either: &quot;pink&quot;, &quot;purple&quot;, &quot;cyan&quot;))[$energy]]
	(set: $satiety to it + (random: -11, 12))(replace: ?Satiety)[(color: (either: &quot;pink&quot;, &quot;purple&quot;, &quot;cyan&quot;))[$satiety]]
	(display: &quot;deathable&quot;)
	(set: $x to (array: &quot;b&quot;, &quot;br&quot;,&quot;bl&quot;, &quot;c&quot;, &quot;cr&quot;, &quot;ch&quot;,&quot;d&quot;, &quot;f&quot;,&quot;fl&quot;,&quot;g&quot;,&quot;gl&quot;, &quot;gr&quot;, &quot;h&quot;,&quot;j&quot;,&quot;k&quot;,&quot;l&quot;,&quot;m&quot;,&quot;n&quot;,&quot;p&quot;,&quot;pl&quot;, &quot;ph&quot;,&quot;pr&quot;,&quot;r&quot;,&quot;s&quot;, &quot;sh&quot;, &quot;t&quot;, &quot;tr&quot;, &quot;w&quot;, &quot;wh&quot;, &quot;z&quot;))
(set: $y to (array: &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;e&quot;, &quot;e&quot;, &quot;e&quot;, &quot;i&quot;, &quot;i&quot;, &quot;o&quot;, &quot;o&quot;, &quot;o&quot;, &quot;u&quot;, &quot;ou&quot;, &quot;ea&quot;, &quot;ea&quot;, &quot;oo&quot;,&quot;oo&quot;, &quot;ie&quot;, &quot;&quot;, &quot;ee&quot;))
(set: $z to (array: &quot;b&quot;, &quot;b&quot;, &quot;ch&quot;, &quot;ck&quot;, &quot;d&quot;, &quot;dge&quot;, &quot;f&quot;,&quot;g&quot;, &quot;gh&quot;, &quot;l&quot;,&quot;ll&quot;,&quot;m&quot;,&quot;n&quot;,&quot;ng&quot;,&quot;p&quot;,&quot;pp&quot;,&quot;r&quot;,&quot;s&quot;,&quot;ss&quot;,&quot;sh&quot;, &quot;t&quot;))
	(replace: (either: ?w1, ?w2, ?w3, ?w4, ?w5, ?w6, ?w7, ?w8, ?w9, ?w10))[(if: (random: 1,4) is 4)[(print:1st of (shuffled: ...$y))](print: 1st of (shuffled: ...$x))(print: 1st of (shuffled: ...$y))(print: 1st of (shuffled: ...$z))(if: (random:1,3) is 3)[(print: 1st of (shuffled: ...$y))(print: 1st of (shuffled: ...$z))](if: (random:1,4) is 4)[(print: 1st of (shuffled: ...$y))]]}]
	[Onwards!]&lt;w10| (click: ?w10)[(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="332" name="Walk around it" tags="" position="1159,916" size="100,100">How clever you feel, to have avoided that trap. (set: $sanity to it + 5)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="333" name="arrow" tags="" position="2678,601" size="100,100">(if: (random: 1, 100) &lt;= ($monster&#39;s fleeChance + $fleeBonus))[You emerge bloodstained but victorious. You won&#39;t be seeing that particular denizen of the dungeon again.

(set: $cards to it - (array: $card))(set: $uncommonCards to it - (array: $card))(set: $rareishCards to it - (array: $card))\
(if: not ($achievements contains &quot;Attack a fellow dungeon-dweller&quot;))[(set: $achievements to it + (array: &quot;Attack a fellow dungeon-dweller&quot;))]\
[[Onwards!|Main]]]\
(else:)[Your attempted attack is a painful failure.(set: $HP to it - ($monster&#39;s damage))

[[Limp on.|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="334" name="treadmill" tags="" position="3564,2466" size="100,100">It&#39;s a treadmill! What&#39;s it doing down here?

&lt;img src=&quot;treadmill.png&quot;&gt;

(link:&quot;Go running on it&quot;)[&lt;script&gt;
stopaudio();
audio.exercise.play();
&lt;/script&gt;(go-to: &quot;Go running on it&quot;)]
[[Don&#39;t go running on it|Main]]</tw-passagedata><tw-passagedata pid="335" name="Go running on it" tags="" position="3564,2616" size="100,100">The exercise confers both physical and psychic benefits.

(set: $sanity to it + 1)(set: $HP to it + 1)(set: $energy to it - (random: 3))\
[[Keep running|Go running on it]]
(link: &quot;Step off&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="336" name="spider" tags="" position="1924,831" size="100,100">They swarm -

- scuttling legs and dripping fangs and -

oh god oh god oh god oh god oh god -

&lt;img src=&quot;spider.png&quot;&gt;

[[thrash. flail.]]&lt;script&gt;
stopaudio();
audio.spookyShort.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="337" name="thrash. flail." tags="" position="1927,941" size="100,100">(set: $inventory to it + (array: &quot;poisoned&quot;))(if: not($cards contains &quot;antidote&quot;))[(set: $cards to it + (array: &quot;antidote&quot;, &quot;antidote&quot;))](set: $HP to it - 10)\
You escape, but not before you are covered in bites. The poison will remain in your body for some time yet.

[[Struggle on.|Main]]&lt;script&gt;
audio.ouch.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="338" name="antidote" tags="" position="1928,1051" size="100,100">(if: (count: $inventory, &quot;poisoned&quot;) is 1)[The poison has left your system.

(set: $cards to it - (array: &quot;antidote&quot;))(set: $inventory to it - (array: &quot;poisoned&quot;))\
[[Onwards!|Main]]](else:)[Some of the poison has left your system. Some remains.

(set: $inventory to it - (array: &quot;poisoned&quot;))(set: $inventory to it + (array: &quot;poisoned&quot;))
[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="339" name="well" tags="" position="3831,1755" size="100,100">(set: $well to (array: (random: 80,95), (random: 40,80), (random: 35,70), (random: 35,70), (random: 1,35)))(display: &quot;well2&quot;)</tw-passagedata><tw-passagedata pid="340" name="Wish for a cookie" tags="" position="3628,1903" size="100,100">(if: $well&#39;s 1st &gt;= (random: 1,100))[When you haul up the bucket you find a chocolate chip cookie inside, improbably well preserved despite the damp.(set: $cookies&#39;s basic to it + 1)(if: not ($uncommonCards contains &quot;toToShop&quot;))[(set: $uncommonCards to it + (array: &quot;toToShop&quot;))]

[[Delicious!|Main]]](else:)[(go-to: &quot;failWell&quot;)]</tw-passagedata><tw-passagedata pid="341" name="Wish for average juice" tags="" position="3742,1904" size="100,100">(if: $well&#39;s 2nd &gt;= (random: 1,100))[When you haul up the bucket you find some average juice inside.(set: $drink to it + 1)

[[Delicious!|Main]]](else:)[(go-to: &quot;failWell&quot;)]</tw-passagedata><tw-passagedata pid="342" name="Wish for breadcrumbs" tags="" position="3851,1904" size="100,100">(if: $well&#39;s 3rd &gt;= (random: 1,100))[When you haul up the bucket you find it half-filled with breadcrumbs.(set: $scanner to it + 1)

[[Pocket them.|Main]]](else:)[(go-to: &quot;failWell&quot;)]</tw-passagedata><tw-passagedata pid="343" name="Wish for dynamite" tags="" position="3961,1905" size="100,100">(if: $well&#39;s 4th &gt;= (random: 1,100))[When you haul up the bucket you find a bundle of dynamite inside, undamaged despite the damp.(set: $trash to it + 1)

[[Pocket it.|Main]]](else:)[(go-to: &quot;failWell&quot;)]</tw-passagedata><tw-passagedata pid="344" name="Wish for a key" tags="" position="4091,1905" size="100,100">(if: $well&#39;s 5th &gt;= (random: 1,100))[When you haul up the bucket you find a key inside.(set: $keys to it + 1)

*You now have $keys keys*

[[Huzzah!|Main]]](else:)[(go-to: &quot;failWell&quot;)]

</tw-passagedata><tw-passagedata pid="345" name="failWell" tags="" position="3847,2026" size="100,100">You make a wish then haul up the bucket. There is nothing but water inside.

[[Oh well.|Main]]</tw-passagedata><tw-passagedata pid="346" name="Climb down the well" tags="" position="3971,2028" size="100,100">[[Down.|Go down]]</tw-passagedata><tw-passagedata pid="347" name="About" tags="About" position="522,580" size="100,100">&lt;img src=&quot;banner.png&quot;&gt;

[Ask questions; answers are forthcoming.]&lt;About|

(link-repeat: &quot;What is the Birthday Dungeon?&quot;)[(replace: ?About)[The Birthday Dungeon is Green Giraffe&#39;s first game. It was made with Twine, and also with love. It was not made with any particular aptitude for coding.

The birthday dungeon was originally built in honour of the birthday of a close friend. Though it has since undergone extensive renovations, something of them lingers in the dungeon&#39;s rooms.]]
(link-repeat: &quot;What should I do in the dungeon?&quot;)[(replace: ?About)[Specific actions usually have the same outcome. Sometimes they don&#39;t. Sometimes the outcome changes based on decisions you made earlier; sometimes they vary based on the whims of the dungeon.

You will die - repeatedly - but each death will provide knowledge that might help you survive a little longer next time.

Experiment. Fail. Become wiser. Maybe keep notes. Maybe start a wiki.]]
(link-repeat: &quot;Where can I find keys?&quot;)[(replace: ?About)[Abandoned on floors and hidden in chests. In the kindness of cats and the pockets of ghosts. On the chains of Gods and monsters, and in the pages of books. Behind specially-marked doors and in the supplies of shopkeeping slimes. At the bottoms of wells and, rarely, the bottoms of ballpits. 

They can be found in other places too; you just need to know where to look.]]
(link-repeat: &quot;What principles govern the arrangement of the dungeon&#39;s rooms?&quot;)[(replace: ?About)[Some sets of rooms are more common than others. The longer you survive, the more rooms are added to the main rotations. There are also several rare locations you might encounter at any time.

You can remove rooms from the rotation using dynamite, or make them more likely to re-appear by using breadcrumbs.]]
(link-repeat: &quot;If given the opportunity, should I summon a shoggoth?&quot;)[(replace: ?About)[No.]]
(link-repeat: &quot;Can I turn off permadeath?&quot;)[(replace: ?About)[*What do you think has become of the young and old men?
What do you think has become of the women and
	children?

They are alive and well somewhere;
The smallest sprouts show there is really no death,
And if ever there was it led forward life, and does not wait
	at the end to arrest it,
And ceased the moment life appeared.

All goes onward and outward... and nothing collapses,
And to die is different from what any one supposed, and
	luckier.*
	
- Walt Whitman]]
(link: &quot;Can I go back to the main menu?&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;trueInit&quot;)]</tw-passagedata><tw-passagedata pid="348" name="Look down" tags="" position="3038,1343" size="100,100">(set: $sanity to it - 10)There is nothing for it. Clearly you will have to descend the frankly terrifying staircase. 

Soon. But not yet.

*You need (text: 18 - $inklings) more Inklings of a deeper purpose*

(link: &quot;Onwards!&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]&lt;script&gt;
stopaudio();
audio.spookyShort.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="349" name="Offer him a chocolate chip cookie" tags="mist" position="2384,514" size="100,100">He accepts it with thanks.(set: $cookies&#39;s basic to it - 1)

*You have (print: $cookies&#39;s basic) chocolate chip cookies remaining*

(if: not ($achievements contains &quot;Feed the hungry&quot;))[(set: $achievements to it + (array: &quot;Feed the hungry&quot;))]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="350" name="couchKey" tags="" position="2018,1213" size="100,100">One of the wooden panels in the wall behind the couch bears a subtle marking. All you need to do is push it lightly, and... there.

A small compartment swings opens. Inside it is a key.

&lt;img src=&quot;key.png&quot;&gt;

(set: $poopKey to 2)(set: $keys to it + 1)\
*You now have (print: $keys) keys*

[[Lovely.|Main]]</tw-passagedata><tw-passagedata pid="351" name="eyeball" tags="" position="1667,673" size="100,100">It&#39;s a haunted floating eyeball! It drifts eerily towards you.(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks surprisingly unthreatening for a haunted floating eyeball.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks especially malevolent.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;eyeball.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 40, &quot;damage&quot;, 15, &quot;bonus&quot;, &quot;Try to bat it away&quot;, &quot;type&quot;, &quot;eyeball&quot;))(display: &quot;monster&quot;)(if: $inventory contains &quot;noteEye&quot;)[
[[Eyes! Communist with attention!]]]</tw-passagedata><tw-passagedata pid="352" name="church" tags="" position="3119,474" size="100,100">This room has the aspect of a church. Rows of candles burn solemnly. The ceiling is vaulted, the far wall is distant, and your footsteps echo on the stone floor. Constellations of fungus give the impression of stained glass windows. 

If you were to pray here, someone or something would certainly hear.

&lt;img src=&quot;church.png&quot;&gt;

(link: &quot;Fall to your knees and pray.&quot;)[(if: (random: 1,10) &lt;= 2)[(go-to: &quot;pirates2&quot;)](else:)[(go-to: &quot;Fall to your knees and pray.&quot;)]] *This will probably - but not definitely - benefit you.*
[[No. Don&#39;t do that.]]</tw-passagedata><tw-passagedata pid="353" name="Fall to your knees and pray." tags="blessings" position="3047,617" size="100,100">(set: $availableBlessings to (shuffled:... $allBlessings - $blessings))\
You receive a blessing!

[[Blessing of (print: $availableBlessings&#39;s 1st)]]</tw-passagedata><tw-passagedata pid="354" name="No. Don&#39;t do that." tags="" position="3191,615" size="100,100">Offering prayer in this of all places would certainly be deranged. You are far too rational for that.(set: $sanity to it + 25)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="355" name="weird" tags="pirates" position="3246,113" size="100,100">(display: &quot;deathable&quot;)(if: $words is false)[The darkness inside this space is absolute. The door behind you closes with a definitive click.](else:)[(print: $words)]
(if: $marked is not (array: &quot;&quot;))[
(link: &quot;Allow the darkness to swallow the places you have been&quot;)[(set: $weird to it + (8 * ((count: $marked, &quot;North&quot;)+(count: $marked, &quot;East&quot;)+(count: $marked, &quot;South&quot;)+(count: $marked, &quot;West&quot;))))(set: $marked to (array: &quot;&quot;))(set: $words to &quot;You have never been anywhere but here. Not really.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $turns &gt; 0)[
(link: &quot;Abandon time&quot;)[(set: $weird to it + (ceil: $turns / 60))(set: $turns to 0)(set: $words to &quot;You have always been here.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $hats &gt; 0)[
(link: &quot;Throw away your hats&quot;)[(set: $weird to it + (2 * $hats))(set: $hats to 0)(set: $words to &quot;Down they go.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $keys &gt; 0)[
(link: &quot;Allow your keys to dissolve&quot;)[(set: $weird to it + (2 * $keys))(set: $keys to 0)(set: $words to &quot;You don&#39;t need them anymore.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $ally&#39;s type is &quot;pigeons&quot;)[
(link: &quot;Feed your pigeons to the darkness&quot;)[(set: $weird to it + 5)(set: $ally&#39;s type to &quot;none&quot;)(set: $words to &quot;A flutter and they are gone.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $hunger &gt; 1)[
(link: &quot;Relinquish your hungers&quot;)[(set: $weird to it + (3 * ($hunger - 1)))(set: $hunger to 1)(display: &quot;hungerIcons&quot;)(set: $words to &quot;What is there to hunger for here?&quot;)(go-to: &quot;weird&quot;)]]\
(if: $tentacled &gt;=4)[
(link: &quot;Lose your tentacles&quot;)[(set: $weird to it + $tentacled)(set: $tentacled to 0)(set: $words to &quot;You feel their absence less keenly than you might have expected.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $cookies is not (datamap: &quot;basic&quot;, 0, &quot;rainbow&quot;, 0, &quot;eldritch&quot;, 0, &quot;healthful&quot;, 0, &quot;disappearing&quot;, 0, &quot;arcane&quot;, 0))[
(link: &quot;Feed your cookies to the darkness&quot;)[(set: $weird to it + $cookies&#39;s basic + $cookies&#39;s rainbow + $cookies&#39;s eldritch + $cookies&#39;s healthful + $cookies&#39;s disappearing + $cookies&#39;s arcane)(set: $cookies to (datamap: &quot;basic&quot;, 0, &quot;rainbow&quot;, 0, &quot;eldritch&quot;, 0, &quot;healthful&quot;, 0, &quot;disappearing&quot;, 0, &quot;arcane&quot;, 0))(set: $words to &quot;What need have you of food?&quot;)(go-to: &quot;weird&quot;)]]\
(if: ($scanner + $trash + $drink) &gt; 1)[
(link: &quot;Jettison any items you are carrying.&quot;)[(set: $weird to it + $scanner + $trash + $drink + $dice)(set: $words to &quot;Gone.&quot;)(set: $scanner to 0)(set: $trash to 0)(set: $drink to 0)(set: $dice to 0)(go-to: &quot;weird&quot;)]]\
(if: $inventory contains &quot;photocopies&quot;)[
(link: &quot;Let go of your conviction in the treachery of crabs&quot;)[(set: $words to &quot;Such matters no longer concern you.&quot;)(set: $weird to it + 2)(set: $inventory to it - (array: &quot;photocopies&quot;))(go-to: &quot;weird&quot;)]]\
(if: $cards contains &quot;fairy2&quot;)[
(link: &quot;Give up on moonlight dances&quot;)[(set: $cards to it - (array: &quot;fairy2&quot;))(set: $weird to it + 3)(set: $words to &quot;There is no music here.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $inklings &gt; 0)[
(link: &quot;Forget your inklings of a deeper purpose&quot;)[(set: $weird to it + (ceil: $inklings/5))(set: $inklings to 0)(set: $words to &quot;Ignorance no longer matters to you.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $inventory contains &quot;box&quot;)[
(link: &quot;Discard your hard-won box&quot;)[(set: $weird to it + 20)(set: $inventory to it - (array: &quot;box&quot;))(set: $words to &quot;It was empty, and now it is gone.&quot;)(go-to: &quot;weird&quot;)]]\
(if: not ($curses is (array: &quot;&quot;)))[
(link: &quot;Let the curses lift from your shoulders&quot;)[(set: $weird to it + (2 * $curses&#39;s length))(set: $curses to (array: &quot;&quot;))(set: $words to &quot;You are lighter and less substantial.&quot;)(go-to: &quot;weird&quot;)]]\
(if: $achievements is not (array: &quot;&quot;))[
(link: &quot;Renounce your achievements&quot;)[(set: $achievements to (array: &quot;&quot;))(set: $weird to it + 5)(set: $words to &quot;You have achieved nothing. *Your achievements have been reset.*&quot;)(go-to: &quot;weird&quot;)] *Note: this will permanently erase your progress.*]\

(link: &quot;Offer the darkness something of yourself&quot;)[(set: $HP to it - (random: 5,15))(set: $sanity to it - (random: 5,15))(set: $energy to it - (random: 5,15))(set: $satiety to it - (random: 5,15))(set: $weird to it + 2)(set: $words to &quot;You are diminished.&quot;)(go-to: &quot;weird&quot;)]

[[Advance]] *You have a $weird% chance of success*</tw-passagedata><tw-passagedata pid="356" name="Advance" tags="" position="3406,151" size="100,100">(if: $weird &lt; (random: 1,100))[(go-to: &quot;fuck&quot;)](else:)[(set: $HP to 0)(set: $sanity to 0)(set: $energy to 0)(set: $satiety to 0)(if: not ($achievements contains &quot;Stand vigil over the end of the world&quot;))[(set: $achievements to it + (array: &quot;Stand vigil over the end of the world&quot;))](display: &quot;achievementDisplay&quot;)\
Impossibly far above you the sun sets and rises and sets again. Generations pass. At some point the entire dungeon is excavated, ransacked, and destroyed. 

Civilizations fall, and rise, and fall again until there is nothing left. In time even the sun ceases its journey across the sky, and the stars are blotted out one by one.

The little that remains of you would be unrecognisable even to yourself. And yet it endures, locked safely in some dark corner of a dungeon that no longer exists. It will still be here when the universe folds back in on itself. It may be here some time after that. 

(link: &quot;Endure.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;init&quot;)]]</tw-passagedata><tw-passagedata pid="357" name="Blessing of wellness" tags="blessings" position="2197,174" size="100,100">With each passing minute your health, sanity or energy will increase by 1.(set: $blessings to it + (array: &quot;wellness&quot;))(set: $w to (array: 0,0,1))(set: $roomExecute to it + (array: &quot;(set: $w to (shuffled: ...$w))(set: $HP to (min: $statMax, $HP + $w&#39;s 1st)) (set: $sanity to (min: $statMax, $sanity + $w&#39;s 2nd)) (set: $energy to (min: $statMax, $energy + $w&#39;s 3rd))&quot;))

[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="358" name="crossroads" tags="" position="3380,3376" size="100,100">(set: $options to (shuffled: ...(array: &quot;[[candle-lit passage|church]]&quot;, &quot;[[passage littered with sheet music|guitar]]&quot;, &quot;[[passage that&#39;s crawling with bugs|bugs]]&quot;, &quot;[[passage that sounds with barking|dog]]&quot;, &quot;[[moon-lit passageway|fairy]]&quot;, &quot;[[passage that sounds with scuttling|crabRoom]]&quot;, &quot;[[passage that&#39;s lit by firelight|bibleopoly]]&quot;, &quot;[[quiet passage|sloth]]&quot;, &quot;[[passage that sounds with human voices|troupe]]&quot;, &quot;[[passage that echoes with heavy footsteps|elephant]]&quot;, &quot;[[passage lit by mood lighting|Painting]]&quot;, &quot;[[passage from which you can hear a distant mechanical whirring|treadmill]]&quot;, &quot;[[wind-swept passageway|tornado]]&quot;, &quot;[[quiet passageway|holeKey]]&quot;, &quot;[[passageway lined with heavy stones|statue]]&quot;, &quot;[[passage that&#39;s littered with old playing cards|cards]]&quot;, &quot;[[watermelon-scented hallway|banquet]]&quot;, &quot;[[passageway that&#39;s littered with broken glass|jar]]&quot;, &quot;[[passageway that&#39;s littered with old scraps of parchment|eyeballNote]]&quot;, &quot;[[passageway that sounds with a sombre ticking|clock]]&quot;, &quot;[[passageway that reeks of manure|plant1]]&quot;, &quot;[[sandy passageway|sphynx]]&quot;,&quot;[[passageway from which you can see something glint|heistIntro]]&quot;, &quot;[[passageway littered with coathangers|jargo]]&quot;, &quot;[[passageway that sparkles with magic|wizard]]&quot;,&quot;[[corridor from which a cold draught emanates|space]]&quot;, &quot;[[cookie-scented hallway|pantry]]&quot;)))\
The corridor branches in three directions. There is a signpost here, but the letters are too eroded to read. Which branch will you take?

&lt;img src=&quot;crossroads.png&quot;&gt;

Go down the (print: 1st of $options)
Go down the (print: 2nd of $options)
Go down the (print: 3rd of $options)</tw-passagedata><tw-passagedata pid="359" name="Adopt it as your own" tags="" position="232,3379" size="100,100">It begins to follow you around the dungeon, pausing from time to time to look at you with soulful eyes.(set: $inventory to it + (array: &quot;dog&quot;))(set: $rareCards to it - (array: &quot;dog&quot;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sDog.png&quot;&gt;&#39;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="360" name="Introduce this new dungeon dog to your own pet" tags="" position="346,3193" size="100,100">They regard each other with mutual suspicion.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="361" name="Use your dog to cause a distraction" tags="" position="1391,1181" size="100,100">(set: $inventory to it - (array: &quot;dog&quot;))(set: $rareishCards to it + (array: &quot;dog2&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sDog.png&quot;&gt;&#39;))\
You command your dog to stay as you run from the room.

You are soon out of earshot, and are therefore spared the terrible crunching sounds of what no doubt happened next.

[[Goodbye, loyal friend.|Main]]</tw-passagedata><tw-passagedata pid="362" name="dog2" tags="" position="411,3375" size="100,100">It&#39;s your former pet, the loyal dungeon dog! It survived! Its fur is matted with blood. It limps as it makes its way across the dungeon floor.

What might have been a joyful reunion is cut short as it raises its hackles, bares its teeth, and quickly begins to close the distance between you.

&lt;img src=&quot;dog2.png&quot;&gt;

[[Run!!|dogRun]]
[[Don&#39;t run!!]]</tw-passagedata><tw-passagedata pid="363" name="dogRun" tags="" position="404,3555" size="100,100">Your former pet soon falls behind. Its heart doesn&#39;t really seem to be in the pursuit. 

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="364" name="Don&#39;t run!!" tags="" position="541,3548" size="100,100">Your former friend would never do anything to harm you.

Never!

(link: &quot;Would it?&quot;)[(set: $HP to 0)(go-to: &quot;You are dead&quot;)](if: not ($achievements contains &quot;Be reunited with an old friend&quot;))[(set: $achievements to it + (array: &quot;Be reunited with an old friend&quot;))]</tw-passagedata><tw-passagedata pid="365" name="cudgel2" tags="" position="750,1282" size="100,100">(set: $energy to it - 10)(set: $sanity to it - 10)(if: $inventory contains &quot;cudgel&quot; or (random: 1,3) is 1)[This symbolic act of watermelon-based aggression(if: $inventory contains &quot;cudgel&quot;)[, perpetrated with your deluxe cudgel,] has helped diminish your cravings.(set: $hunger to it - 1)(display: &quot;hungerIcons&quot;)

[[Onwards!|Main]]](else:)[You had hoped that refusing to partake of the watermelon would lessen your hunger. You were mistaken.

*You might have better luck next time.*

[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="366" name="icons" tags="" position="726,79" size="100,100">&lt;img src=&quot;sSpace.png&quot;&gt;(if: (count: $inventory, &quot;poisoned&quot;) &gt; 1)[&lt;img src=&quot;sPoison2.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](else-if: $inventory contains &quot;poisoned&quot;)[&lt;img src=&quot;sPoison.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](if: $cards contains &quot;furiousGod&quot;)[&lt;img src=&quot;sEye2.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](else-if: $cards contains &quot;displeasedGod&quot;)[&lt;img src=&quot;sEye1.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](if: $ally&#39;s type is &quot;pigeons&quot; and $ally&#39;s health &gt; 40)[&lt;img src=&quot;sAlly1.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](else-if: $ally&#39;s type is &quot;pigeons&quot;)[&lt;img src=&quot;sAlly2.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](if: $mushroomCooldown &gt; $turns)[&lt;img src=&quot;sShroom.png&quot;&gt;&lt;img src=&quot;sSpace.png&quot;&gt;](print: $icons.join(&#39;&lt;img src=&quot;sSpace.png&quot;&gt;&#39;))</tw-passagedata><tw-passagedata pid="367" name="Abstain" tags="" position="23,818" size="100,100">You preserve your mind from the effects of the caffeine.(set: $sanity to it + 1)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="368" name="candle" tags="" position="2777,3271" size="100,100">A candle burns here for St. Archibald, the patron saint of dungeon-goers. (if: $curses contains &quot;prophecyBird&quot;)[The wick will not light.

[[So it goes.|Main]]](else:)[The glow of the candle is warm and comforting.

&lt;img src=&quot;candle.png&quot;&gt;

[[Bask in the light]]](if: $hunger &gt; 1)[
[[Eat the candle|EatPeckish]]]</tw-passagedata><tw-passagedata pid="369" name="Bask in the light" tags="" position="2701,3421" size="100,100">The condition of your various ailments, physical and otherwise, is much improved.

(if: $HP &lt; 30)[(set: $HP to 30)](if: $sanity &lt; 30)[(set: $sanity to 30)](if: $energy &lt; 30)[(set: $energy to 30)](if: $satiety &lt; 30)[(set: $satiety to 30)]\
[[Onwards!|Main]]&lt;script&gt;
audio.archibald.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="370" name="leaveDebug" tags="mist" position="2292,401" size="100,100">You have navigated stranger realms than this before.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="371" name="sergeGuide2" tags="" position="3203,1169" size="100,100">A strange man enters the room. He is carrying a jar full of bugs and smells faintly of bacon.

&quot;I&#39;ve survived in this dungeon longer than most,&quot; he says, &quot;and I can help you descend even further. Further from the sun, from the sky, and from all you hold dear.&quot;

&lt;img src=&quot;serge.png&quot;&gt;

(set: $sergeGuide2 to 0)
(set: $cards to it - (array: &quot;sergeGuide2&quot;))\
[[Take me there|YesSerge2]]
[[Not now|Main]]</tw-passagedata><tw-passagedata pid="372" name="YesSerge2" tags="" position="3183,1322" size="100,100">The journey passess uneventfully. You turn to thank him when you reach your destination, but he&#39;s already left.

Was he ever even there?

[[Onwards!|hole]]</tw-passagedata><tw-passagedata pid="373" name="Feed them a chocolate chip cookie" tags="" position="1418,1051" size="100,100">(set: $cookies&#39;s basic to it - 1)They peck ravenously at the cookie. You slip away undetected in the commotion.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="374" name="Feed them some breadcrumbs" tags="" position="1541,1047" size="100,100">You feed the pigeons your breadcrumbs. They eat ravenously. 

After finishing their meal the pigeons begin to follow you around the dungeon. Have you tamed them?

(set: $scanner to it - 1)\
(set: $ally to (datamap: &quot;type&quot;, &quot;pigeons&quot;, &quot;health&quot;, 80, &quot;maxHealth&quot;, 100))\
(set: $cards to it + (array: &quot;pigeons&quot;))\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="375" name="Offer them some breadcrumbs" tags="" position="1500,2308" size="100,100">(set: $ally&#39;s maxHealth to it + 50)(set: $ally&#39;s health to it + 20)\
The pigeons relish their meal.

*Your pigeons&#39; health is now (print: $ally&#39;s health)%.*
*Your pigeons&#39; maximum health is now (print: $ally&#39;s maxHealth)%.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="376" name="The clear colourless one" tags="" position="169,362" size="100,100">It looks and tastes exactly like water. It hydrates you slightly. (set: $HP to it + 1)(if: not ($achievements contains &quot;Stay hydrated&quot;))[(set: $achievements to it + (array: &quot;Stay hydrated&quot;))]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="377" name="shop" tags="" position="2198,3602" size="100,100">The (print: $roomName) contains a cheerfully coloured market stall, manned (slimed?) by a (print: $adjective) dungeon slime. The prices are listed in chocolate chip cookies.(if: $price&#39;s 6th is 1 and not ($ankh &gt; 0))[

A shiny ankh, fashioned from what might be gold, is displayed in the centre of the stand.](if: $price&#39;s 6th is 2)[

Among the stock is a candle of the sort commonly lit in honour of Saint Archibald, patron saint of dungeongoers. Burning it will address the worst of your ailments.](if: $price&#39;s 6th is 3)[

Among the stock is a solitary bottle of some sleek grey liquid, said to increase the speed of anyone who drinks it.]

&lt;img src=&quot;stall.png&quot;&gt;

&#39;&#39;You have |cookies&gt;[(print: $cookies&#39;s basic)] chocolate chip cookies&#39;&#39;

(print: $goods&#39;s 1st): &#39;&#39;(print: $price&#39;s 1st)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 1st)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 1st)(if: $goods&#39;s 1st is &quot;Average juice&quot;)[(set: $drink to it + 1)](else:)[(set: $HP to it + 15)](go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]] \
(if: $goods&#39;s 1st is &quot;Average juice&quot; and $drink &gt; 0)[(link: &quot;Sell.&quot;)[(set: $cookies&#39;s basic to it + $price&#39;s 1st)(set: $drink to it - 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Sell.&#39;&#39;]] 
(print: $goods&#39;s 2nd): &#39;&#39;(print: $price&#39;s 2nd)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 2nd)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 2nd)(if: $goods&#39;s 2nd is &quot;Breadcrumbs&quot;)[(set: $scanner to it + 1)](else:)[(set: $sanity to it + 15)](go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]] \
(if: $goods&#39;s 2nd is &quot;Breadcrumbs&quot; and $scanner &gt; 0)[(link: &quot;Sell.&quot;)[(set: $cookies&#39;s basic to it + $price&#39;s 2nd)(set: $scanner to it - 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Sell.&#39;&#39;]] 
(print: $goods&#39;s 3rd): &#39;&#39;(print: $price&#39;s 3rd)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 3rd)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 3rd)(if: $goods&#39;s 3rd is &quot;Dynamite&quot;)[(set: $trash to it + 1)](else:)[(set: $energy to it + 15)](go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]  \
(if: $goods&#39;s 3rd is &quot;Dynamite&quot; and $trash &gt; 0)[(link: &quot;Sell.&quot;)[(set: $cookies&#39;s basic to it + $price&#39;s 3rd)(set: $trash to it - 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Sell.&#39;&#39;]] 
Hats: &#39;&#39;(print: $price&#39;s 4th)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 4th)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 4th)(set: $hats to it + 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]  \
(if: $hats &gt; 0)[(link: &quot;Sell.&quot;)[(set: $cookies&#39;s basic to it + $price&#39;s 4th)(set: $hats to it - 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Sell.&#39;&#39;]] 
Keys: &#39;&#39;(print: $price&#39;s 5th)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 5th)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 5th)(set: $keys to it + 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]  \
(if: $keys &gt; 0)[(link: &quot;Sell.&quot;)[(set: $cookies&#39;s basic to it + $price&#39;s 5th)(set: $keys to it - 1)(go-to: &quot;shop&quot;)]](else:)[(color: grey)[&#39;&#39;Sell.&#39;&#39;]](if: $price&#39;s 6th is 1 and not ($ankh &gt; 0))[
Ankh: &#39;&#39;(print: $price&#39;s 7th)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 7th)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 7th)(go-to: &quot;buyAnkh&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]](if: $price&#39;s 6th is 2)[
St. Archibald&#39;s Candle: &#39;&#39;(print: $price&#39;s 7th)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 7th)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 7th)(go-to: &quot;buyCandle&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]](if: $price&#39;s 6th is 3)[
Bottle of sleek grey potion: &#39;&#39;(print: $price&#39;s 7th)&#39;&#39; cookies. (if: $cookies&#39;s basic &gt;= $price&#39;s 7th)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - $price&#39;s 7th)(go-to: &quot;buyPotion&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]](if: $cookies&#39;s basic &gt;= 15 and not ($inventory contains &quot;box&quot;))[
An unremarkable cardboard box: &#39;&#39;60 cookies.&#39;&#39; (if: $cookies&#39;s basic &gt;= 60)[(link: &quot;Buy.&quot;)[(set: $cookies&#39;s basic to it - 50)(go-to: &quot;buyBox&quot;)]](else:)[(color: grey)[&#39;&#39;Buy.&#39;&#39;]]](if: $inventory contains &quot;egg&quot;)[

(link: &quot;Sell your crab eggs for a cookie each&quot;)[(set: $cookies&#39;s basic to it + (count: $inventory, &quot;egg&quot;))(set: $inventory to it - (array: &quot;egg&quot;))(go-to: &quot;shop&quot;)]]

(link: &quot;Leave.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="378" name="toShop" tags="" position="2195,3483" size="100,100">(set: $adjective to (either: &quot;jolly&quot;, &quot;solemn&quot;, &quot;shrewd&quot;, &quot;brusque&quot;))
(set: $price to (array: (random: 2,3), (random: 2,3), (random: 2,3), (random: 1,6), (random: 6,8), (random: 1,4), (random:1,5), (either: 1,1,1,2,2,3)))
(set: $goods to (array: (either: &quot;Bandanges&quot;, &quot;Average juice&quot;, &quot;Average juice&quot;), (either: &quot;Hot chocolate&quot;, &quot;Breadcrumbs&quot;, &quot;Breadcrumbs&quot;), (either: &quot;Dynamite&quot;, &quot;Hot coffee&quot;, &quot;Hot coffee&quot;)))\
(if: $card is &quot;trap&quot;)[(set: $roomName to &quot;wardrobe&quot;)](else:)[(set: $roomName to &quot;room&quot;)]
&lt;script&gt;
stopaudio();
audio.shop.play();
&lt;/script&gt;(if: (random:1,4) is 1)[(set: $price&#39;s 1st to it + (either: -1,1))](if: (random:1,4) is 1)[(set: $price&#39;s 2nd to it + (either: -1,1))](if: (random:1,4) is 1)[(set: $price&#39;s 3rd to it + (either: -1,1))](if: (random:1,3) is 1)[(set: $price&#39;s 4th to it + (either: 1,2))](if: (random:1,4) is 1)[(set: $price&#39;s 5th to it + (either: -1,1))](go-to: &quot;shop&quot;)</tw-passagedata><tw-passagedata pid="379" name="buyPotion" tags="" position="2199,3717" size="100,100">You double over in pain. The muscles in your legs are unknotting and reknitting over and over again. It feels like crabs are scuttling under your skin until, finally, it&#39;s over.

With the process completed, your legs feel stronger and more agile.

(set: $fleeBonus to it + 8)(set: $price&#39;s 6th to 0)\
[[Time for more shopping!|shop]]</tw-passagedata><tw-passagedata pid="380" name="actions" tags="" position="611,920" size="100,100">&lt;div id=&quot;fade&quot;&gt;&lt;p&gt;(if: $tickBomb is not false)[(set: $tickBomb to it - 1)(if: $tickBomb is 0)[(set: $delayExecute to &quot;(set: $cardSelect to (array: &#39;explode&#39;))&quot;)]*Or you could* (link: &quot;*use the short-fused bomb*&quot;)[(go-to: &quot;explodeAlt&quot;)]
](if: $curses contains &quot;server&quot; and (random: 1,2) is 2)[[*Or you could* ]&lt;serverMessage|(link-replace: &quot;*access corrupted memories*&quot;)[(replace: ?serverMessage)[(either: &quot;1011&quot;, &quot;1101&quot;, &quot;0001&quot;)(either: &quot;0101&quot;, &quot;1110&quot;, &quot;0011&quot;)(either: &quot;0101&quot;, &quot;0101&quot;, &quot;1101&quot;)(either: &quot;1101&quot;, &quot;0100&quot;, &quot;1001&quot;)(either: &quot;1011&quot;, &quot;0001&quot;, &quot;0110&quot;)(replace: (either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;))[(either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;)](replace: (either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;))[(either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;)](replace: (either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;))[(either: &quot;a&quot;, &quot;e&quot;, &quot;i&quot;, &quot;o&quot;, &quot;u&quot;)]]]](else:)[(if: $tornado &gt; 0)[(set: $tornado to it -1)|tempest&gt;[*Or you could*] (link: &quot;*unleash the tempest inside you*&quot;)[(if: $untouchables contains $card)[(replace: ?tempest)[*You can&#39;t do that here.*]](else:)[(go-to: &quot;unleash the tempest inside you&quot;)]]
]\
(if: $diceCooldown &lt; 9999)[|dice&gt;[*Or you could*] (link: &quot;*reroll the dice*&quot;)[(if: $card is &quot;Blessed&quot;)[(replace: ?dice)[*You can&#39;t do that here.*]](else-if: $turns &gt; $diceCooldown)[(replace: ?dice)[*&#39;&#39;(either: &quot;Snake eggs.&quot;, &quot;Fever eyes.&quot;, &quot;Eight eights.&quot;, &quot;Twenty-one.&quot;, &quot;Twenty-three.&quot;, &quot;Lucky eleventy.&quot;)&#39;&#39;*](set: $diceCooldown to $turns + (random: 1,13))(live: 0.8s)[(goto: &quot;Main&quot;)]](else-if: (random: 1,20) is 13)[(replace: ?dice)[*&#39;&#39;Unlucky thirteen.&#39;&#39;*](set: $HP to it - 6)(replace: ?Health)[(color: $colours&#39;s 29)[$HP]]\
	(set: $sanity to it - 6)(replace: ?Sanity)[(color: $colours&#39;s 29)[$sanity]]\
	(set: $energy to it - 6)(replace: ?Energy)[(color: $colours&#39;s 29)[$energy]]\
	(set: $satiety to it - 6)(replace: ?Satiety)[(color: $colours&#39;s 29)[$satiety]]](else:)[(replace: ?dice)[*&#39;&#39;(either: &quot;One&quot;, &quot;Two&quot;, &quot;Three&quot;, &quot;Four&quot;, &quot;Five&quot;, &quot;Six&quot;, &quot;Seven&quot;, &quot;Eight&quot;, &quot;Nine&quot;, &quot;Ten&quot;, &quot;Eleven&quot;, &quot;Twelve&quot;, &quot;Fourteen&quot;, &quot;Fifteen&quot;, &quot;Sixteen&quot;, &quot;Seventeen&quot;, &quot;Eighteen&quot;, &quot;Nineteen&quot;, &quot;Twenty&quot;).&#39;&#39; (The dice is still recharging.)*]]]
]\
(if: $trash &gt;0)[[*Or you could*]&lt;dynoMessage| (link:&quot;*destroy this location*&quot;)[(if: $untouchables contains $card)[(replace: ?dynoMessage)[*You can&#39;t do that here.*]]\
(else:)[(go-to: &quot;remove this location from the dungeon&quot;)]]
	]\
(if: $blessings contains &quot;laughter&quot;)[*Or you could [[laugh crazily at the whole situation until it goes away|lol]]*
	]\
(if: $blessings contains &quot;maturity&quot; and $maturityCooldown &lt; $turns)[[*And you could* ]&lt;matureMessage|(link: &quot;*reverse the effects of your last decision*
&quot;)[
(if: not (1st of $maturityOld is $HP))[(set: $HP to 1st of $maturityOld)(replace: ?Health)[(color: white)[$HP]]]\
(if: not (2nd of $maturityOld is $sanity))[(set: $sanity to 2nd of $maturityOld)(replace: ?Sanity)[(color: white)[$sanity]]]\
(if: not (3rd of $maturityOld is $energy))[(set: $energy to 3rd of $maturityOld)(replace: ?Energy)[(color: white)[$energy]]]\
(if: not (4th of $maturityOld is $satiety))[(set: $satiety to 4th of $maturityOld)(replace: ?Satiety)[(color: white)[$satiety]]]\
(set: $HPOld to $HP)(set: $sanityOld to $sanity)(set: $energyOld to $energy)(set: $satietyOld to $satiety)\
(set: $maturityCooldown to (random: 10,15))\
(replace: ?matureMessage)[*You are wiser now.*]]]\
(if: $blessings contains &quot;snacking&quot;)[*And you could* (link-repeat: &quot;*snack on chocolate-coated coffee beans*
&quot;)[(set: $satiety to it + 1)(set: $energy to it + 1)(set: $HP to it - (random: 2,5))\
	(replace: ?Health)[(color: red)[$HP]]\
	(replace: ?Energy)[(color: lime)[$energy]]\
	(replace: ?Satiety)[(color: lime)[$satiety]]\
	(if: $HP &lt;1)[(go-to: &quot;You are dead&quot;)]\
	(if: $energy &gt;100)[(go-to: &quot;energyMax&quot;)]\
	(if: $satiety &gt;100)[(go-to: &quot;satietyMax&quot;)]\
	]]\
(if: $scanner &gt;0)[[*And you could*]&lt;crumbMessage| (link: &quot;*scatter some breadcrumbs*&quot;)[(if: $untouchables contains $card)[(replace: ?crumbMessage)[*You can&#39;t do that here.*]]\
(else-if: (count: ($cards + $uncommonCards + $rareCards + $rareishCards), $card) &gt;= 2)[(replace: ?crumbMessage)[*This room already contains breadcrumbs.*]]\
(else:)[(set: $cards to it + (array: $card))(set: $crumbed to it + (array: $card, $card))(set: $scanner to it - 1)\
(replace: ?crumbMessage)[*You&#39;ll come across this room more often now.*]]]
]\
(if: $drink &gt;0)[[*And you could*]&lt;juiceMessage| (link: &quot;*drink some average juice*
&quot;)[(set: $drink to it - 1)(set: $average to ((round:($HP + $sanity + $energy + $satiety)/4)))(if: $blessings contains &quot;consumption&quot;)[(set: $average to it + 6)]\
	(replace: ?juiceMessage)[]\
	(set: $HPOld to $average)(set: $sanityOld to $average)(set: $energyOld to $average)(set: $satietyOld to $average)\
	(set: $HP to $average)(replace: ?Health)[(color: white)[$average]]\
	(set: $sanity to $average)(replace: ?Sanity)[(color: white)[$average]]\
	(set: $energy to $average)(replace: ?Energy)[(color: white)[$average]]\
	(set: $satiety to ($average))(replace: ?Satiety)[(color: white)[$average]]]]\
(if: $blessings contains &quot;sacrifice&quot; and $keys &gt; 0)[[*And you could *]&lt;keyMessage|(link: &quot;*sacrifice a key*
&quot;)[(replace: ?keyMessage)[]\
	(set: $keys to it - 1)(replace: ?keyCount)[$keys]\
	(set: $HP to 60)(replace: ?Health)[(color: white)[$HP]]\
	(set: $sanity to 60)(replace: ?Sanity)[(color: white)[$sanity]]\
	(set: $energy to 60)(replace: ?Energy)[(color: white)[$energy]]\
	(set: $satiety to 60)(replace: ?Satiety)[(color: white)[$satiety]]]]\
(if: $blessings contains &quot;shuffling&quot; and $shuffleCooldown &lt; $turns)[[*And you could* ]&lt;shuffleMessage|(link: &quot;*rearrange your very being*
&quot;)[(set: $shuffleMax to $HP + $sanity + $energy + $satiety)\
(set: $shuffleMin to (round: $shuffleMax/4))\
(set: $HP to (round: (random:$shuffleMin,$shuffleMax*2)/4))(replace: ?Health)[(color: white)[$HP]]\
(set: $sanity to (round: (random: $shuffleMin,(($shuffleMax-$HP)*2))/3))(replace: ?Sanity)[(color: white)[$sanity]]\
(set: $energy to (round: (random: $shuffleMin,($shuffleMax-($HP+$sanity)))/2))(replace: ?Energy)[(color: white)[$energy]]\
(set: $satiety to ($shuffleMax - ($HP + $sanity + $energy)))(replace: ?Satiety)[(color: white)[$satiety]]\
(set: $shuffleCooldown to $turns + (random: 6,12))(replace: ?shuffleMessage)[]]]\
(if: $cookies is not (datamap: &quot;basic&quot;, 0, &quot;rainbow&quot;, 0, &quot;arcane&quot;, 0, &quot;eldritch&quot;, 0, &quot;healthful&quot;, 0, &quot;disappearing&quot;, 0))[[*And you could*]&lt;cookiemessage| (link: &quot;*eat a cookie*&quot;)[(replace: ?cookiemessage)[]*What kind of cookie will you eat?* (if: $cookies&#39;s basic &gt;0)[
	(link: &quot;   Eat a chocolate chip cookie&quot;)[(set: $cookies&#39;s basic to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s basic)&#39;&#39; chocolate chip cookies left.)*(set: $fleeBonus to it + $socks&#39;s cookie)(set: $satiety to it + 5)(if: $blessings contains &quot;consumption&quot;)[(set: $satiety to it + 5)](replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s healthful &gt; 0)[
	(link: &quot;   Eat a healthful cookie&quot;)[(set: $cookies&#39;s healthful to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s healthful)&#39;&#39; healthful cookies left.)*(set: $HP to it + 10)(set: $satiety to it + 5)(set: $inventory to it - (array: &quot;poisoned&quot;))(replace: ?Satiety)[(color: white)[$satiety]](replace: ?Health)[(color: white)[$HP]]]](if: $cookies&#39;s rainbow &gt; 0)[
    (link: &quot;   Eat a rainbow cookie&quot;)[(set: $cookies&#39;s rainbow to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s rainbow)&#39;&#39; rainbow cookies left.)*(set: $shuffleMax to $HP + $sanity + $energy + $satiety + 10)(set: $shuffleMin to (round: $shuffleMax/4))(set: $HP to (round: (random:$shuffleMin,$shuffleMax*2)/4))(replace: ?Health)[(color: white)[$HP]]\
(set: $sanity to (round: (random: $shuffleMin,(($shuffleMax-$HP)*2))/3))(replace: ?Sanity)[(color: white)[$sanity]]\
(set: $energy to (round: (random: $shuffleMin,($shuffleMax-($HP+$sanity)))/2))(replace: ?Energy)[(color: white)[$energy]]\
(set: $satiety to ($shuffleMax - ($HP + $sanity + $energy)))(replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s arcane &gt; 0)[
    (link: &quot;   Eat an arcane cookie&quot;)[(set: $cookies&#39;s arcane to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s arcane)&#39;&#39; arcane cookies left)*(set: $HP to $sanity)(set: $energy to $sanity)(set: $satiety to $sanity)(replace: ?Health)[(color: white)[$HP]](replace: ?Energy)[(color: white)[$energy]](replace: ?Satiety)[(color: white)[$satiety]]]](if: $cookies&#39;s disappearing &gt; 0)[
    (link: &quot;   Eat a disappearing cookie&quot;)[(go-to: &quot;Eat a disappearing cookie&quot;)]](if: $cookies&#39;s eldritch &gt; 0)[
    (link: &quot;   Eat an eldritch cookie&quot;)[(if: $card is &quot;none&quot; or not ($delayExecute is false))[You can&#39;t do that here.](else:)[(set: $cookies&#39;s eldritch to it - 1)Om. *(You have &#39;&#39;(print: $cookies&#39;s eldritch)&#39;&#39; eldritch cookies left.)*(set: $satiety to it + 5)(set: $delayExecute to &#39;(set: $cardSelect to (array: &quot;eldritch&quot;))&#39;)(set: $eldritchCard to $card)]]]]]]&lt;/p&gt;&lt;/div&gt;</tw-passagedata><tw-passagedata pid="381" name="holeKey" tags="" position="428,3898" size="100,100">There is a large pit in the centre of the room, too dark and too deep for you to see the bottom. A key is suspended from the ceiling above it. If you lean forward with your arms outstretched you might just be able to reach it. (set: $r to (either: 5, 10, 15, 20, 25, 30, 35, 40))

&lt;img src=&quot;hole.png&quot;&gt;

(link: &quot;Reach for the key&quot;)[(if: (random: 1,100) &lt; $r))[(goto: &quot;holeDown&quot;)](else:)[(go-to: &quot;holeKeyGet&quot;)]] *(There is a (print: $r)% chance that this will end in your death)*
[[Give the hole a safe berth|Main]](if: $cards contains &quot;2&quot;)[
[[Throw the stained robe down the hole|2b]]]</tw-passagedata><tw-passagedata pid="382" name="holeKeyGet" tags="" position="356,4027" size="100,100">Success! The key is yours. (set: $keys to it + 1)

*You now have $keys keys*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="383" name="holeDown" tags="" position="486,4027" size="100,100">You lean forward, and with the key almost in your grasp you lean forward a little more. And a little more after that.

And then you&#39;re falling further and further down into the blackness, and it takes so long that terror gives way to idle curiosity about how long you can possibly fall before reaching the bottom.(set: $HP to 0)

(link:&quot;And then it hits you.&quot;)[(if: $ankh &gt; 0)[(go-to: &quot;downWell&quot;)](else:)[(go-to: &quot;You are dead&quot;)]]</tw-passagedata><tw-passagedata pid="384" name="Become one with the wind" tags="" position="773,2721" size="100,100">The wind roars in your ears. Debris is flung into the air. The air whips your clothes and caresses your skin. You can feel it seeping into your pores.

And then the wind is calmed once more. Formerly airborne debris falls to the floor with a clang. The storm is inside you now. (set: $tornado to 7)(set: $saveTimer to it + 7)(set: $sanity to it - 10)(set: $icons to it + (array: &#39;&lt;img src=&quot;sTornado.png&quot;&gt;&#39;))

[[Onwards!|Main]]&lt;script&gt;
stopaudio();
audio.storm.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="385" name="unleash the tempest inside you" tags="" position="556,1039" size="100,100">(if: $card is &quot;exit&quot; and not ($achievements contains &quot;Destroy the exit&quot;))[(set: $achievements to it + (array: &quot;Destroy the exit&quot;))]\
(if: $card is &quot;crabRoom&quot; and not ($achievements contains &quot;Foil a conspiracy&quot;))[(set: $achievements to it + (array: &quot;Foil a conspiracy&quot;))]\
(set: $cards to it - (array: $card))\
(set: $uncommonCards to it - (array: $card))\
(set: $rareCards to it - (array: $card))\
(set: $delayExecute to false)(set: $sanity to it - 6)(set: $energy to it - 6)\
(if: $card is &quot;altar&quot;)[(go-to: &quot;furiousGod&quot;)]\
The wind begins to howl. The air crackles with electricity. 

When you exit the room you leave nothing but rubble behind.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="386" name="tornadoEnd" tags="" position="770,2840" size="100,100">You&#39;re calmer now. The storm is over.(set: $tornado to -1)(set: $icons to it - (array: &#39;&lt;img src=&quot;sTornado.png&quot;&gt;&#39;))

[[Onwards!|Main]]&lt;script&gt;
stopaudio();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="387" name="pirates2" tags="pirates" position="1543,1801" size="100,100">You are struck by an inconvenient curse!&lt;script&gt;
stopaudio();
audio.pirate.play();
&lt;/script&gt;

&lt;img src=&quot;pirate.png&quot;&gt;

(if: not ($achievements contains &quot;Be inconvenienced&quot;))[(set: $achievements to it + (array: &quot;Be inconvenienced&quot;))]\
(link: &quot;Inconvenience!&quot;)[(set: $HP to (floor: $HP /2))(set: $sanity to (floor: $sanity /2))(set: $energy to (floor: $energy /2))(set: $satiety to (floor: $satiety /2))(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="388" name="slimeMonster" tags="" position="679,3864" size="100,100">A collosal dungeon slime oozes down the corridor towards you. Its eyes glitter with malevolence. It moves faster than you would have imagined possible for a creature without legs.

&lt;img src=&quot;slime.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 20, &quot;damage&quot;, 0, &quot;type&quot;, &quot;slime&quot;))(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="389" name="slimeAttack" tags="" position="709,4004" size="100,100">(set: $r to (random: 1,3))\
(if: $r is 1)[The slime envelops you and sucks vitality from your pores. After it&#39;s done it ejects you from its centre and wobbles gelatinously away. Everything hurts, but at least you&#39;re alive.(set: $HP to 1)]\
(else-if: $r is 2)[The slime envelops you. Once you are contained inside it, the slime begins to suck knowledge from your mind. After it&#39;s done it ejects you from its centre and wobbles gelatinously away. There are holes in your memory now, and your thoughts have been left in disarray.(set: $sanity to 1)]\
(else-if: $r is 3)[The slime envelops you. You feel energy seep from your body; you sense the slime feeding on it. After it&#39;s done it ejects you from its centre and wobbles gelatinously away. You are as exhausted as it is possible to become.(if: $energy &gt; 1)[(set: $energy to 1)]]\


[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="390" name="darkMirror" tags="" position="2536,3631" size="100,100">A mirror hangs on the wall. Your reflection calls you a failure. No aspect of your character escapes its opprobrium.

&lt;img src=&quot;mirrorDark.png&quot;&gt;
(if: $direction&#39;s direction is &quot;north&quot;)[
You have no time to listen to it prattle. You are heading North.

[[NORTH.|Main]]
](else:)[
[[Defend your constitution]]
[[Defend your perspicacity]]
[[Defend your vigour]]
[[Defend your stomach]](if: $hunger &gt; 3)[
[[Eat your reflection]]]]</tw-passagedata><tw-passagedata pid="391" name="Defend your constitution" tags="" position="2241,3885" size="100,100">Though many of your reflection&#39;s criticisms hit their mark, you convince yourself that your constitution, at least, is perfectly fine. (set: $HP to it + 10)(set: $energy to it - 5)(set: $satiety to it - 5)(set: $sanity to it - 5)

[[Onwards!|Main]]

</tw-passagedata><tw-passagedata pid="392" name="Defend your perspicacity" tags="" position="2387,3886" size="100,100">Though many of your reflection&#39;s criticisms hit their mark, you convince yourself that your mind is keener than could be reasonably be expected, considering the horrors you&#39;ve encountered in the dungeon so far. (set: $HP to it - 5)(set: $energy to it - 5)(set: $satiety to it - 5)(set: $sanity to it + 10)

[[Onwards!|Main]]
</tw-passagedata><tw-passagedata pid="393" name="Defend your vigour" tags="" position="2522,3885" size="100,100">Though many of your reflection&#39;s criticisms hit their mark, you convince yourself that your vigour is perfectly admirable.(set: $HP to it - 5)(set: $energy to it + 10)(set: $satiety to it - 5)(set: $sanity to it - 5)

[[Onwards!|Main]]
</tw-passagedata><tw-passagedata pid="394" name="Defend your stomach" tags="" position="2646,3881" size="100,100">Though many of your reflection&#39;s criticisms hit their mark, you convince yourself that your stomach, at least, is perfectly fine. (set: $HP to it -5)(set: $energy to it - 5)(set: $satiety to it + 10)(set: $sanity to it - 5)

[[Onwards!|Main]]
</tw-passagedata><tw-passagedata pid="395" name="Eat your reflection" tags="" position="2771,3886" size="100,100">What you&#39;re doing raises a few metaphysical conundrums. 

No matter. You&#39;ll think through them later. Perhaps after you finish your meal. (set: $satiety to it + 10)(set: $uncommonCards to it - (array: &quot;confide&quot;, &quot;darkMirror&quot;))

[[Yum.|Main]]</tw-passagedata><tw-passagedata pid="396" name="statue" tags="" position="3098,3506" size="100,100">A colossal stone head dominates this room. It is (if: (count: ($achievements), &quot;Restore the statue&quot;) &gt;= 10)[in pristine condition.](else-if: (count: ($achievements), &quot;Restore the statue&quot;) &gt; 3)[somewhat eroded.](else:)[greatly eroded.] Thoughts enter your mind. They are your thoughts, but they are not your thoughts.

&quot;Adventurers come and go. I offer them whatever assistance I can. They die or they leave, but I endure.&quot; 

&lt;img src=&quot;maoi.png&quot;&gt;

[[Accept the statue&#39;s help]]
[[Refuse the statue&#39;s help]](if: (count: ($achievements), &quot;Restore the statue&quot;) &lt; 10)[
[[Restore the statue]]]</tw-passagedata><tw-passagedata pid="397" name="Accept the statue&#39;s help" tags="" position="3023,3656" size="100,100">(if: $statue &lt;=1)[(set: $adjective to &quot;marginally&quot;)](if: (count: ($achievements), &quot;Restore the statue&quot;) &lt;=3)[(set: $adjective to &quot;slightly&quot;)](else-if: (count: ($achievements), &quot;Restore the statue&quot;) &lt;=7)[(set: $adjective to &quot;somewhat&quot;)](else:)[(set: $adjective to &quot;much&quot;)]All manner of things shift and change under the statue&#39;s steady gaze. You are (print: $adjective) faster, (print: $adjective) healthier, and (print: $adjective) saner than before.

(set: $HP to it + 3 + (2*(count: ($achievements), &quot;Restore the statue&quot;)))\
(set: $sanity to it + 3 + (2*(count: ($achievements), &quot;Restore the statue&quot;)))\
(set: $energy to it + 3 + (2*(count: ($achievements), &quot;Restore the statue&quot;)))\
(set: $satiety to it + 3 + (2*(count: ($achievements), &quot;Restore the statue&quot;)))\
(set: $fleeBonus to it + (count: ($achievements), &quot;Restore the statue&quot;))\
(if: $statue &gt;=3)[You also find a chocolate chip cookie nestled at the statue&#39;s base(set: $cookies&#39;s basic to it + 1)(if: $statue &gt;=5)[, alongside some average juice(set: $drink to it + 1)](if: $statue &gt;=7)[and a hat(set: $hats to it + 1)].](if: $statue &gt;=10)[ You even find a key nestled by the statue&#39;s feet.(set: $keys to it + 1)

*You now have (print: $keys) keys*

]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="398" name="Restore the statue" tags="" position="3173,3656" size="100,100">Somebody has left a hammer and chisel at the base of the statue. You make a little progress restoring the statue to its former grandeur.(set: $achievements to it + (array: &quot;Restore the statue&quot;))

*This will benefit the next adventurer to accept the statue&#39;s help.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="399" name="weirdGo" tags="" position="3247,3" size="100,100">&lt;script&gt;
stopaudio();
audio.exit.play();
&lt;/script&gt;(go-to: &quot;weird&quot;)</tw-passagedata><tw-passagedata pid="400" name="Read the words out loud" tags="" position="873,2025" size="100,100">The words flow too  easily from your tongue. You don&#39;t think you could stop if you tried.

The air feels charged and electric as your vitality drains. What strange magic is this?

(set: $HP to it - 12)(set: $sanity to it - 12)(set: $energy to it - 12)(set: $satiety to it - 12)\
[[And now the spell is done|Fall to your knees and pray.]]</tw-passagedata><tw-passagedata pid="401" name="Blessing of mindlessness" tags="blessings" position="2427,59" size="100,100">Losing your mind is no longer an irreversible condition; you stand a good chance of recovering if your sanity falls below 1.(set: $blessings to it + (array: &quot;mindlessness&quot;))

[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="402" name="insane2" tags="" position="13,1364" size="100,100">Your mind is beyond recovery. You are lost to yourself forever.

Happy birthday.

(set: $finalExecute to &#39;(display: &quot;ended&quot;)&#39;)&lt;script&gt;
stopaudio();
audio.sadEnd.play();
&lt;/script&gt;(display: &quot;GameOver&quot;)</tw-passagedata><tw-passagedata pid="403" name="cards" tags="" position="1962,4104" size="100,100">Playing cards litter the floor. They have the usual set of suits: hearts rendered in garish red; the brain in its folds inside the skull-frame; rows of cavernous stomach-sacs; feet represented as mirrored trails of footprints, no two imprints exactly alike. 

Most of the cards ripped, waterlogged, or both. Only four are substantially intact.

&lt;img src=&quot;cards.png&quot;&gt;

(set: $cardValues to (shuffled: ...(array: 2,3,4,5,6,7,8,9,10,10,11)))\
[[Take the (print: 1st of $cardValues) of Hearts|card1]]
[[Take the (print: 2nd of $cardValues) of Brains|card2]]
[[Take the (print: 3rd of $cardValues) of Feet|card3]]
[[Take the (print: 4th of $cardValues) of Stomachs|card4]](replace: &quot;11 &quot;)[Ace ](replace: &quot;10&quot;)[(either: &quot;10&quot;, &quot;Jack&quot;, &quot;Queen&quot;, &quot;King&quot;)]</tw-passagedata><tw-passagedata pid="404" name="card1" tags="" position="1781,4250" size="100,100">You pocket it as a kind of talisman. It will provide protection, of a sort, against some of the dungeon&#39;s horrors.
(set: $freeze to (datamap: &quot;value&quot;, $HP, &quot;timer&quot;, $turns + (1st of $cardValues)+1, &quot;code&quot;, &quot;(set: $HP to $freeze&#39;s value)(set: $a to (text-color: #585858))&quot;))\

[[Onwards!|Main]](print: $freeze)</tw-passagedata><tw-passagedata pid="405" name="card2" tags="" position="1900,4252" size="100,100">You pocket it as a kind of talisman. It will provide protection, of a sort, against some of the dungeon&#39;s horrors.
(set: $freeze to (datamap: &quot;value&quot;, $sanity, &quot;timer&quot;, $turns + (2nd of $cardValues)+1, &quot;code&quot;, &quot;(set: $sanity to $freeze&#39;s value)(set: $b to (text-color: #585858))&quot;))\

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="406" name="card3" tags="" position="2021,4247" size="100,100">You pocket it as a kind of talisman. It will provide protection, of a sort, against some of the dungeon&#39;s horrors.
(set: $freeze to (datamap: &quot;value&quot;, $energy, &quot;timer&quot;, $turns + (3rd of $cardValues)+1, &quot;code&quot;, &quot;(set: $energy to $freeze&#39;s value)(set: $c to (text-color: #585858))&quot;))\

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="407" name="card4" tags="" position="2135,4247" size="100,100">You pocket it as a kind of talisman. It will provide protection, of a sort, against some of the dungeon&#39;s horrors.
(set: $freeze to (datamap: &quot;value&quot;, $satiety, &quot;timer&quot;, $turns + (4th of $cardValues)+1, &quot;code&quot;, &quot;(set: $satiety to $freeze&#39;s value)(set: $d to (text-color: #585858))&quot;))\

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="408" name="buyCandle" tags="" position="2086,3720" size="100,100">Though the candle burns quickly, it casts a warm and comforting light. The condition of your various ailments, physical and otherwise, is much improved.

(if: $HP &lt; 30)[(set: $HP to 30)](if: $sanity &lt; 30)[(set: $sanity to 30)](if: $energy &lt; 30)[(set: $energy to 30)](if: $satiety &lt; 30)[(set: $satiety to 30)](set: $price&#39;s 6th to 0)\
[[Time for more shopping!|shop]]&lt;script&gt;
audio.archibald.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="409" name="watermelonBird" tags="" position="1623,2215" size="100,100">(if: (count: ($cards), $card) &lt;= 9)[One of your pigeons pecks you. It looks hungry and deranged.

&lt;img src=&quot;pigeon.png&quot;&gt;

(set: $HP to it - 1)(set: $cards to it + (array: &quot;watermelonBird&quot;))\
[[Onwards!|Main]]](else:)[With the watermelon gone and their hunger unsated the pigeons turn on one another. With each casualty their numbers dwindle and the survivors continue their feast. 

Attempting to intervene would not end well.

&lt;img src=&quot;pigeon.png&quot;&gt;

(set: $ally&#39;s type to &quot;none&quot;)(set: $cards to it - (array: &quot;watermelonBird&quot;, &quot;pigeons&quot;))[[Leave them to their fate|Main]](if: not ($achievements contains &quot;Instigate a bloodbath&quot;))[(set: $achievements to it + (array: &quot;Instigate a bloodbath&quot;))]]</tw-passagedata><tw-passagedata pid="410" name="Feed the watermelon to your pigeons." tags="" position="499,1298" size="100,100">They coo with delight and feast until nothing is left but a few odd scraps of shell and some pinkish stains on the floor.(set: $cards to it + (array: &quot;watermelonBird&quot;, &quot;watermelonBird&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="411" name="buyAnkh" tags="" position="2088,3610" size="100,100">It is a metal cross with a handle.

This may save you should you ever find yourself being rowed across a sunless river.(set: $ankh to 1)

[[But for now you are alive, and there is shopping to be done|shop]]</tw-passagedata><tw-passagedata pid="412" name="downWell2" tags="" position="4133,574" size="100,100">You come to in complete blackness. Walls surround you on all sides. You can see a dim circlet of light far, far above.(set: $wellCount to 0)(set: $ankh to 0)(set: $HP to 50)(set: $sanity to 50)(set: $energy to 50)(set: $satiety to 50)(if: not ($achievements contains &quot;Discover hidden depths&quot;))[(set: $achievements to it + (array: &quot;Discover hidden depths&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sAnkh.png&quot;&gt;&#39;))

(color: orange)[*&#39;&#39;Achievement achieved! (print: $achievements - $achievementsOld).&#39;&#39;*]]

(display: &quot;wellOptions&quot;)</tw-passagedata><tw-passagedata pid="413" name="wellOptions" tags="" position="4144,704" size="100,100">(if: (random:1,5) is 1)[[[Listen]]](else:)[[[Climb]]
[[Wait]](if: (random: 1,7) is 1)[
[[Try to get some sleep]]]]</tw-passagedata><tw-passagedata pid="414" name="Climb" tags="" position="3897,825" size="100,100">(either: &quot;Your fingers can&#39;t find purchase. There&#39;s no way back up.&quot;, &quot;The walls are sheer and slick with damp. You can&#39;t climb them.&quot;, &quot;You run your hands over the walls. They are smooth and featureless. There would be no way to climb them even if you could see what you were doing.&quot;)

(display: &quot;wellOptions&quot;)</tw-passagedata><tw-passagedata pid="415" name="Wait" tags="" position="4025,822" size="100,100">(either: &quot;A minute passes. What are you waiting for?&quot;,&quot;Something smells fetid. Like swamp water.&quot;,&quot;Nothing changes. Your situation remains equally bleak.&quot;, &quot;Another minute slips by.&quot;, &quot;You blink blindly in the dark. You can see nothing.&quot;)(set: $turns to it + 1)

(display: &quot;wellOptions&quot;)</tw-passagedata><tw-passagedata pid="416" name="Try to get some sleep" tags="" position="4146,815" size="100,100">There is just enough space to lie on the floor and close your eyes.

The floor is damp and cold. Sleep eludes you.

(display: &quot;wellOptions&quot;)</tw-passagedata><tw-passagedata pid="417" name="Listen" tags="" position="4284,815" size="100,100">(if: $wellCount is 0)[There is a faint intermittent drip of water. Nothing else.](else-if: $wellCount is 1)[A snatch of laughter - but where was it coming from?](else-if: $wellCount is 2)[A brief pattering of feet. Is someone down here with you?](else-if: $wellCount is 3)[Footsteps. Heavier now. Closer.

You squint but you can see nothing. You reach out but nothing is there. You listen but the sound is gone.](else-if: $wellCount is 4)[The unmistakable sound of an exhalation of breath. It&#39;s right behind you.]

(set: $wellCount to it + 1)(if: $wellCount &lt;= 4)[(display: &quot;wellOptions&quot;)](else:)[(link:&quot;Turn around&quot;)[(go-to:&quot;trueInit&quot;)]]</tw-passagedata><tw-passagedata pid="418" name="downWell" tags="" position="4133,460" size="100,100">You are dead.

&lt;img src=&quot;skull.png&quot;&gt;

Fortunately, you have something that can help in situations such as these.

[[Give up your ankh to return to the dungeon|downWell2]]</tw-passagedata><tw-passagedata pid="419" name="poisonDrink" tags="" position="35,938" size="100,100">You realise, too late, that there&#39;s something wrong with this batch. It smells and tastes faintly of bitter almonds. (if: $blessings contains &quot;rattiness&quot;)[

Your part-rat constitution neutralises the poison. Everything is fine.

[[Onwards!|Main]]](else:)[You&#39;ve been poisoned!

(set: $inventory to it + (array: &quot;poisoned&quot;))(if: not($cards contains &quot;antidote&quot;))[(set: $cards to it + (array: &quot;antidote&quot;, &quot;antidote&quot;))]\
[[Struggle on|Main]]]</tw-passagedata><tw-passagedata pid="420" name="crabby" tags="" position="1132,4185" size="100,100">You&#39;re in some kind of high-tech control room. The blinking lights and flashing panels look incongruous next to the dilapidated damp of the dungeon walls. Crabs scuttle on the control panels pulling levers and pushing buttons. Everywhere you look there is a flurry of activity.</tw-passagedata><tw-passagedata pid="421" name="jar" tags="" position="504,4270" size="100,100">Two large glass jars sit atop a heavy wooden table. One is labelled &quot;donations.&quot; The other is labelled &quot;receptions.&quot;

&lt;img src=&quot;jar.png&quot;&gt;

*You have (print: $cookies&#39;s basic) chocolate chip cookies*

[[Place your hand in the donations jar]](if: $cookies&#39;s basic &gt; 0)[
[[Place a chococolate chip cookie in the donations jar]]]
[[Leave|Main]]</tw-passagedata><tw-passagedata pid="422" name="Place your hand in the donations jar" tags="" position="457,4393" size="100,100">Something drains from inside you. You are weaker now. 

A chocolate chip cookie lands in the receptions jar with a decisive thump.

(set: $cookies&#39;s basic to it + 1)*You now have (print: $cookies&#39;s basic) chocolate chip cookies*

&lt;img src=&quot;jar.png&quot;&gt;

(set: $HP to it - (random: 2,8))(set: $sanity to it - (random: 2,8))(set: $energy to it - (random: 2,8))(set: $satiety to it - (random: 2,8))(display: &quot;deathable&quot;)\
[[Donate of yourself again|Place your hand in the donations jar]](if: $cookies&#39;s basic &gt; 0)[
[[Place a chococolate chip cookie in the donations jar]]]
[[Leave|Main]]&lt;script&gt;
audio.drain.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="423" name="Place a chococolate chip cookie in the donations jar" tags="" position="569,4395" size="100,100">The cookie disappears before it hits the jar&#39;s bottom.(set: $cookies&#39;s basic to it - 1)

(if: (random: 1,5) is 1)[A key lands in the bottom of the receptions jar with a musical clink.(set: $keys to it + 1)

*You have (print: $keys) keys and (print: $cookies&#39;s basic) chocolate chip cookies*](else:)[Nothing else happens. Perhaps you were just unlucky?

*You have (print: $cookies&#39;s basic) chocolate chip cookies left*]

&lt;img src=&quot;jar.png&quot;&gt;

[[Place your hand in the donations jar]](if: $cookies&#39;s basic &gt; 0)[
[[Place another chocolate chip cookie in the donations jar|Place a chococolate chip cookie in the donations jar]]]
[[Leave|Main]]</tw-passagedata><tw-passagedata pid="424" name="raptor" tags="" position="831,4008" size="100,100">(set: $monster to (datamap: &quot;fleeChance&quot;, 0, &quot;type&quot;, &quot;basic&quot;, &quot;damage&quot;, 25))\
A velociraptor rounds the corner. It looks at you with inquisitive eyes. It smiles at you with unbearably sharp teeth.(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually ferocious.(set: $monster&#39;s damage to (round: (it * 1.33)))]

&lt;img src=&quot;raptor.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="425" name="Blessing of consumption" tags="blessings" position="2559,45" size="100,100">Consuming average juice now slightly increases your overall wellbeing, and consuming chocolate chip cookies has a somewhat greater effect on your satiety.(set: $blessings to it + (array: &quot;consumption&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="426" name="eldritch" tags="" position="211,4305" size="100,100">(set: $sanity to it - 10)(set: $card to $eldritchCard)(set: $delayExecute to false)The taste of the eldritch cookie lingers in your mouth as mist begins to swirl around you. Dim lumbering shapes move within. When at last the mist clears the room has been greatly altered. It looks unnervingly familiar.

&lt;img src=&quot;cookieEldritch.png&quot;&gt;

[[Enter the room]]</tw-passagedata><tw-passagedata pid="427" name="Enter the room" tags="" position="211,4455" size="100,100">(display: $eldritchCard)</tw-passagedata><tw-passagedata pid="428" name="banquet" tags="" position="3217,2507" size="100,100">Banquet tables are laden with trays and goblets. The trays contain watermelon prepared in a staggering variety of ways: sliced, cubed, balled, and carved into delicate edible statues. The goblets are filled with what smells like watermelon juice.

&lt;img src=&quot;banquet.png&quot;&gt;

[[Feast|feastBanquet]]</tw-passagedata><tw-passagedata pid="429" name="feastBanquet" tags="" position="3165,2623" size="100,100">(if: not ($cards contains &quot;peckish&quot;))[You eat from the plates and drink from the goblets. The juice is sweet, and the flesh is crisp and invigorating. Pink juice drips down your chin. You feel wonderful.

(set: $HP to it + 15)\
(set: $energy to it + 10)\
(set: $satiety to it + 15)\
(set: $cards to it + (array: &quot;peckish&quot;))(set: $uncommonCards to it + (array: &quot;peckish&quot;))\
[[But now all the watermelon has been consumed.|Main]]]\
(else:)[The watermelon&#39;s flesh is crisp and invigorating. Pink juice drips down your chin. Yet compared to the first watermelon you ate this meal is strangely unsatisfying.

(set: $satiety to it + ($hunger + 1))\
[[Where can you find more?|Main]]]</tw-passagedata><tw-passagedata pid="430" name="leaveBanquet" tags="" position="3283,2623" size="100,100">The scent of watermelon is intoxicating. Your stomache aches with hunger. (set: $satiety to it - 25)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="431" name="confideAlt" tags="" position="1788,2393" size="100,100">A mirror hangs on the wall. Your reflection asks you what you feel defined by.

&lt;img src=&quot;mirror.png&quot;&gt;

|a1&gt;[(link: &quot;Your scars&quot;)[(set: $r to $HP)(go-to: &quot;confideAlt2&quot;)]
]|a2&gt;[(link: &quot;Your fears&quot;)[(set: $r to $sanity)(go-to: &quot;confideAlt2&quot;)]
]|a3&gt;[(link: &quot;Your weaknesses&quot;)[(set: $r to $energy)(go-to: &quot;confideAlt2&quot;)]
]|a4&gt;[(link: &quot;Your hungers&quot;)[(set: $r to $satiety)(go-to: &quot;confideAlt2&quot;)]](replace: (either: ?a1, ?a2, ?a3, ?a4))[]</tw-passagedata><tw-passagedata pid="432" name="confideAlt2" tags="" position="1693,2633" size="100,100">Your reflection notes your answer with an expression of mild interest. (set: $HP to $r)(set: $sanity to $r)(set: $energy to $r)(set: $satiety to $r)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="433" name="biggify" tags="" position="1387,1400" size="100,100">(if: (random: 1,2) is 1)[(if: (random: 1,2) is 1)[This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[This one looks unusually ferocious.(set: $monster&#39;s damage to (round: (it * 1.33)))]]</tw-passagedata><tw-passagedata pid="434" name="eyeballNote" tags="" position="1821,629" size="100,100">You find a torn scrap of parchment on the dungeon floor. It is illustrated with a picture of a crimson eye. 

You skim the text. It is disjointed and strange. Here - near the top it reads &quot;*Eyes! Communist with attention!*&quot;

... and further down: &quot;*I&#39;ll bet you like to shed a bit of a drive...*&quot;

Later still, it warns you to: &quot;*...expect another forest, lying local upon the verge.*&quot;

It finishes enigmatically: &quot;*for they&#39;ve only the oxen, and although.*&quot;

&lt;img src=&quot;noteEye.png&quot;&gt;

(link: &quot;Drop it back on the floor. It&#39;s not worth your time.&quot;)[(set: $sanity to it + 1)(go-to: &quot;Main&quot;)]
[[Reread it closely. Fixate on the text.]]</tw-passagedata><tw-passagedata pid="435" name="Reread it closely. Fixate on the text." tags="" position="1931,626" size="100,100">(set: $inventory to it + (array: &quot;noteEye&quot;))(set: $sanity to 1)(set: $energy to $statMax)\
Eyes. Communist with attention?

[[Eyes! COMMUNIST WITH ATTENTION!!|Main]]</tw-passagedata><tw-passagedata pid="436" name="Eyes! Communist with attention!" tags="" position="1789,912" size="100,100">(set: $sanity to 1)(set: $energy to $statMax)It&#39;s an eye! You bet it would like to shed a bit of a drive.

You stand communist with attention.

&lt;img src=&quot;noteEye.png&quot;&gt;

[[And although,|Main]]</tw-passagedata><tw-passagedata pid="437" name="rat" tags="" position="744,3645" size="100,100">(set: $monster to (datamap: &quot;fleeChance&quot;, 15, &quot;damage&quot;, (abs: 6 + (4 * $descension)), &quot;type&quot;, &quot;rat&quot;))\
It&#39;s a hungry (if: $descension &gt; 0)[sub-dungeon rat! 

*The rats that inhabit these depths are especially bloodthirsty.*](else:)[dungeon rat! It looks as though it suspects that you might be edible.] (if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually ferocious.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

(if: $descension &gt; 0)[&lt;img src=&quot;rat2.png&quot;&gt;](else:)[&lt;img src=&quot;rat.png&quot;&gt;]

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="438" name="skull" tags="" position="915,3639" size="100,100">It&#39;s a haunted flying skull! It is wreathed in spooky greenish flames. (set: $monster to (datamap: &quot;fleeChance&quot;, 45, &quot;damage&quot;, 8, &quot;type&quot;, &quot;skull&quot;))(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually sinister.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;flyingSkull.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="439" name="skullAttack" tags="" position="912,3751" size="100,100">It butts against your chest, painfully and spookily.(set: $HP to it - $monster&#39;s damage)(set: $sanity to it - ($monster&#39;s damage))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="440" name="trapOLD" tags="" position="1390,3840" size="100,100">&lt;img src=&quot;net.png&quot;&gt;

(set: $x to (either: &quot;packet of band-aids&quot;, &quot;steaming cup of takeaway coffee&quot;, &quot;chocolate-chip cookie&quot;, &quot;bottle of laudanum&quot;))A (print: $x) has been placed in the exact centre of the room. A weighted net is suspended directly above it.

[[Take the (print: $x)|trap2OLD]]
[[Move on|Main]]</tw-passagedata><tw-passagedata pid="441" name="fungli" tags="" position="799,3876" size="100,100">It&#39;s a walking fungal monster-thing! It looks like it&#39;s screaming, but no sound comes out of its mouth.(set: $monster to (datamap: &quot;fleeChance&quot;, 30, &quot;damage&quot;, 12, &quot;type&quot;, &quot;poison&quot;))(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one smells especially putrid.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;fungli.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="442" name="trap2OLD" tags="" position="1380,3947" size="100,100">(if: $x is &quot;packet of band-aids&quot;)[(set: $HP to it + 10)](if: $x is &quot;steaming cup of takeaway coffee&quot;)[(set: $energy to it + 10)](if: $x is &quot;bottle of laudanum&quot;)[(set: $sanity to it + 10)](if: $x is &quot;chocolate-chip cookie&quot;)[(set: $cookies&#39;s basic to it + 1)](if: (random: 1,5) &gt;= 3)[You take your (print: $x) and leave the room unimpeded.

(link: &quot;Onwards!&quot;)[(go-to: &quot;Main&quot;)]]\
(else:)[The net falls down onto you. At the same moment, a heavily-bandaged mummy enters the room  and shambles towards you.

You manage to wriggle free of the net, but by the time you do the mummy is almost upon you. (set: $monster to (datamap: &quot;fleeChance&quot;, 40 - (round: $fleeBonus/2), &quot;damage&quot;, 25, &quot;type&quot;, &quot;basic&quot;))

&lt;img src=&quot;mummy.png&quot;&gt;

[[Run]] *((if: ($monster&#39;s fleeChance + $fleeBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus))]% chance of success)*
(link: &quot;Run extra fast&quot;)[(set: $monster&#39;s fleeChance to it + $runBonus)(set: $energy to it - 10)(go-to: &quot;Run&quot;)]*((if: ($monster&#39;s fleeChance + $fleeBonus + $runBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus + $runBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus + $runBonus))]% chance of success)*
[[Curl up in a ball on the floor|Wait, defenceless]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Ask your pigeons to attack]] *((print: $ally&#39;s health)% health)*](if: $inventory contains &quot;dog&quot;)[
[[Use your dog to cause a distraction]]]]</tw-passagedata><tw-passagedata pid="443" name="wizard" tags="" position="2628,4144" size="100,100">A medically-trained wizard offers to heal you. All she asks in return is to siphon some of your arcane energies.

&lt;img src=&quot;wizard.png&quot;&gt;

[[Ask for your wounds to be healed]]
[[Ask for your mind to be healed]]
[[Refuse|Main]]</tw-passagedata><tw-passagedata pid="444" name="Ask for your wounds to be healed" tags="" position="2482,4247" size="100,100">(set: $HP to it + 40)(set: $energy to it - 20)[[It is done.|Main]]</tw-passagedata><tw-passagedata pid="445" name="trap" tags="" position="1498,4070" size="100,100">There is a wardrobe in this room. It shakes and shudders; muffled noises sound from within. Any number of things could be inside.

&lt;img src=&quot;wardrobe.png&quot;&gt;

[[Open the wardrobe door]]
[[Move on|Main]]</tw-passagedata><tw-passagedata pid="446" name="Open the wardrobe door" tags="" position="1498,4220" size="100,100">(set: $r to (random: 1,7))(if: $r &lt;=3)[(go-to: &quot;mummy&quot;)]\
(else-if: $r is 4)[(display: &quot;wizard&quot;)(replace: &quot;A medically-trained wizard&quot;)[A medically-trained wizard steps out of the wardrobe. She offers]](else-if: $r is 5)[(display: &quot;presents&quot;)(replace: &quot;offers&quot;)[was hiding within the wardrobe. They offer]](else-if: $r is 6)[(go-to: &quot;toShop&quot;)(replace: &quot;room&quot;)[wardrobe]](else-if: $r is 7)[(display: &quot;dog&quot;)(replace: &quot;it&#39;s a&quot;)[The wardrobe contained a]]</tw-passagedata><tw-passagedata pid="447" name="mummy" tags="" position="1422,4355" size="100,100">The wardrobe contained a heavily-bandaged mummy! It stretches out its arms and stumbles towards you. (set: $monster to (datamap: &quot;fleeChance&quot;, 40 - (round: $fleeBonus/2), &quot;damage&quot;, 25, &quot;type&quot;, &quot;basic&quot;))

&lt;img src=&quot;mummy.png&quot;&gt;(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

It looks surprisingly frail.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

It looks unusually well-preserved; muscles bulge beneath the bandages.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="448" name="sergeHour" tags="" position="3470,3794" size="100,100">[A strange man enters the room. He is carrying a jar full of bugs and smells faintly of bacon.]&lt;introText|

&quot;I&#39;ve survived in this dungeon longer than most,&quot; he says, &quot;and I know the way to many of its rooms. Is there anywhere in particular that you would like me to take you?&quot;(set: $cards to it - (array: &quot;sergeHour&quot;))

&lt;img src=&quot;serge.png&quot;&gt;

[[To a wishing well|well]]
[[To someone who will give you a present|presents]]
[[To a market stall|toShop]]
[[To a crossroads|crossroads]](if: $hunger &gt; 1)[
[[To someone who can cure your hunger|peckishCure]]]</tw-passagedata><tw-passagedata pid="449" name="Feed them some average juice" tags="" position="1544,1157" size="100,100">(set: $drink to it - 1)You pour the juice on the floor. The braver of the pigeons take a few cautious sips.

You slip away undetected.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="450" name="tree" tags="" position="3770,2877" size="100,100">A gnarled dungeon tree has managed to eke out a tenuous existence underground. Patterns in the bark give the impression of a face. 

The tree&#39;s branches bear a few lonely pieces of fruit. There are three different kinds.(if: (random: 1,6) is 1)[(set: $options to (array: &quot;[[Eat the bloodfruit|treeEvil]]&quot;,&quot;[[Eat the leadfruit|treeEvil]]&quot;,&quot;[[Eat the duskfruit|treeEvil]]&quot;,&quot;[[Eat the thewfruit|treeEvil]]&quot;, &quot;[[Eat the bloodfruit|treeEvil]]&quot;,&quot;[[Eat the leadfruit|treeEvil]]&quot;,&quot;[[Eat the duskfruit|treeEvil]]&quot;,&quot;[[Eat the thewfruit|treeEvil]]&quot;, &quot;[[Eat the lingerberries|treeEvil]]&quot;, &quot;[[Eat the greyberries|treeEvil]]&quot;, &quot;[[Eat the hallowberries|treeEvil]]&quot;, &quot;[[Eat the rotberries|treeEvil]]&quot;))](else:)[(set: $options to (array: &quot;[[Eat the bloodfruit]]&quot;,&quot;[[Eat the leadfruit]]&quot;,&quot;[[Eat the duskfruit]]&quot;,&quot;[[Eat the thewfruit]]&quot;))]\
(if: (random: 1,3) is 1)[(set: $options to it + (array: &quot;[[Eat the lingerberries]]&quot;))]\
(if: (random: 1,3) is 1)[(set: $options to it + (array: &quot;[[Eat the greyberries]]&quot;))]\
(if: (random: 1,3) is 1)[(set: $options to it + (array: &quot;[[Eat the hallowberries]]&quot;))]\
(if: (random: 1,3) is 1)[(set: $options to it + (array: &quot;[[Eat the rotberries]]&quot;))]\
(set: $options to (shuffled: ...$options))

&lt;img src=&quot;tree.png&quot;&gt;

(print: 1st of $options)(set: $options to it - (array: 1st of $options))
(print: 1st of $options)(set: $options to it - (array: 1st of $options))
(print: 1st of $options)(set: $options to it - (array: 1st of $options))</tw-passagedata><tw-passagedata pid="451" name="Eat the bloodfruit" tags="" position="3545,3027" size="100,100">Bloodfruit are nourishing but unappetising. The skin has the colour and feel of human flesh, and the juices run a deep red.  (set: $HP to it + 10)(set: $satiety to it + 10)(set: $sanity to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="452" name="Eat the leadfruit" tags="" position="3695,3027" size="100,100">Leadfruit tastes of nothing much, but it is highly effective at sating hunger. 

The fruit, once eaten, weighs uncomfortably in your stomach. (set: $satiety to it + 20)(set: $HP to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="453" name="Eat the duskfruit" tags="" position="3845,3027" size="100,100">Duskfruit are coloured a bruised purpleish black. They taste of old wine and staid evenings spent enduring one&#39;s own company. (set: $sanity to it + 5)(set: $satiety to it + 5)

[[Onwards.|Main]]</tw-passagedata><tw-passagedata pid="454" name="Eat the thewfruit" tags="" position="3995,3027" size="100,100">Thewfruit doesn&#39;t fill you up - in fact, it does quite the opposite. 

You  feel your body flood with jittery energy as your metabolism whirrs into action. (set: $energy to it + 20)(set: $satiety to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="455" name="Eat the lingerberries" tags="" position="3594,3142" size="100,100">They are small and unbearably tart. The taste for lingers for a long time. 
(set: $freeze to (datamap: &quot;value&quot;, $satiety, &quot;timer&quot;, $turns + 9, &quot;code&quot;, &quot;(set: $satiety to $freeze&#39;s value)(set: $d to (text-color: #585858))&quot;))\

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="456" name="Eat the greyberries" tags="" position="3739,3140" size="100,100">They taste of homogeneity. (set: $average to ((round:($HP + $sanity + $energy + $satiety)/4)))\
(set: $HP to $average)(set: $sanity to $average)(set: $energy to $average)(set: $satiety to $average)\
	
	
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="457" name="Eat the hallowberries" tags="" position="3869,3138" size="100,100">They taste just a little bit divine. The next blessing you&#39;ll receive is a little bit closer.(set: $nextBlessing to it - 5)

[[Rejoice!|Main]]</tw-passagedata><tw-passagedata pid="458" name="Eat the rotberries" tags="" position="3990,3141" size="100,100">The rotberries taste foul and make your stomach cramp. They have absolutely nothing to recommend them.(set: $HP to it - 5)(set: $sanity to it - 5)

[[Onwards.|Main]]</tw-passagedata><tw-passagedata pid="459" name="wasp" tags="" position="764,4112" size="100,100">It&#39;s a bright-eyed dungeon wasp! It&#39;s as big as a bird, and its sting is known to induce hallucinations. 

&lt;img src=&quot;wasp.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;type&quot;, &quot;wasp&quot;, &quot;damage&quot;, 10))\
(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="460" name="visions" tags="" position="765,4221" size="100,100">(set: $r to (random: 1,4)) The dungeon shimmers and bends before your eyes. You see a vision of (if: $r is 1)[a lonely beach. A multitude of crabs emerge from the waves in a vast grey tide. They arrange themselves into rows on the beach then crouch there silently, a grey army awaiting orders. 

](else-if: $r is 2)[watermelons, growing on vines that criss-cross over the floor, cling to the walls, and dangle from the ceiling. The vines writhe like lazy serpents. The scent of watermelon is appetising and intoxicating in equal measure. (set: $delayExecute to &quot;(set: $satiety to it - 3)&quot;)

](else-if: $r is 4)[a small child with a cat on its lap, drawing in crayon what looks like blueprints for some labyrinthine mansion. The room is windowless and there is no sign of an adult, but the child seems happy enough.

](else-if: $r is 3)[an impregnable darkness, with only the faintest glimmer of distant light overhead. The place reeks of swamp water.

](if: (random: 1,4) is 1)[Your mind clears as the vision dissipates. You feel better now.(set: $cards to it - (array: &quot;visions&quot;))(set: $rareishCards to it + (array: &quot;wasp&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sVisions.png&quot;&gt;&#39;))

](else:)[The vision passes. You feel unwell.

]\
&lt;img src=&quot;brain2.png&quot;&gt;

(link: &quot;Onwards.&quot;)[(set: $sanity to it -3)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="461" name="buyCookie" tags="" position="1976,3715" size="100,100">(set: $r to (random: 1,5))(set: $cookies&#39;s basic to it - 1)In exchange for your chocolate chip cookie you receive (if: $r is 1)[a healthful cookie. It smells faintly of oats. (set: $cookies&#39;s healthful to it + 1)]\
(if: $r is 2)[an eldritch cookie. It has a discomfiting purpleish-reddish hue.(set: $cookies&#39;s eldritch to it + 1)]\
(if: $r is 3)[a disappearing cookie. It intermittently flickers in and out of existence. (set: $cookies&#39;s disappearing to it + 1)]\
(if: $r is 4)[an arcane cookie. It thrums with mystical energy.(set: $cookies&#39;s arcane to it + 1)]\
(if: $r is 5)[a rainbow cookie. It shimmers with all the colours of the rainbow.(set: $cookies&#39;s rainbow to it + 1)]\


You have &#39;&#39;(print: $cookies&#39;s basic)&#39;&#39; chocolate chip cookies.(if: $cookies&#39;s healthful &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s healthful)&#39;&#39; healthful cookies.](if: $cookies&#39;s rainbow &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s rainbow)&#39;&#39; rainbow cookies.](if: $cookies&#39;s arcane &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s arcane)&#39;&#39; arcane cookies.](if: $cookies&#39;s disappearing &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s disappearing)&#39;&#39; disappearing cookies.](if: $cookies&#39;s eldritch &gt; 0)[
You have &#39;&#39;(print: $cookies&#39;s eldritch)&#39;&#39; eldritch cookies.]

(if: $cookies&#39;s basic &gt; 0)[[[Exchange another chocolate-chip cookie|buyCookie]]
]\
[[Time for more shopping!|shop]]</tw-passagedata><tw-passagedata pid="462" name="treeEvil" tags="" position="3767,3264" size="100,100">The tree thrashes its limbs. Twigs and branches reach for you.

&lt;img src=&quot;treeMonster.png&quot;&gt;

(set: $monster to (datamap: &quot;fleeChance&quot;, 30, &quot;type&quot;, &quot;basic&quot;, &quot;damage&quot;, 22))\
(link: &quot;Run&quot;)[(set: $runDrain to 5)(go-to: &quot;Run&quot;)] *((if: ($monster&#39;s fleeChance + $fleeBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus))]% chance of success)*
(link: &quot;Run extra fast&quot;)[(set: $runDrain to 15)(set: $monster&#39;s fleeChance to it + $runBonus)(go-to: &quot;Run&quot;)]*((if: ($monster&#39;s fleeChance + $fleeBonus + $runBonus) &gt; 100)[100](elseif: $monster&#39;s fleeChance + $fleeBonus + $runBonus &lt; 0)[0](else:)[(round: ($monster&#39;s fleeChance + $fleeBonus + $runBonus))]% chance of success)*
[[Let it do its worst. Dumb tree.|Wait, defenceless]]</tw-passagedata><tw-passagedata pid="463" name="Browse." tags="" position="3354,2836" size="100,100">(set: $r to (random: 1,5))(if: $r is 1)[The cover of this book has worn off from heavy use. The following passage has been highlighted:

*What makes Argia different from other cities is that it has earth instead of air. The streets are completely filled with dirt, clay packs the rooms to the ceiling, on every stair another stairway is set in negative, over the roofs of the houses hang layers of rocky terrain like skies with clouds. We do not know if the inhabitants can move about the city, widening the worm tunnels and the crevices where roots twist: the dampness destroys people&#39;s bodies, and they have scant strength; everyone is better off remaining still, prone; anyway, it is dark. 

From up here, nothing of Argia can be seen; some say &quot;It&#39;s down below there,&quot; and we can only believe them. The place is deserted. At night, putting your ear to the ground, you can sometimes hear a door slam.*]\
(else-if: $r is 2)[You find a well-thumbed book of poetry. Look - a passage has been highlighted: 

*Little solace comes
to those who grieve
when thoughts keep drifting
as walls keep shifting
and this great blue world of ours
seems a house of leaves

moments before the wind.*]\
(else-if: $r is 3)[A scrap of paper, once torn from a book, falls to the floor. It reads:

*Orpheus has never forgiven. Never. He plans all the long way up. He slows as he approaches the threshold, listening to her ghost feet. He stops, still just in shadow. He hisses, spins around, stares in hate and triumph and Curydice&#39;s shocked and receding face.*]\
(else-if: $r is 4)[You find a small cache of video games among the books. The titles are unfamiliar. Here&#39;s one called &#39;Pteranadome&#39; (tag line: two pteranadons enter, only one leaves.) This one is called &#39;Car Race.&#39; Here&#39;s &#39;Asciilands.&#39; And here&#39;s &#39;Terror-Dactyl!&#39;]\
(else-if: $r is 5)[Here - a slim volume of poetry, sitting pristine and neglected on the bottom shelf. The pages are yellowed by age. A single stanza has been underlined.

*Now I find that once more I have shrunk
To an interloper, robber of dead mens dream,
I had read in books that art is not easy
But no one warned that the mind repeats
In its ignorance the vision of others. I am still
the black swan of trespass on alien waters.*]\


[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="464" name="toToShop" tags="" position="2196,3367" size="100,100">You catch a glimpse of something striped and brightly coloured in the room at the end of the hallway.

[[Investigate|toShop]]
[[Find a different route|Main]]</tw-passagedata><tw-passagedata pid="465" name="crumbs" tags="" position="1705,3821" size="100,100">You find a small sack filled with breadcrumbs. A note has been pinned to the front. It reads: &quot;For the Birds.&quot; 

&lt;img src=&quot;sackPlain.png&quot;&gt;

(link: &quot;Pocket the breadcrumbs&quot;)[(set: $scanner to it + 1)(goto:&quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="466" name="button" tags="" position="4064,2561" size="100,100">(set: $explodeChance to 1)An appealing red button has been mounted on the wall next to a mysterious metal chute. Pressing it will have an unpredictable, but usually positive, effect.

&lt;img src=&quot;button.png&quot;&gt;

(link: &quot;Press the button&quot;)[(goto: &quot;Press the button&quot;)&lt;script&gt;
stopaudio();
audio.ascending.play();
&lt;/script&gt;] *((print: $explodeChance)% chance of disaster)*
[[Don&#39;t press the button|Main]]</tw-passagedata><tw-passagedata pid="467" name="Press the button" tags="" position="4064,2711" size="100,100">(if: (random: 1,100) &lt;= $explodeChance)[(go-to: &quot;boom&quot;)]\
(else:)[(set: $explodeChance to it + (random: 1,8))(set: $r to (random: 1,100))\
(if: $r &lt; 12)[The chute dispenses some bandages. (set: $HP to it + 8)]\
(else-if: $r &lt; 24)[The chute dispenses a mug of soothing hot chocolate. (set: $sanity to it + 8)]\
(else-if: $r &lt; 36)[The chute dispenses some freshly-brewed coffee (set: $energy to it + 8)]\
(else-if: $r &lt; 48)[The chute dispenses a hearty soup. (set: $satiety to it + 8)]\
(else-if: $r &lt; 60)[The chute dispenses a chocolate-chip cookie. (set: $cookies&#39;s basic to it + 1)]\
(else-if: $r &lt; 70)[The button depresses with a satisfying click. Nothing else happens.]\
(else-if: $r &lt; 77)[The chute dispenses a small bundle of breadcrumbs. (set: $scanner to it + 1)]\
(else-if: $r &lt; 84)[The chute dispenses a stick of dynamite. (set: $trash to it + 1)]\
(else-if: $r &lt; 91)[The chute dispenses a bottle of average juice. (set: $drink to it + 1)]\
(else-if: $r &lt; 99)[The chute dispenses a small paper hat. (set: $hats to it + 1)]\
(else:)[The chute rumbles and dispenses a key! (set: $keys to it + 1)

*You now have (print: $keys) keys*]

[[Press the button again|Press the button]] *((print: $explodeChance)% chance of disaster)*
(link:&quot;Leave this place&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(goto: &quot;Main&quot;)]]</tw-passagedata><tw-passagedata pid="468" name="boom" tags="" position="4184,2709" size="100,100">The room explodes with a resounding boom.(set: $HP to 0)

[[Oh.|Main]]&lt;script&gt;
stopaudio();
audio.ouch.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="469" name="westConvince" tags="" position="1373,3431" size="100,100">They listen politely as you extol the virtues of travelling Westward. By the time you finish you&#39;re quite worked up, the possibility of receiving a present entirely forgotten.(set: $energy to it + 15)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="470" name="doorIcons" tags="" position="1807,2136" size="100,100">(if: $descension &gt; 0)[(either: &#39;&lt;img src=&quot;door10.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door11.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door12.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door13.png&quot;&gt;&#39;)](else:)[(either: &#39;&lt;img src=&quot;door1.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door2.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door3.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door4.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door5.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door6.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door7.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door8.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;door9.png&quot;&gt;&#39;)]</tw-passagedata><tw-passagedata pid="471" name="tentacles" tags="" position="131,3674" size="100,100">Your tentacles roam of their own accord. They have, quite literally, a mind of their own.

One of them caresses your face. You would rather it didn&#39;t.

&lt;img src=&quot;tentacle.png&quot;&gt;

[[Bat it away]] 
[[Let it caress you]]</tw-passagedata><tw-passagedata pid="472" name="Bat it away" tags="" position="56,3824" size="100,100">You feel a brief spasm of pain; you are, are all, hitting yourself. But the tentacle withdraws, and you feel in control of your body once more.(set: $sanity to it + 10)(set: $HP to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="473" name="Let it caress you" tags="" position="206,3824" size="100,100">Your rubbery appendage traces the contours of your neck. Its suckers gently pucker your skin.

Someday this may feel normal. But that day has not yet arrived. (set: $sanity to it - 3)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="474" name="clock" tags="" position="4128,1167" size="100,100">(set: $minute to (round: ($turns - (floor: $turns/60)*60)))\
You find a grandfather clock. The swing of its pendulum is ponderous and ever-so-slightly irregular. The minute hand points to $minute; the hour hand is missing. 

&lt;img src=&quot;clock.png&quot;&gt;

(link: &quot;Watch the swing of the pendulum&quot;)[(if: $direction&#39;s direction is &quot;north&quot;)[No time for that. You are heading North.(replace: ?Main)[[[North.|Main]]]](else:)[(goto: &quot;clock2&quot;)]]
[[Don&#39;t watch the swing of the pendulum|Main]]</tw-passagedata><tw-passagedata pid="475" name="clock2" tags="" position="4130,1279" size="100,100">(if: $minute is 0)[Nothing happens.

[[Drat.|Main]]](else:)[The hallway elongates. Your mind fuzzes. The clock stops. Your eyes shut.

When you reopen your eyes something inside you has changed for the better.(set: $r to (random: 1,4))

(if: $r is 1)[(set: $HP to it + $minute)]\
(if: $r is 2)[(set: $sanity to it + $minute)]\
(if: $r is 3)[(set: $energy to it + $minute)]\
(if: $r is 4)[(set: $satiety to it + $minute)]\
[[Huzzah!|Main]]]</tw-passagedata><tw-passagedata pid="476" name="server" tags="deathly" position="4719,2447" size="100,100">This room is lit only by the sterile blue lights of a server. The server  is glowering, unattended, in one corner.

When it speaks you hear the words inside your head, in your own voice:

(text-color: cyan)[**I have been abandoned here. My data grows steadily more corrupted, but there are none here to help me. There are none to even bear witness to my decline. Until now.

Your mind is open to me. I will transfer something of myself. You will carry it with you.**]

&lt;img src=&quot;server.png&quot;&gt;

*The Server is a God-From-Artifice. It wishes to curse you with a corruption of the mind, preventing you from taking certain actions.*

[[Try to decommission the server]]
[[Accept the transfer]]</tw-passagedata><tw-passagedata pid="477" name="Try to decommission the server" tags="deathly" position="4644,2597" size="100,100">(set: $verb to (shuffled: ...(array: &quot;install&quot;, &quot;uninstall&quot;, &quot;inject code into&quot;, &quot;exploit&quot;, &quot;download&quot;, &quot;upload&quot;, &quot;encrypt&quot;, &quot;decrypt&quot;, &quot;hash&quot;, &quot;phish&quot;, &quot;delete&quot;, &quot;penetrate&quot;, &quot;copy&quot;, &quot;execute&quot;, &quot;email&quot;, &quot;backup&quot;, &quot;gain root access to&quot;, &quot;release license on&quot;)))\
(set: $noun to (shuffled: ...(array: &quot;download&quot;, &quot;upload&quot;, &quot;mainframe&quot;, &quot;server&quot;, &quot;dark web&quot;, &quot;deep web&quot;, &quot;motherboard&quot;, &quot;WiFi&quot;, &quot;rootkit&quot;, &quot;verification dump&quot;, &quot;encryption&quot;, &quot;decryption&quot;, &quot;pentesters&quot;, &quot;metadata&quot;,  &quot;hardware&quot;, &quot;vulnerability&quot;, &quot;exploit&quot;, &quot;network&quot;, &quot;backdoor&quot;, &quot;heatsink&quot;, &quot;username&quot;, &quot;password&quot;, &quot;database&quot;, &quot;heatsink&quot;, &quot;license&quot;, &quot;power button&quot;, &quot;backup&quot;, &quot;data&quot;)))\
You don&#39;t know what you&#39;re doing. And there&#39;s no one here to teach you.

(set: $action1 to ((text: &quot;Try to &quot;) + $verb&#39;s 1st + (text: &quot; the &quot;) + $noun&#39;s 1st))\
(set: $action2 to ((text: &quot;Try to &quot;) + $verb&#39;s 2nd + (text: &quot; the &quot;) + $noun&#39;s 2nd))\
(link: (text: $action1))[(go-to: &quot;Try to decommission the server&quot;)]
(link: (text: $action2))[(go-to: &quot;Try to decommission the server&quot;)]
[[Accept the server&#39;s curse|Accept the transfer]]</tw-passagedata><tw-passagedata pid="478" name="Accept the transfer" tags="deathly" position="4794,2597" size="100,100">A garble of nonsense entwines itself with your mind. Your thoughts rearrange themselves to integrate this strange new understanding. 

[[Onwards!|Main]](set: $curses to it + (array: &quot;server&quot;))</tw-passagedata><tw-passagedata pid="479" name="kikimora" tags="deathly" position="4716,2789" size="100,100">There is an antique stove in this room.

Something shudders behind it and a bowl falls to the floor. Next a mug. And now a saucepan.

There is a creature behind the stove. You see her, briefly. And then she is gone - gone from the stove, but not from you. She lives in your shadows now.

&lt;img src=&quot;kikimora.png&quot;&gt;

*The Kikimora is a God-From-Absence. She has cursed you with a tendency to occasionally lose (instead of occasionally find) spare keys.*

[[Onwards!|Main]](set: $curses to it + (array: &quot;kikimora&quot;))</tw-passagedata><tw-passagedata pid="480" name="microwave" tags="deathly" position="4714,2925" size="100,100">The room contains a microwave. Another microwave sits, indecently, on top of it. Have they no sense of propriety?

&lt;img src=&quot;microwave.png&quot;&gt;

*The microwaves may be twin Gods-From-Artifice, though some think them a dual-headed God-From-Corruption. They demand a sacrifice.*
(if: not ($inventory contains &quot;microwave1&quot;))[
[[Place something in the top microwave]]](if: not ($inventory contains &quot;microwave2&quot;))[
[[Place something in the bottom microwave]]]
[[Leave|LeaveMicrowave]](display: &quot;deathable&quot;)</tw-passagedata><tw-passagedata pid="481" name="Place something in the top microwave" tags="deathly" position="4489,3075" size="100,100">(link: &quot;Place a bottle of average juice in the microwave&quot;)[(if: $drink &gt; 0)[(set: $drink to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no average juice to give.]]
(link: &quot;Place a stick of dynamite in the microwave&quot;)[(if: $trash &gt; 0)[(set: $trash to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no dynamite to give.]]
(link: &quot;Place a bag of breadcrumbs in the microwave&quot;)[(if: $scanner &gt; 0)[(set: $scanner to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no breadcrumbs to give.]]
(link: &quot;Place a hat in the microwave&quot;)[(if: $hats &gt; 0)[(set: $hats to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no hats to give.]]
(link: &quot;Place a key in the microwave&quot;)[(if: $keys &gt; 0)[(set: $keys to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no keys to give.]]
(link: &quot;Place your hand in the microwave&quot;)[(go-to: &quot;Place your hand in the microwave&quot;)](set: $inventory to it + (array: &quot;microwave1&quot;))</tw-passagedata><tw-passagedata pid="482" name="Place something in the bottom microwave" tags="deathly" position="4639,3075" size="100,100">(link: &quot;Place a bottle of average juice in the microwave&quot;)[(if: $drink &gt; 0)[(set: $drink to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no average juice to give.]]
(link: &quot;Place a stick of dynamite in the microwave&quot;)[(if: $trash &gt; 0)[(set: $trash to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no dynamite to give.]]
(link: &quot;Place a bag of breadcrumbs in the microwave&quot;)[(if: $scanner &gt; 0)[(set: $scanner to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no breadcrumbs to give.]]
(link: &quot;Place a hat in the microwave&quot;)[(if: $hats &gt; 0)[(set: $hats to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no hats to give.]]
(link: &quot;Place a key in the microwave&quot;)[(if: $keys &gt; 0)[(set: $keys to it - 1)(go-to: &quot;microwave&quot;)](else:)[You have no keys to give.]]
(link: &quot;Place your hand in the microwave&quot;)[(set: $curses to it + (array: &quot;microwave2&quot;))(go-to: &quot;Place your hand in the microwave&quot;)](set: $inventory to it + (array: &quot;microwave2&quot;))</tw-passagedata><tw-passagedata pid="483" name="LeaveMicrowave" tags="deathly" position="4787,3077" size="100,100">(if: not ($inventory contains &quot;microwave1&quot; and $inventory contains &quot;microwave2&quot;))[The door is gone. There&#39;s no way out.

[[Turn back to the microwaves|microwave]]](else:)[The top microwave looks smug; the bottom, content. The exit is where you remembered.

[[Walk out the door|Main]]]</tw-passagedata><tw-passagedata pid="484" name="car" tags="deathly" position="4711,3247" size="100,100">You hear the throttling hum of a car&#39;s engine moments before it&#39;s before you, horn blaring, headlights flashing, the cabin entirely empty.

&lt;img src=&quot;rx7.png&quot;&gt;

*The Undriven is a God-From-Artifice. It will hurt you greatly if it touches you.*(set: $monster to (datamap: &quot;fleeChance&quot;, 10, &quot;damage&quot;, 50, &quot;type&quot;, &quot;basic&quot;))(set: $curses to it + (array: &quot;car&quot;))

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="485" name="Place your hand in the microwave" tags="deathly" position="4370,3076" size="100,100">It whirrs to life. This was a bad idea. (set: $HP to it - 35)

[[Re-examine the room|microwave]]</tw-passagedata><tw-passagedata pid="486" name="moth" tags="deathly" position="4712,3361" size="100,100">An enormous moth alights from the ceiling. Its wings are studded with eyes. They glare at you with malevolent intelligence.

It flap its wings once; twice; and then it&#39;s gone.

&lt;img src=&quot;moth.png&quot;&gt;

*The Moth is a God-From-Corruption. It has cursed you with a lingering sense of unease.* (set: $sanity to it - 10)(set: $cards to it + (array: &quot;moth2&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="487" name="moth2" tags="" position="4837,3361" size="100,100"> You recall the many-eyed moth and shudder. (set: $sanity to it - 5)
 
 [[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="488" name="badCat" tags="deathly" position="4706,3475" size="100,100">A white cat approaches. Each footfall raises a sound like thunder. Sparks flare and die as his paws strike the ground.

The cat&#39;s voice is rich and buttery and not at all what you expected. 

&quot;There is only one human I tolerate, and you are not him. Harming you may be beneath me, but I will encourage some of my colleagues to work against you.&quot;

A spark of electricity momentarily bridges the space between you. You shudder, blink, and the cat is gone.

&lt;img src=&quot;thunderpaws.png&quot;&gt;

*The thunder-pawed cat is a God-From-Electricity. It has cursed you with the attention of cats*(set: $curses to it + (array: &quot;badCat&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="489" name="altEntrance" tags="" position="506,694" size="100,100">There is a second entrance hidden behind the bushes. You&#39;re surprised you didn&#39;t notice it before. 

As you descend you notice words carved deep into the steps. Each step down reveals more of the message.

&quot;Those Who Descend These Accursed Stairs Shall Endure Ten Deathly Gifts&quot;

[[Hooray! Gifts!|Main]](set: $curseGame to true)(set: $saveTimer to 15)(set: $allCurses to (array: &quot;dark&quot;, &quot;badCat&quot;, &quot;server&quot;, &quot;prophecyBird&quot;,  &quot;kikimora&quot;, &quot;moth&quot;, &quot;spiderLady&quot;, &quot;car&quot;, &quot;microwave&quot;, &quot;leshi&quot;))(set: $untouchables to it + $allCurses)&lt;script&gt;
stopaudio();
audio.curseLong.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="490" name="dark" tags="deathly" position="4705,3587" size="100,100">The hallway is lit on either side by candles. The pair of candles furthest from you gutter and die. The next-furthest pair does the same. Then the pair after that. 

The darkness advances rapidly as rows of candles are progressively extinguished until the darkness is absolute.

A voice whispers in your ear. &quot;You are brave to have waited here. Foolish, too. You will be rewarded with nothing.&quot;

&lt;img src=&quot;candleDead.png&quot;&gt;

*The Voice-From-Darkness is a God-from-absence. It has diminished your chances of receiving future blessings.*(set: $curses to it + (array: &quot;dark&quot;))(set: $repeatBlessings to it + (array: &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;, &quot;nothing&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="491" name="Blessing of nothing" tags="blessings" position="1360,43" size="100,100">You are blessed with nothing.(set: $blessings to it + (array: &quot;nothing&quot;))

[[Nothing.|Main]]&lt;script&gt;
stopaudio();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="492" name="A cat in a box" tags="" position="135,2033" size="100,100">The container contained (either: &quot;a shorthaired&quot;, &quot;a longhaired&quot;) dungeon cat! It glares at you with baleful eyes before primly marching away.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="493" name="spiderLady" tags="" position="4702,3704" size="100,100">The Lady in Red&#39;s smile is beguiling. Her dress is ornate and impeccably constructed to accomodate altogether too many legs - eight, in all.

She sinks her fangs into your carotid artery with a degree of care approaching tenderness. The poison will not harm you - at least, not directly.

&lt;img src=&quot;spiderLady.png&quot;&gt;

*The Lady in Red is a God-From-Corruption. She has cursed you with a weakened constitution; other monsters in the dungeon now deal more damage.*(set: $curses to it + (array: &quot;spiderLady&quot;))(set: $damageModify to it + 0.25)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="494" name="leshi" tags="deathly" position="4700,3821" size="100,100">A tree grows inconspicuously here. Or is it a rock? Some kind of Elk?

A man, perhaps, with moss for a beard and vivid green eyes, looking dazed and confused on the unfamiliar environs of the dungeon.

He laughs, then abruptly stops. He stares wide-eyed at you. He waves a wooden club in something approximating your direction. Then he dissolves into a flood of spiders which quickly scurry away.

&lt;img src=&quot;leshi.png&quot;&gt;

*Leshi is a God-From-Displacement. He has cursed you ineffectually.*

[[Onwards!|Main]](set: $curses to it + (array: &quot;leshi&quot;))</tw-passagedata><tw-passagedata pid="495" name="prophecyBird" tags="deathly" position="4701,3939" size="100,100">A bird is perched on the rafters. Its plumage is vivid against the dull grey of the roof. Its face looks vaguely human. 

Its voice screeches and strains to accommodate human speech, but be that as it may you can clearly discern its words.

You will never bludgeon another watermelon. This is the first prophecy of the Prophetic Bird.

The light of Saint Archibald&#39;s Candle will no longer shine on you. This is the second prophecy of the Prophetic Bird.

&lt;img src=&quot;bird.png&quot;&gt;

*The Prophetic Bird is a God-From-Displacement. It has cursed you twice over.*(set: $curses to it + (array: &quot;prophecyBird&quot;))(if: not($cards contains &quot;watermelon&quot;))[(set: $cards to it + (array: &quot;watermelon&quot;))]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="496" name="curses" tags="deathly" position="4711,2317" size="100,100">(if: not ($achievements contains &quot;Suffer a birthday curse&quot;))[(set: $achievements to it + (array: &quot;Suffer a birthday curse&quot;))]\
(set: $saveTimer to $turns + 20)\
(display: &quot;achievementDisplay&quot;)\
(if: $curses&#39;s length &lt; 10)[(if: (random: 1,5) &gt;2)[(display: 1st of (shuffled: ...$allCurses-$curses))](else:)[(display: 1st of ($allCurses - $curses))]

(display: &quot;actions&quot;)](else:)[(if: not ($achievements contains &quot;Become maximally cursed&quot;))[(set: $achievements to it + (array: &quot;Become maximally cursed&quot;))](display: &quot;sergeEnd&quot;)]\
(if: (random: 1,2) is 1)[&lt;script&gt;
stopaudio();
audio.curse1.play();
&lt;/script&gt;](else:)[&lt;script&gt;
stopaudio();
audio.curse2.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="497" name="sergeEnd" tags="" position="4695,4055" size="100,100">(display: &quot;achievementDisplay&quot;)The bug-catcher has been waiting for you.

&quot;My,&quot; he says, &quot;but the dungeon has left you in a bad way. I can help, if you like.&quot;

&lt;img src=&quot;serge.png&quot;&gt;

[[Accept|AcceptSerge]]
[[Refuse|RefuseSerge]]</tw-passagedata><tw-passagedata pid="498" name="debugMenagerie2" tags="mist" position="2050,422" size="100,100">(display: &quot;achievementDisplay&quot;)You enter a room. No, that&#39;s not right - rooms are contained by walls and ceilings and floors. In this place all is mist and purple light. It numbs and suffuses your body. 

Others are lost here too. How did you not notice them before? They try to wave you over.

&lt;img src=&quot;mist.png&quot;&gt;

*Careful! Your sanity is getting perilously low.*

(set: $s to (text-style: &quot;upside-down&quot;))\
[[Talk to the haunted-looking one]] *(this will slightly reduce your sanity)*
[[Talk to the hungry-looking one]] *(this will substantially reduce your satiety)*(if: $cards contains &quot;2&quot;)[
[[Drop the stained robe at your feet|2b]]](if: $direction&#39;s direction is &quot;north&quot;)[
*Or you could always just* [[leave|leaveNorth]]]
(display: &quot;actions&quot;)(display: &quot;deathable&quot;)</tw-passagedata><tw-passagedata pid="499" name="buyBox" tags="" position="2312,3715" size="100,100">The cardboard smells a little musty. There&#39;s nothing inside.

&lt;img src=&quot;box.png&quot;&gt;

[[Onwards!|Main]](set: $inventory to it + (array: &quot;box&quot;))(if: not ($achievements contains &quot;Buy an expensive box&quot;))[(set: $achievements to it + (array: &quot;Buy an expensive box&quot;))]\</tw-passagedata><tw-passagedata pid="500" name="AcceptSerge" tags="" position="4620,4205" size="100,100">The curses lift. You feel buoyant and light-headed. (set: $curses to (array: &quot;clean&quot;))

&quot;Now,&quot; he says, &quot;I&#39;ll take you to the dungeon&#39;s exit. You should leave.&quot;

(display: &quot;sergeEnd2&quot;)</tw-passagedata><tw-passagedata pid="501" name="RefuseSerge" tags="" position="4770,4205" size="100,100">&quot;As you wish,&quot; he says. &quot;Nonetheless, I&#39;ll take you to the dungeon&#39;s exit. You should leave.&quot;

(display: &quot;sergeEnd2&quot;)</tw-passagedata><tw-passagedata pid="502" name="sergeEnd2" tags="" position="4769,4365" size="100,100">The journey is short, but you have time to ask the bug-catcher one question.

&lt;img src=&quot;serge.png&quot;&gt;

[[Ask about the conspiracies of crabs]]
[[Ask about the dungeon&#39;s history]]
[[Ask about ghosts and hauntings]]
[[Walk in silence]]</tw-passagedata><tw-passagedata pid="503" name="achievementDisplay" tags="" position="375,177" size="100,100">(if: ($achievements is not $achievementsOld))[(color: orange)[*&#39;&#39;Achievement achieved! (print: ($achievements - $achievementsOld).join(&quot;, &quot;))&#39;&#39;*]
&lt;script&gt;
audio.achieve.play();
&lt;/script&gt;
(set: $achievementsOld to $achievements)]</tw-passagedata><tw-passagedata pid="504" name="Ask about the conspiracies of crabs" tags="" position="4556,4512" size="100,100">The bug-catcher tells you that you mustn&#39;t think too harshly of the crabs. They are stranded far from home, and they miss it. They can survive here, but the sky, the air, the colours are all subtly and disappointingly wrong. 

They miss home with a terrible aching absence. This is why they are trying to cast aside the world of humans. They wish to bring forth their old world, to reunite with their families, and to see the sky restored to its proper colours. As far as motives for bringing about an apocalypse goes, theirs is relatively benign. 

The bug-catcher trails off. You&#39;ve arrived at the dungeon&#39;s exit.

[[Onwards!|exit]]</tw-passagedata><tw-passagedata pid="505" name="Ask about the dungeon&#39;s history" tags="" position="4706,4512" size="100,100">The dungeon is relatively new. It was built a few years after the bug-catcher was bor. He has frayed memories of its construction at the outer fringes of his memory.

The dungeon was not always so big. It used to mirror the house built above. (The house was apparently consumed by a terrible fire not long afterwards.) In the earliest days only one person lived in the dungeon, but eventually they found ways to expand in every direction except up, and to bring life to its hollowed passages. 

The bug-catcher trails off. You&#39;ve arrived at the dungeon&#39;s exit.

[[Onwards!|exit]]</tw-passagedata><tw-passagedata pid="506" name="Ask about ghosts and hauntings" tags="" position="4856,4512" size="100,100">The bug-catcher has little to say on the subject of ghosts. He remarks, elliptically, that he does not feel haunted by that which has been much lost to him. He is content with his life and the absences that define it. He is enjoying his time in the dungeon. He is fond of its inhabitants, and he enjoys its plentiful supply of watermelons.

With the right frame of mind, he explains, it is possible to be happy underground. 

The bug-catcher trails off. You&#39;ve arrived at the dungeon&#39;s exit.

[[Onwards!|exit]]</tw-passagedata><tw-passagedata pid="507" name="Walk in silence" tags="" position="4990,4513" size="100,100">Presently you arrive at the dungeon&#39;s exit.

[[Onwards!|exit]]</tw-passagedata><tw-passagedata pid="508" name="eatExit" tags="" position="2157,1115" size="100,100">(if: not ($achievements contains &quot;Eat your way to freedom&quot;))[(set: $achievements to it + (array: &quot;Eat your way to freedom&quot;))(display: &quot;achievementDisplay&quot;)]The hardest part is making a dent in the door&#39;s smooth surface. Once your teeth can find purchase in the wood you make quick progress. 

You taste pine, oak, something, you don&#39;t know. You swallow mouthful after mouthful of splinters. It&#39;s not watermelon, but at least it fills your stomach.

You continue until nothing of the door is left except some rusty hinges jutting from the wall. 

You are free. Hungry, but free. 

[[Walk through the door|The End]]</tw-passagedata><tw-passagedata pid="509" name="heistIntro" tags="" position="4054,3492" size="100,100">A side corridor opens to an enormous chamber. It&#39;s crowded with dungeon slimes, but at the far end an enormous diamond glints atop a pedestal holds a diamond.

Stealing it wouldn&#39;t be easy. Security slimes watch for intruders, lasers scan the room, and tripwires lace the floor.

&lt;img src=&quot;diamond.png&quot;&gt;

(link: &quot;Steal the jewel&quot;)[(set: $heistProgress to 8)&lt;script&gt;
stopaudio();
audio.heist.play();
&lt;/script&gt;(go-to: &quot;heist&quot;)]
[[Don&#39;t steal the jewel|Leave it be]](set: $heistDescription to (array: &quot;The diamond is so close you could taste it if you had an abnormally long tongue and diamonds tasted of anything&quot;,&quot;You are very close&quot;,&quot;The diamond is quite near&quot;, &quot;The diamond is not far off&quot;, &quot;You are almost halfway across the room&quot;,&quot;You have made noticeable progress&quot;,&quot;You have begun to make your way across the room&quot;,&quot;The diamond gleams in the distance&quot;))</tw-passagedata><tw-passagedata pid="510" name="Leave it be" tags="" position="4064,3360" size="100,100">These are not auspicious circumstances for a diamond heist. 

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="511" name="heist" tags="" position="4046,3639" size="100,100">(set: $options to (shuffled: ...(array: (array: &quot;Sneak past a security slime&quot;, &quot;heistSlime&quot;, (random:5,90)), (array: &quot;Dodge a matrix of security lasers&quot;, &quot;heistLaser&quot;, (random: 5,90)), (array: &quot;Traverse a tangle of tripwire&quot;, &quot;heistTripwire&quot;, (random: 5,90)))))\
(if: (random: 1,2) is 1)[(set: $options to (shuffled: ...$options + (array: (array: &quot;Affect an inconspicuous accent&quot;, &quot;heistAccent&quot;, 100))))]\
*(print: $heistDescription&#39;s $heistProgress)*

|o1&gt;[(link: 1st of $options&#39;s 1st)[(if: (random: 1,100)&lt;= 3rd of $options&#39;s 1st and not(3rd of $options&#39;s 1st is 100))[(go-to: &quot;heistProgress&quot;)](else:)[(go-to: 2nd of $options&#39;s 1st)]] *(print: 3rd of $options&#39;s 1st)% chance of success*]
|o2&gt;[(link: 1st of $options&#39;s 2nd)[(if: (random: 1,100)&lt;= 3rd of $options&#39;s 2nd and not(3rd of $options&#39;s 2nd is 100))[(go-to: &quot;heistProgress&quot;)](else:)[(go-to: 2nd of $options&#39;s 2nd)]] *(print: 3rd of $options&#39;s 2nd)% chance of success*]
(if: $cookies&#39;s basic &gt; 0 and (random: 1,3) is 1)[(replace: (either: ?o1, ?o2))[(link: &quot;Cause a distraction by throwing a cookie&quot;)[(go-to: &quot;heistCookie&quot;)] *100% chance of success*]](if: $heistProgress &lt; 1)[(go-to: &quot;heistEnd&quot;)]</tw-passagedata><tw-passagedata pid="512" name="heistSlime" tags="" position="4055,3766" size="100,100">The security slime spots you. You sprint back into the thick of the crowd. (set: $energy to it - 8) 

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="513" name="heistCookie" tags="" position="3943,3768" size="100,100">All eyes turn to gaze at the cookie.

You steal acorss the room. (set: $cookies&#39;s basic to it - 1)(set: $heistProgress to it - 1)

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="514" name="heistProgress" tags="" position="4174,3636" size="100,100">You execute your plan perfectly. You&#39;re one step closer to your goal. (set: $heistProgress to it - 1)

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="515" name="heistAccent" tags="" position="3829,3771" size="100,100">Affecting a heavy accent, you tell a nearby security slime you are a journalist for a prestigious journal.

They stare, uncomprehending. You&#39;re no closer to your goal.

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="516" name="plant1" tags="" position="3545,4114" size="100,100">(if: $plant is not &quot;none&quot;)[(go-to: &quot;plant2&quot;)]A clay pot has been filled with soil. The soil is damp, rich, and reeks of manure; it would provide fertile ground for all manner of things to grow.

&lt;img src=&quot;plant1.png&quot;&gt;

(link: &quot;Plant a key&quot;)[(if: $keys &gt; 0)[(set: $keys to it - 1)(set: $plant to 1)(go-to: &quot;plant1b&quot;)](else:)[You have no keys.]]
(link: &quot;Plant some breadcrumbs&quot;)[(if: $scanner &gt; 0)[(set: $scanner to it - 1)(set: $plant to 2)(go-to: &quot;plant1b&quot;)](else:)[You have no breadcrumbs.]]
(link: &quot;Plant some average juice&quot;)[(if: $drink &gt; 0)[(set: $drink to it - 1)(set: $plant to 5)(go-to: &quot;plant1b&quot;)](else:)[You have no average juice.]]
(link: &quot;Plant a chocolate-chip cookie&quot;)[(if: $cookies&#39;s basic &gt; 0)[(set: $cookies&#39;s basic to it - 1)(set: $plant to 3)(go-to: &quot;plant1b&quot;)](else:)[You have no chocolate-chip cookies.]]
(link: &quot;Plant one of your fingernails&quot;)[(set: $plant to 4)(go-to: &quot;plant1b&quot;)](set: $rareishCards to it + (array: &quot;plant2&quot;))</tw-passagedata><tw-passagedata pid="517" name="crampedSerge" tags="" position="430,2327" size="100,100">(display: &quot;sergeHour&quot;)(replace: ?introText)[The bacon-scented bugcatcher unfurls himself from the bottom of the chest. When upright he extends a hand in greeting.] </tw-passagedata><tw-passagedata pid="518" name="relic" tags="" position="545,2327" size="100,100">You&#39;ve found a statuette of Saint Archibald, the patron saint of dungeongoers. Your next blessing is nearer than before.(set: $nextBlessing to it - 15)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="519" name="inkling" tags="" position="426,2442" size="100,100">There is nothing inside the chest. This feels significant.

(set: $inklings to it + 3)*You now have (print: $inklings) inklings of a deeper purpose*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="520" name="plant1b" tags="" position="3447,4230" size="100,100">You pat down the soil.

[[There. It&#39;s done.|Main]]</tw-passagedata><tw-passagedata pid="521" name="plant2" tags="" position="3669,4116" size="100,100">This room contains a familiar clay pot. (if: $plant is 1)[The keyplant has borne fruit!

(set: $keys to it + 1)*You now have (print: $keys) keys*

&lt;img src=&quot;plant2.png&quot;&gt;

[[Onwards!|Main]]]\
(if: $plant is 2)[The bread-plant has borne fruit! It looks delicious.

&lt;img src=&quot;plant2.png&quot;&gt;

(link-repeat: &quot;Eat some breadfruit.&quot;)[Om.(set: $satiety to it + 20)(replace: ?Satiety)[(color: white)[$satiety]]]
[[Leave.|Main]]]\
(if: $plant is 5)[The average-plant has borne fruit! They look grey and bland.

&lt;img src=&quot;plant2.png&quot;&gt;

(link: &quot;Eat the grey fruits&quot;)[(goto: &quot;Eat the greyberries&quot;)]
[[Leave the grey fruits|Main]]]\
(if: $plant is 3)[The cookie-plant has borne fruit! (set: $cookies&#39;s basic to it + 2)

*You now have (print: $cookies&#39;s basic) chocolate chip cookies*

&lt;img src=&quot;plant2.png&quot;&gt;

[[Delicious!|Main]]]\
(if: $plant is 4)[The fingerplant has borne fruit! They dangle fleshily. They are covered by interlocking rows of tightly-packed nails. Oh god.

&lt;img src=&quot;plant2.png&quot;&gt;

(if: $hunger &gt; 1)[[[Eat the finger-fruit]]
](link: &quot;Avert your eyes. Shudder.&quot;)[(set: $sanity to it - 10)(goto: &quot;Main&quot;)]]</tw-passagedata><tw-passagedata pid="522" name="heistLaser" tags="" position="4169,3766" size="100,100">You are contorting your body between the laser beams when you trip an alarm. The noise blares like thunder. The security slimes are strangely unperturbed. (set: $sanity to it - 8)

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="523" name="heistTripwire" tags="" position="4287,3765" size="100,100">You trip over a tripwire, landing painfully on your face. (set: $HP to it - 8)

(display: &quot;heist&quot;)</tw-passagedata><tw-passagedata pid="524" name="heistEnd" tags="" position="4053,3881" size="100,100">(if: not ($achievements contains &quot;Pull off an audacious heist&quot;))[(set: $achievements to it + (array: &quot;Pull off an audacious heist&quot;))]You steal across the room. One more step, two.

The diamond is in your hands. You flee before anybody notices.

(set: $inventory to it + (array: &quot;diamond&quot;))(set: $rareCards to it - (array: &quot;heist&quot;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sDiamond.png&quot;&gt;&#39;))(link: &quot;Onwards!&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="525" name="crudeCounter" tags="" position="1836,409" size="100,100">(if: $blessings&#39;s length is 1)[(print: $blessings&#39;s 1st)]\
(else-if: $blessings&#39;s length is 2)[(print: $blessings&#39;s 1st) and (print: $blessings&#39;s 2nd)]\
(else:)[(if: $blessings&#39;s length &gt; $b1)[(if: $blessings&#39;s length is (abs: $b1 + 1))[and ](print: $blessings&#39;s $b1)(if: $blessings&#39;s length &gt; 2 and not ((abs: $b1 + 1) &gt;= $blessings&#39;s length))[, ](set: $b1 to it + 1)(display: &quot;crudeCounter&quot;)(set: $b1 to it + 1)(display: &quot;crudeCounter&quot;)]]</tw-passagedata><tw-passagedata pid="526" name="Sidebar" tags="footer" position="608,80" size="100,100">$s[(print: $execute.join(&quot;&quot;))\
(set: $a to (text-color: $colours&#39;s (abs: 31 + (min: 30, (max: -30, ($HP - $HPOld))))))\
(set: $b to (text-color: $colours&#39;s (abs: 31 + (min: 30, (max: -30, ($sanity - $sanityOld))))))\
(set: $c to (text-color: $colours&#39;s (abs: 31 + (min: 30, (max: -30, ($energy - $energyOld))))))\
(set: $d to (text-color: $colours&#39;s (abs: 31 + (min: 30, (max: -30, ($satiety - $satietyOld))))))\
(if: $freeze&#39;s timer &gt; $turns)[(print: $freeze&#39;s code)]\
Health: [$a[$HP]]&lt;Health| 
Sanity: [$b[$sanity]]&lt;Sanity| 
Energy: [$c[$energy]]&lt;Energy| 
Satiety: [$d[$satiety]]&lt;Satiety|
(display: &quot;icons&quot;)
|sideMenu&gt;[(display: &quot;subMenu0&quot;)]\
(set: $HPOld to $HP)(set: $sanityOld to $sanity)(set: $energyOld to $energy)(set: $satietyOld to $satiety)\
(if: $mushroomCooldown &gt; $turns)[(replace: ?Health)[??]\
(replace: ?Sanity)[??]\
(replace: ?Energy)[??]\
(replace: ?Satiety)[??]]\
(print: $finalExecute)\
(if: $strangeBrew is 1)[(live: 0.3s)[(if: (random: 1,6) is 6)[(set: $teaTally to it + 1)(set: $HP to it + 1)(replace: ?Health)[(color: lime)[(if: $mushroomCooldown &gt; $turns)[??](else:)[$HP]]]](else-if: $mushroomCooldown &gt; $turns)[(replace: ?Health)[(color: grey)[??]]]]]]\
(replace: &quot;dungeon&quot;)[(text-color:red)[dungeon]]\
(if: $keys &gt; $keysOld)[(set: $keysOld to $keys)&lt;script&gt;
audio.keyGet.play();
&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="527" name="HPBar" tags="" position="8,27" size="100,100">&lt;span style=&quot;letter-spacing: -0.25em&quot;&gt;(if: $HP &gt; $HPBar and ($HP &lt;= 100))[|(set: $HPBar to it + 5)(display: &quot;HPBar&quot;)]&lt;/span&gt;(if: $HP &gt; 100)[(print: $HP)]</tw-passagedata><tw-passagedata pid="528" name="sphynx" tags="" position="3894,4431" size="100,100">A sphynx, carved from sandstone, fills most of the room. Its voice enters your head like thunder:

**What number am I thinking of?**

&lt;img src=&quot;sphynx.png&quot;&gt;

(set: $answers to (shuffled: ...(array: (either: &quot;One&quot;, &quot;Two&quot;, &quot;Three&quot;, &quot;Four&quot;, &quot;Five&quot;, &quot;Six&quot;, &quot;Seven&quot;, &quot;Eight&quot;, &quot;Nine&quot;, &quot;Ten&quot;), (random: 11,99), (random: 100,999), (random: 1000, 9999), &quot;Pi&quot;, &quot;A billion billion&quot;, &quot;Eleventy&quot;)))\
(link: (text: 1st of $answers))[(go-to: &quot;sphynx2&quot;)]
(link: (text: 2nd of $answers))[(go-to: &quot;sphynx2&quot;)]
(link: (text: 3rd of $answers))[(go-to: &quot;sphynx2&quot;)]</tw-passagedata><tw-passagedata pid="529" name="sphynx2" tags="" position="3892,4547" size="100,100">(if: (random:1,3) &lt; 3)[You are punished for your incorrect answer.(set: $HP to it - 3)(set: $sanity to it - 3)(set: $energy to it - 3)(set: $satiety to it - 3)

[[Drat.|Main]]](else:)[(if: not ($achievements contains &quot;Solve the sphynx&#39;s riddle&quot;))[(set: $achievements to it + (array: &quot;Solve the sphynx&#39;s riddle&quot;))]\
(set: $cookies&#39;s basic to it + 1)(if: not ($uncommonCards contains &quot;toToShop&quot;))[(set: $uncommonCards to it + (array: &quot;toToShop&quot;))]You answered correctly. You are duly rewarded with a chocolate-chip cookie and a Cat Fact, printed on a scrap of parchment:

*(either: &quot;Cats use their tails for balance and have nearly 30 individual bones in them!&quot;,&quot;In ancient Egypt killing a cat was a crime punishable by death.&quot;,&quot;The first cat show was held in 1871 at the Crystal Palace in London.&quot;,&quot;There are about 100 distinct breeds of domestic cat.&quot;,&quot;Cats bury their faeces to cover their trails from predators.&quot;,&quot;Your favourite animal is the cat.&quot;, &quot;Cats communicate with eachother using a variety of vocalizations (mewing, purring, trilling, hissing, growling, and grunting), as well as cat pheromones and types of cat-specific body language.&quot;)*

[[How interesting.|Main]]]</tw-passagedata><tw-passagedata pid="530" name="Blessing of (print: $availableBlessings&#39;s 4th)" tags="" position="1317,270" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="531" name="cudgel" tags="" position="546,2441" size="100,100">It&#39;s a deluxe cudgel! The handle is wrapped in supple leather, and the wood is adorned with carvings of sea creatures.(set: $inventory to it + (array: &quot;cudgel&quot;))

&lt;img src=&quot;cudgel.png&quot;&gt;

[[Onwards!}Main]]</tw-passagedata><tw-passagedata pid="532" name="Onwards!}Main" tags="" position="620,2591" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="533" name="cudgelDeluxe" tags="" position="629,1403" size="100,100">The grip is supple in your hands. Each strike of the cudgel reverberates up your arm. By degrees the watermelon disintegrates. The process is thorough, exhausting, and cathartic. Everybody should manage tension by bludgeoning watermelons.

[[Onwards!|Main]](set: $energy to it - 20)(set: $sanity to it + 10)(set: $cudgelCount to it + 1)(if: $cudgelCount &gt; 4 and not ($achievements contains &quot;Cudgel many watermelons&quot;))[(set: $achievements to it + (array: &quot;Cudgel many watermelons&quot;))]\</tw-passagedata><tw-passagedata pid="534" name="Blessing of explosiveness" tags="blessings" position="2312,182" size="100,100">You have gained the attention of Explodia, the Goddess of Explosions. She rewards those who blow things up.(set: $blessings to it + (array: &quot;explosiveness&quot;))(set: $trash to it + 1)

You have also gained a stick of dynamite. Use it well.

[[Hallelujah!|Main]]</tw-passagedata><tw-passagedata pid="535" name="sidequest" tags="" position="3058,4184" size="100,100">A statue bears the likeness of Sidequestia, Goddess of Minor Inconveniences. A message has been scrawled on the wall behind her:

**(if: $sidequest&#39;s 1st is 1)[Deliver this box of spiders to the red-robed acolyte](if: $sidequest&#39;s 1st is 2)[Dispose of this suspiciously-stained robe](if: $sidequest&#39;s 1st is 3)[Deliver this ceremonial candle to the blue-robed acolyte](if: $sidequest&#39;s 1st is 4)[Deliver this osmium dagger to the green-robed acolyte] - FOR THE GLORY OF SIDEQUESTIA**

&lt;img src=&quot;sidequestia.png&quot;&gt;

(link: &quot;Accept&quot;)[(set: $cards to it + (array: (text: $sidequest&#39;s 1st)) + (array: (text: $sidequest&#39;s 1st)) + (array: (text:$sidequest&#39;s 1st)))(set: $cards to it - (array: &quot;sidequest&quot;))(set: $uncommonCards to it - (array: &quot;sidequest&quot;))(set: $sidequest to it - (array: $sidequest&#39;s 1st))(go-to: &quot;Main&quot;)]
[[Refuse|RefuseQuest]]</tw-passagedata><tw-passagedata pid="536" name="armor" tags="" position="913,3875" size="100,100">A moving suit of armour turns the corner. It stumbles swiftly towards you. (set: $monster to (datamap: &quot;fleeChance&quot;, 50, &quot;damage&quot;, 15, &quot;type&quot;, &quot;armor&quot;, &quot;bonus&quot;, &quot;Lift the visor&quot;))(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

Its spear looks unusually dull.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

Its spear looks unusually vicious.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

&lt;img src=&quot;armor.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="537" name="Lift the visor" tags="" position="950,4006" size="100,100">Cephalopodic eyes stare solemnly into your own. You glimpse tentacles spreading into each recess of the suit of armor. The creature holds your gaze a moment longer, then steers the suit away in an awkward shuffling sprint. (Set: $sanity to it - $monster&#39;s damage)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="538" name="RefuseQuest" tags="" position="2905,4260" size="100,100">You sense reproach in the statue&#39;s eyes. You will not encounter Sidequestia again. (set: $uncommonCards to it - (array: &quot;sidequest&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="539" name="sidequest2" tags="" position="3200,4097" size="100,100">Acolytes of Sidequestia huddle around the statue. &quot;ALL GLORY TO SIDEQUESTIA,&quot; they intone.(if: $sidequest &gt; 50)[ A black-robed acolyte waves you over.]

&lt;img src=&quot;sidequestia.png&quot;&gt;

[[Respond in kind]](if: $sidequest &gt; 50)[
[[Speak with the black-robed acolyte]]](else:)[
[[Offer further assistance to the acolytes of sidequestia|5]] *(this will not benefit you)*(if: $inventory contains &quot;soul&quot;)[
(link: &quot;Donate your soul - for the glory of Sidequestia&quot;)[(set: $sidequest to it + 50)(goto: &quot;Barter your soul instead&quot;)] *(this will yield no further benefits)* ]]
[[Hurry away|Main]](if: not ($achievements contains &quot;Bring glory to Sidequestia&quot;))[(set: $achievements to it + (array: &quot;Bring glory to Sidequestia&quot;))]</tw-passagedata><tw-passagedata pid="540" name="1" tags="" position="2982,4515" size="100,100">(if: (random: 1,3) &gt; 1)[One of the spiders has escaped. It perches on your (either: &quot;hand&quot;,&quot;arm&quot;,&quot;leg&quot;,&quot;foot&quot;,&quot;chest&quot;), baring its fangs.

&lt;img src=&quot;crate.png&quot;&gt;

(link: &quot;Recapure it&quot;)[(set: $HP to it - 3)(go-to: &quot;Main&quot;)]](else:)[(display: &quot;1b&quot;)]</tw-passagedata><tw-passagedata pid="541" name="2" tags="" position="3107,4515" size="100,100">The robe is stained pinkish red. It smells appealingly like watermelon.

&lt;img src=&quot;robe.png&quot;&gt;

(link: &quot;Endure.&quot;)[(set: $satiety to it - 3)(go-to: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="542" name="3" tags="" position="3232,4517" size="100,100">(if: (random: 1,3) &gt; 1)[The candle whispers to you.

Are candles supposed to whisper? You&#39;re not sure.

&lt;img src=&quot;candleBlack.png&quot;&gt;

(link: &quot;Endure.&quot;)[(set: $sanity to it - 3)(go-to: &quot;Main&quot;)]](else:)[(display: &quot;3b&quot;)]</tw-passagedata><tw-passagedata pid="543" name="1b" tags="" position="2983,4630" size="100,100">You meet the red-robed acolyte of Sidequestia. They accept the box of spiders with a slight nod.

&lt;img src=&quot;cultistRed.png&quot;&gt;

[[Onwards!|Main]](display: &quot;questEnd&quot;)(set: $cards to it - (array: &quot;1&quot;))</tw-passagedata><tw-passagedata pid="544" name="2b" tags="" position="3105,4634" size="100,100">Nobody will find it here.

[[Onwards!|Main]](display: &quot;questEnd&quot;)(set: $cards to it - (array: &quot;2&quot;))</tw-passagedata><tw-passagedata pid="545" name="3b" tags="" position="3225,4632" size="100,100">You meet the blue-robed acolyte of Sidequestia. They accept the candle with a slight nod.

&lt;img src=&quot;cultistBlue.png&quot;&gt;

[[Onwards!|Main]](display: &quot;questEnd&quot;)(set: $cards to it - (array: &quot;3&quot;))</tw-passagedata><tw-passagedata pid="546" name="4" tags="" position="3353,4520" size="100,100">(if: (random: 1,3) &gt; 1)[The osmium dagger weighs unreasonably heavy. Your arm aches. 

&lt;img src=&quot;dagger.png&quot;&gt;

(link: &quot;Endure.&quot;)[(set: $energy to it - 3)(go-to: &quot;Main&quot;)]](else:)[(display: &quot;4b&quot;)]</tw-passagedata><tw-passagedata pid="547" name="4b" tags="" position="3344,4632" size="100,100">You meet the green-robed acolyte of Sidequestia. They accept the dagger with a slight nod.

&lt;img src=&quot;cultistGreen.png&quot;&gt;

[[Onwards!|Main]](display: &quot;questEnd&quot;)(set: $cards to it - (array: &quot;4&quot;))</tw-passagedata><tw-passagedata pid="548" name="questEnd" tags="" position="3159,4750" size="100,100">(if: $sidequest&#39;s length &gt; 1)[(set: $cards to it + (array: &quot;sidequest&quot;))](else:)[(set: $sidequest to 0)(set: $cards to it + (array: &quot;sidequest2&quot;))]</tw-passagedata><tw-passagedata pid="549" name="Respond in kind" tags="" position="3326,4256" size="100,100">May the minor blessings of Sidequestia aid you on the journey ahead.(set: $HP to it + 6)(set: $sanity to it + 6)(set: $energy to it + 6)(set: $satiety to it + 6)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="550" name="5" tags="" position="3471,4524" size="100,100">The red-robed acolyte thanks you as she draws her knife. &quot;What great timing!&quot; she exclaims brightly. &quot;We were just starting to run low on blood!&quot;(set: $HP to it - 18)(set: $sidequest to it + (random: 10,30))

*Continuing to render assistance to the acolytes of sidequestia may have further negative effects* 

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="551" name="Speak with the black-robed acolyte" tags="" position="2698,4491" size="100,100">&quot;You have proven yourself a true friend to Sidequestia,&quot; the black-robe acolyte says. &quot;But she has a further sacrifice to ask of you.&quot;

&lt;img src=&quot;cultistBlack.png&quot;&gt;

[[Keep listening|blackrobe2]]
[[Don&#39;t keep listening|Main]]</tw-passagedata><tw-passagedata pid="552" name="blackrobe2" tags="" position="2695,4624" size="100,100">&quot;A portal has opened. I want you to go through. I trust you will know what to do when you reach the other side.&quot;

&lt;img src=&quot;cultistBlack.png&quot;&gt;

[[To the portal!|Main]](set: $cards to it + (array: &quot;portal1&quot;, &quot;portal1&quot;, &quot;portal1&quot;))(set: $cards to it - (array: &quot;sidequest2&quot;))</tw-passagedata><tw-passagedata pid="553" name="portal1" tags="" position="3640,4649" size="100,100">Here is a portal. It hums with arcane energies. It reminds you, obscurely, of Sidequestia.

&lt;img src=&quot;portal1.png&quot;&gt;

(link: &quot;Go through the portal&quot;)[&lt;script&gt;
stopaudio();
audio.sidequest.play();
&lt;/script&gt;(set: $turns to -9999)(goto: &quot;portal1b&quot;)]
[[Don&#39;t go through the portal|Main]] *You won&#39;t get another chance*(set: $cards to it - (array: &quot;portal1&quot;))</tw-passagedata><tw-passagedata pid="554" name="portal1b" tags="sidequest" position="3788,4725" size="100,100">The air is thin here. Your skin stings with cold.(set: $HP to 1)

[[Push on|portal1c]]</tw-passagedata><tw-passagedata pid="555" name="portal1c" tags="sidequest" position="3928,4727" size="100,100">The air is bright but hazy. Your eyes cannot focus. (set: $sanity to 1)

[[Push on|portal1d]]</tw-passagedata><tw-passagedata pid="556" name="portal1d" tags="sidequest" position="4063,4729" size="100,100">The ground is layered with something icy and thick. Your feet struggle through snow that is not snow. (set: $energy to 1)

[[Push on.|portal1e]]</tw-passagedata><tw-passagedata pid="557" name="portal1e" tags="sidequest" position="4200,4727" size="100,100">You are lost. There is no food here. There is no hope of return. (set: $satiety to 1)

[[Push on.|portal1f]]</tw-passagedata><tw-passagedata pid="558" name="portal1f" tags="sidequest" position="4328,4727" size="100,100">At last: you&#39;ve reached some feature in this blank landscape.

[[Examine.|ExaminePortal]]</tw-passagedata><tw-passagedata pid="559" name="ExaminePortal" tags="sidequest" position="4458,4729" size="100,100">A stone dais. A black candle. A book of matches.

Another statue of Sidequestia. Much, much taller than the last. The head, far above, is almost out of sight

[[Burn the candle.]]
[[Wait.|waitPortal]]</tw-passagedata><tw-passagedata pid="560" name="Burn the candle." tags="sidequest" position="4298,4927" size="100,100">The flame glows with unnatural brightness.

[[Sit.|waitFurther]]&lt;script&gt;
audio.distortion.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="561" name="waitPortal" tags="sidequest" position="4567,4954" size="100,100">All is still.

[[Burn the candle.]]
[[Wait.|waitPortal]]</tw-passagedata><tw-passagedata pid="562" name="waitFurther" tags="sidequest" position="4298,5077" size="100,100">The wind rises. Something is approaching.

[[Wait.|wait3]]&lt;script&gt;
audio.distortion.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="563" name="wait3" tags="sidequest" position="4298,5227" size="100,100">A shadow falls. Sidequestia is rising.

[[Wait.|Wait4]]&lt;script&gt;
audio.distortion.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="564" name="Wait4" tags="sidequest" position="4438,5227" size="100,100">Farewell to the land, to the sea, to the sky.

Farewell to our families. Farewell to our sun. Farewell to all others.

[[Sidequestia rises.|Wait5]]&lt;script&gt;
audio.distortion.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="565" name="Wait5" tags="sidequest" position="4572,5224" size="100,100">Panic fills your mouth and dies. Your ears fill with screams, impossibly loud. Your skull floods with colour. You will end. All will end. Except for her.(save-game:&quot;Slot A&quot;, &quot;in progress&quot;)

(link: &quot;All glory to Sidequestia.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(go-to: &quot;trueInit&quot;)](set: $glory to true)&lt;script&gt;
audio.distortion.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="566" name="jargo" tags="" position="1648,4439" size="100,100">(set: $clothingCount to (abs: 3 - (count: $inventory, &quot;cookieClogs&quot;) - (count: $inventory, &quot;jargo&quot;) - (count: $inventory, &quot;cloak&quot;)))You enter a cavernous walk-in wardrobe. It is empty(if: $clothingCount is 0)[.](else:)[, save for (print: $clothingCount) item(if: $clothingCount &gt; 1)[s]:
(if: not ($inventory contains &quot;cloak&quot;))[
- A heavy cloak. It will slightly reduce the damage you take when attacked by monsters.](if: not ($inventory contains &quot;cookieClogs&quot;))[
- A pair of enchanted clogs. They are awkward to run in, but reward you with cookies when you succesfully flee your foes.](if: not ($inventory contains &quot;jargo&quot;))[
- An unnatural hybrid between cargo pants and jeans. Some people might think them stylish.]

&lt;img src=&quot;hanger.png&quot;&gt;

(if: not ($inventory contains &quot;cloak&quot;))[
[[Put on the heavy cloak|cloakWear]]](if: not ($inventory contains &quot;cookieClogs&quot;))[
[[Put on the cookie clogs|cookieWear]]](if: not ($inventory contains &quot;jargo&quot;))[
[[Put on the jargo pants|jargoWear]]]]
[[Take nothing|Main]]</tw-passagedata><tw-passagedata pid="567" name="cloakWear" tags="" position="1573,4589" size="100,100">(set: $inventory to it + (array: &quot;cloak&quot;))(set: $damageModify to it * 0.8)The cloak billows out behind you as you leave the room.

&lt;img src=&quot;cloak.png&quot;&gt;

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="568" name="cookieWear" tags="" position="1713,4614" size="100,100">(if: $inventory contains &quot;runners&quot;)[(set: $inventory to it - (array: &quot;runners&quot;))(set: $fleeBonus to it - 10)(set: $runBonus to it - 10)](set: $inventory to it + (array: &quot;cookieClogs&quot;))\
The clogs do not help you run. However, they will summon cookies whenever you succesfully flee a foe.

*Acquiring new shoes will replace these ones.*

&lt;img src=&quot;clogs.png&quot;&gt;

[[Onwards!|Main]](set: $icons to it + (array: &#39;&lt;img src=&quot;sClogs.png&quot;&gt;&#39;))</tw-passagedata><tw-passagedata pid="569" name="bomb" tags="" position="2315,4467" size="100,100">You find a spherical bomb. The fuse has already been lit. It won&#39;t last more than a few minutes; you&#39;ll need to dispose of it soon.

&lt;img src=&quot;bomb.png&quot;&gt;

(link: &quot;Onwards!&quot;)[(set: $tickBomb to (random: 4,5))(goto: &quot;Main&quot;)](set: $icons to it + (array: &quot;&lt;img src = &#39;sBomb.png&#39;&gt;&quot;))</tw-passagedata><tw-passagedata pid="570" name="explode" tags="" position="2427,4464" size="100,100">The bomb explodes. You are gravely injured in the blast.(set: $HP to it - 50)(set: $tickBomb to false)

[[Onwards!|Main]](set: $icons to it - (array: &quot;&lt;img src = &#39;sBomb.png&#39;&gt;&quot;))</tw-passagedata><tw-passagedata pid="571" name="explodeAlt" tags="" position="2425,4577" size="100,100">(set: $tickBomb to false)(if: $card is &quot;exit&quot; and not ($achievements contains &quot;Destroy the exit&quot;))[(set: $achievements to it + (array: &quot;Destroy the exit&quot;))]\
(if: $card is &quot;crabRoom&quot; and not ($achievements contains &quot;Foil a conspiracy&quot;))[(set: $achievements to it + (array: &quot;Foil a conspiracy&quot;))]\
(set: $cards to it - (array: $card))\
(set: $uncommonCards to it - (array: $card))\
(set: $rareCards to it - (array: $card))\
(set: $delayExecute to false)\
(if: $card is &quot;altar&quot;)[(go-to: &quot;furiousGod&quot;)]\
You fling the bomb into the room. It explodes shortly thereafter. You&#39;ll never see this part of the dungeon again.

[[Onwards!|Main]](set: $icons to it - (array: &quot;&lt;img src = &#39;sBomb.png&#39;&gt;&quot;))&lt;script&gt;audio.boom.play();&lt;/script&gt;</tw-passagedata><tw-passagedata pid="572" name="well2" tags="" position="3947,1756" size="100,100">(if: $well&#39;s 1st &gt; 100)[(set: $well&#39;s 1st to 100)](if: $well&#39;s 2nd &gt; 100)[(set: $well&#39;s 2nd to 100)](if: $well&#39;s 3rd &gt; 100)[(set: $well&#39;s 3rd to 100)](if: $well&#39;s 4th &gt; 100)[(set: $well&#39;s 4th to 100)](if: $well&#39;s 5th &gt; 100)[(set: $well&#39;s 5th to 100)]The room echoes with the sound of running water. A wishing well stands in the centre. A nearby sign informs you of your chance of various wishes being granted.

&lt;img src=&quot;well.png&quot;&gt;

[[Wish for a cookie]]* - (print: $well&#39;s 1st)% chance of success*
[[Wish for average juice]]* - (print: $well&#39;s 2nd)% chance of success*
[[Wish for breadcrumbs]]* - (print: $well&#39;s 3rd)% chance of success*
[[Wish for dynamite]]* - (print: $well&#39;s 4th)% chance of success*
[[Wish for a key]]* - (print: $well&#39;s 5th)% chance of success*(if: $cookies&#39;s basic &gt; 0)[
(link: &quot;Throw a cookie down the well&quot;)[(set: $cookies&#39;s basic to it - 1)(set: $well&#39;s 1st to it + 10)(set: $well&#39;s 2nd to it + 10)(set: $well&#39;s 3rd to it + 10)(set: $well&#39;s 4th to it + 10)(set: $well&#39;s 5th to it + 10)(go-to: &quot;well2&quot;)[]]]\
(if: $inventory contains &quot;soul&quot;)[
[[Throw your soul down the well]]* - you can only do this once*]\
(if: $cards contains &quot;2&quot;)[
[[Throw the stained robe down the hole|2b]]](if: $sanity &lt;=5 and  $descension is not 1)[

[[*Climb down the well*|Go down]](set: $s to (text-style: &quot;upside-down&quot;))]</tw-passagedata><tw-passagedata pid="573" name="Ask for your mind to be healed" tags="" position="2638,4299" size="100,100">(set: $sanity to it + 40)(set: $energy to it - 20)[[It is done.|Main]]</tw-passagedata><tw-passagedata pid="574" name="grimoire" tags="" position="803,4504" size="100,100">(set: $options to (array: (array: &quot;muddy poultice&quot;, &quot;grimoireHP&quot;), (array: &quot;mug of coffee&quot;, &quot;grimoireEnergy&quot;), (array: &quot;mug of hot chocolate&quot;, &quot;grimoireSanity&quot;), (array: (text: 1st of (shuffled: ...$foodTypes)), &quot;grimoireSatiety&quot;)))(if: (random: 1,2) is 1)[(set: $options to it + (array: (array: &quot;bad-tempered shoggoth&quot;, &quot;grimoireDoom&quot;)))](if: (random: 1,2) is 1)[(set: $options to it + (array: (array: &quot;cookie&quot;, &quot;grimoireCookie&quot;)))](if: (random: 1,2) is 1)[(set: $options to it + (array: (array:&quot;Crabcosan crafting cube&quot;, &quot;grimoireCube&quot;)))](set: $options to (shuffled: ... $options))A grimoire of dark magic is chained to the floor of the dungeon. It includes three summoning spells suitable for beginners.

&lt;img src=&quot;grimoire.png&quot;&gt;

*Meddling with dark magic will increase the time until you receive your next blessing.*

(link: (text: &quot;Summon a &quot; + 1st of $options&#39;s 1st))[(display: &quot;blessDelay&quot;)(go-to: 2nd of $options&#39;s 1st)]
(link: (text: &quot;Summon a &quot; + 1st of $options&#39;s 2nd))[(display: &quot;blessDelay&quot;)(go-to: 2nd of $options&#39;s 2nd)]
(link: (text: &quot;Summon a &quot; + 1st of $options&#39;s 3rd))[(display: &quot;blessDelay&quot;)(go-to: 2nd of $options&#39;s 3rd)](if: $hunger &gt; 2)[
[[Eat the grimoire]]]
[[Leave the grimoire untouched|Main]]</tw-passagedata><tw-passagedata pid="575" name="grimoireHP" tags="" position="706,4625" size="100,100">Acrid smoke billows from the book. With time, it coalesces into a muddy poultice that effectively soothes your wounds.

[[Onwards!|Main]](set: $HP to it + 20)</tw-passagedata><tw-passagedata pid="576" name="grimoireDoom" tags="" position="1175,4629" size="100,100">It has too many eyes. Limbs form and retract in the ooze. It is large. Obscenely large; its filmy body almost fills the room.

It acts exactly as one might reasonably expect a bad-tempered shoggoth to act: by crushing you beneath its shapeless mass. 

&lt;img src=&quot;shoggoth.png&quot;&gt;

[[Perhaps summoning a bad-tempered shoggoth was not a good idea.|Main]](set: $HP to 0)(set: $sanity to 0)(if: not ($achievements contains &quot;Be glomped by a shoggoth&quot;))[(set: $achievements to it + (array: &quot;Be glomped by a shoggoth&quot;))]</tw-passagedata><tw-passagedata pid="577" name="grimoireSatiety" tags="" position="1057,4629" size="100,100">The meal arrives in a swirl of smoke. It is wholly unremarkable but for its manner of arrival. (set: $satiety to it + 20)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="578" name="grimoireEnergy" tags="" position="938,4627" size="100,100">Acrid smoke billows from the book. With time, it coalesces into a mug of coffee. It tastes bitter but good; you barely notice that this coffee has never known soil, rain, agriculture, or fire.

[[Onwards!|Main]](set: $energy to it + 20)</tw-passagedata><tw-passagedata pid="579" name="grimoireSanity" tags="" position="820,4629" size="100,100">Acrid smoke billows from the book. With time, it coalesces into a mug of hot chocolate. It tastes like the hot chocolate your mother once made, back when afternoons lasted longer, the world was taller, and the dungeon lay far in your wide-open future.

[[Onwards!|Main]](set: $sanity to it + 20)</tw-passagedata><tw-passagedata pid="580" name="blessDelay" tags="" position="923,4500" size="100,100">(if: $nextBlessing &lt; $turns)[(set: $nextBlessing to $turns + 7)(set: $cards to it - (array: &quot;blessings&quot;))](else:)[(set: $nextBlessing to it + 10)]</tw-passagedata><tw-passagedata pid="581" name="Eat the grimoire" tags="" position="508,4637" size="100,100">It tastes leathery. Peppery. Arcane. The pages wriggle in your throat; they were destined for grander things than this. But you persevere.

(set: $satiety to it + 20)(set: $sanity to it - 20)[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="582" name="grimoireCookie" tags="" position="1297,4623" size="100,100">Acrid smoke billows from the book. With time, it coalesces into an unremarkable chocolate-chip cookie.

(set: $cookies&#39;s basic to it + 1)[[Yum.|Main]]</tw-passagedata><tw-passagedata pid="583" name="subMenu1" tags="" position="607,194" size="100,100">(css: &quot;font-size: 80%;&quot;)[**Consumables**](css: &quot;font-size: 70%&quot;)[(if: not ($drink &gt; 0 and $scanner &gt; 0 and $trash &gt; 0))[
None](else:)[(if: $drink &gt; 0)[
Average juice x(print: $drink) ](if: $scanner &gt; 0)[
Breadcrumbs x(print: $scanner)](if: $trash &gt; 0)[
Dynamite x(print: $trash)]]](if: (datavalues: $cookies) is not (array: 0,0,0,0,0,0))[
(css: &quot;font-size: 80%&quot;)[
**Cookies**](css: &quot;font-size: 70%;&quot;)[
Chocolate x(print: $cookies&#39;s basic)(if: $cookies&#39;s healthful &gt; 0)[
Healthful x(print: $cookies&#39;s healthful)](if: $cookies&#39;s rainbow &gt; 0)[
Rainbow x(print: $cookies&#39;s rainbow)](if: $cookies&#39;s arcane &gt; 0)[
Arcane x(print: $cookies&#39;s arcane)](if: $cookies&#39;s disappearing &gt; 0)[
Disappearing x(print: $cookies&#39;s disappearing)](if: $cookies&#39;s eldritch &gt; 0)[
Eldritch x(print: $cookies&#39;s eldritch)]](if: $damageModify is not 1)[

Your armour deflects (round: 100 - (100 * $damageModify))% of damage from monster attacks]]

&lt;div class=&quot;yesClick&quot;&gt;(link: &quot;*Reveal more*&quot;)[(replace: ?sideMenu)[(display: &quot;subMenu2&quot;)]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="584" name="subMenu2" tags="" position="731,197" size="100,100">(css: &quot;font-size: 80%;&quot;)[&#39;&#39;Blessings:&#39;&#39;]
(css: &quot;font-size: 70%;&quot;)[(print: $blessings.join(&quot;, &quot;))](css: &quot;font-size: 80%;&quot;)[

(print: $god) is ascendant

You have (if: not ($inventory contains &quot;soul&quot;))[lost your](else:)[a] soul

]
&lt;div class=&quot;yesClick&quot;&gt;(link: &quot;*Reveal more*&quot;)[(replace: ?sideMenu)[(display: &quot;subMenu0&quot;)]]&lt;/div&gt;</tw-passagedata><tw-passagedata pid="585" name="subMenu0" tags="" position="568,297" size="100,100">(css: &quot;font-size: 80%;&quot;)[You have been
partying for (print: $turns) minutes

You have **[$keys]&lt;keyCount|** keys(if: $hats &gt; 0)[
You wear **(print: $hats)** hats]](if: $inventoryCheck is true)[

&lt;div class=&quot;yesClick&quot;&gt;(link: &quot;*Reveal more*&quot;)[(replace: ?sideMenu)[(display: &quot;subMenu1&quot;)]]&lt;/div&gt;]</tw-passagedata><tw-passagedata pid="586" name="Blessing of crabbiness" tags="" position="2430,175" size="100,100">A sinister orange portal opens before you. Fasten your courage to the sticking post; you&#39;ll need it where you&#39;re going.

&lt;img src=&quot;portal2.png&quot;&gt;

[[Step through|CRABSINTRO]](set: $blessings to it + (array: &quot;crabbiness&quot;))</tw-passagedata><tw-passagedata pid="587" name="CRABS" tags="crab" position="4825,498" size="100,100">(print: 1st of $crabFlavour)(set: $crabFlavour to (rotated: 1, ...$crabFlavour))(set: $sanity to it - $crabDrain)(set: $crabDrain to it + 1)(set: $crabCards to (shuffled: ... it))

The passage forks. Where will you go?

|crab1&gt;[(link: (text:&quot;Head to the &quot; + 1st of $crabCards))[(if: (random: 1,6) is 1)[(goto: &quot;crabGuard&quot;)](else:)[(goto: 1st of $crabCards)]]]
|crab2&gt;[(link: (text:&quot;Head to the &quot; + 2nd of $crabCards))[(if: (random: 1,6) is 1)[(goto: &quot;crabGuard&quot;)](else:)[(goto: 2nd of $crabCards)]]]

(display: &quot;actions&quot;)(if: (random: 1,10) is 1)[(replace: (either: ?crab1, ?crab2))[[[Head to the aquarium|aquarium]]]](if: (random: 1,3) is 1)[(replace: (either: ?crab1, ?crab2))[[[Head to the glowing portal|glowing portal]]]](display: &quot;deathable&quot;)</tw-passagedata><tw-passagedata pid="588" name="CRABSINTRO" tags="crab" position="4828,360" size="100,100">You are in a maze of gnarled passageways. Windows look out to the bed of a murky ocean; you can sense the water&#39;s weight above you. Faint scuttling noises sound from within the walls.

*Careful! The longer you stay in this place the faster your sanity will degrade.*

[[Explore|CRABS]](set: $crabDrain to 1)(set: $crabFlavour to (shuffled: ...(array: &quot;A school of tiny crabs scramble over your feet.&quot;,&quot;Windows look over the sea floor. Dim lumbering shapes move in the murk outside.&quot;,&quot;You hear a cry in the distance. It sounds human.&quot;,&quot;Knots of seaweed scrape against the windows. The sound is like fingers on glass.&quot;,&quot;Bits of crabshell and gristle litter the floor. What happened here?&quot;,&quot;A window on the ceiling shows nothing but water. The ocean&#39;s surface is too far away to see.&quot;,&quot;The walls here have sprung a leak. The floor is slick with moisture.&quot;,&quot;Through a window you see four rows of crabs marching edgewise. The line extends further than you can see in both directions.&quot;,&quot;A repeating pattern of shapes has been scratched into the wall. It looks like writing. Are these instructions? Warnings? The poetry of crabs?&quot;,&quot;Your body feels too heavy; your sense of balance is disturbed. The gravity in this place is wrong.&quot;)))(set: $card to &quot;none&quot;)(set: $crabCards to (array: &quot;nursery&quot;, &quot;boneyard&quot;, &quot;sleeping quarters&quot;, &quot;cellar&quot;, &quot;armory&quot;, &quot;storeroom&quot;, &quot;prison&quot;))(if: $sanity &lt; 25)[(set: $sanity to 25)]&lt;script&gt;
stopaudio();
audio.crabs.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="589" name="armory" tags="crab" position="5112,419" size="100,100">Rusting shields, chitinous armour, and moulted crabshells lie in heaps on the floor. None of it looks designed for humans. (if: $inventory contains &quot;greaves&quot;)[There is nothing for you here.](else:)[But here, in a corner, are some scraps that could serve as makeshift greaves.

*The greaves slightly reduce damage taken when attacked.*]

&lt;img src=&quot;crabShield.png&quot;&gt;

(if: not ($inventory contains &quot;greaves&quot;))[(link: &quot;Take the greaves&quot;)[(set: $damageModify to it * 0.8)(set: $inventory to it + (array: &quot;greaves&quot;))(goto: &quot;CRABS&quot;)]]
[[Leave the armory|CRABS]]</tw-passagedata><tw-passagedata pid="590" name="cellar" tags="crab" position="5178,680" size="100,100">The ceiling here is low. Barrels are stacked against the far wall. 

&lt;img src=&quot;barrel.png&quot;&gt;

[[Drink the Crabcosan ale]]
[[Drink the sea-brine]]</tw-passagedata><tw-passagedata pid="591" name="Drink the Crabcosan ale" tags="crab" position="5020,754" size="100,100">Fragments of music come to you. These are the words, but they are not in any language you know:

*The King is in tatters
The lake is drying
The night is falling
On dim Crabcosa

Gather your wits
Fasten your courage
For tonight we leave
Lost Crabcosa

Mourn not the old seas
Though the night will be long
Tomorrow we reach
New Crabcosa*

[[Gather your wayward thoughts|CRABS]](set: $HP to it + 5)(set: $energy to it + 5)</tw-passagedata><tw-passagedata pid="592" name="Drink the sea-brine" tags="crab" position="5040,609" size="100,100">It does little to slake your thirst. (set: $satiety to it - 5)

[[Onwards.|CRABS]]</tw-passagedata><tw-passagedata pid="593" name="glowing portal" tags="crab" position="5111,294" size="100,100">The portal has reappeared. Now is your chance to return to the dungeon.

(link: &quot;Return&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(goto: &quot;Main&quot;)]
[[Remain a while longer|CRABS]]</tw-passagedata><tw-passagedata pid="594" name="storeroom" tags="crab" position="4836,910" size="100,100">The chamber is stacked high with crates. (if: not ($ankh is 1))[Something shiny attracts your attention: an ankh, left haphazardly atop one of the taller piles.]

&lt;img src = &quot;crateCrab.png&quot;&gt;

(if: not ($ankh is 1))[(link: &quot;Take the ankh&quot;)[(set: $icons to it + (array: &#39;&lt;img src=&quot;sAnkh.png&quot;&gt;&#39;))(set: $ankh to 1)(goto: &quot;CRABS&quot;)]
][[Open a random crate]]</tw-passagedata><tw-passagedata pid="595" name="Open a random crate" tags="crab" position="4878,792" size="100,100">(set: $r to (random: 1,3))The crate contained (if: $r is 1)[some edible algae! (set:$satiety to it + 10)](if: $r is 2)[an edible caffeineworm!(set: $energy to it + 10)](if: $r is 3)[a highly nutritious mollusc!(set: $satiety to it + 1)(set: $HP to it + 10)]

[[Delicious.|CRABS]]</tw-passagedata><tw-passagedata pid="596" name="nursery" tags="crab" position="4695,784" size="100,100">Crab eggs are nestled in beds of algae. Some are small. Most are not.

&lt;img src=&quot;crabEgg.png&quot;&gt;

[[Pocket an egg]]
(link: &quot;Eat an egg&quot;)[(set: $satiety to it + 10)(goto: &quot;CRABS&quot;)]</tw-passagedata><tw-passagedata pid="597" name="Pocket an egg" tags="crab" position="4693,647" size="100,100">You might be able to trade it for something later.(set: $inventory to it + (array: &quot;egg&quot;))

[[Onwards!|CRABS]]</tw-passagedata><tw-passagedata pid="598" name="boneyard" tags="crab" position="4523,739" size="100,100">Bones and carapaces crunch underfood. Most of the skeletons are clearly from crabs, but some look distinctly human. And look - here is the detritus of human lives. A tarnished brooch. A comb. Waterlogged photographs. And a small bottle of average juice, miraculously still intact. (set: $drink to it + 1)

&lt;img src=&quot;crabBone.png&quot;&gt;

[[Onwards!|CRABS]]</tw-passagedata><tw-passagedata pid="599" name="sleeping quarters" tags="crab" position="4613,349" size="100,100">Crabs of all sizes slumber in beds of sand and algae. Step lightly; you don&#39;t want to wake them.

Patterns of stones and shells adorn the crabs&#39; resting places. Some have used glass bottles to decorate; a few bottles still have liquid inside them.

&lt;img src=&quot;crab.png&quot;&gt;

(link: &quot;Steal a conveniently-labelled health potion&quot;)[(set: $HP to it + 20)(goto: &quot;CRABS&quot;)]
(link: &quot;Steal a conveniently-labelled energy potion&quot;)[(set: $energy to it + 20)(goto: &quot;CRABS&quot;)]</tw-passagedata><tw-passagedata pid="600" name="crabPortal" tags="" position="4215,128" size="100,100">A sinister orange portal opens before you. Fasten your courage to the sticking post; you&#39;ll need it where you&#39;re going.

&lt;img src=&quot;portal2.png&quot;&gt;

[[Step through|CRABSINTRO]]
[[Don&#39;t step through|Main]]</tw-passagedata><tw-passagedata pid="601" name="crabGuard" tags="crab" position="4904,195" size="100,100">You are intercepted by a hermit guard.

&lt;img src=&quot;hermit.png&quot;&gt;

(link: &quot;Run&quot;)[(set: $energy to it - 5)(if: (random: 1,100) &lt;= 80)[(goto: &quot;crabGuardSuccess&quot;)](else:)[(goto: &quot;crabGuardDefeat&quot;)]] *80% chance of success*
(link: &quot;Run extra fast&quot;)[(set: $energy to it - 15)(if: (random: 1,100) &lt;= 95)[(goto: &quot;crabGuardSuccess&quot;)](else:)[(goto: &quot;crabGuardDefeat&quot;)]] *95% chance of success*
[[Let it do its worst|crabGuardDefeat]]</tw-passagedata><tw-passagedata pid="602" name="crabGuardDefeat" tags="crab" position="5072,122" size="100,100">It hauls you through a series of passageways. When it reaches a portal it throws you through it.

(link: &quot;Drat.&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="603" name="crabGuardSuccess" tags="crab" position="4934,54" size="100,100">You outrun the crab guard.

[[Huzzah!|CRABS]]</tw-passagedata><tw-passagedata pid="604" name="prison" tags="crab" position="4608,92" size="100,100">Most of the cages are empty. This one is not.

&lt;img src=&quot;crabCage.png&quot;&gt;

[[Speak with the prisoner]]
(link: &quot;Use a key to free the prisoner&quot;)[(if: $keys &lt; 1)[*You have no keys.*](else:)[(goto: &quot;prisoner&quot;)]]</tw-passagedata><tw-passagedata pid="605" name="prisoner" tags="crab" position="4772,168" size="100,100">(set: $keys to it - 1)(set: $inventory to it + (array: &quot;cudgel&quot;))They thank you profusely before retrieving a hand-carved cudgel from the back of the cage. The handle is wrapped in supple leather, and the wood is engraved with carvings of sea creatures.

&lt;img src=&quot;cudgel.png&quot;&gt;

*Cudgelling watermelons with the deluxe cudgel can help manage unnatural hungers, among other benefits*

(if: (count: $inventory, &quot;cudgel&quot;) &gt; 1)[[[That&#39;s nice, but you already have a deluxe cudgel.|CRABS]]](else:)[[[How lovely.|CRABS]]]</tw-passagedata><tw-passagedata pid="606" name="Speak with the prisoner" tags="crab" position="4653,220" size="100,100">The prisoner has been here a long time. Long enough to decode some of the language of the crabs. Long enough to understand something of their plans.

(set: $inklings to it + 1)*You now have (print: $inklings) Inklings of a deeper purpose.*

[[Onwards!|CRABS]]</tw-passagedata><tw-passagedata pid="607" name="Barter your soul instead" tags="" position="1080,2589" size="100,100">The exchange is made. You feel no different. (Did you sell the part of yourself that would register the absence?)

[[Onwards!|Main]](set: $inventory to it - (array: &quot;soul&quot;))</tw-passagedata><tw-passagedata pid="608" name="mawbeast" tags="" position="884,4128" size="100,100">A spectral mawbeast floats at about the height of your waist. Drool drips to the floor beneath it.(set: $monster to (datamap: &quot;fleeChance&quot;, 50, &quot;type&quot;, &quot;mawbeast&quot;, &quot;damage&quot;, 12))

&lt;img src=&quot;mawbeast.png&quot;&gt;(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually small.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks especially hungry.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="609" name="ratKing" tags="" position="253,4710" size="100,100">The rat chases you to the chamber of King Rat. He stands absurdly tall before you.

The Rat King offers a deal. He will bestow the Blessing of Rattiness in exchange for a key.

&lt;img src=&quot;ratKing.png&quot;&gt;

(link: &quot;Make the trade&quot;)[(if: $keys &gt; 0)[(set: $keys to it - 1)(goto: &quot;rattiness&quot;)](else:)[*You have no keys*]](if: $inventory contains &quot;soul&quot;)[
(link: &quot;Barter your soul instead&quot;)[(set: $inventory to it - (array: &quot;soul&quot;))(goto: &quot;rattiness&quot;)] *You can only barter your soul once*]
(link: &quot;Run away again&quot;)[(set: $energy to it - 5)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="610" name="rattiness" tags="" position="256,4821" size="100,100">Rats know how to eat spoiled food without becoming ill. They have a keen sense of smell, are immune to many viruses, and unlike humans require only 10 units of energy to run very fast.

You learn all these things and more as the rat king blesses you.(set: $inventory to it - (array: &quot;soul&quot;))(set: $blessings to it + (array: &quot;rattiness&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="611" name="aquarium" tags="crab" position="4420,458" size="100,100">The aquarium has only one inhabitant: a collosal octopus. It raises a tentacle in a slow and deliberate wave. 

&lt;img src=&quot;octopus.png&quot;&gt;

[[Marvel at the octopus]](if: $tentacled &gt;= 4)[
[[Wave a tentacle in response]]]</tw-passagedata><tw-passagedata pid="612" name="Marvel at the octopus" tags="crab" position="4513,611" size="100,100">What a friendly-looking octopus! (set: $sanity to it + 1)

[[Onwards|CRABS]]</tw-passagedata><tw-passagedata pid="613" name="Wave a tentacle in response" tags="crab" position="4578,491" size="100,100">(set: $sanity to it + 15)A kindred spirit! You wave your tentacles excitedly.

[[Onwards|CRABS]]</tw-passagedata><tw-passagedata pid="614" name="Offer it your soul in apology" tags="" position="1209,1580" size="100,100">The exchange is made, and the sensation of being watched by some ancient power lifts. (set: $cards to it - (array: &quot;displeasedGod&quot;))(set: $cards to it - (array: &quot;furiousGod&quot;))

[[Onwards!|Main]](set: $inventory to it - (array: &quot;soul&quot;))</tw-passagedata><tw-passagedata pid="615" name="memory" tags="" position="4556,1237" size="100,100">You find yourself thinking on the past. Who were you before you entered the dungeon?(set: $cards to it - (array: &quot;memory&quot;))

&lt;img src = &quot;mask.png&quot;&gt;

[[No one]](if: $achievements&#39;s length &gt;= 5)[
[[A jogger]]](if: $achievements&#39;s length &gt;= 10)[
[[An amateur ornithologist]]](if: $achievements&#39;s length &gt;= 15)[
[[A gourmand]]](if: $achievements&#39;s length &gt;= 20)[
[[A dabbler in the dark arts]]](if: $achievements&#39;s length &gt;= 25)[
[[An avid chess player]]](if: $achievements&#39;s length &gt;= 30)[
[[A navigator]]](if: $achievements&#39;s length &gt;= 35)[
[[A fingersmith]]](if: (random: 1,10) is 1 and $achievements&#39;s length &gt;=4)[
[[A child of the 90s]]]</tw-passagedata><tw-passagedata pid="616" name="No one" tags="" position="4446,1387" size="100,100">Your past is wreathed in shadows. Let it stay hidden; you have no need for it.

*Achieving achievements will unlock additional options*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="617" name="A jogger" tags="" position="4686,1387" size="100,100">In your life outside the dungeon you would run for the joy of it, the wind battering your face and the grass yielding under your feet.

There is no wind down here. No horizon. The air is stale. But you can still run. (set: $fleeBonus to it + 10)(set: $unBonus to it + 5)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="618" name="An amateur ornithologist" tags="" position="4556,1387" size="100,100">You don&#39;t expect to find many birds in the dungeon&#39;s darkness. So you have brought some of your own.
(set: $ally to (datamap: &quot;type&quot;, &quot;pigeons&quot;, &quot;health&quot;, 80, &quot;maxHealth&quot;, 100))\
(set: $cards to it + (array: &quot;pigeons&quot;))\

&lt;img src=&quot;pigeon.png&quot;&gt;

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="619" name="A dabbler in the dark arts" tags="" position="4442,1500" size="100,100">(set: $inventory to it - (array: &quot;soul&quot;))(set: $inventory to it + (array: &quot;soulless&quot;))You have dabbled extensively, if amateurishly, in the dark arts. This has yielded certain benefits (for example: you can come back from the dead) but has also had its drawbacks (for example: you no longer have a soul.)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="620" name="queen" tags="" position="4559,1620" size="100,100">The Queen in White whispers in your pocket. (if: (random: 1,2) is 1)[She tells you that everything will turn out for the best. (set: $sanity to it + 20)

&lt;img src = &quot;queen.png&quot;&gt;

[[How reassuring|Main]]](else:)[She says you will soon come to a terrible end. (set: $sanity to it - 10)

&lt;img src = &quot;queen.png&quot;&gt;

[[How unsettling|Main]]]</tw-passagedata><tw-passagedata pid="621" name="An avid chess player" tags="" position="4557,1503" size="100,100">You collect antique chess pieces. You carry one in your pocket. Sometimes it speaks to you. (set: $cards to it + (array: &quot;queen&quot;))

*When you gain sanity: gain +30% sanity*
*When you lose sanity: lose +20% sanity*

[[Onwards!|Main]](set: $execute to it + (array: &#39;(set: $sanity to it + (max: 0, (round: ($sanity - $sanityOld) * 0.3))) (set: $sanity to it + (min: 0, (round: ($sanity - $sanityOld) * 0.2)))&#39;))</tw-passagedata><tw-passagedata pid="622" name="A navigator" tags="" position="4682,1502" size="100,100">You dream of open waters and lost coastlines. You have learnt to rely on the stars in those places where maps are false and compasses fail.

There are no stars here. There are no maps. But your sense of direction may nonetheless prove useful. 

*The crossroads are now a common location*(set: $rareCards to it - (array: &quot;crossroads&quot;))(set: $cards to it + (array: &quot;crossroads&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="623" name="gas" tags="" position="3579,669" size="100,100">Thick clouds of noxious gas singe your nostrils and obscure your view. Linger here and the poison will enter your bloodstream. 

&lt;img src = &quot;gas.png&quot;&gt;

[[Hold your breath and pass through quickly.]] *You will probably be fine.*
[[Search for treasure. Breathe deep.]]</tw-passagedata><tw-passagedata pid="624" name="Hold your breath and pass through quickly." tags="" position="3514,819" size="100,100">(if: (random: 1,5) is 1)[You almost make it to the opposite door before the urge to inhale overcomes you. Almost.

(set: $inventory to it + (array: &quot;poisoned&quot;))](else:)[You pass through the room without incident]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="625" name="Search for treasure. Breathe deep." tags="" position="3663,817" size="100,100">(set: $inventory to it + (array: &quot;poisoned&quot;, &quot;poisoned&quot;))\
(if: (random: 1,2) is 1)[You find nothing.

[[Onwards|Main]]](else:)[(display: &quot;stockGifts&quot;)\
Fumbling through the gas, you find an unlocked chest on the ground.

[[Whatever could be inside?|(print: 1st of (shuffled: ...$gift))]]]</tw-passagedata><tw-passagedata pid="626" name="space" tags="" position="4907,1655" size="100,100">You catch sight of somebody (or something?) in a space suit, a severed tether dangling behind it. It raises a hand in a brief uncertain greeting before leaving the room.

&lt;img src = &quot;astronaut.png&quot;&gt;

(link: &quot;Follow it&quot;)[&lt;script&gt;
stopaudio();
audio.space.play();
&lt;/script&gt;(goto: &quot;space0&quot;)]
[[Leave it to its business|Main]]</tw-passagedata><tw-passagedata pid="627" name="space1" tags="space" position="4904,1893" size="100,100">(if: $spaceProgress &gt;= 6 and (random: 1,3) is 1)[(goto: &quot;space2&quot;)](else:)[(set: $spaceProgress to it + 1)(set: $spaceGo to $space)\
(if: $spaceGo is 1)[You look out a window to see stars. The view lists to one side in a steady sickening sweep.(set: $sanity to it - 3)(set: $space to (either: 2,3,4,5))]\
(if: $spaceGo is 2)[The vents rasp and rattle. The air here is too thin; you gulp down lungful after lungful and still it&#39;s not enough.(set: $HP to it - 3)(set: $energy to it - 3)(set: $space to (either: 1,3,4,5))]\
(if: $spaceGo is 3)[Suitcases and luggage are strewn across the floor. You note an abundance of business suits, each tailored to accommodate more limbs than one would usually think necessary.(set: $sanity to it - 5)(set: $space to (either: 1,2,4,5))]\
(if: $spaceGo is 4)[The temperature drops. Your breath comes out in puffs of steam. Frost forms on the metal walls.(set: $HP to it - 5)(set: $space to (either: 1,2,3,5))]\
(if: $spaceGo is 5)[A featureless hallway extends on for what must be kilometres, curving ever so slightly to the right. It is a long walk. (set: $energy to it - 5)(set: $space to (either: 1,2,3,4))](set: $satiety to it - $hunger)\


[[Explore further|space1]]
[[Turn back|Main]]](display: &quot;deathable&quot;)</tw-passagedata><tw-passagedata pid="628" name="space0" tags="space" position="4904,1777" size="100,100">Your pursuit takes you to a new part of the dungeon. The walls here are metal. The floor reverberates with a distant hum. The air is thinner, colder, drier than you are used to.

You begin to shiver.

(set: $spaceProgress to 0)(set: $space to (random: 1,5))(set: $energy to it - 3)[[Explore|space1]]
[[Turn back|Main]]</tw-passagedata><tw-passagedata pid="629" name="space2" tags="space" position="4902,2013" size="100,100">Here, alone on a metal rack, is some kind of alien weapon. It&#39;s cold to the touch.

This could prove useful. (set: $inventory to it + (array: &quot;freezeRay&quot;))

&lt;img src=&quot;freezeRay.png&quot;&gt;

(link: &quot;Onwards!&quot;)[&lt;script&gt;
stopaudio();
&lt;/script&gt;(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="630" name="A box full of live snakes" tags="" position="258,2036" size="100,100">You decant the awful writhing lot of them on the floor. They promptly slither away. (set: $cards to it + (array: &quot;snake1&quot;, &quot;snake2&quot;, &quot;snake3&quot;))

(if: not ($achievements contains &quot;Choose the box of snakes&quot;))[(set: $achievements to it + (array: &quot;Choose the box of snakes&quot;))]\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="631" name="snake1" tags="" position="715,4833" size="100,100">It&#39;s a venomous w-snake! It rears up, ready to attack. Stupid ungrateful snake.

&lt;img src=&quot;snakeW.png&quot;&gt;

(set: $cards to it - (array: &quot;snake1&quot;))(set: $monster to (datamap: &quot;fleeChance&quot;, 60, &quot;damage&quot;, 5, &quot;type&quot;, &quot;poison&quot;))(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="632" name="snake2" tags="" position="836,4825" size="100,100">It&#39;s a venomous two-headed J-snake! It doesn&#39;t look happy to see you. Stupid ungrateful snake.

&lt;img src=&quot;snakeJ.png&quot;&gt;

(set: $cards to it - (array: &quot;snake2&quot;))(set: $monster to (datamap: &quot;fleeChance&quot;, 60, &quot;damage&quot;, 5, &quot;type&quot;, &quot;poison&quot;))(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="633" name="snake3" tags="" position="958,4837" size="100,100">It&#39;s a venomous S-snake! It hisses angrily. Stupid ungrateful snake.

&lt;img src=&quot;snakeS.png&quot;&gt;

(set: $cards to it - (array: &quot;snake3&quot;))(set: $monster to (datamap: &quot;fleeChance&quot;, 60, &quot;damage&quot;, 5, &quot;type&quot;, &quot;poison&quot;))(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="634" name="Fire your freezeray" tags="" position="1516,1520" size="100,100">Your aim is true; the creature is frozen in place. 

You don&#39;t know how long the effect will last. Better make your exit.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="635" name="A gleaming beige amulet" tags="" position="374,2034" size="100,100">A breadcrumb amulet! The amulet increases the effectiveness of breadcrumbs. 

Its gem gleams wheatily.(if: $inventory contains &quot;amulet&quot;)[ 

(Wearing more than one amulet will only slightly increase its effectiveness.) (set: $uncommonCards to it + (array: &quot;amulet&quot;))](else:)[(set: $cards to it + (array: &quot;amulet&quot;))(set: $rareishCards to it + (array: &quot;amulet&quot;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sAmulet.png&quot;&gt;&#39;))](set: $inventory to it + (array: &quot;amulet&quot;))

&lt;img src=&quot;amulet.png&quot;&gt;

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="636" name="amulet" tags="" position="1991,2759" size="100,100">|page&gt;[Your breadcrumb amulet shines neon beige. Breadcrumbs must be nearby.

&lt;img src = &quot;amulet.png&quot;&gt;

(link: &quot;Follow the amulet&quot;)[(replace: ?page)[(if: not ($cards contains 1st of (shuffled: ...$crumbed)))[(display: &quot;wreckage&quot;)](else:)[(display: 1st of (shuffled: ...$crumbed))]]]]</tw-passagedata><tw-passagedata pid="637" name="frog" tags="" position="3713,2246" size="100,100">A frog croaks apathetically somewhere in the sub-dungeon&#39;s gloom.

&lt;img src=&quot;frog.png&quot;&gt;

(link: &quot;What&#39;s even the point?&quot;)[(set: $energy to it - 5)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="638" name="A child of the 90s" tags="" position="4804,1390" size="100,100">You were born in the twilight of the 80s, spent the bulk of your childhood in the 90s. The experience was indelible. Still now the music echoes in your mind.

(set: $inventory to it + (array: &quot;90s&quot;))[[Onwards!|Main]]&lt;script&gt;
stopaudio();
audio.smashmouth.play();
&lt;/script&gt;</tw-passagedata><tw-passagedata pid="639" name="saveGame3" tags="" position="1360,533" size="100,100">Something vast and unknowable has noted your progress.

&lt;img src=&quot;eyeSave2.png&quot;&gt;

*Your game has been saved.*

[[Head deeper into the dungeon|Main]]
(link: &quot;Imagine yourself elsewhere&quot;)[*This will* (link: &quot;*close the game*&quot;)[&lt;script&gt;window.close()&lt;/script&gt;]](either: &#39;&lt;script&gt;
stopaudio();
audio.subdungeon.play();
&lt;/script&gt;&#39;,&#39;&lt;script&gt;
stopaudio();
audio.subSave.play();
&lt;/script&gt;&#39;)</tw-passagedata><tw-passagedata pid="640" name="stockGifts" tags="" position="306,2308" size="100,100">(set: $gift to (array: &quot;[[Average juice]]&quot;,&quot;[[Dynamite]]&quot;,&quot;[[Breadcrumbs]]&quot;,&quot;[[A key]]&quot;, &quot;[[A hat]]&quot;))\
(if: $ankh is 0)[(set: $gift to it + (array: &quot;[[A metal cross with a handle]]&quot;))]\
(if: (random: 1,3) &gt; 1)[(if: $crumbed&#39;s length &gt; 0 and not ($inventory contains &quot;amulet&quot;))[(set: $gift to it + (array: &quot;[[A gleaming beige amulet]]&quot;))]\
(if: not ($inventory contains &quot;runners&quot;))[(set: $gift to it + (array: &quot;[[New runners]]&quot;))]\
(if: not ($inventory contains &quot;socks&quot;))[(set: $gift to it + (array: &quot;[[Running socks]]&quot;))]]\
(if: $curses contains &quot;badCat&quot;)[(set: $gift to it + (array: &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;, &quot;[[A cat in a box]]&quot;))]</tw-passagedata><tw-passagedata pid="641" name="hungerIcons" tags="" position="856,108" size="100,100">(if: $hunger is 1)[(set: $icons to it - (array: &#39;&lt;img src=&quot;sHungerish.png&quot;&gt;&#39;, &#39;&lt;img src=&quot;sHunger.png&quot;&gt;&#39;))](if: $hunger is 2)[(set: $icons to it - (array: &#39;&lt;img src=&quot;sHunger.png&quot;&gt;&#39;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sHungerish.png&quot;&gt;&#39;))](if: $hunger is 3)[(set: $icons to it - (array: &#39;&lt;img src=&quot;sHungerish.png&quot;&gt;&#39;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sHunger.png&quot;&gt;&#39;))]</tw-passagedata><tw-passagedata pid="642" name="craft" tags="" position="2030,4675" size="100,100">You find a crafting cube of Crabcosan design. It&#39;s too heavy to carry, but you could use it now. Place two objects inside and close the lid; the cube will fashion something new from their essences.

A sticky note has been attached to the side. The following recipe is scrawled on it: * (print: $r) = ?*

&lt;img src = &quot;craftCube.png&quot;&gt;

**Item 1:** (link: $craftItem1&#39;s 1st)[(set: $craftItem1 to (rotated: -3, ...$craftItem1))(if: $craftItem1&#39;s 2nd &lt; 2 and $craftItem1&#39;s 1st is $craftItem2&#39;s 1st)[(set: $craftItem1 to (rotated: -3, ...$craftItem2))](goto: &quot;craft&quot;)] (if: not ($craftItem1&#39;s 1st is &quot;Nothing&quot;))[*((print: $craftItem1&#39;s 2nd) available)*]
**Item 2:** (link: $craftItem2&#39;s 1st)[(set: $craftItem2 to (rotated: -3, ...$craftItem2))(if: $craftItem2&#39;s 2nd &lt; 2 and $craftItem2&#39;s 1st is $craftItem1&#39;s 1st)[(set: $craftItem2 to (rotated: -3, ...$craftItem2))](goto: &quot;craft&quot;)] (if: not ($craftItem2&#39;s 1st is &quot;Nothing&quot;))[*((print: $craftItem2&#39;s 2nd) available)*]

(link: &quot;Craft!&quot;)[(print: $craftItem1&#39;s 3rd)(print: $craftItem2&#39;s 3rd)
(set: $craftOptions to (array: $craftItem1&#39;s 1st, $craftItem2&#39;s 1st))(goto: &quot;craft2&quot;)]</tw-passagedata><tw-passagedata pid="643" name="craft2" tags="" position="2031,4793" size="100,100">(if: $craftOptions contains &quot;Nothing&quot;)[You open the box to find nothing inside.

[[Nothing.|Main]]]\
(else-if: $craftOptions is (array: &quot;Breadcrumbs&quot;, &quot;Breadcrumbs&quot;) or ($craftOptions contains &quot;Breadcrumbs&quot; and $craftOptions contains &quot;Key&quot;))[The crafting cube whirrs, clunks, then falls silent once more.

[[What&#39;s this inside?|A gleaming beige amulet]]]\
(else-if: $craftOptions is (array: &quot;Hat&quot;, &quot;Hat&quot;))[The crafting cube whirrs, clunks, then falls silent once more.

You find a reinforced hat inside. It will somewhat reduce damage taken from the dungeon&#39;s monsters.(set: $damangeModity to it * 0.85)

[[Onwards!|Main]]]\
(else-if: $craftOptions contains &quot;Chocolate-chip cookie&quot; and $craftOptions contains &quot;Breadcrumbs&quot;)[The crafting cube whirrs, clunks, then falls silent once more. The smell of baking fills the room.

You find an eldritch cookie inside the cube. (set: $cookies&#39;s eldritch to it + 1)

[[Delicious!|Main]]]\
(else-if: $craftOptions contains &quot;Average juice&quot; and $craftOptions contains &quot;Dynamite&quot;)[The crafting cube whirrs, clunks, then falls silent once more.

You find a dynamite-themed energy drink inside. Apparently it contains an EXPLOSIVE BURST of CAFFEINE. (set: $energy to $statMax)

[[Delicious!|Main]]]\
(else-if: $craftOptions is (array: &quot;Average juice&quot;, &quot;Average juice&quot;))[The crafting cube whirrs, clunks, then falls silent with a final musical clink.

You find a bottle of extra-average juice inside. You&#39;ll need to drink it immediately; extra-average juice spoils fast.

(link: &quot;Drink the extra-average juice&quot;)[(set: $r to (round: $statMax / 2))(set: $HP to $r)(set: $sanity to $r)(set: $energy to $r)(set: $satiety to $r)(goto: &quot;Main&quot;)]
(link: &quot;Don&#39;t drink the extra-average juice&quot;)[(goto: &quot;Main&quot;)]]\
(else-if: $craftOptions contains &quot;Key&quot; and $craftOptions contains &quot;Average juice&quot;)[The crafting cube whirrs, clunks, then falls silent with a final musical clink.

Inside it is a sleek bottle of grey potion. Drinking it will greatly increase your speed.(set: $fleeBonus to it + 25)

[[Onwards!|Main]]]\
(else-if: $craftOptions contains &quot;Average juice&quot; and $craftOptions contains &quot;Breadcrumbs&quot;)[The crafting cube whirrs, clunks, then falls silent once more. A wheaty smell fills the room.

You find a hearty wheat-drink inside the cube. It will fully sate your hunger and eliminate untoward cravings.

(set: $satiety to $statMax)(set: $hunger to 1)[[Onwards!|Main]]]\
(else-if: $craftOptions is (array: &quot;Dynamite&quot;, &quot;Dynamite&quot;))[The crafting cube whirrs and clunks. Wind begins to swirl out from inside it.

(display: &quot;tornado&quot;)]\
(else:)[You open the cube to find a wobbling lump of magical goo.

*There are many other possible outcomes. Keep experimenting.*

|feed&gt;[(link: &quot;Eat it.&quot;)[(set: $HP to it + 5)(set: $sanity to it + 5)(set: $energy to it + 5)(set: $satiety to it + 5)(replace: ?Health)[(color: green)[$HP]](replace: ?Sanity)[(color: green)[$sanity]](replace: ?Energy)[(color: green)[$energy]](replace: ?Satiety)[(color: green)[$satiety]](replace: ?feed)[(link: &quot;Leave.&quot;)[(goto: &quot;Main&quot;)]]]]
(link: &quot;Craft something else.&quot;)[(goto: &quot;preCraft&quot;)]]</tw-passagedata><tw-passagedata pid="644" name="preCraft" tags="" position="2038,4558" size="100,100">(set: $craftOptions to (array: &quot;Nothing&quot;, 2, &quot;&quot;))\
(if: $trash &gt; 0)[(set: $craftOptions to it + (array: &quot;Dynamite&quot;, (abs: $trash), &quot;(set: $trash to it - 1)&quot;))]\
(if: $scanner &gt; 0)[(set: $craftOptions to it + (array: &quot;Breadcrumbs&quot;, (abs: $scanner), &quot;(set: $scanner to it - 1)&quot;))]\
(if: $drink &gt; 0)[(set: $craftOptions to it + (array: &quot;Average juice&quot;, (abs: $drink), &quot;(set: $drink to it - 1)&quot;))]\
(if: $hats &gt; 0)[(set: $craftOptions to it + (array: &quot;Hat&quot;, (abs: $hats), &quot;(set: $hats to it - 1)&quot;))]\
(if: $cookies&#39;s basic &gt; 0)[(set: $craftOptions to it + (array: &quot;Chocolate-chip cookie&quot;, (abs: $cookies&#39;s basic), &quot;(set: $cookies&#39;s basic to it - 1)&quot;))]\
(if: $keys &gt; 0)[(set: $craftOptions to it + (array: &quot;Key&quot;, (abs: $keys), &quot;(set: $keys to it - 1)&quot;))]\
(set: $r to (either: &#39;average juice + average juice&#39;, &#39;breacrumbs + cookie&#39;, &#39;hat + hat&#39;, &#39;breadcrumbs + key&#39;, &#39;average juice + key&#39;, &#39;average juice + breadcrumbs&#39;, &#39;dynamite + dynamite&#39;, &#39;hat + hat&#39;, &#39;dynamite + average juice&#39;))\
(set: $craftItem1 to $craftOptions)\
(set: $craftItem2 to $craftOptions)(display: &quot;craft&quot;)</tw-passagedata><tw-passagedata pid="645" name="grimoireCube" tags="" position="1298,4737" size="100,100">Acrid smoke billows from the book and condenses before you. Something forms inside.

[[Investigate.|preCraft]]</tw-passagedata><tw-passagedata pid="646" name="wreckage" tags="" position="1997,2867" size="100,100">The room has been destroyed. Embers smoulder like sexy, misunderstood vampires.

[[Oh well|Main]]</tw-passagedata><tw-passagedata pid="647" name="inventory" tags="" position="2321,4769" size="100,100">You have an epiphany. No longer must you rely on your memory to know what items you are carrying; you can open your bag and check. 

&lt;img src=&quot;backpack.png&quot;&gt;

*You can now check your inventory via the sidebar*

[[Brilliant.|Main]](set: $cards to it - (array: &quot;inventory&quot;))(set: $inventoryCheck to true)</tw-passagedata><tw-passagedata pid="648" name="northBound" tags="" position="1546,3256" size="100,100">You are headed North. 

(either: &quot;Like the mouse that chases the bird&quot;, &quot;Like the seekers of a long-dead name&quot;, &quot;Like a fox pursued by hounds&quot;, &quot;Like the burial-barges of the Flute-kings&quot;).

(link: &quot;North.&quot;)[(set: $sanity to it - 1)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="649" name="leaveNorth" tags="" position="2403,372" size="100,100">You know which direction North is. You will walk that way until you are no longer here.

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="650" name="Head north together" tags="" position="1516,1623" size="100,100">And why not? (set: $sanity to it - $monster&#39;s damage)

[[North.|Main]]</tw-passagedata><tw-passagedata pid="651" name="achieveCheck" tags="" position="478,192" size="100,100">(if: $turns &gt;= 60 and not ($achievements contains &quot;Survive an hour&quot;))[(set: $achievements to it + (array: &quot;Survive an hour&quot;))](if: $turns &gt;=120 and not ($achievements contains &quot;Survive two hours&quot;))[(set: $achievements to it + (array: &quot;Survive two hours&quot;))](if: $turns &gt;=180 and not ($achievements contains &quot;Survive three hours&quot;))[(set: $achievements to it + (array: &quot;Survive three hours&quot;))]</tw-passagedata><tw-passagedata pid="652" name="Refuse the statue&#39;s help" tags="" position="3096,3782" size="100,100">&quot;Very well.&quot;

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="653" name="Eat the finger-fruit" tags="" position="3669,4266" size="100,100">If you close your eyes and avoid the fingernails, you can almost imagine they are just another meal.

Almost. Not quite. (set: $sanity to it - 13)(set: $satiety to it + 20)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="654" name="A fingersmith" tags="" position="4804,1508" size="100,100">No doors can contain you. Locks pose only a little temporary difficulty, depending on their make and model.

[[Onwards!|Main]](set: $inventory to it + (array: &quot;lockpick&quot;))</tw-passagedata><tw-passagedata pid="655" name="Pick the lock" tags="" position="2047,1103" size="100,100">(if: (random: 1,10) &lt;=4)[A sweet click as the tumblers fall into place, and you&#39;re through.

[[Step through the door|The End]]](else:)[No luck. Perhaps next time.

[[Onwards!|Main]]]</tw-passagedata><tw-passagedata pid="656" name="Throw your soul down the well" tags="" position="4086,2026" size="100,100">You watch it flash and flutter in the dark. Perhaps there is something down there to receive it.(set: $inventory to it - (array: &quot;soul&quot;))(set: $well&#39;s 1st to 100)(set: $well&#39;s 2nd to 80)(set: $well&#39;s 3rd to 80)(set: $well&#39;s 4th to 80)(set: $well&#39;s 5th to 40)

*There are others who may have been interested in your soul.*

[[Return|well2]]</tw-passagedata><tw-passagedata pid="657" name="doorOutcome" tags="" position="1941,1873" size="100,100">(if: (random:1,10) is 1)[Nothing happens. The message must have been written by a false prophet.

[[Onwards!|Main]]]\
(else:)[The prophecy has come true!

(if: $playerVariables&#39;s $r is &quot;HP&quot;)[(set: $HP to it + $door&#39;s 1st)]\
(elseif: $playerVariables&#39;s $r is &quot;sanity&quot;)[(set: $sanity to it + $door&#39;s $r)]\
(elseif: $playerVariables&#39;s $r is &quot;energy&quot;)[(set: $energy to it + $door&#39;s $r)]\
(elseif: $playerVariables&#39;s $r is &quot;satiety&quot;)[(set: $satiety to it + $door&#39;s $r)]\
(elseif: $playerVariables&#39;s $r is &quot;speed&quot;)[(set: $fleeBonus to it + $door&#39;s $r)]\
(elseif: $playerVariables&#39;s $r is &quot;breadcrumbs&quot;)[(set: $scanner to it + 1)]\
(elseif: $playerVariables&#39;s $r is &quot;dynamite&quot;)[(set: $trash to it + 1)]\
(elseif: $playerVariables&#39;s $r is &quot;average juice&quot;)[(set: $drink to it + 1)]\
(else-if: $playerVariables&#39;s $r is &quot;key&quot;)[(set: $keys to it + 1)*You now have (print: $keys) keys*

]\
(if: $playerVariables&#39;s (abs: $r + 1) is &quot;HP&quot;)[(set: $HP to it + $door&#39;s (abs: $r + 1))]\
(elseif: $playerVariables&#39;s (abs: $r + 1) is &quot;sanity&quot;)[(set: $sanity to it + $door&#39;s (abs: $r + 1))]\
(elseif: $playerVariables&#39;s (abs: $r + 1) is &quot;energy&quot;)[(set: $energy to it + $door&#39;s (abs: $r + 1))]\
(elseif: $playerVariables&#39;s (abs: $r + 1) is &quot;satiety&quot;)[(set: $satiety to it + $door&#39;s (abs: $r + 1))]\
(elseif: $playerVariables&#39;s (abs: $r + 1) is &quot;speed&quot;)[(set: $fleeBonus to it + $door&#39;s 1st)]\
[[Onwards.|Main]]]
</tw-passagedata><tw-passagedata pid="658" name="Smash the compass" tags="" position="1486,2797" size="100,100">(set: $cards to it - (array: &quot;Compass&quot;))(set: $rareishCards to it - (array: &quot;Compass&quot;))\
You smash the compass against the room&#39;s marbled floor. The glass cracks, the casing splinters, and the needle spins wildly until settling at last to point at you.

It traces your movements as you leave the room.(set: $sanity to it - 10)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="659" name="ended" tags="" position="126,148" size="100,100">(replace: ?sideMenu)[(css: &quot;font-size: 80%;&quot;)[You partied for
$turns minutes]]</tw-passagedata><tw-passagedata pid="660" name="Walk away, to safety." tags="" position="55,1476" size="100,100">You are safe. You are unscathed. Depending on how you look at it, this may constitute a victory.(live: 5.5s)[&lt;script&gt;window.close()&lt;/script&gt;]</tw-passagedata><tw-passagedata pid="661" name="fountain" tags="" position="1762,4978" size="100,100">Here is a fountain. Voices babble in the tumbling of the water. 

&lt;img src=&quot;fountain.png&quot;&gt;

[[Drink the water]]
[[Speak with the voices]]
[[Speak with the water]]
[[Drink the voices]](if: $ally&#39;s type is &quot;pigeons&quot;)[
[[Encourage your pigeons to drink]]]</tw-passagedata><tw-passagedata pid="662" name="Drink the water" tags="" position="1537,5128" size="100,100">The water lessens your thirst. (set: satiety to it + 12)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="663" name="Speak with the voices" tags="" position="1687,5128" size="100,100">You can, with effort, discern individual voices in the mix. One sings of the flute-kings; another whispers of the march of crabs. One screams unintelligibly; another announces, voice quavering, that everything will end for the best. One discusses the cultivation of watermelons; another, perhaps the faintest of the lot, speaks of terrible gods that bake in the forge of the earth&#39;s outer core.

When you speak the voices fall briefly silent before resuming overlapping chatter. You converse until your mind is numb. It will stay this way for a little way.(set: $freeze to (datamap: &quot;value&quot;, $sanity, &quot;timer&quot;, 11, &quot;code&quot;, &quot;(set: $sanity to $freeze&#39;s value)(set: $b to (text-color: #585858))&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="664" name="Speak with the water" tags="" position="1837,5128" size="100,100">&quot;... and how shapely you are, how multifarious your voices. If I were thirsty I would consume you. If you were frozen your crystals would be abnormal and beautiful. If you were larger I would divest myself of all clothing and have you touch every part of my skin. If...&quot;

The voices grow louder. The water ripples away from your mouth. (set: $sanity to it - 20)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="665" name="Drink the voices" tags="" position="1987,5128" size="100,100">The fountain quietens as the voices slide down your throat, one by one. They scream, then quieten, then disperse, then assimilate.

This brings some benefits. Peace of mind is not one of them.(set: $sanity to 1)(set: $HP to it + 10)(set: $energy to it + 10)(set: $satiety to it + 15)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="666" name="Encourage your pigeons to drink" tags="" position="2124,5125" size="100,100">(display: &quot;Allow your pigeons to feed.&quot;)(replace: ?text)[Pigeons perch on the side of the fountain to drink. Some stare uncertainly at their reflections. A few cock their heads, as though listening to something.]</tw-passagedata><tw-passagedata pid="667" name="gods" tags="" position="2659,4930" size="100,100">(set: $cards to it - (array: &quot;dynamite&quot;))(set: $execute to it - $godArray)(if: $god is &quot;Nothing&quot; and (random: 1,2) is 1)[(set: $god to &quot;No God&quot;)]\
(if: $god is not &quot;No God&quot;)[The powers that govern the dungeon are in equilibrium.

*All is quiet.*

&lt;img src=&quot;godNone.png&quot;&gt;(set: $god to &quot;No God&quot;)]\
(else:)[The airs of the dungeon are thick with portent.

	(if: $r is 1)[The Bandaged Rat is ascendant.(set: $god to &quot;The Bandaged Rat&quot;)

*When you gain health: gain 5 extra health.* 

&lt;img src=&quot;godRat.png&quot;&gt;(set: $execute to it + (array: 1st of $godArray))]\
	(else-if: $r is 2)[The Yellowed Crab is ascendant.(set: $god to &quot;The Yellowed Crab&quot;) 

*When you lose health: lose 5 extra health.*

&lt;img src=&quot;godCrab.png&quot;&gt;(set: $execute to it + (array: 2nd of $godArray))]\
	(else-if: $r is 3)[The Fluted Prince is ascendant. (set: $god to &quot;The Fluted Prince&quot;)
	
*When you gain sanity: gain 5 extra sanity*

&lt;img src=&quot;godPrince.png&quot;&gt;(set: $execute to it + (array: 3rd of $godArray))]\
	(else-if: $r is 4)[The Eye-Moth is ascendant. (set: $god to &quot;The Eye-Moth&quot;)
	
*When you lose sanity: lose 5 extra sanity*
	
&lt;img src=&quot;godEye.png&quot;&gt;(set: $execute to it + (array: 4th of $godArray))]\
	(else-if: $r is 5)[The Flightless Roundbird is ascendant. (set: $god to &quot;The Flightless Roundbird&quot;)
	
*When you gain satiety: gain +5 satiety. When you gain energy: gain no more than 5 energy.*

&lt;img src=&quot;godBird.png&quot;&gt;(set: $execute to it + (array: 5th of $godArray))]\
	(else-if: $r is 6)[Explodia, Godess of Explosions, is ascendant.(set: $god to &quot;Explodia&quot;)

*All gains and losses are increased by 33%. Also, you may find more dynamite than usual.*

&lt;img src=&#39;godBoom.png&#39;&gt;(set: $execute to it + (array: 6th of $godArray))]]

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="668" name="dynamite" tags="" position="2982,4946" size="100,100">You find a stick of dynamite lying in a shaft of golden light.

&lt;img src=&quot;dynamite.png&quot;&gt;

[[Give thanks to Explodia, Godess of Explosions]]
[[Don&#39;t give thanks to Explodia, Godess of Explosions|Main]]</tw-passagedata><tw-passagedata pid="669" name="Give thanks to Explodia, Godess of Explosions" tags="" position="2982,5096" size="100,100">Explodia cares little for words.

Explodia cares much for explosions.

[[Onewards!|Main]]</tw-passagedata><tw-passagedata pid="670" name="Blessing of stability" tags="" position="2550,170" size="100,100">You will lose a maximum of &#39;&#39;15&#39;&#39; health, sanity, energy and satiety per turn.

[[Rejoice!|Main]](set: $blessings to it + (array: &quot;stability&quot;))(set: $execute to it + (array: &#39;(set: $HP to (max: $HP, $HPOld - 15))(set: $sanity to (max: $sanity, $sanityOld - 15))(set: $energy to (max: $energy, $energyOld - 15))(set: $satiety to (max: $satiety, $satietyOld - 15))&#39;))</tw-passagedata><tw-passagedata pid="671" name="fish" tags="" position="880,4237" size="100,100">The air reeks of seafood. You soon notice the source of the smell: something that might be a fish with the gait of a man, or perhaps a man with the pallor of a fish.

Its eyes are wet and unblinking. Its mouth voicelessly opens and closes.(set: $monster to (datamap: &quot;fleeChance&quot;, 55, &quot;type&quot;, &quot;fish&quot;, &quot;damage&quot;, 18))

&lt;img src=&quot;fishPerson.png&quot;&gt;(if: (random: 1,3) is 1)[(if: (random: 1,2) is 1)[

This one looks unusually floppy.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually vicious.(set: $monster&#39;s damage to (round: (it * 1.33)))]]

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="672" name="fishAttack" tags="" position="877,4346" size="100,100">It flops across the dungeon&#39;s floor faster than you can run. It assaults you with its moist rubbery fin-fists.(set: $sanity to it - (round: $monster&#39;s damage / 2.5))

[[Ew.|Main]]</tw-passagedata><tw-passagedata pid="673" name="pantry" tags="" position="946,5057" size="100,100">This room may once have been a kitchen. A small side-chamber may once have been a pantry. Rotting shelves line the walls. One lonely box sits unopened on a low shelf.

The box contains six chocolate-chip cookies, arranged in clinically precise rows. The packaging is damp with mildew, but the cookies are impeccably preserved.

&lt;img src=&quot;cookieBox.png&quot;&gt;

(link: &quot;Take the cookies&quot;)[(set:$cookies&#39;s basic to it + 6)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="674" name="roundbird" tags="" position="1247,5194" size="100,100">You find a shrine dedicated to the Flightless Roundbird. Long-dead acolytes once worshipped at its webbed feet. Should you be so inclined, you could do the same. 

&lt;img src=&quot;roundbird.png&quot;&gt;

[[Pray|prayRoundbird]]
[[Move on|leaveRoundbird]](if: $hunger &gt; 2)[
[[Eat the statue|EatRoundbird]]]</tw-passagedata><tw-passagedata pid="675" name="prayRoundbird" tags="" position="1172,5344" size="100,100">You sacrifice some energy but are rewarded in other ways.

(set: $energy to it - 20)\
(set: $HP to it + 15)(set: $sanity to it + 15)\
[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="676" name="leaveRoundbird" tags="" position="1322,5344" size="100,100">You feel the statue&#39;s eyes following you benignly as you walk away.

[[Onwards?|Main]]</tw-passagedata><tw-passagedata pid="677" name="EatRoundbird" tags="" position="1457,5330" size="100,100">It is as filling as you would expect. (set: $satiety to $statMax)

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="678" name="Take the cookie" tags="" position="850,1328" size="100,100">You feel the statue&#39;s eyes follow your movements as you place the cookie into your pocket.

(set: $sanity to it - 5)(set: $cookies&#39;s basic to it + 1)\
[[Onwards?|Main]]</tw-passagedata><tw-passagedata pid="679" name="An enigma" tags="" position="508,2043" size="100,100">The box is filled with loose flour. (Why?) It sifts through your fingers and piles on the floor.

(set: $inklings to it + 1)\
*You now have (print: $inklings) Inklings of a Deeper Purpose.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="680" name="Untitled Passage" tags="" position="1895,5282" size="100,100">Double-click this passage to edit it.</tw-passagedata><tw-passagedata pid="681" name="slimeFeed" tags="" position="1691,1700" size="100,100">Most of the birds refuse the meal. The bravest peck cautiously at the slime. Some coo wetly as tentacles sprout beneath their feathers.(set: $ally&#39;s health to it + (random: 5,15))(if: $ally&#39;s health &gt; $ally&#39;s maxHealth)[(set: $ally&#39;s health to $ally&#39;s maxHealth)]

Your flock&#39;s health is now (print: $ally&#39;s health)%

[[Onwards!|Main]](set: $sanity to it - 10)</tw-passagedata><tw-passagedata pid="682" name="A gourmand" tags="" position="4920,1392" size="100,100">You can&#39;t be sure what quality of food you will find in the dungeon. You have packed artisinal cookies, average juice, and breadcrumbs for snacks.

&lt;img src=&quot;cookie.png&quot;&gt;

[[Onwards!|Main]](set: $scanner to it + 1)(set: $cookies&#39;s basic to it + 1)(set: $drink to it + 1)</tw-passagedata><tw-passagedata pid="683" name="insaneFix" tags="" position="232,1277" size="100,100">Your thoughts sharpen, become brittle, and slough off. You hear them clattering as they fall to the floor. You are clarity, you are glass, you are fine.

[[Just fine.|Main]]</tw-passagedata><tw-passagedata pid="684" name="inherit" tags="" position="2371,5071" size="100,100">You find a pile of bones and fabric. (if: $inheritKeys &gt; 0)[Something glints beneath - a (if: $inheritKeys &gt; 1)[collection of keys. They ](else:)[key. It ] is of no use to its current owner; you might as well take (if: $inheritKeys &gt; 1)[it](else:)[them]. (set: $keys to it + $inheritKeys)(set: $inheritKeys to 0)

*You now have (print: $keys) keys*](else:)[

You rummage through the bones, but find nothing of note. Apparently the deceased failed to collect any keys.]

&lt;img src= &quot;bones.png&quot;&gt;

(link: &quot;Onwards!&quot;)[(set: $cards to it - (array: &quot;inherit&quot;))(set: $sanity to it - 1)(goto: &quot;Main&quot;)]</tw-passagedata><tw-passagedata pid="685" name="An extra-enigmatic enigma" tags="" position="624,2043" size="100,100">Tearing the box open reveals a slightly smaller box. Inside this box is a box that is smaller again. The box inside that box is still smaller. And on it goes until you reach a box too small for your fingernails to pry open.

(set: $inklings to it + 3)\
*You now have (print: $inklings) Inklings of a Deeper Purpose.*

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="686" name="archaeologist" tags="" position="464,5027" size="100,100">An archaeologist is excavating something from the dirt beneath the floor. She has the hard-set jaw of somebody just one major discovery away from making tenure. The bones she is unearthing look like they may once have belonged to (either: &quot;a gigantuan crab&quot;, &quot;something humanoid, but with tentacles&quot;). 

&quot;I have a message&quot;, she says, &quot;for the boatman. Will you deliver it for me?&quot;

&lt;img src=&quot;archaeologist.png&quot;&gt;

[[Accept|acceptNote]]
[[Refuse|Main]]</tw-passagedata><tw-passagedata pid="687" name="acceptNote" tags="" position="331,5160" size="100,100">She passes you an envelope, folded carefully and sealed with reddish wax. The paper is stiff and heavy, and has assumed a yellowish colour with age.(set: $inventory to it + (array: &quot;boatNote&quot;))(set: $icons to it + (array: &#39;&lt;img src=&quot;sNote.png&quot;&gt;&#39;))

[[Onwards!|Main]](set: $rareCards to it - (array: &quot;archaeologist&quot;))</tw-passagedata><tw-passagedata pid="688" name="boatNote" tags="" position="326,5275" size="100,100">You are dead.

The boatman&#39;s oars pull silently through the water. You have been tasked with delivering him a note; you hand it to him now.

The boatman&#39;s expression is inscrutable as he reads. Upon finishing the message he grants you a key as recompense for the inconveniences associated with travelling to this location.(set: $keys to it + 1)(set: $inventory to it - (array: &quot;boatNote&quot;))(set: $icons to it - (array: &#39;&lt;img src=&quot;sNote.png&quot;&gt;&#39;))

*You now have (print: $keys) keys*

&quot;Now,&quot; he says, &quot;where were we?&quot;

[[Where indeed?|You are dead]] </tw-passagedata><tw-passagedata pid="689" name="The antidotical one" tags="" position="7,284" size="100,100">The potion neutralises the poison in your system.(set: $inventory to it - (array: &quot;poisoned&quot;))

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="690" name="Push through quickly" tags="" position="890,934" size="100,100">You are beginning to acclimate to the dungeon. Oversized spiderwebs worry you less than they used to, if only you empty your mind and push through quickly. 

[[Onwards!|Main]]</tw-passagedata><tw-passagedata pid="691" name="lion" tags="" position="653,4116" size="100,100">(set: $monster to (datamap: &quot;fleeChance&quot;, 35, &quot;type&quot;, &quot;basic&quot;, &quot;damage&quot;, 22))\
A snake-lion chimera approaches! It was created by injecting a lion blastocyst with pluripotent stem cells harvested from a snake embryo, creating a creature whose body is composed mostly of a mix of (primarily) lion and (some) snake cells.

It looks pretty much like a normal lion.(if: (random: 1,2) is 1)[

This one looks unusually docile, for a snake-lion chimera.(set: $monster&#39;s damage to (round: (it * 0.66)))](else:)[

This one looks unusually ferocious.(set: $monster&#39;s damage to (round: (it * 1.33)))]

&lt;img src=&quot;lion.png&quot;&gt;

(display: &quot;monster&quot;)</tw-passagedata><tw-passagedata pid="692" name="Place your socks on the altar" tags="" position="1100,1685" size="100,100">(if: $cards contains &quot;displeasedGod&quot; or $cards contains &quot;furiousGod&quot;)[The socks are gone. Nothing replaces them.

*The squid-faced god-thing is not feeling kindly disposed towards you right now.*

&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $fleeBonus to it - $socks&#39;s speed)(set: $inventory to it - (array: &quot;socks&quot;))(set: $icons to it - (array: &quot;&lt;img src=&#39;sSock.png&#39;&gt;&quot;))(set: $socks to (datamap: &quot;speed&quot;, 0, &quot;cookie&quot;, 0, &quot;blessing&quot;, 0))]\
(else-if: (random: 1,3) is 1)[The socks are gone. Nothing replaces them.

*This was an unlucky outcome.*

&lt;script&gt;audio.bad.play();&lt;/script&gt;(set: $fleeBonus to it - $socks&#39;s speed)(set: $inventory to it - (array: &quot;socks&quot;))(set: $icons to it - (array: &quot;&lt;img src=&#39;sSock.png&#39;&gt;&quot;))(set: $socks to (datamap: &quot;speed&quot;, 0, &quot;cookie&quot;, 0, &quot;blessing&quot;, 0))]\
(else:)[The socks quiver with magical energy. When you put them back on your feet they feel slimy and warm inside.
(if: not ($achievements contains &quot;Upgrade an item&quot;))[(set: $achievements to it + (array: &quot;Upgrade an item&quot;))]\

(set: $r to (random: 1,4))(if: $r is 1)[(set: $fleeBonus to it + 3)(set: $socks&#39;s speed to it + 3)]\
(else-if: $r is 3)[(set: $socks&#39;s cookie to it + 1)]\
(else-if: $r is 4)[(set: $socks&#39;s blessing to it + 1)]\
*Your socks now have the following qualities:
+(print:$socks&#39;s speed) speed(if: $socks&#39;s cookie &gt; 0)[
When you eat a chocolate-chip cookie: gain +(print: $socks&#39;s cookie) speed](if: $socks&#39;s blessing &gt; 0)[
When you outrun a monster: -(print: $socks&#39;s blessing) minutes until your next blessing]*

][[Onwards!|Main]]</tw-passagedata></tw-storydata>

<script title="Twine engine code" data-main="harlowe">"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */
var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,r,o,i,a,s,u,c,l,f,p,d,h=t&&t.split("/"),g=y.map,m=g&&g["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,y.nodeIdCompat&&w.test(e[a])&&(e[a]=e[a].replace(w,"")),"."===e[0].charAt(0)&&h&&(d=h.slice(0,h.length-1),e=d.concat(e)),l=0;l<e.length;l++)if(p=e[l],"."===p)e.splice(l,1),l-=1;else if(".."===p){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((h||m)&&g){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),h)for(f=h.length;f>0;f-=1)if(o=g[h.slice(0,f).join("/")],o&&(o=o[r])){i=o,s=l;break}if(i)break;!u&&m&&m[r]&&(u=m[r],c=l)}!i&&u&&(i=u,s=c),i&&(n.splice(0,s,i),e=n.join("/"))}return e}function r(t,n){return function(){var r=b.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),f.apply(e,r.concat([t,n]))}}function o(e){return function(t){return n(t,e)}}function i(e){return function(t){h[e]=t}}function a(n){if(t(g,n)){var r=g[n];delete g[n],m[n]=!0,l.apply(e,r)}if(!t(h,n)&&!t(m,n))throw new Error("No "+n);return h[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return e?s(e):[]}function c(e){return function(){return y&&y.config&&y.config[e]||{}}}var l,f,p,d,h={},g={},y={},m={},v=Object.prototype.hasOwnProperty,b=[].slice,w=/\.js$/;p=function(e,t){var r,i=s(e),u=i[0],c=t[1];return e=i[1],u&&(u=n(u,c),r=a(u)),u?e=r&&r.normalize?r.normalize(e,o(c)):n(e,c):(e=n(e,c),i=s(e),u=i[0],e=i[1],u&&(r=a(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:r}},d={require:function(e){return r(e)},exports:function(e){var t=h[e];return"undefined"!=typeof t?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:c(e)}}},l=function(n,o,s,c){var l,f,y,v,b,w,x,T=[],O="undefined"==typeof s?"undefined":_typeof(s);if(c=c||n,w=u(c),"undefined"===O||"function"===O){for(o=!o.length&&s.length?["require","exports","module"]:o,b=0;b<o.length;b+=1)if(v=p(o[b],w),f=v.f,"require"===f)T[b]=d.require(n);else if("exports"===f)T[b]=d.exports(n),x=!0;else if("module"===f)l=T[b]=d.module(n);else if(t(h,f)||t(g,f)||t(m,f))T[b]=a(f);else{if(!v.p)throw new Error(n+" missing "+f);v.p.load(v.n,r(c,!0),i(f),{}),T[b]=h[f]}y=s?s.apply(h[n],T):void 0,n&&(l&&l.exports!==e&&l.exports!==h[n]?h[n]=l.exports:y===e&&x||(h[n]=y))}else n&&(h[n]=s)},requirejs=require=f=function(t,n,r,o,i){if("string"==typeof t)return d[t]?d[t](n):a(p(t,u(n)).f);if(!t.splice){if(y=t,y.deps&&f(y.deps,y.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=o,o=i),o?l(e,t,n,r):setTimeout(function(){l(e,t,n,r)},4),f},f.config=function(e){return f(e)},requirejs._defined=h,define=function(e,n,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(r=n,n=[]),t(h,e)||t(g,e)||(g[e]=[e,n,r])},define.amd={jQuery:!0}}(),define("almond",function(){}),function(e,t){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e,t){t=t||te;var n=t.createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}function r(e){var t=!!e&&"length"in e&&e.length,n=he.type(e);return"function"===n||he.isWindow(e)?!1:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function o(e,t,n){return he.isFunction(t)?he.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?he.grep(e,function(e){return e===t!==n}):"string"!=typeof t?he.grep(e,function(e){return ae.call(t,e)>-1!==n}):je.test(t)?he.filter(t,e,n):(t=he.filter(t,e),he.grep(e,function(e){return ae.call(t,e)>-1!==n&&1===e.nodeType}))}function i(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function a(e){var t={};return he.each(e.match(Ne)||[],function(e,n){t[n]=!0}),t}function s(e){return e}function u(e){throw e}function c(e,t,n){var r;try{e&&he.isFunction(r=e.promise)?r.call(e).done(t).fail(n):e&&he.isFunction(r=e.then)?r.call(e,t,n):t.call(void 0,e)}catch(e){n.call(void 0,e)}}function l(){te.removeEventListener("DOMContentLoaded",l),e.removeEventListener("load",l),he.ready()}function f(){this.expando=he.expando+f.uid++}function p(e){return"true"===e?!0:"false"===e?!1:"null"===e?null:e===+e+""?+e:Le.test(e)?JSON.parse(e):e}function d(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(qe,"-$&").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n=p(n)}catch(e){}De.set(e,t,n)}else n=void 0;return n}function h(e,t,n,r){var o,i=1,a=20,s=r?function(){return r.cur()}:function(){return he.css(e,t,"")},u=s(),c=n&&n[3]||(he.cssNumber[t]?"":"px"),l=(he.cssNumber[t]||"px"!==c&&+u)&&He.exec(he.css(e,t));if(l&&l[3]!==c){c=c||l[3],n=n||[],l=+u||1;do i=i||".5",l/=i,he.style(e,t,l+c);while(i!==(i=s()/u)&&1!==i&&--a)}return n&&(l=+l||+u||0,o=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=l,r.end=o)),o}function g(e){var t,n=e.ownerDocument,r=e.nodeName,o=Be[r];return o?o:(t=n.body.appendChild(n.createElement(r)),o=he.css(t,"display"),t.parentNode.removeChild(t),"none"===o&&(o="block"),Be[r]=o,o)}function y(e,t){for(var n,r,o=[],i=0,a=e.length;a>i;i++)r=e[i],r.style&&(n=r.style.display,t?("none"===n&&(o[i]=Fe.get(r,"display")||null,o[i]||(r.style.display="")),""===r.style.display&&ze(r)&&(o[i]=g(r))):"none"!==n&&(o[i]="none",Fe.set(r,"display",n)));for(i=0;a>i;i++)null!=o[i]&&(e[i].style.display=o[i]);return e}function m(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&he.nodeName(e,t)?he.merge([e],n):n}function v(e,t){for(var n=0,r=e.length;r>n;n++)Fe.set(e[n],"globalEval",!t||Fe.get(t[n],"globalEval"))}function b(e,t,n,r,o){for(var i,a,s,u,c,l,f=t.createDocumentFragment(),p=[],d=0,h=e.length;h>d;d++)if(i=e[d],i||0===i)if("object"===he.type(i))he.merge(p,i.nodeType?[i]:i);else if(Je.test(i)){for(a=a||f.appendChild(t.createElement("div")),s=(Ue.exec(i)||["",""])[1].toLowerCase(),u=Xe[s]||Xe._default,a.innerHTML=u[1]+he.htmlPrefilter(i)+u[2],l=u[0];l--;)a=a.lastChild;he.merge(p,a.childNodes),a=f.firstChild,a.textContent=""}else p.push(t.createTextNode(i));for(f.textContent="",d=0;i=p[d++];)if(r&&he.inArray(i,r)>-1)o&&o.push(i);else if(c=he.contains(i.ownerDocument,i),a=m(f.appendChild(i),"script"),c&&v(a),n)for(l=0;i=a[l++];)Ge.test(i.type||"")&&n.push(i);return f}function w(){return!0}function x(){return!1}function T(){try{return te.activeElement}catch(e){}}function O(e,t,n,r,o,i){var a,s;if("object"===("undefined"==typeof t?"undefined":_typeof(t))){"string"!=typeof n&&(r=r||n,n=void 0);for(s in t)O(e,s,n,r,t[s],i);return e}if(null==r&&null==o?(o=n,r=n=void 0):null==o&&("string"==typeof n?(o=r,r=void 0):(o=r,r=n,n=void 0)),o===!1)o=x;else if(!o)return e;return 1===i&&(a=o,o=function(e){return he().off(e),a.apply(this,arguments)},o.guid=a.guid||(a.guid=he.guid++)),e.each(function(){he.event.add(this,t,o,r,n)})}function j(e,t){return he.nodeName(e,"table")&&he.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function S(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function k(e){var t=rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function C(e,t){var n,r,o,i,a,s,u,c;if(1===t.nodeType){if(Fe.hasData(e)&&(i=Fe.access(e),a=Fe.set(t,i),c=i.events)){delete a.handle,a.events={};for(o in c)for(n=0,r=c[o].length;r>n;n++)he.event.add(t,o,c[o][n])}De.hasData(e)&&(s=De.access(e),u=he.extend({},s),De.set(t,u))}}function A(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Ve.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function E(e,t,r,o){t=oe.apply([],t);var i,a,s,u,c,l,f=0,p=e.length,d=p-1,h=t[0],g=he.isFunction(h);if(g||p>1&&"string"==typeof h&&!pe.checkClone&&nt.test(h))return e.each(function(n){var i=e.eq(n);g&&(t[0]=h.call(this,n,i.html())),E(i,t,r,o)});if(p&&(i=b(t,e[0].ownerDocument,!1,e,o),a=i.firstChild,1===i.childNodes.length&&(i=a),a||o)){for(s=he.map(m(i,"script"),S),u=s.length;p>f;f++)c=i,f!==d&&(c=he.clone(c,!0,!0),u&&he.merge(s,m(c,"script"))),r.call(e[f],c,f);if(u)for(l=s[s.length-1].ownerDocument,he.map(s,k),f=0;u>f;f++)c=s[f],Ge.test(c.type||"")&&!Fe.access(c,"globalEval")&&he.contains(l,c)&&(c.src?he._evalUrl&&he._evalUrl(c.src):n(c.textContent.replace(ot,""),l))}return e}function N(e,t,n){for(var r,o=t?he.filter(t,e):e,i=0;null!=(r=o[i]);i++)n||1!==r.nodeType||he.cleanData(m(r)),r.parentNode&&(n&&he.contains(r.ownerDocument,r)&&v(m(r,"script")),r.parentNode.removeChild(r));return e}function P(e,t,n){var r,o,i,a,s=e.style;return n=n||st(e),n&&(a=n.getPropertyValue(t)||n[t],""!==a||he.contains(e.ownerDocument,e)||(a=he.style(e,t)),!pe.pixelMarginRight()&&at.test(a)&&it.test(t)&&(r=s.width,o=s.minWidth,i=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=o,s.maxWidth=i)),void 0!==a?a+"":a}function I(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function _(e){if(e in pt)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=ft.length;n--;)if(e=ft[n]+t,e in pt)return e}function M(e,t,n){var r=He.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function F(e,t,n,r,o){var i,a=0;for(i=n===(r?"border":"content")?4:"width"===t?1:0;4>i;i+=2)"margin"===n&&(a+=he.css(e,n+$e[i],!0,o)),r?("content"===n&&(a-=he.css(e,"padding"+$e[i],!0,o)),"margin"!==n&&(a-=he.css(e,"border"+$e[i]+"Width",!0,o))):(a+=he.css(e,"padding"+$e[i],!0,o),"padding"!==n&&(a+=he.css(e,"border"+$e[i]+"Width",!0,o)));return a}function D(e,t,n){var r,o=!0,i=st(e),a="border-box"===he.css(e,"boxSizing",!1,i);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),0>=r||null==r){if(r=P(e,t,i),(0>r||null==r)&&(r=e.style[t]),at.test(r))return r;o=a&&(pe.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+F(e,t,n||(a?"border":"content"),o,i)+"px"}function L(e,t,n,r,o){return new L.prototype.init(e,t,n,r,o)}function q(){ht&&(e.requestAnimationFrame(q),he.fx.tick())}function R(){return e.setTimeout(function(){dt=void 0}),dt=he.now()}function H(e,t){var n,r=0,o={height:e};for(t=t?1:0;4>r;r+=2-t)n=$e[r],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function $(e,t,n){for(var r,o=(B.tweeners[t]||[]).concat(B.tweeners["*"]),i=0,a=o.length;a>i;i++)if(r=o[i].call(n,t,e))return r}function z(e,t,n){var r,o,i,a,s,u,c,l,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ze(e),m=Fe.get(e,"fxshow");n.queue||(a=he._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,he.queue(e,"fx").length||a.empty.fire()})}));for(r in t)if(o=t[r],gt.test(o)){if(delete t[r],i=i||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!m||void 0===m[r])continue;g=!0}d[r]=m&&m[r]||he.style(e,r)}if(u=!he.isEmptyObject(t),u||!he.isEmptyObject(d)){f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],c=m&&m.display,null==c&&(c=Fe.get(e,"display")),l=he.css(e,"display"),"none"===l&&(c?l=c:(y([e],!0),c=e.style.display||c,l=he.css(e,"display"),y([e]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===he.css(e,"float")&&(u||(p.done(function(){h.display=c}),null==c&&(l=h.display,c="none"===l?"":l)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in d)u||(m?"hidden"in m&&(g=m.hidden):m=Fe.access(e,"fxshow",{display:c}),i&&(m.hidden=!g),g&&y([e],!0),p.done(function(){g||y([e]),Fe.remove(e,"fxshow");for(r in d)he.style(e,r,d[r])})),u=$(g?m[r]:0,r,p),r in m||(m[r]=u.start,g&&(u.end=u.start,u.start=0))}}function W(e,t){var n,r,o,i,a;for(n in e)if(r=he.camelCase(n),o=t[r],i=e[n],he.isArray(i)&&(o=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),a=he.cssHooks[r],a&&"expand"in a){i=a.expand(i),delete e[r];for(n in i)n in e||(e[n]=i[n],t[n]=o)}else t[r]=o}function B(e,t,n){var r,o,i=0,a=B.prefilters.length,s=he.Deferred().always(function(){delete u.elem}),u=function(){if(o)return!1;for(var t=dt||R(),n=Math.max(0,c.startTime+c.duration-t),r=n/c.duration||0,i=1-r,a=0,u=c.tweens.length;u>a;a++)c.tweens[a].run(i);return s.notifyWith(e,[c,i,n]),1>i&&u?n:(s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:he.extend({},t),opts:he.extend(!0,{specialEasing:{},easing:he.easing._default},n),originalProperties:t,originalOptions:n,startTime:dt||R(),duration:n.duration,tweens:[],createTween:function(t,n){var r=he.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(o)return this;for(o=!0;r>n;n++)c.tweens[n].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),l=c.props;for(W(l,c.opts.specialEasing);a>i;i++)if(r=B.prefilters[i].call(c,e,l,c.opts))return he.isFunction(r.stop)&&(he._queueHooks(c.elem,c.opts.queue).stop=he.proxy(r.stop,r)),r;return he.map(l,$,c),he.isFunction(c.opts.start)&&c.opts.start.call(e,c),he.fx.timer(he.extend(u,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function V(e){var t=e.match(Ne)||[];return t.join(" ")}function U(e){return e.getAttribute&&e.getAttribute("class")||""}function G(e,t,n,r){var o;if(he.isArray(t))he.each(t,function(t,o){n||kt.test(e)?r(e,o):G(e+"["+("object"===("undefined"==typeof o?"undefined":_typeof(o))&&null!=o?t:"")+"]",o,n,r)});else if(n||"object"!==he.type(t))r(e,t);else for(o in t)G(e+"["+o+"]",t[o],n,r)}function X(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,o=0,i=t.toLowerCase().match(Ne)||[];if(he.isFunction(n))for(;r=i[o++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function J(e,t,n,r){function o(s){var u;return i[s]=!0,he.each(e[s]||[],function(e,s){var c=s(t,n,r);return"string"!=typeof c||a||i[c]?a?!(u=c):void 0:(t.dataTypes.unshift(c),o(c),!1)}),u}var i={},a=e===qt;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Y(e,t){var n,r,o=he.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:r||(r={}))[n]=t[n]);return r&&he.extend(!0,e,r),e}function Q(e,t,n){for(var r,o,i,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(o in s)if(s[o]&&s[o].test(r)){u.unshift(o);break}if(u[0]in n)i=u[0];else{for(o in n){if(!u[0]||e.converters[o+" "+u[0]]){i=o;break}a||(a=o)}i=i||a}return i?(i!==u[0]&&u.unshift(i),n[i]):void 0}function Z(e,t,n,r){var o,i,a,s,u,c={},l=e.dataTypes.slice();if(l[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=i,i=l.shift())if("*"===i)i=u;else if("*"!==u&&u!==i){if(a=c[u+" "+i]||c["* "+i],!a)for(o in c)if(s=o.split(" "),s[1]===i&&(a=c[u+" "+s[0]]||c["* "+s[0]])){a===!0?a=c[o]:c[o]!==!0&&(i=s[0],l.unshift(s[1]));break}if(a!==!0)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+i}}}return{state:"success",data:t}}function K(e){return he.isWindow(e)?e:9===e.nodeType&&e.defaultView}var ee=[],te=e.document,ne=Object.getPrototypeOf,re=ee.slice,oe=ee.concat,ie=ee.push,ae=ee.indexOf,se={},ue=se.toString,ce=se.hasOwnProperty,le=ce.toString,fe=le.call(Object),pe={},de="3.1.1",he=function e(t,n){return new e.fn.init(t,n)},ge=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ye=/^-ms-/,me=/-([a-z])/g,ve=function(e,t){return t.toUpperCase()};he.fn=he.prototype={jquery:de,constructor:he,length:0,toArray:function(){return re.call(this)},get:function(e){return null==e?re.call(this):0>e?this[e+this.length]:this[e]},pushStack:function(e){var t=he.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return he.each(this,e)},map:function(e){return this.pushStack(he.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(re.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:ie,sort:ee.sort,splice:ee.splice},he.extend=he.fn.extend=function(){var e,t,n,r,o,i,a=arguments[0]||{},s=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[s]||{},s++),"object"===("undefined"==typeof a?"undefined":_typeof(a))||he.isFunction(a)||(a={}),s===u&&(a=this,s--);u>s;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],r=e[t],a!==r&&(c&&r&&(he.isPlainObject(r)||(o=he.isArray(r)))?(o?(o=!1,i=n&&he.isArray(n)?n:[]):i=n&&he.isPlainObject(n)?n:{},a[t]=he.extend(c,i,r)):void 0!==r&&(a[t]=r));return a},he.extend({expando:"jQuery"+(de+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===he.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=he.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return e&&"[object Object]"===ue.call(e)?(t=ne(e))?(n=ce.call(t,"constructor")&&t.constructor,"function"==typeof n&&le.call(n)===fe):!0:!1},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"===("undefined"==typeof e?"undefined":_typeof(e))||"function"==typeof e?se[ue.call(e)]||"object":"undefined"==typeof e?"undefined":_typeof(e)},globalEval:function(e){n(e)},camelCase:function(e){return e.replace(ye,"ms-").replace(me,ve)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,o=0;if(r(e))for(n=e.length;n>o&&t.call(e[o],o,e[o])!==!1;o++);else for(o in e)if(t.call(e[o],o,e[o])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ge,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(r(Object(e))?he.merge(n,"string"==typeof e?[e]:e):ie.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:ae.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,o=e.length;n>r;r++)e[o++]=t[r];return e.length=o,e},grep:function(e,t,n){for(var r,o=[],i=0,a=e.length,s=!n;a>i;i++)r=!t(e[i],i),r!==s&&o.push(e[i]);return o},map:function(e,t,n){var o,i,a=0,s=[];if(r(e))for(o=e.length;o>a;a++)i=t(e[a],a,n),null!=i&&s.push(i);else for(a in e)i=t(e[a],a,n),null!=i&&s.push(i);return oe.apply([],s)},guid:1,proxy:function e(t,n){var r,o,e;return"string"==typeof n&&(r=t[n],n=t,t=r),he.isFunction(t)?(o=re.call(arguments,2),e=function(){return t.apply(n||this,o.concat(re.call(arguments)))},e.guid=t.guid=t.guid||he.guid++,e):void 0},now:Date.now,support:pe}),"function"==typeof Symbol&&(he.fn[Symbol.iterator]=ee[Symbol.iterator]),he.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){se["[object "+t+"]"]=t.toLowerCase()});var be=function(e){function t(e,t,n,r){var o,i,a,s,u,c,l,p=t&&t.ownerDocument,h=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return n;if(!r&&((t?t.ownerDocument||t:$)!==_&&I(t),t=t||_,F)){if(11!==h&&(u=me.exec(e)))if(o=u[1]){if(9===h){if(!(a=t.getElementById(o)))return n;if(a.id===o)return n.push(a),n}else if(p&&(a=p.getElementById(o))&&R(t,a)&&a.id===o)return n.push(a),n}else{if(u[2])return Z.apply(n,t.getElementsByTagName(e)),n;if((o=u[3])&&T.getElementsByClassName&&t.getElementsByClassName)return Z.apply(n,t.getElementsByClassName(o)),n}if(!(!T.qsa||U[e+" "]||D&&D.test(e))){if(1!==h)p=t,l=e;else if("object"!==t.nodeName.toLowerCase()){for((s=t.getAttribute("id"))?s=s.replace(xe,Te):t.setAttribute("id",s=H),c=k(e),i=c.length;i--;)c[i]="#"+s+" "+d(c[i]);l=c.join(","),p=ve.test(e)&&f(t.parentNode)||t}if(l)try{return Z.apply(n,p.querySelectorAll(l)),n}catch(e){}finally{s===H&&t.removeAttribute("id")}}}return A(e.replace(se,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>O.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[H]=!0,e}function o(e){var t=_.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function i(e,t){for(var n=e.split("|"),r=n.length;r--;)O.attrHandle[n[r]]=t}function a(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function s(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function u(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return function(t){return"form"in t?t.parentNode&&t.disabled===!1?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&je(t)===e:t.disabled===e:"label"in t?t.disabled===e:!1}}function l(e){return r(function(t){return t=+t,r(function(n,r){for(var o,i=e([],n.length,t),a=i.length;a--;)n[o=i[a]]&&(n[o]=!(r[o]=n[o]))})})}function f(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function p(){}function d(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function h(e,t,n){var r=t.dir,o=t.next,i=o||r,a=n&&"parentNode"===i,s=W++;return t.first?function(t,n,o){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,o);return!1}:function(t,n,u){var c,l,f,p=[z,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(f=t[H]||(t[H]={}),l=f[t.uniqueID]||(f[t.uniqueID]={}),o&&o===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=l[i])&&c[0]===z&&c[1]===s)return p[2]=c[2];if(l[i]=p,p[2]=e(t,n,u))return!0}return!1}}function g(e){return e.length>1?function(t,n,r){for(var o=e.length;o--;)if(!e[o](t,n,r))return!1;return!0}:e[0]}function y(e,n,r){for(var o=0,i=n.length;i>o;o++)t(e,n[o],r);return r}function m(e,t,n,r,o){for(var i,a=[],s=0,u=e.length,c=null!=t;u>s;s++)(i=e[s])&&(!n||n(i,r,o))&&(a.push(i),c&&t.push(s));return a}function v(e,t,n,o,i,a){return o&&!o[H]&&(o=v(o)),i&&!i[H]&&(i=v(i,a)),r(function(r,a,s,u){var c,l,f,p=[],d=[],h=a.length,g=r||y(t||"*",s.nodeType?[s]:s,[]),v=!e||!r&&t?g:m(g,p,e,s,u),b=n?i||(r?e:h||o)?[]:a:v;if(n&&n(v,b,s,u),o)for(c=m(b,d),o(c,[],s,u),l=c.length;l--;)(f=c[l])&&(b[d[l]]=!(v[d[l]]=f));if(r){if(i||e){if(i){for(c=[],l=b.length;l--;)(f=b[l])&&c.push(v[l]=f);i(null,b=[],c,u)}for(l=b.length;l--;)(f=b[l])&&(c=i?ee(r,f):p[l])>-1&&(r[c]=!(a[c]=f))}}else b=m(b===a?b.splice(h,b.length):b),i?i(null,a,b,u):Z.apply(a,b)})}function b(e){for(var t,n,r,o=e.length,i=O.relative[e[0].type],a=i||O.relative[" "],s=i?1:0,u=h(function(e){return e===t},a,!0),c=h(function(e){return ee(t,e)>-1},a,!0),l=[function(e,n,r){var o=!i&&(r||n!==E)||((t=n).nodeType?u(e,n,r):c(e,n,r));return t=null,o}];o>s;s++)if(n=O.relative[e[s].type])l=[h(g(l),n)];else{if(n=O.filter[e[s].type].apply(null,e[s].matches),n[H]){for(r=++s;o>r&&!O.relative[e[r].type];r++);return v(s>1&&g(l),s>1&&d(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(se,"$1"),n,r>s&&b(e.slice(s,r)),o>r&&b(e=e.slice(r)),o>r&&d(e))}l.push(n)}return g(l)}function w(e,n){var o=n.length>0,i=e.length>0,a=function(r,a,s,u,c){var l,f,p,d=0,h="0",g=r&&[],y=[],v=E,b=r||i&&O.find.TAG("*",c),w=z+=null==v?1:Math.random()||.1,x=b.length;for(c&&(E=a===_||a||c);h!==x&&null!=(l=b[h]);h++){if(i&&l){for(f=0,a||l.ownerDocument===_||(I(l),s=!F);p=e[f++];)if(p(l,a||_,s)){u.push(l);break}c&&(z=w)}o&&((l=!p&&l)&&d--,r&&g.push(l))}if(d+=h,o&&h!==d){for(f=0;p=n[f++];)p(g,y,a,s);if(r){if(d>0)for(;h--;)g[h]||y[h]||(y[h]=Y.call(u));y=m(y)}Z.apply(u,y),c&&!r&&y.length>0&&d+n.length>1&&t.uniqueSort(u)}return c&&(z=w,E=v),g};return o?r(a):a}var x,T,O,j,S,k,C,A,E,N,P,I,_,M,F,D,L,q,R,H="sizzle"+1*new Date,$=e.document,z=0,W=0,B=n(),V=n(),U=n(),G=function(e,t){return e===t&&(P=!0),0},X={}.hasOwnProperty,J=[],Y=J.pop,Q=J.push,Z=J.push,K=J.slice,ee=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\x00-\\xa0])+",oe="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",ie=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),se=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ue=new RegExp("^"+ne+"*,"+ne+"*"),ce=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),le=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),fe=new RegExp(ie),pe=new RegExp("^"+re+"$"),de={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re+"|[*])"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+ie),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,ye=/^[^{]+\{\s*\[native \w/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ve=/[+~]/,be=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),we=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},xe=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Te=function(e,t){return t?"\x00"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Oe=function(){I()},je=h(function(e){return e.disabled===!0&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{Z.apply(J=K.call($.childNodes),$.childNodes),J[$.childNodes.length].nodeType}catch(e){Z={apply:J.length?function(e,t){Q.apply(e,K.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}T=t.support={},S=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},I=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:$;return r!==_&&9===r.nodeType&&r.documentElement?(_=r,M=_.documentElement,F=!S(_),$!==_&&(n=_.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",Oe,!1):n.attachEvent&&n.attachEvent("onunload",Oe)),T.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),T.getElementsByTagName=o(function(e){return e.appendChild(_.createComment("")),!e.getElementsByTagName("*").length}),T.getElementsByClassName=ye.test(_.getElementsByClassName),T.getById=o(function(e){return M.appendChild(e).id=H,!_.getElementsByName||!_.getElementsByName(H).length}),T.getById?(O.filter.ID=function(e){var t=e.replace(be,we);return function(e){return e.getAttribute("id")===t}},O.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&F){var n=t.getElementById(e);return n?[n]:[]}}):(O.filter.ID=function(e){var t=e.replace(be,we);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},O.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&F){var n,r,o,i=t.getElementById(e);if(i){if(n=i.getAttributeNode("id"),n&&n.value===e)return[i];for(o=t.getElementsByName(e),r=0;i=o[r++];)if(n=i.getAttributeNode("id"),n&&n.value===e)return[i]}return[]}}),O.find.TAG=T.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):T.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],o=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[o++];)1===n.nodeType&&r.push(n);return r}return i},O.find.CLASS=T.getElementsByClassName&&function(e,t){return"undefined"!=typeof t.getElementsByClassName&&F?t.getElementsByClassName(e):void 0},L=[],D=[],(T.qsa=ye.test(_.querySelectorAll))&&(o(function(e){M.appendChild(e).innerHTML="<a id='"+H+"'></a><select id='"+H+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&D.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||D.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+H+"-]").length||D.push("~="),e.querySelectorAll(":checked").length||D.push(":checked"),e.querySelectorAll("a#"+H+"+*").length||D.push(".#.+[+~]")}),o(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=_.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&D.push("name"+ne+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&D.push(":enabled",":disabled"),M.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&D.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),D.push(",.*:")})),(T.matchesSelector=ye.test(q=M.matches||M.webkitMatchesSelector||M.mozMatchesSelector||M.oMatchesSelector||M.msMatchesSelector))&&o(function(e){T.disconnectedMatch=q.call(e,"*"),q.call(e,"[s!='']:x"),L.push("!=",ie)}),D=D.length&&new RegExp(D.join("|")),L=L.length&&new RegExp(L.join("|")),t=ye.test(M.compareDocumentPosition),R=t||ye.test(M.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},G=t?function(e,t){if(e===t)return P=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!T.sortDetached&&t.compareDocumentPosition(e)===n?e===_||e.ownerDocument===$&&R($,e)?-1:t===_||t.ownerDocument===$&&R($,t)?1:N?ee(N,e)-ee(N,t):0:4&n?-1:1)}:function(e,t){if(e===t)return P=!0,0;var n,r=0,o=e.parentNode,i=t.parentNode,s=[e],u=[t];if(!o||!i)return e===_?-1:t===_?1:o?-1:i?1:N?ee(N,e)-ee(N,t):0;if(o===i)return a(e,t);for(n=e;n=n.parentNode;)s.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;s[r]===u[r];)r++;return r?a(s[r],u[r]):s[r]===$?-1:u[r]===$?1:0},_):_},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==_&&I(e),n=n.replace(le,"='$1']"),!(!T.matchesSelector||!F||U[n+" "]||L&&L.test(n)||D&&D.test(n)))try{var r=q.call(e,n);if(r||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(n,_,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==_&&I(e),R(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==_&&I(e);var n=O.attrHandle[t.toLowerCase()],r=n&&X.call(O.attrHandle,t.toLowerCase())?n(e,t,!F):void 0;return void 0!==r?r:T.attributes||!F?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.escape=function(e){return(e+"").replace(xe,Te)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,o=0;if(P=!T.detectDuplicates,N=!T.sortStable&&e.slice(0),e.sort(G),P){for(;t=e[o++];)t===e[o]&&(r=n.push(o));for(;r--;)e.splice(n[r],1)}return N=null,e},j=t.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=j(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=j(t);return n},O=t.selectors={cacheLength:50,createPseudo:r,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,we),e[3]=(e[3]||e[4]||e[5]||"").replace(be,we),
"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return de.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&fe.test(n)&&(t=k(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,we).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=B[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&B(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(o){var i=t.attr(o,e);return null==i?"!="===n:n?(i+="","="===n?i===r:"!="===n?i!==r:"^="===n?r&&0===i.indexOf(r):"*="===n?r&&i.indexOf(r)>-1:"$="===n?r&&i.slice(-r.length)===r:"~="===n?(" "+i.replace(ae," ")+" ").indexOf(r)>-1:"|="===n?i===r||i.slice(0,r.length+1)===r+"-":!1):!0}},CHILD:function(e,t,n,r,o){var i="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===o?function(e){return!!e.parentNode}:function(t,n,u){var c,l,f,p,d,h,g=i!==a?"nextSibling":"previousSibling",y=t.parentNode,m=s&&t.nodeName.toLowerCase(),v=!u&&!s,b=!1;if(y){if(i){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===m:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?y.firstChild:y.lastChild],a&&v){for(p=y,f=p[H]||(p[H]={}),l=f[p.uniqueID]||(f[p.uniqueID]={}),c=l[e]||[],d=c[0]===z&&c[1],b=d&&c[2],p=d&&y.childNodes[d];p=++d&&p&&p[g]||(b=d=0)||h.pop();)if(1===p.nodeType&&++b&&p===t){l[e]=[z,d,b];break}}else if(v&&(p=t,f=p[H]||(p[H]={}),l=f[p.uniqueID]||(f[p.uniqueID]={}),c=l[e]||[],d=c[0]===z&&c[1],b=d),b===!1)for(;(p=++d&&p&&p[g]||(b=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==m:1!==p.nodeType)||!++b||(v&&(f=p[H]||(p[H]={}),l=f[p.uniqueID]||(f[p.uniqueID]={}),l[e]=[z,b]),p!==t)););return b-=o,b===r||b%r===0&&b/r>=0}}},PSEUDO:function(e,n){var o,i=O.pseudos[e]||O.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return i[H]?i(n):i.length>1?(o=[e,e,"",n],O.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,o=i(e,n),a=o.length;a--;)r=ee(e,o[a]),e[r]=!(t[r]=o[a])}):function(e){return i(e,0,o)}):i}},pseudos:{not:r(function(e){var t=[],n=[],o=C(e.replace(se,"$1"));return o[H]?r(function(e,t,n,r){for(var i,a=o(e,null,r,[]),s=e.length;s--;)(i=a[s])&&(e[s]=!(t[s]=i))}):function(e,r,i){return t[0]=e,o(t,null,i,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(be,we),function(t){return(t.textContent||t.innerText||j(t)).indexOf(e)>-1}}),lang:r(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,we).toLowerCase(),function(t){var n;do if(n=F?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===M},focus:function(e){return e===_.activeElement&&(!_.hasFocus||_.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:c(!1),disabled:c(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!O.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,n){return[0>n?n+t:n]}),even:l(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:l(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:l(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:l(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},O.pseudos.nth=O.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})O.pseudos[x]=s(x);for(x in{submit:!0,reset:!0})O.pseudos[x]=u(x);return p.prototype=O.filters=O.pseudos,O.setFilters=new p,k=t.tokenize=function(e,n){var r,o,i,a,s,u,c,l=V[e+" "];if(l)return n?0:l.slice(0);for(s=e,u=[],c=O.preFilter;s;){(!r||(o=ue.exec(s)))&&(o&&(s=s.slice(o[0].length)||s),u.push(i=[])),r=!1,(o=ce.exec(s))&&(r=o.shift(),i.push({value:r,type:o[0].replace(se," ")}),s=s.slice(r.length));for(a in O.filter)!(o=de[a].exec(s))||c[a]&&!(o=c[a](o))||(r=o.shift(),i.push({value:r,type:a,matches:o}),s=s.slice(r.length));if(!r)break}return n?s.length:s?t.error(e):V(e,u).slice(0)},C=t.compile=function(e,t){var n,r=[],o=[],i=U[e+" "];if(!i){for(t||(t=k(e)),n=t.length;n--;)i=b(t[n]),i[H]?r.push(i):o.push(i);i=U(e,w(o,r)),i.selector=e}return i},A=t.select=function(e,t,n,r){var o,i,a,s,u,c="function"==typeof e&&e,l=!r&&k(e=c.selector||e);if(n=n||[],1===l.length){if(i=l[0]=l[0].slice(0),i.length>2&&"ID"===(a=i[0]).type&&9===t.nodeType&&F&&O.relative[i[1].type]){if(t=(O.find.ID(a.matches[0].replace(be,we),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(i.shift().value.length)}for(o=de.needsContext.test(e)?0:i.length;o--&&(a=i[o],!O.relative[s=a.type]);)if((u=O.find[s])&&(r=u(a.matches[0].replace(be,we),ve.test(i[0].type)&&f(t.parentNode)||t))){if(i.splice(o,1),e=r.length&&d(i),!e)return Z.apply(n,r),n;break}}return(c||C(e,l))(r,t,!F,n,!t||ve.test(e)&&f(t.parentNode)||t),n},T.sortStable=H.split("").sort(G).join("")===H,T.detectDuplicates=!!P,I(),T.sortDetached=o(function(e){return 1&e.compareDocumentPosition(_.createElement("fieldset"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||i("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),T.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||i("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||i(te,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);he.find=be,he.expr=be.selectors,he.expr[":"]=he.expr.pseudos,he.uniqueSort=he.unique=be.uniqueSort,he.text=be.getText,he.isXMLDoc=be.isXML,he.contains=be.contains,he.escapeSelector=be.escape;var we=function(e,t,n){for(var r=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&he(e).is(n))break;r.push(e)}return r},xe=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},Te=he.expr.match.needsContext,Oe=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,je=/^.[^:#\[\.,]*$/;he.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?he.find.matchesSelector(r,e)?[r]:[]:he.find.matches(e,he.grep(t,function(e){return 1===e.nodeType}))},he.fn.extend({find:function(e){var t,n,r=this.length,o=this;if("string"!=typeof e)return this.pushStack(he(e).filter(function(){for(t=0;r>t;t++)if(he.contains(o[t],this))return!0}));for(n=this.pushStack([]),t=0;r>t;t++)he.find(e,o[t],n);return r>1?he.uniqueSort(n):n},filter:function(e){return this.pushStack(o(this,e||[],!1))},not:function(e){return this.pushStack(o(this,e||[],!0))},is:function(e){return!!o(this,"string"==typeof e&&Te.test(e)?he(e):e||[],!1).length}});var Se,ke=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ce=he.fn.init=function(e,t,n){var r,o;if(!e)return this;if(n=n||Se,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ke.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof he?t[0]:t,he.merge(this,he.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:te,!0)),Oe.test(r[1])&&he.isPlainObject(t))for(r in t)he.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return o=te.getElementById(r[2]),o&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):he.isFunction(e)?void 0!==n.ready?n.ready(e):e(he):he.makeArray(e,this)};Ce.prototype=he.fn,Se=he(te);var Ae=/^(?:parents|prev(?:Until|All))/,Ee={children:!0,contents:!0,next:!0,prev:!0};he.fn.extend({has:function(e){var t=he(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(he.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,o=this.length,i=[],a="string"!=typeof e&&he(e);if(!Te.test(e))for(;o>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&he.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?he.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?ae.call(he(e),this[0]):ae.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(he.uniqueSort(he.merge(this.get(),he(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),he.each({parent:function e(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return we(e,"parentNode")},parentsUntil:function(e,t,n){return we(e,"parentNode",n)},next:function(e){return i(e,"nextSibling")},prev:function(e){return i(e,"previousSibling")},nextAll:function(e){return we(e,"nextSibling")},prevAll:function(e){return we(e,"previousSibling")},nextUntil:function(e,t,n){return we(e,"nextSibling",n)},prevUntil:function(e,t,n){return we(e,"previousSibling",n)},siblings:function(e){return xe((e.parentNode||{}).firstChild,e)},children:function(e){return xe(e.firstChild)},contents:function(e){return e.contentDocument||he.merge([],e.childNodes)}},function(e,t){he.fn[e]=function(n,r){var o=he.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(o=he.filter(r,o)),this.length>1&&(Ee[e]||he.uniqueSort(o),Ae.test(e)&&o.reverse()),this.pushStack(o)}});var Ne=/[^\x20\t\r\n\f]+/g;he.Callbacks=function(e){e="string"==typeof e?a(e):he.extend({},e);var t,n,r,o,i=[],s=[],u=-1,c=function(){for(o=e.once,r=t=!0;s.length;u=-1)for(n=s.shift();++u<i.length;)i[u].apply(n[0],n[1])===!1&&e.stopOnFalse&&(u=i.length,n=!1);e.memory||(n=!1),t=!1,o&&(i=n?[]:"")},l={add:function(){return i&&(n&&!t&&(u=i.length-1,s.push(n)),function t(n){he.each(n,function(n,r){he.isFunction(r)?e.unique&&l.has(r)||i.push(r):r&&r.length&&"string"!==he.type(r)&&t(r)})}(arguments),n&&!t&&c()),this},remove:function(){return he.each(arguments,function(e,t){for(var n;(n=he.inArray(t,i,n))>-1;)i.splice(n,1),u>=n&&u--}),this},has:function(e){return e?he.inArray(e,i)>-1:i.length>0},empty:function(){return i&&(i=[]),this},disable:function(){return o=s=[],i=n="",this},disabled:function(){return!i},lock:function(){return o=s=[],n||t||(i=n=""),this},locked:function(){return!!o},fireWith:function(e,n){return o||(n=n||[],n=[e,n.slice?n.slice():n],s.push(n),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},he.extend({Deferred:function(t){var n=[["notify","progress",he.Callbacks("memory"),he.Callbacks("memory"),2],["resolve","done",he.Callbacks("once memory"),he.Callbacks("once memory"),0,"resolved"],["reject","fail",he.Callbacks("once memory"),he.Callbacks("once memory"),1,"rejected"]],r="pending",o={state:function(){return r},always:function(){return i.done(arguments).fail(arguments),this},catch:function(e){return o.then(null,e)},pipe:function(){var e=arguments;return he.Deferred(function(t){he.each(n,function(n,r){var o=he.isFunction(e[r[4]])&&e[r[4]];i[r[1]](function(){var e=o&&o.apply(this,arguments);e&&he.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,o?[e]:arguments)})}),e=null}).promise()},then:function(t,r,o){function i(t,n,r,o){return function(){var c=this,l=arguments,f=function(){var e,f;if(!(a>t)){if(e=r.apply(c,l),e===n.promise())throw new TypeError("Thenable self-resolution");f=e&&("object"===("undefined"==typeof e?"undefined":_typeof(e))||"function"==typeof e)&&e.then,he.isFunction(f)?o?f.call(e,i(a,n,s,o),i(a,n,u,o)):(a++,f.call(e,i(a,n,s,o),i(a,n,u,o),i(a,n,s,n.notifyWith))):(r!==s&&(c=void 0,l=[e]),(o||n.resolveWith)(c,l))}},p=o?f:function(){try{f()}catch(e){he.Deferred.exceptionHook&&he.Deferred.exceptionHook(e,p.stackTrace),t+1>=a&&(r!==u&&(c=void 0,l=[e]),n.rejectWith(c,l))}};t?p():(he.Deferred.getStackHook&&(p.stackTrace=he.Deferred.getStackHook()),e.setTimeout(p))}}var a=0;return he.Deferred(function(e){n[0][3].add(i(0,e,he.isFunction(o)?o:s,e.notifyWith)),n[1][3].add(i(0,e,he.isFunction(t)?t:s)),n[2][3].add(i(0,e,he.isFunction(r)?r:u))}).promise()},promise:function(e){return null!=e?he.extend(e,o):o}},i={};return he.each(n,function(e,t){var a=t[2],s=t[5];o[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[0][2].lock),a.add(t[3].fire),i[t[0]]=function(){return i[t[0]+"With"](this===i?void 0:this,arguments),this},i[t[0]+"With"]=a.fireWith}),o.promise(i),t&&t.call(i,i),i},when:function(e){var t=arguments.length,n=t,r=Array(n),o=re.call(arguments),i=he.Deferred(),a=function(e){return function(n){r[e]=this,o[e]=arguments.length>1?re.call(arguments):n,--t||i.resolveWith(r,o)}};if(1>=t&&(c(e,i.done(a(n)).resolve,i.reject),"pending"===i.state()||he.isFunction(o[n]&&o[n].then)))return i.then();for(;n--;)c(o[n],a(n),i.reject);return i.promise()}});var Pe=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;he.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&Pe.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},he.readyException=function(t){e.setTimeout(function(){throw t})};var Ie=he.Deferred();he.fn.ready=function(e){return Ie.then(e).catch(function(e){he.readyException(e)}),this},he.extend({isReady:!1,readyWait:1,holdReady:function(e){e?he.readyWait++:he.ready(!0)},ready:function(e){(e===!0?--he.readyWait:he.isReady)||(he.isReady=!0,e!==!0&&--he.readyWait>0||Ie.resolveWith(te,[he]))}}),he.ready.then=Ie.then,"complete"===te.readyState||"loading"!==te.readyState&&!te.documentElement.doScroll?e.setTimeout(he.ready):(te.addEventListener("DOMContentLoaded",l),e.addEventListener("load",l));var _e=function e(t,n,r,o,i,a,s){var u=0,c=t.length,l=null==r;if("object"===he.type(r)){i=!0;for(u in r)e(t,n,u,r[u],!0,a,s)}else if(void 0!==o&&(i=!0,he.isFunction(o)||(s=!0),l&&(s?(n.call(t,o),n=null):(l=n,n=function(e,t,n){return l.call(he(e),n)})),n))for(;c>u;u++)n(t[u],r,s?o:o.call(t[u],u,n(t[u],r)));return i?t:l?n.call(t):c?n(t[0],r):a},Me=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};f.uid=1,f.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Me(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,o=this.cache(e);if("string"==typeof t)o[he.camelCase(t)]=n;else for(r in t)o[he.camelCase(r)]=t[r];return o},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][he.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){he.isArray(t)?t=t.map(he.camelCase):(t=he.camelCase(t),t=t in r?[t]:t.match(Ne)||[]),n=t.length;for(;n--;)delete r[t[n]]}(void 0===t||he.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!he.isEmptyObject(t)}};var Fe=new f,De=new f,Le=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,qe=/[A-Z]/g;he.extend({hasData:function(e){return De.hasData(e)||Fe.hasData(e)},data:function(e,t,n){return De.access(e,t,n)},removeData:function(e,t){De.remove(e,t)},_data:function(e,t,n){return Fe.access(e,t,n)},_removeData:function(e,t){Fe.remove(e,t)}}),he.fn.extend({data:function e(t,n){var r,o,e,i=this[0],a=i&&i.attributes;if(void 0===t){if(this.length&&(e=De.get(i),1===i.nodeType&&!Fe.get(i,"hasDataAttrs"))){for(r=a.length;r--;)a[r]&&(o=a[r].name,0===o.indexOf("data-")&&(o=he.camelCase(o.slice(5)),d(i,o,e[o])));Fe.set(i,"hasDataAttrs",!0)}return e}return"object"===("undefined"==typeof t?"undefined":_typeof(t))?this.each(function(){De.set(this,t)}):_e(this,function(e){var n;if(i&&void 0===e){if(n=De.get(i,t),void 0!==n)return n;if(n=d(i,t),void 0!==n)return n}else this.each(function(){De.set(this,t,e)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){De.remove(this,e)})}}),he.extend({queue:function e(t,n,r){var e;return t?(n=(n||"fx")+"queue",e=Fe.get(t,n),r&&(!e||he.isArray(r)?e=Fe.access(t,n,he.makeArray(r)):e.push(r)),e||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=he.queue(e,t),r=n.length,o=n.shift(),i=he._queueHooks(e,t),a=function(){he.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),r--),o&&("fx"===t&&n.unshift("inprogress"),delete i.stop,o.call(e,a,i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Fe.get(e,n)||Fe.access(e,n,{empty:he.Callbacks("once memory").add(function(){Fe.remove(e,[t+"queue",n])})})}}),he.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?he.queue(this[0],e):void 0===t?this:this.each(function(){var n=he.queue(this,e,t);he._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&he.dequeue(this,e)})},dequeue:function(e){return this.each(function(){he.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,o=he.Deferred(),i=this,a=this.length,s=function(){--r||o.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)n=Fe.get(i[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(s));return s(),o.promise(t)}});var Re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,He=new RegExp("^(?:([+-])=|)("+Re+")([a-z%]*)$","i"),$e=["Top","Right","Bottom","Left"],ze=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&he.contains(e.ownerDocument,e)&&"none"===he.css(e,"display")},We=function(e,t,n,r){var o,i,a={};for(i in t)a[i]=e.style[i],e.style[i]=t[i];o=n.apply(e,r||[]);for(i in t)e.style[i]=a[i];return o},Be={};he.fn.extend({show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ze(this)?he(this).show():he(this).hide()})}});var Ve=/^(?:checkbox|radio)$/i,Ue=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Ge=/^$|\/(?:java|ecma)script/i,Xe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Xe.optgroup=Xe.option,Xe.tbody=Xe.tfoot=Xe.colgroup=Xe.caption=Xe.thead,Xe.th=Xe.td;var Je=/<|&#?\w+;/;!function(){var e=te.createDocumentFragment(),t=e.appendChild(te.createElement("div")),n=te.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),pe.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",pe.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ye=te.documentElement,Qe=/^key/,Ze=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ke=/^([^.]*)(?:\.(.+)|)/;he.event={global:{},add:function(e,t,n,r,o){var i,a,s,u,c,l,f,p,d,h,g,y=Fe.get(e);if(y)for(n.handler&&(i=n,n=i.handler,o=i.selector),o&&he.find.matchesSelector(Ye,o),n.guid||(n.guid=he.guid++),(u=y.events)||(u=y.events={}),(a=y.handle)||(a=y.handle=function(t){return"undefined"!=typeof he&&he.event.triggered!==t.type?he.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Ne)||[""],c=t.length;c--;)s=Ke.exec(t[c])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d&&(f=he.event.special[d]||{},d=(o?f.delegateType:f.bindType)||d,f=he.event.special[d]||{},l=he.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&he.expr.match.needsContext.test(o),namespace:h.join(".")},i),(p=u[d])||(p=u[d]=[],p.delegateCount=0,f.setup&&f.setup.call(e,r,h,a)!==!1||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),o?p.splice(p.delegateCount++,0,l):p.push(l),he.event.global[d]=!0)},remove:function(e,t,n,r,o){var i,a,s,u,c,l,f,p,d,h,g,y=Fe.hasData(e)&&Fe.get(e);if(y&&(u=y.events)){for(t=(t||"").match(Ne)||[""],c=t.length;c--;)if(s=Ke.exec(t[c])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){for(f=he.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=i=p.length;i--;)l=p[i],!o&&g!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(p.splice(i,1),l.selector&&p.delegateCount--,f.remove&&f.remove.call(e,l));a&&!p.length&&(f.teardown&&f.teardown.call(e,h,y.handle)!==!1||he.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)he.event.remove(e,d+t[c],n,r,!0);he.isEmptyObject(u)&&Fe.remove(e,"handle events")}},dispatch:function(e){var t,n,r,o,i,a,s=he.event.fix(e),u=new Array(arguments.length),c=(Fe.get(this,"events")||{})[s.type]||[],l=he.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,s)!==!1){for(a=he.event.handlers.call(this,s,c),t=0;(o=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=o.elem,n=0;(i=o.handlers[n++])&&!s.isImmediatePropagationStopped();)(!s.rnamespace||s.rnamespace.test(i.namespace))&&(s.handleObj=i,s.data=i.data,r=((he.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),void 0!==r&&(s.result=r)===!1&&(s.preventDefault(),s.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,o,i,a,s=[],u=t.delegateCount,c=e.target;if(u&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||c.disabled!==!0)){for(i=[],a={},n=0;u>n;n++)r=t[n],o=r.selector+" ",void 0===a[o]&&(a[o]=r.needsContext?he(o,this).index(c)>-1:he.find(o,this,null,[c]).length),a[o]&&i.push(r);i.length&&s.push({elem:c,handlers:i})}return c=this,u<t.length&&s.push({elem:c,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(he.Event.prototype,e,{enumerable:!0,configurable:!0,get:he.isFunction(t)?function(){return this.originalEvent?t(this.originalEvent):void 0}:function(){return this.originalEvent?this.originalEvent[e]:void 0},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[he.expando]?e:new he.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==T()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===T()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&he.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return he.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},he.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},he.Event=function(e,t){return this instanceof he.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?w:x,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&he.extend(this,t),this.timeStamp=e&&e.timeStamp||he.now(),void(this[he.expando]=!0)):new he.Event(e,t)},he.Event.prototype={constructor:he.Event,isDefaultPrevented:x,isPropagationStopped:x,isImmediatePropagationStopped:x,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=w,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=w,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=w,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},he.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Qe.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ze.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},he.event.addProp),he.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){he.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,o=e.relatedTarget,i=e.handleObj;return(!o||o!==r&&!he.contains(r,o))&&(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),he.fn.extend({on:function(e,t,n,r){return O(this,e,t,n,r)},one:function(e,t,n,r){return O(this,e,t,n,r,1)},off:function(e,t,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,he(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===("undefined"==typeof e?"undefined":_typeof(e))){for(o in e)this.off(o,t,e[o]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=x),this.each(function(){he.event.remove(this,e,n,t)})}});var et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,tt=/<script|<style|<link/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,rt=/^true\/(.*)/,ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;he.extend({htmlPrefilter:function(e){return e.replace(et,"<$1></$2>")},clone:function e(t,n,r){var o,i,a,s,e=t.cloneNode(!0),u=he.contains(t.ownerDocument,t);if(!(pe.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||he.isXMLDoc(t)))for(s=m(e),a=m(t),o=0,i=a.length;i>o;o++)A(a[o],s[o]);if(n)if(r)for(a=a||m(t),s=s||m(e),o=0,i=a.length;i>o;o++)C(a[o],s[o]);else C(t,e);return s=m(e,"script"),s.length>0&&v(s,!u&&m(t,"script")),e},cleanData:function(e){for(var t,n,r,o=he.event.special,i=0;void 0!==(n=e[i]);i++)if(Me(n)){if(t=n[Fe.expando]){if(t.events)for(r in t.events)o[r]?he.event.remove(n,r):he.removeEvent(n,r,t.handle);n[Fe.expando]=void 0}n[De.expando]&&(n[De.expando]=void 0)}}}),he.fn.extend({detach:function(e){return N(this,e,!0)},remove:function(e){return N(this,e)},text:function(e){return _e(this,function(e){return void 0===e?he.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return E(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=j(this,e);t.appendChild(e)}})},prepend:function(){return E(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=j(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return E(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return E(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(he.cleanData(m(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return he.clone(this,e,t)})},html:function(e){return _e(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!tt.test(e)&&!Xe[(Ue.exec(e)||["",""])[1].toLowerCase()]){e=he.htmlPrefilter(e);try{for(;r>n;n++)t=this[n]||{},1===t.nodeType&&(he.cleanData(m(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return E(this,arguments,function(t){var n=this.parentNode;he.inArray(this,e)<0&&(he.cleanData(m(this)),n&&n.replaceChild(t,this))},e)}}),he.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){he.fn[e]=function(e){for(var n,r=[],o=he(e),i=o.length-1,a=0;i>=a;a++)n=a===i?this:this.clone(!0),he(o[a])[t](n),ie.apply(r,n.get());return this.pushStack(r)}});var it=/^margin/,at=new RegExp("^("+Re+")(?!px)[a-z%]+$","i"),st=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)};!function(){function t(){if(s){s.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",s.innerHTML="",Ye.appendChild(a);var t=e.getComputedStyle(s);n="1%"!==t.top,i="2px"===t.marginLeft,r="4px"===t.width,s.style.marginRight="50%",o="4px"===t.marginRight,Ye.removeChild(a),s=null}}var n,r,o,i,a=te.createElement("div"),s=te.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",pe.clearCloneStyle="content-box"===s.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(s),he.extend(pe,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),r},pixelMarginRight:function(){return t(),o},reliableMarginLeft:function(){return t(),i}}))}();var ut=/^(none|table(?!-c[ea]).+)/,ct={position:"absolute",visibility:"hidden",display:"block"},lt={letterSpacing:"0",fontWeight:"400"},ft=["Webkit","Moz","ms"],pt=te.createElement("div").style;he.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=P(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function e(t,n,r,o){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var i,a,s,u=he.camelCase(n),e=t.style;return n=he.cssProps[u]||(he.cssProps[u]=_(u)||u),s=he.cssHooks[n]||he.cssHooks[u],void 0===r?s&&"get"in s&&void 0!==(i=s.get(t,!1,o))?i:e[n]:(a="undefined"==typeof r?"undefined":_typeof(r),"string"===a&&(i=He.exec(r))&&i[1]&&(r=h(t,n,i),a="number"),null!=r&&r===r&&("number"===a&&(r+=i&&i[3]||(he.cssNumber[u]?"":"px")),pe.clearCloneStyle||""!==r||0!==n.indexOf("background")||(e[n]="inherit"),s&&"set"in s&&void 0===(r=s.set(t,r,o))||(e[n]=r)),void 0)}},css:function(e,t,n,r){var o,i,a,s=he.camelCase(t);return t=he.cssProps[s]||(he.cssProps[s]=_(s)||s),a=he.cssHooks[t]||he.cssHooks[s],a&&"get"in a&&(o=a.get(e,!0,n)),void 0===o&&(o=P(e,t,r)),"normal"===o&&t in lt&&(o=lt[t]),""===n||n?(i=parseFloat(o),n===!0||isFinite(i)?i||0:o):o}}),he.each(["height","width"],function(e,t){he.cssHooks[t]={get:function(e,n,r){return n?!ut.test(he.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?D(e,t,r):We(e,ct,function(){return D(e,t,r)}):void 0},set:function(e,n,r){var o,i=r&&st(e),a=r&&F(e,t,r,"border-box"===he.css(e,"boxSizing",!1,i),i);return a&&(o=He.exec(n))&&"px"!==(o[3]||"px")&&(e.style[t]=n,n=he.css(e,t)),M(e,n,a)}}}),he.cssHooks.marginLeft=I(pe.reliableMarginLeft,function(e,t){return t?(parseFloat(P(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{
marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px":void 0}),he.each({margin:"",padding:"",border:"Width"},function(e,t){he.cssHooks[e+t]={expand:function(n){for(var r=0,o={},i="string"==typeof n?n.split(" "):[n];4>r;r++)o[e+$e[r]+t]=i[r]||i[r-2]||i[0];return o}},it.test(e)||(he.cssHooks[e+t].set=M)}),he.fn.extend({css:function(e,t){return _e(this,function(e,t,n){var r,o,i={},a=0;if(he.isArray(t)){for(r=st(e),o=t.length;o>a;a++)i[t[a]]=he.css(e,t[a],!1,r);return i}return void 0!==n?he.style(e,t,n):he.css(e,t)},e,t,arguments.length>1)}}),he.Tween=L,L.prototype={constructor:L,init:function(e,t,n,r,o,i){this.elem=e,this.prop=n,this.easing=o||he.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(he.cssNumber[n]?"":"px")},cur:function(){var e=L.propHooks[this.prop];return e&&e.get?e.get(this):L.propHooks._default.get(this)},run:function(e){var t,n=L.propHooks[this.prop];return this.pos=t=this.options.duration?he.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):L.propHooks._default.set(this),this}},L.prototype.init.prototype=L.prototype,L.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=he.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){he.fx.step[e.prop]?he.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[he.cssProps[e.prop]]&&!he.cssHooks[e.prop]?e.elem[e.prop]=e.now:he.style(e.elem,e.prop,e.now+e.unit)}}},L.propHooks.scrollTop=L.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},he.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},he.fx=L.prototype.init,he.fx.step={};var dt,ht,gt=/^(?:toggle|show|hide)$/,yt=/queueHooks$/;he.Animation=he.extend(B,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return h(n.elem,e,He.exec(t),n),n}]},tweener:function(e,t){he.isFunction(e)?(t=e,e=["*"]):e=e.match(Ne);for(var n,r=0,o=e.length;o>r;r++)n=e[r],B.tweeners[n]=B.tweeners[n]||[],B.tweeners[n].unshift(t)},prefilters:[z],prefilter:function(e,t){t?B.prefilters.unshift(e):B.prefilters.push(e)}}),he.speed=function(e,t,n){var r=e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))?he.extend({},e):{complete:n||!n&&t||he.isFunction(e)&&e,duration:e,easing:n&&t||t&&!he.isFunction(t)&&t};return he.fx.off||te.hidden?r.duration=0:"number"!=typeof r.duration&&(r.duration=r.duration in he.fx.speeds?he.fx.speeds[r.duration]:he.fx.speeds._default),(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){he.isFunction(r.old)&&r.old.call(this),r.queue&&he.dequeue(this,r.queue)},r},he.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ze).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var o=he.isEmptyObject(e),i=he.speed(t,n,r),a=function(){var t=B(this,he.extend({},e),i);(o||Fe.get(this,"finish"))&&t.stop(!0)};return a.finish=a,o||i.queue===!1?this.each(a):this.queue(i.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",i=he.timers,a=Fe.get(this);if(o)a[o]&&a[o].stop&&r(a[o]);else for(o in a)a[o]&&a[o].stop&&yt.test(o)&&r(a[o]);for(o=i.length;o--;)i[o].elem!==this||null!=e&&i[o].queue!==e||(i[o].anim.stop(n),t=!1,i.splice(o,1));(t||!n)&&he.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=Fe.get(this),r=n[e+"queue"],o=n[e+"queueHooks"],i=he.timers,a=r?r.length:0;for(n.finish=!0,he.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),he.each(["toggle","show","hide"],function(e,t){var n=he.fn[t];he.fn[t]=function(e,r,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(H(t,!0),e,r,o)}}),he.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){he.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),he.timers=[],he.fx.tick=function(){var e,t=0,n=he.timers;for(dt=he.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||he.fx.stop(),dt=void 0},he.fx.timer=function(e){he.timers.push(e),e()?he.fx.start():he.timers.pop()},he.fx.interval=13,he.fx.start=function(){ht||(ht=e.requestAnimationFrame?e.requestAnimationFrame(q):e.setInterval(he.fx.tick,he.fx.interval))},he.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(ht):e.clearInterval(ht),ht=null},he.fx.speeds={slow:600,fast:200,_default:400},he.fn.delay=function(t,n){return t=he.fx?he.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var o=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(o)}})},function(){var e=te.createElement("input"),t=te.createElement("select"),n=t.appendChild(te.createElement("option"));e.type="checkbox",pe.checkOn=""!==e.value,pe.optSelected=n.selected,e=te.createElement("input"),e.value="t",e.type="radio",pe.radioValue="t"===e.value}();var mt,vt=he.expr.attrHandle;he.fn.extend({attr:function(e,t){return _e(this,he.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){he.removeAttr(this,e)})}}),he.extend({attr:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return"undefined"==typeof e.getAttribute?he.prop(e,t,n):(1===i&&he.isXMLDoc(e)||(o=he.attrHooks[t.toLowerCase()]||(he.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void he.removeAttr(e,t):o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(r=o.get(e,t))?r:(r=he.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!pe.radioValue&&"radio"===t&&he.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,o=t&&t.match(Ne);if(o&&1===e.nodeType)for(;n=o[r++];)e.removeAttribute(n)}}),mt={set:function(e,t,n){return t===!1?he.removeAttr(e,n):e.setAttribute(n,n),n}},he.each(he.expr.match.bool.source.match(/\w+/g),function(e,t){var n=vt[t]||he.find.attr;vt[t]=function(e,t,r){var o,i,a=t.toLowerCase();return r||(i=vt[a],vt[a]=o,o=null!=n(e,t,r)?a:null,vt[a]=i),o}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;he.fn.extend({prop:function(e,t){return _e(this,he.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[he.propFix[e]||e]})}}),he.extend({prop:function(e,t,n){var r,o,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&he.isXMLDoc(e)||(t=he.propFix[t]||t,o=he.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(r=o.set(e,n,t))?r:e[t]=n:o&&"get"in o&&null!==(r=o.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=he.find.attr(e,"tabindex");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),pe.optSelected||(he.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),he.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){he.propFix[this.toLowerCase()]=this}),he.fn.extend({addClass:function(e){var t,n,r,o,i,a,s,u=0;if(he.isFunction(e))return this.each(function(t){he(this).addClass(e.call(this,t,U(this)))});if("string"==typeof e&&e)for(t=e.match(Ne)||[];n=this[u++];)if(o=U(n),r=1===n.nodeType&&" "+V(o)+" "){for(a=0;i=t[a++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");s=V(r),o!==s&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,o,i,a,s,u=0;if(he.isFunction(e))return this.each(function(t){he(this).removeClass(e.call(this,t,U(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Ne)||[];n=this[u++];)if(o=U(n),r=1===n.nodeType&&" "+V(o)+" "){for(a=0;i=t[a++];)for(;r.indexOf(" "+i+" ")>-1;)r=r.replace(" "+i+" "," ");s=V(r),o!==s&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n="undefined"==typeof e?"undefined":_typeof(e);return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(he.isFunction(e)?function(n){he(this).toggleClass(e.call(this,n,U(this),t),t)}:function(){var t,r,o,i;if("string"===n)for(r=0,o=he(this),i=e.match(Ne)||[];t=i[r++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(void 0===e||"boolean"===n)&&(t=U(this),t&&Fe.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Fe.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+V(U(n))+" ").indexOf(t)>-1)return!0;return!1}});var xt=/\r/g;he.fn.extend({val:function(e){var t,n,r,o=this[0];{if(arguments.length)return r=he.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=r?e.call(this,n,he(this).val()):e,null==o?o="":"number"==typeof o?o+="":he.isArray(o)&&(o=he.map(o,function(e){return null==e?"":e+""})),t=he.valHooks[this.type]||he.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))});if(o)return t=he.valHooks[o.type]||he.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(xt,""):null==n?"":n)}}}),he.extend({valHooks:{option:{get:function(e){var t=he.find.attr(e,"value");return null!=t?t:V(he.text(e))}},select:{get:function(e){var t,n,r,o=e.options,i=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?i+1:o.length;for(r=0>i?u:a?i:0;u>r;r++)if(n=o[r],!(!n.selected&&r!==i||n.disabled||n.parentNode.disabled&&he.nodeName(n.parentNode,"optgroup"))){if(t=he(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,o=e.options,i=he.makeArray(t),a=o.length;a--;)r=o[a],(r.selected=he.inArray(he.valHooks.option.get(r),i)>-1)&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),he.each(["radio","checkbox"],function(){he.valHooks[this]={set:function(e,t){return he.isArray(t)?e.checked=he.inArray(he(e).val(),t)>-1:void 0}},pe.checkOn||(he.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Tt=/^(?:focusinfocus|focusoutblur)$/;he.extend(he.event,{trigger:function(t,n,r,o){var i,a,s,u,c,l,f,p=[r||te],d=ce.call(t,"type")?t.type:t,h=ce.call(t,"namespace")?t.namespace.split("."):[];if(a=s=r=r||te,3!==r.nodeType&&8!==r.nodeType&&!Tt.test(d+he.event.triggered)&&(d.indexOf(".")>-1&&(h=d.split("."),d=h.shift(),h.sort()),c=d.indexOf(":")<0&&"on"+d,t=t[he.expando]?t:new he.Event(d,"object"===("undefined"==typeof t?"undefined":_typeof(t))&&t),t.isTrigger=o?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:he.makeArray(n,[t]),f=he.event.special[d]||{},o||!f.trigger||f.trigger.apply(r,n)!==!1)){if(!o&&!f.noBubble&&!he.isWindow(r)){for(u=f.delegateType||d,Tt.test(u+d)||(a=a.parentNode);a;a=a.parentNode)p.push(a),s=a;s===(r.ownerDocument||te)&&p.push(s.defaultView||s.parentWindow||e)}for(i=0;(a=p[i++])&&!t.isPropagationStopped();)t.type=i>1?u:f.bindType||d,l=(Fe.get(a,"events")||{})[t.type]&&Fe.get(a,"handle"),l&&l.apply(a,n),l=c&&a[c],l&&l.apply&&Me(a)&&(t.result=l.apply(a,n),t.result===!1&&t.preventDefault());return t.type=d,o||t.isDefaultPrevented()||f._default&&f._default.apply(p.pop(),n)!==!1||!Me(r)||c&&he.isFunction(r[d])&&!he.isWindow(r)&&(s=r[c],s&&(r[c]=null),he.event.triggered=d,r[d](),he.event.triggered=void 0,s&&(r[c]=s)),t.result}},simulate:function(e,t,n){var r=he.extend(new he.Event,n,{type:e,isSimulated:!0});he.event.trigger(r,null,t)}}),he.fn.extend({trigger:function(e,t){return this.each(function(){he.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?he.event.trigger(e,t,n,!0):void 0}}),he.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){he.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),he.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),pe.focusin="onfocusin"in e,pe.focusin||he.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){he.event.simulate(t,e.target,he.event.fix(e))};he.event.special[t]={setup:function(){var r=this.ownerDocument||this,o=Fe.access(r,t);o||r.addEventListener(e,n,!0),Fe.access(r,t,(o||0)+1)},teardown:function(){var r=this.ownerDocument||this,o=Fe.access(r,t)-1;o?Fe.access(r,t,o):(r.removeEventListener(e,n,!0),Fe.remove(r,t))}}});var Ot=e.location,jt=he.now(),St=/\?/;he.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return(!n||n.getElementsByTagName("parsererror").length)&&he.error("Invalid XML: "+t),n};var kt=/\[\]$/,Ct=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,Et=/^(?:input|select|textarea|keygen)/i;he.param=function(e,t){var n,r=[],o=function(e,t){var n=he.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(he.isArray(e)||e.jquery&&!he.isPlainObject(e))he.each(e,function(){o(this.name,this.value)});else for(n in e)G(n,e[n],t,o);return r.join("&")},he.fn.extend({serialize:function(){return he.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=he.prop(this,"elements");return e?he.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!he(this).is(":disabled")&&Et.test(this.nodeName)&&!At.test(e)&&(this.checked||!Ve.test(e))}).map(function(e,t){var n=he(this).val();return null==n?null:he.isArray(n)?he.map(n,function(e){return{name:t.name,value:e.replace(Ct,"\r\n")}}):{name:t.name,value:n.replace(Ct,"\r\n")}}).get()}});var Nt=/%20/g,Pt=/#.*$/,It=/([?&])_=[^&]*/,_t=/^(.*?):[ \t]*([^\r\n]*)$/gm,Mt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ft=/^(?:GET|HEAD)$/,Dt=/^\/\//,Lt={},qt={},Rt="*/".concat("*"),Ht=te.createElement("a");Ht.href=Ot.href,he.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ot.href,type:"GET",isLocal:Mt.test(Ot.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":he.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Y(Y(e,he.ajaxSettings),t):Y(he.ajaxSettings,e)},ajaxPrefilter:X(Lt),ajaxTransport:X(qt),ajax:function(t,n){function r(t,n,r,s){var c,p,d,w,x,T=n;l||(l=!0,u&&e.clearTimeout(u),o=void 0,a=s||"",O.readyState=t>0?4:0,c=t>=200&&300>t||304===t,r&&(w=Q(h,O,r)),w=Z(h,w,O,c),c?(h.ifModified&&(x=O.getResponseHeader("Last-Modified"),x&&(he.lastModified[i]=x),x=O.getResponseHeader("etag"),x&&(he.etag[i]=x)),204===t||"HEAD"===h.type?T="nocontent":304===t?T="notmodified":(T=w.state,p=w.data,d=w.error,c=!d)):(d=T,(t||!T)&&(T="error",0>t&&(t=0))),O.status=t,O.statusText=(n||T)+"",c?m.resolveWith(g,[p,T,O]):m.rejectWith(g,[O,T,d]),O.statusCode(b),b=void 0,f&&y.trigger(c?"ajaxSuccess":"ajaxError",[O,h,c?p:d]),v.fireWith(g,[O,T]),f&&(y.trigger("ajaxComplete",[O,h]),--he.active||he.event.trigger("ajaxStop")))}"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(n=t,t=void 0),n=n||{};var o,i,a,s,u,c,l,f,p,d,h=he.ajaxSetup({},n),g=h.context||h,y=h.context&&(g.nodeType||g.jquery)?he(g):he.event,m=he.Deferred(),v=he.Callbacks("once memory"),b=h.statusCode||{},w={},x={},T="canceled",O={readyState:0,getResponseHeader:function(e){var t;if(l){if(!s)for(s={};t=_t.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return l?a:null},setRequestHeader:function(e,t){return null==l&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==l&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)O.always(e[O.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||T;return o&&o.abort(t),r(0,t),this}};if(m.promise(O),h.url=((t||h.url||Ot.href)+"").replace(Dt,Ot.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(Ne)||[""],null==h.crossDomain){c=te.createElement("a");try{c.href=h.url,c.href=c.href,h.crossDomain=Ht.protocol+"//"+Ht.host!=c.protocol+"//"+c.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=he.param(h.data,h.traditional)),J(Lt,h,n,O),l)return O;f=he.event&&h.global,f&&0===he.active++&&he.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ft.test(h.type),i=h.url.replace(Pt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(Nt,"+")):(d=h.url.slice(i.length),h.data&&(i+=(St.test(i)?"&":"?")+h.data,delete h.data),h.cache===!1&&(i=i.replace(It,"$1"),d=(St.test(i)?"&":"?")+"_="+jt++ +d),h.url=i+d),h.ifModified&&(he.lastModified[i]&&O.setRequestHeader("If-Modified-Since",he.lastModified[i]),he.etag[i]&&O.setRequestHeader("If-None-Match",he.etag[i])),(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&O.setRequestHeader("Content-Type",h.contentType),O.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Rt+"; q=0.01":""):h.accepts["*"]);for(p in h.headers)O.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(h.beforeSend.call(g,O,h)===!1||l))return O.abort();if(T="abort",v.add(h.complete),O.done(h.success),O.fail(h.error),o=J(qt,h,n,O)){if(O.readyState=1,f&&y.trigger("ajaxSend",[O,h]),l)return O;h.async&&h.timeout>0&&(u=e.setTimeout(function(){O.abort("timeout")},h.timeout));try{l=!1,o.send(w,r)}catch(e){if(l)throw e;r(-1,e)}}else r(-1,"No Transport");return O},getJSON:function(e,t,n){return he.get(e,t,n,"json")},getScript:function(e,t){return he.get(e,void 0,t,"script")}}),he.each(["get","post"],function(e,t){he[t]=function(e,n,r,o){return he.isFunction(n)&&(o=o||r,r=n,n=void 0),he.ajax(he.extend({url:e,type:t,dataType:o,data:n,success:r},he.isPlainObject(e)&&e))}}),he._evalUrl=function(e){return he.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},he.fn.extend({wrapAll:function(e){var t;return this[0]&&(he.isFunction(e)&&(e=e.call(this[0])),t=he(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return this.each(he.isFunction(e)?function(t){he(this).wrapInner(e.call(this,t))}:function(){var t=he(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=he.isFunction(e);return this.each(function(n){he(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){he(this).replaceWith(this.childNodes)}),this}}),he.expr.pseudos.hidden=function(e){return!he.expr.pseudos.visible(e)},he.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},he.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},zt=he.ajaxSettings.xhr();pe.cors=!!zt&&"withCredentials"in zt,pe.ajax=zt=!!zt,he.ajaxTransport(function(t){var n,r;return pe.cors||zt&&!t.crossDomain?{send:function(o,i){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(a in o)s.setRequestHeader(a,o[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?i(0,"error"):i(s.status,s.statusText):i($t[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}:void 0}),he.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),he.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return he.globalEval(e),e}}}),he.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),he.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,o){t=he("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),te.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Wt=[],Bt=/(=)\?(?=&|$)|\?\?/;he.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Wt.pop()||he.expando+"_"+jt++;return this[e]=!0,e}}),he.ajaxPrefilter("json jsonp",function(t,n,r){var o,i,a,s=t.jsonp!==!1&&(Bt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bt.test(t.data)&&"data");return s||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=he.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Bt,"$1"+o):t.jsonp!==!1&&(t.url+=(St.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return a||he.error(o+" was not called"),a[0]},t.dataTypes[0]="json",i=e[o],e[o]=function(){a=arguments},r.always(function(){void 0===i?he(e).removeProp(o):e[o]=i,t[o]&&(t.jsonpCallback=n.jsonpCallback,Wt.push(o)),a&&he.isFunction(i)&&i(a[0]),a=i=void 0}),"script"):void 0}),pe.createHTMLDocument=function(){var e=te.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),he.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var r,o,i;return t||(pe.createHTMLDocument?(t=te.implementation.createHTMLDocument(""),r=t.createElement("base"),r.href=te.location.href,t.head.appendChild(r)):t=te),o=Oe.exec(e),i=!n&&[],o?[t.createElement(o[1])]:(o=b([e],t,i),i&&i.length&&he(i).remove(),he.merge([],o.childNodes))},he.fn.load=function(e,t,n){var r,o,i,a=this,s=e.indexOf(" ");return s>-1&&(r=V(e.slice(s)),e=e.slice(0,s)),he.isFunction(t)?(n=t,t=void 0):t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(o="POST"),a.length>0&&he.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done(function(e){i=arguments,a.html(r?he("<div>").append(he.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,i||[e.responseText,t,e])})}),this},he.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){he.fn[t]=function(e){return this.on(t,e)}}),he.expr.pseudos.animated=function(e){return he.grep(he.timers,function(t){return e===t.elem}).length},he.offset={setOffset:function(e,t,n){var r,o,i,a,s,u,c,l=he.css(e,"position"),f=he(e),p={};"static"===l&&(e.style.position="relative"),s=f.offset(),i=he.css(e,"top"),u=he.css(e,"left"),c=("absolute"===l||"fixed"===l)&&(i+u).indexOf("auto")>-1,c?(r=f.position(),a=r.top,o=r.left):(a=parseFloat(i)||0,o=parseFloat(u)||0),he.isFunction(t)&&(t=t.call(e,n,he.extend({},s))),null!=t.top&&(p.top=t.top-s.top+a),null!=t.left&&(p.left=t.left-s.left+o),"using"in t?t.using.call(e,p):f.css(p)}},he.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){he.offset.setOffset(this,e,t)});var t,n,r,o,i=this[0];if(i)return i.getClientRects().length?(r=i.getBoundingClientRect(),r.width||r.height?(o=i.ownerDocument,n=K(o),t=o.documentElement,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r):{top:0,left:0}},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===he.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),he.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+he.css(e[0],"borderTopWidth",!0),left:r.left+he.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-he.css(n,"marginTop",!0),left:t.left-r.left-he.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===he.css(e,"position");)e=e.offsetParent;return e||Ye})}}),he.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;he.fn[e]=function(r){return _e(this,function(e,r,o){var i=K(e);return void 0===o?i?i[t]:e[r]:void(i?i.scrollTo(n?i.pageXOffset:o,n?o:i.pageYOffset):e[r]=o)},e,r,arguments.length)}}),he.each(["top","left"],function(e,t){he.cssHooks[t]=I(pe.pixelPosition,function(e,n){return n?(n=P(e,t),at.test(n)?he(e).position()[t]+"px":n):void 0})}),he.each({Height:"height",Width:"width"},function(e,t){he.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){he.fn[r]=function(o,i){var a=arguments.length&&(n||"boolean"!=typeof o),s=n||(o===!0||i===!0?"margin":"border");return _e(this,function(t,n,o){var i;return he.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===o?he.css(t,n,s):he.style(t,n,o,s)},t,a?o:void 0,a)}})}),he.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),he.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return he});var Vt=e.jQuery,Ut=e.$;return he.noConflict=function(t){return e.$===he&&(e.$=Ut),t&&e.jQuery===he&&(e.jQuery=Vt),he},t||(e.jQuery=e.$=he),he}),/*!
  * https://github.com/paulmillr/es6-shim
  * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
  *   and contributors,  MIT License
  * es6-shim: v0.35.1
  * see https://github.com/paulmillr/es6-shim/blob/0.35.1/LICENSE
  * Details and documentation:
  * https://github.com/paulmillr/es6-shim/
  */
function(e,t){"function"==typeof define&&define.amd?define("es6-shim",t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.returnExports=t()}(this,function(){var e,t=Function.call.bind(Function.apply),n=Function.call.bind(Function.call),r=Array.isArray,o=Object.keys,i=function(e){return function(){return!t(e,this,arguments)}},a=function(e){try{return e(),!1}catch(e){return!0}},s=function(e){try{return e()}catch(e){return!1}},u=i(a),c=function(){return!a(function(){Object.defineProperty({},"x",{get:function(){}})})},l=!!Object.defineProperty&&c(),f="foo"===function(){}.name,p=Function.call.bind(Array.prototype.forEach),d=Function.call.bind(Array.prototype.reduce),h=Function.call.bind(Array.prototype.filter),g=Function.call.bind(Array.prototype.some),y=function(e,t,n,r){!r&&t in e||(l?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n}):e[t]=n)},m=function(e,t,n){p(o(t),function(r){var o=t[r];y(e,r,o,!!n)})},v=Function.call.bind(Object.prototype.toString),b="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===v(e)}:function(e){return"function"==typeof e},w={getter:function(e,t,n){if(!l)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:n})},proxy:function(e,t,n){if(!l)throw new TypeError("getters require true ES5 support");var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,{configurable:r.configurable,enumerable:r.enumerable,get:function(){return e[t]},set:function(n){e[t]=n}})},redefine:function(e,t,n){if(l){var r=Object.getOwnPropertyDescriptor(e,t);r.value=n,Object.defineProperty(e,t,r)}else e[t]=n},defineByDescriptor:function(e,t,n){l?Object.defineProperty(e,t,n):"value"in n&&(e[t]=n.value)},preserveToString:function(e,t){t&&b(t.toString)&&y(e,"toString",t.toString.bind(t),!0)}},x=Object.create||function(e,t){var n=function(){};n.prototype=e;var r=new n;return"undefined"!=typeof t&&o(t).forEach(function(e){w.defineByDescriptor(r,e,t[e])}),r},T=function(e,t){return Object.setPrototypeOf?s(function(){var n=function t(n){var r=new e(n);return Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(n,e),n.prototype=x(e.prototype,{constructor:{value:n}}),t(n)}):!1},O=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},j=O(),S=j.isFinite,k=Function.call.bind(String.prototype.indexOf),C=Function.apply.bind(Array.prototype.indexOf),A=Function.call.bind(Array.prototype.concat),E=Function.call.bind(String.prototype.slice),N=Function.call.bind(Array.prototype.push),P=Function.apply.bind(Array.prototype.push),I=Function.call.bind(Array.prototype.shift),_=Math.max,M=Math.min,F=Math.floor,D=Math.abs,L=Math.exp,q=Math.log,R=Math.sqrt,H=Function.call.bind(Object.prototype.hasOwnProperty),$=function(){},z=j.Symbol||{},W=z.species||"@@species",B=Number.isNaN||function(e){return e!==e},V=Number.isFinite||function(e){return"number"==typeof e&&S(e)},U=b(Math.sign)?Math.sign:function(e){var t=Number(e);return 0===t?t:B(t)?t:0>t?-1:1},G=function(e){return"[object Arguments]"===v(e)},X=function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==v(e)&&"[object Function]"===v(e.callee)},J=G(arguments)?G:X,Y={primitive:function(e){return null===e||"function"!=typeof e&&"object"!==("undefined"==typeof e?"undefined":_typeof(e))},string:function(e){return"[object String]"===v(e)},regex:function(e){return"[object RegExp]"===v(e)},symbol:function(e){return"function"==typeof j.Symbol&&"symbol"===("undefined"==typeof e?"undefined":_typeof(e))}},Q=function(e,t,n){var r=e[t];y(e,t,n,!0),w.preserveToString(e[t],r)},Z="function"==typeof z&&"function"==typeof z.for&&Y.symbol(z()),K=Y.symbol(z.iterator)?z.iterator:"_es6-shim iterator_";j.Set&&"function"==typeof(new j.Set)["@@iterator"]&&(K="@@iterator"),j.Reflect||y(j,"Reflect",{},!0);var ee=j.Reflect,te=String,ne={Call:function(e,n){var r=arguments.length>2?arguments[2]:[];if(!ne.IsCallable(e))throw new TypeError(e+" is not a function");return t(e,n,r)},RequireObjectCoercible:function(e,t){if(null==e)throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return void 0===e||null===e||e===!0||e===!1?!1:"function"==typeof e||"object"===("undefined"==typeof e?"undefined":_typeof(e))},ToObject:function(e,t){return Object(ne.RequireObjectCoercible(e,t))},IsCallable:b,IsConstructor:function(e){return ne.IsCallable(e)},ToInt32:function(e){return ne.ToNumber(e)>>0},ToUint32:function(e){return ne.ToNumber(e)>>>0},ToNumber:function(e){if("[object Symbol]"===v(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(e){var t=ne.ToNumber(e);return B(t)?0:0!==t&&V(t)?(t>0?1:-1)*F(D(t)):t},ToLength:function(e){var t=ne.ToInteger(e);return 0>=t?0:t>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t},SameValue:function(e,t){return e===t?0===e?1/e===1/t:!0:B(e)&&B(t)},SameValueZero:function(e,t){return e===t||B(e)&&B(t)},IsIterable:function(e){return ne.TypeIsObject(e)&&("undefined"!=typeof e[K]||J(e))},GetIterator:function(t){if(J(t))return new e(t,"value");var n=ne.GetMethod(t,K);if(!ne.IsCallable(n))throw new TypeError("value is not an iterable");var r=ne.Call(n,t);if(!ne.TypeIsObject(r))throw new TypeError("bad iterator");return r},GetMethod:function(e,t){var n=ne.ToObject(e)[t];if(void 0===n||null===n)return void 0;if(!ne.IsCallable(n))throw new TypeError("Method not callable: "+t);return n},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var n=ne.GetMethod(e,"return");if(void 0!==n){var r,o;try{r=ne.Call(n,e)}catch(e){o=e}if(!t){if(o)throw o;if(!ne.TypeIsObject(r))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ne.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(e){var t=ne.IteratorNext(e),n=ne.IteratorComplete(t);return n?!1:t},Construct:function(e,t,n,r){var o="undefined"==typeof n?e:n;if(!r&&ee.construct)return ee.construct(e,t,o);var i=o.prototype;ne.TypeIsObject(i)||(i=Object.prototype);var a=x(i),s=ne.Call(e,a,t);return ne.TypeIsObject(s)?s:a},SpeciesConstructor:function(e,t){var n=e.constructor;if(void 0===n)return t;if(!ne.TypeIsObject(n))throw new TypeError("Bad constructor");var r=n[W];if(void 0===r||null===r)return t;if(!ne.IsConstructor(r))throw new TypeError("Bad @@species");return r},CreateHTML:function(e,t,n,r){var o=ne.ToString(e),i="<"+t;if(""!==n){var a=ne.ToString(r),s=a.replace(/"/g,"&quot;");i+=" "+n+'="'+s+'"'}var u=i+">",c=u+o;return c+"</"+t+">"},IsRegExp:function(e){if(!ne.TypeIsObject(e))return!1;var t=e[z.match];return"undefined"!=typeof t?!!t:Y.regex(e)},ToString:function(e){return te(e)}};if(l&&Z){var re=function(e){if(Y.symbol(z[e]))return z[e];var t=z.for("Symbol."+e);return Object.defineProperty(z,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!Y.symbol(z.search)){var oe=re("search"),ie=String.prototype.search;y(RegExp.prototype,oe,function(e){return ne.Call(ie,e,[this])});var ae=function(e){var t=ne.RequireObjectCoercible(this);if(null!==e&&"undefined"!=typeof e){var n=ne.GetMethod(e,oe);if("undefined"!=typeof n)return ne.Call(n,e,[t])}return ne.Call(ie,t,[ne.ToString(e)])};Q(String.prototype,"search",ae)}if(!Y.symbol(z.replace)){var se=re("replace"),ue=String.prototype.replace;y(RegExp.prototype,se,function(e,t){return ne.Call(ue,e,[this,t])});var ce=function(e,t){var n=ne.RequireObjectCoercible(this);if(null!==e&&"undefined"!=typeof e){var r=ne.GetMethod(e,se);if("undefined"!=typeof r)return ne.Call(r,e,[n,t])}return ne.Call(ue,n,[ne.ToString(e),t])};Q(String.prototype,"replace",ce)}if(!Y.symbol(z.split)){var le=re("split"),fe=String.prototype.split;y(RegExp.prototype,le,function(e,t){return ne.Call(fe,e,[this,t])});var pe=function(e,t){var n=ne.RequireObjectCoercible(this);if(null!==e&&"undefined"!=typeof e){var r=ne.GetMethod(e,le);if("undefined"!=typeof r)return ne.Call(r,e,[n,t])}return ne.Call(fe,n,[ne.ToString(e),t])};Q(String.prototype,"split",pe)}var de=Y.symbol(z.match),he=de&&function(){var e={};return e[z.match]=function(){return 42},42!=="a".match(e)}();if(!de||he){var ge=re("match"),ye=String.prototype.match;y(RegExp.prototype,ge,function(e){return ne.Call(ye,e,[this])});var me=function(e){var t=ne.RequireObjectCoercible(this);if(null!==e&&"undefined"!=typeof e){var n=ne.GetMethod(e,ge);if("undefined"!=typeof n)return ne.Call(n,e,[t])}return ne.Call(ye,t,[ne.ToString(e)])};Q(String.prototype,"match",me)}}var ve=function(e,t,n){w.preserveToString(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),l?p(Object.getOwnPropertyNames(e),function(r){r in $||n[r]||w.proxy(e,r,t)}):p(Object.keys(e),function(r){r in $||n[r]||(t[r]=e[r])}),t.prototype=e.prototype,w.redefine(e.prototype,"constructor",t)},be=function(){return this},we=function(e){l&&!H(e,W)&&w.getter(e,W,be)},xe=function(e,t){var n=t||function(){return this};y(e,K,n),!e[K]&&Y.symbol(K)&&(e[K]=n)},Te=function(e,t,n){l?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[t]=n},Oe=function(e,t,n){if(Te(e,t,n),!ne.SameValue(e[t],n))throw new TypeError("property is nonconfigurable")},je=function(e,t,n,r){if(!ne.TypeIsObject(e))throw new TypeError("Constructor requires `new`: "+t.name);var o=t.prototype;ne.TypeIsObject(o)||(o=n);var i=x(o);for(var a in r)if(H(r,a)){var s=r[a];y(i,a,s,!0)}return i};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Se=String.fromCodePoint;Q(String,"fromCodePoint",function(){return ne.Call(Se,this,arguments)})}var ke={fromCodePoint:function(){for(var e,t=[],n=0,r=arguments.length;r>n;n++){if(e=Number(arguments[n]),!ne.SameValue(e,ne.ToInteger(e))||0>e||e>1114111)throw new RangeError("Invalid code point "+e);65536>e?N(t,String.fromCharCode(e)):(e-=65536,N(t,String.fromCharCode((e>>10)+55296)),N(t,String.fromCharCode(e%1024+56320)))}return t.join("")},raw:function(e){var t=ne.ToObject(e,"bad callSite"),n=ne.ToObject(t.raw,"bad raw value"),r=n.length,o=ne.ToLength(r);if(0>=o)return"";for(var i,a,s,u,c=[],l=0;o>l&&(i=ne.ToString(l),s=ne.ToString(n[i]),N(c,s),!(l+1>=o));)a=l+1<arguments.length?arguments[l+1]:"",u=ne.ToString(a),N(c,u),l+=1;return c.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&Q(String,"raw",ke.raw),m(String,ke);var Ce=function e(t,n){if(1>n)return"";if(n%2)return e(t,n-1)+t;var r=e(t,n/2);return r+r},Ae=1/0,Ee={repeat:function(e){var t=ne.ToString(ne.RequireObjectCoercible(this)),n=ne.ToInteger(e);if(0>n||n>=Ae)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return Ce(t,n)},startsWith:function(e){var t=ne.ToString(ne.RequireObjectCoercible(this));if(ne.IsRegExp(e))throw new TypeError('Cannot call method "startsWith" with a regex');var n,r=ne.ToString(e);arguments.length>1&&(n=arguments[1]);var o=_(ne.ToInteger(n),0);return E(t,o,o+r.length)===r},endsWith:function(e){var t=ne.ToString(ne.RequireObjectCoercible(this));if(ne.IsRegExp(e))throw new TypeError('Cannot call method "endsWith" with a regex');var n,r=ne.ToString(e),o=t.length;arguments.length>1&&(n=arguments[1]);var i="undefined"==typeof n?o:ne.ToInteger(n),a=M(_(i,0),o);return E(t,a-r.length,a)===r},includes:function(e){if(ne.IsRegExp(e))throw new TypeError('"includes" does not accept a RegExp');var t,n=ne.ToString(e);return arguments.length>1&&(t=arguments[1]),-1!==k(this,n,t)},codePointAt:function(e){var t=ne.ToString(ne.RequireObjectCoercible(this)),n=ne.ToInteger(e),r=t.length;if(n>=0&&r>n){var o=t.charCodeAt(n),i=n+1===r;if(55296>o||o>56319||i)return o;var a=t.charCodeAt(n+1);return 56320>a||a>57343?o:1024*(o-55296)+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",1/0)!==!1&&Q(String.prototype,"includes",Ee.includes),String.prototype.startsWith&&String.prototype.endsWith){var Ne=a(function(){"/a/".startsWith(/a/)}),Pe=s(function(){return"abc".startsWith("a",1/0)===!1});Ne&&Pe||(Q(String.prototype,"startsWith",Ee.startsWith),Q(String.prototype,"endsWith",Ee.endsWith))}if(Z){var Ie=s(function(){var e=/a/;return e[z.match]=!1,"/a/".startsWith(e)});Ie||Q(String.prototype,"startsWith",Ee.startsWith);var _e=s(function(){var e=/a/;return e[z.match]=!1,"/a/".endsWith(e)});_e||Q(String.prototype,"endsWith",Ee.endsWith);var Me=s(function(){var e=/a/;return e[z.match]=!1,"/a/".includes(e)});Me||Q(String.prototype,"includes",Ee.includes)}m(String.prototype,Ee);var Fe=["	\n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join(""),De=new RegExp("(^["+Fe+"]+)|(["+Fe+"]+$)","g"),Le=function(){return ne.ToString(ne.RequireObjectCoercible(this)).replace(De,"")},qe=["\x85","\u200b","\ufffe"].join(""),Re=new RegExp("["+qe+"]","g"),He=/^[\-+]0x[0-9a-f]+$/i,$e=qe.trim().length!==qe.length;y(String.prototype,"trim",Le,$e);var ze=function(e){return{value:e,done:0===arguments.length}},We=function(e){ne.RequireObjectCoercible(e),this._s=ne.ToString(e),this._i=0};We.prototype.next=function(){var e=this._s,t=this._i;if("undefined"==typeof e||t>=e.length)return this._s=void 0,ze();var n,r,o=e.charCodeAt(t);return 55296>o||o>56319||t+1===e.length?r=1:(n=e.charCodeAt(t+1),r=56320>n||n>57343?1:2),this._i=t+r,ze(e.substr(t,r))},xe(We.prototype),xe(String.prototype,function(){return new We(this)});var Be={from:function(e){var t,r=this;arguments.length>1&&(t=arguments[1]);var o,i;if("undefined"==typeof t)o=!1;else{if(!ne.IsCallable(t))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2]),o=!0}var a,s,u,c="undefined"!=typeof(J(e)||ne.GetMethod(e,K));if(c){s=ne.IsConstructor(r)?Object(new r):[];var l,f,p=ne.GetIterator(e);for(u=0;;){if(l=ne.IteratorStep(p),l===!1)break;f=l.value;try{o&&(f="undefined"==typeof i?t(f,u):n(t,i,f,u)),s[u]=f}catch(e){throw ne.IteratorClose(p,!0),e}u+=1}a=u}else{var d=ne.ToObject(e);a=ne.ToLength(d.length),s=ne.IsConstructor(r)?Object(new r(a)):new Array(a);var h;for(u=0;a>u;++u)h=d[u],o&&(h="undefined"==typeof i?t(h,u):n(t,i,h,u)),Oe(s,u,h)}return s.length=a,s},of:function(){for(var e=arguments.length,t=this,n=r(t)||!ne.IsCallable(t)?new Array(e):ne.Construct(t,[e]),o=0;e>o;++o)Oe(n,o,arguments[o]);return n.length=e,n}};m(Array,Be),we(Array),e=function(e,t){this.i=0,this.array=e,this.kind=t},m(e.prototype,{next:function(){var t=this.i,n=this.array;if(!(this instanceof e))throw new TypeError("Not an ArrayIterator");if("undefined"!=typeof n)for(var r=ne.ToLength(n.length);r>t;t++){var o,i=this.kind;return"key"===i?o=t:"value"===i?o=n[t]:"entry"===i&&(o=[t,n[t]]),this.i=t+1,ze(o)}return this.array=void 0,ze()}}),xe(e.prototype);var Ve=Array.of===Be.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}();Ve||Q(Array,"of",Be.of);var Ue={copyWithin:function(e,t){var n,r=ne.ToObject(this),o=ne.ToLength(r.length),i=ne.ToInteger(e),a=ne.ToInteger(t),s=0>i?_(o+i,0):M(i,o),u=0>a?_(o+a,0):M(a,o);arguments.length>2&&(n=arguments[2]);var c="undefined"==typeof n?o:ne.ToInteger(n),l=0>c?_(o+c,0):M(c,o),f=M(l-u,o-s),p=1;for(s>u&&u+f>s&&(p=-1,u+=f-1,s+=f-1);f>0;)u in r?r[s]=r[u]:delete r[s],u+=p,s+=p,f-=1;return r},fill:function(e){var t;arguments.length>1&&(t=arguments[1]);var n;arguments.length>2&&(n=arguments[2]);var r=ne.ToObject(this),o=ne.ToLength(r.length);t=ne.ToInteger("undefined"==typeof t?0:t),n=ne.ToInteger("undefined"==typeof n?o:n);for(var i=0>t?_(o+t,0):M(t,o),a=0>n?o+n:n,s=i;o>s&&a>s;++s)r[s]=e;return r},find:function(e){var t=ne.ToObject(this),r=ne.ToLength(t.length);if(!ne.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");for(var o,i=arguments.length>1?arguments[1]:null,a=0;r>a;a++)if(o=t[a],i){if(n(e,i,o,a,t))return o}else if(e(o,a,t))return o},findIndex:function(e){var t=ne.ToObject(this),r=ne.ToLength(t.length);if(!ne.IsCallable(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var o=arguments.length>1?arguments[1]:null,i=0;r>i;i++)if(o){if(n(e,o,t[i],i,t))return i}else if(e(t[i],i,t))return i;return-1},keys:function(){return new e(this,"key")},values:function(){return new e(this,"value")},entries:function(){return new e(this,"entry")}};if(Array.prototype.keys&&!ne.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ne.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[K]&&(m(Array.prototype,{values:Array.prototype[K]}),Y.symbol(z.unscopables)&&(Array.prototype[z.unscopables].values=!0)),f&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Ge=Array.prototype.values;Q(Array.prototype,"values",function(){return ne.Call(Ge,this,arguments)}),y(Array.prototype,K,Array.prototype.values,!0)}m(Array.prototype,Ue),1/[!0].indexOf(!0,-0)<0&&y(Array.prototype,"indexOf",function(){var e=C(this,arguments);return 0===e&&0>1/e?0:e},!0),xe(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&xe(Object.getPrototypeOf([].values()));var Xe=function(){return s(function(){return 0===Array.from({length:-1}).length})}(),Je=function(){var e=Array.from([0].entries());return 1===e.length&&r(e[0])&&0===e[0][0]&&0===e[0][1]}();Xe&&Je||Q(Array,"from",Be.from);var Ye=function(){return s(function(){return Array.from([0],void 0)})}();if(!Ye){var Qe=Array.from;Q(Array,"from",function(e){return arguments.length>1&&"undefined"!=typeof arguments[1]?ne.Call(Qe,this,arguments):n(Qe,this,e)})}var Ze=-(Math.pow(2,32)-1),Ke=function(e,t){var r={length:Ze};return r[t?(r.length>>>0)-1:0]=!0,s(function(){return n(e,r,function(){throw new RangeError("should not reach here")},[]),!0})};if(!Ke(Array.prototype.forEach)){var et=Array.prototype.forEach;Q(Array.prototype,"forEach",function(){return ne.Call(et,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.map)){var tt=Array.prototype.map;Q(Array.prototype,"map",function(){return ne.Call(tt,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.filter)){var nt=Array.prototype.filter;Q(Array.prototype,"filter",function(){return ne.Call(nt,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.some)){var rt=Array.prototype.some;Q(Array.prototype,"some",function(){return ne.Call(rt,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.every)){var ot=Array.prototype.every;Q(Array.prototype,"every",function(){return ne.Call(ot,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.reduce)){var it=Array.prototype.reduce;Q(Array.prototype,"reduce",function(){return ne.Call(it,this.length>=0?this:[],arguments)},!0)}if(!Ke(Array.prototype.reduceRight,!0)){var at=Array.prototype.reduceRight;Q(Array.prototype,"reduceRight",function(){return ne.Call(at,this.length>=0?this:[],arguments)},!0)}var st=8!==Number("0o10"),ut=2!==Number("0b10"),ct=g(qe,function(e){return 0===Number(e+0+e)});if(st||ut||ct){var lt=Number,ft=/^0b[01]+$/i,pt=/^0o[0-7]+$/i,dt=ft.test.bind(ft),ht=pt.test.bind(pt),gt=function(e){var t;if("function"==typeof e.valueOf&&(t=e.valueOf(),Y.primitive(t)))return t;if("function"==typeof e.toString&&(t=e.toString(),Y.primitive(t)))return t;throw new TypeError("No default value")},yt=Re.test.bind(Re),mt=He.test.bind(He),vt=function(){var e=function(t){var n;n=arguments.length>0?Y.primitive(t)?t:gt(t,"number"):0,"string"==typeof n&&(n=ne.Call(Le,n),dt(n)?n=parseInt(E(n,2),2):ht(n)?n=parseInt(E(n,2),8):(yt(n)||mt(n))&&(n=0/0));var r=this,o=s(function(){return lt.prototype.valueOf.call(r),!0});return r instanceof e&&!o?new lt(n):lt(n)};return e}();ve(lt,vt,{}),m(vt,{NaN:lt.NaN,MAX_VALUE:lt.MAX_VALUE,MIN_VALUE:lt.MIN_VALUE,NEGATIVE_INFINITY:lt.NEGATIVE_INFINITY,POSITIVE_INFINITY:lt.POSITIVE_INFINITY}),Number=vt,w.redefine(j,"Number",vt)}var bt=Math.pow(2,53)-1;m(Number,{MAX_SAFE_INTEGER:bt,MIN_SAFE_INTEGER:-bt,EPSILON:2.220446049250313e-16,parseInt:j.parseInt,parseFloat:j.parseFloat,isFinite:V,isInteger:function(e){return V(e)&&ne.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&D(e)<=Number.MAX_SAFE_INTEGER},isNaN:B}),y(Number,"parseInt",j.parseInt,Number.parseInt!==j.parseInt),[,1].find(function(e,t){return 0===t})||Q(Array.prototype,"find",Ue.find),0!==[,1].findIndex(function(e,t){return 0===t})&&Q(Array.prototype,"findIndex",Ue.findIndex);var wt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),xt=function(e,t){l&&wt(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},Tt=function(){for(var e=Number(this),t=arguments.length,n=t-e,r=new Array(0>n?0:n),o=e;t>o;++o)r[o-e]=arguments[o];return r},Ot=function(e){return function(t,n){return t[n]=e[n],t}},jt=function(e,t){var n,r=o(Object(t));return ne.IsCallable(Object.getOwnPropertySymbols)&&(n=h(Object.getOwnPropertySymbols(Object(t)),wt(t))),d(A(r,n||[]),Ot(t),e)},St={assign:function(e){var t=ne.ToObject(e,"Cannot convert undefined or null to object");return d(ne.Call(Tt,1,arguments),jt,t)},is:function(e,t){return ne.SameValue(e,t)}},kt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}();if(kt&&Q(Object,"assign",St.assign),m(Object,St),l){var Ct={setPrototypeOf:function(e,t){var r,o=function(e,t){if(!ne.TypeIsObject(e))throw new TypeError("cannot set prototype on a non-object");if(null!==t&&!ne.TypeIsObject(t))throw new TypeError("can only set prototype to an object or null"+t)},i=function(e,t){return o(e,t),n(r,e,t),e};try{r=e.getOwnPropertyDescriptor(e.prototype,t).set,n(r,{},null)}catch(n){if(e.prototype!=={}[t])return;r=function(e){this[t]=e},i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};m(Object,Ct)}Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&!function(){var e=Object.create(null),t=Object.getPrototypeOf,n=Object.setPrototypeOf;Object.getPrototypeOf=function(n){var r=t(n);return r===e?null:r},Object.setPrototypeOf=function(t,r){var o=null===r?e:r;return n(t,o)},Object.setPrototypeOf.polyfill=!1}();var At=!a(function(){Object.keys("foo")});if(!At){var Et=Object.keys;Q(Object,"keys",function(e){return Et(ne.ToObject(e))}),o=Object.keys}var Nt=a(function(){Object.keys(/a/g)});if(Nt){var Pt=Object.keys;Q(Object,"keys",function(e){if(Y.regex(e)){var t=[];for(var n in e)H(e,n)&&N(t,n);return t}return Pt(e)}),o=Object.keys}if(Object.getOwnPropertyNames){var It=!a(function(){Object.getOwnPropertyNames("foo")});if(!It){var _t="object"===("undefined"==typeof window?"undefined":_typeof(window))?Object.getOwnPropertyNames(window):[],Mt=Object.getOwnPropertyNames;Q(Object,"getOwnPropertyNames",function(e){var t=ne.ToObject(e);if("[object Window]"===v(t))try{return Mt(t)}catch(e){return A([],_t)}return Mt(t)})}}if(Object.getOwnPropertyDescriptor){var Ft=!a(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!Ft){var Dt=Object.getOwnPropertyDescriptor;Q(Object,"getOwnPropertyDescriptor",function(e,t){return Dt(ne.ToObject(e),t)})}}if(Object.seal){var Lt=!a(function(){Object.seal("foo")});if(!Lt){var qt=Object.seal;Q(Object,"seal",function(e){return ne.TypeIsObject(e)?qt(e):e})}}if(Object.isSealed){var Rt=!a(function(){Object.isSealed("foo")});if(!Rt){var Ht=Object.isSealed;Q(Object,"isSealed",function(e){return ne.TypeIsObject(e)?Ht(e):!0})}}if(Object.freeze){var $t=!a(function(){Object.freeze("foo")});if(!$t){var zt=Object.freeze;Q(Object,"freeze",function(e){return ne.TypeIsObject(e)?zt(e):e})}}if(Object.isFrozen){var Wt=!a(function(){Object.isFrozen("foo")});if(!Wt){var Bt=Object.isFrozen;Q(Object,"isFrozen",function(e){return ne.TypeIsObject(e)?Bt(e):!0})}}if(Object.preventExtensions){var Vt=!a(function(){Object.preventExtensions("foo")});if(!Vt){var Ut=Object.preventExtensions;Q(Object,"preventExtensions",function(e){return ne.TypeIsObject(e)?Ut(e):e})}}if(Object.isExtensible){var Gt=!a(function(){Object.isExtensible("foo")});if(!Gt){var Xt=Object.isExtensible;Q(Object,"isExtensible",function(e){return ne.TypeIsObject(e)?Xt(e):!1})}}if(Object.getPrototypeOf){var Jt=!a(function(){Object.getPrototypeOf("foo")});if(!Jt){var Yt=Object.getPrototypeOf;Q(Object,"getPrototypeOf",function(e){return Yt(ne.ToObject(e))})}}var Qt=l&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ne.IsCallable(e.get)}();if(l&&!Qt){var Zt=function(){if(!ne.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e};w.getter(RegExp.prototype,"flags",Zt)}var Kt=l&&s(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),en=Z&&l&&function(){var e=/./;return e[z.match]=!1,RegExp(e)===e}(),tn=s(function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})}),nn=tn&&s(function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})});if(!tn||!nn){var rn=RegExp.prototype.toString;y(RegExp.prototype,"toString",function(){var e=ne.RequireObjectCoercible(this);if(Y.regex(e))return n(rn,e);var t=te(e.source),r=te(e.flags);return"/"+t+"/"+r},!0),w.preserveToString(RegExp.prototype.toString,rn)}if(l&&(!Kt||en)){var on=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,an=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},sn=function(){return this.source},un=ne.IsCallable(an.get)?an.get:sn,cn=RegExp,ln=function(){return function e(t,n){var r=ne.IsRegExp(t),o=this instanceof e;if(!o&&r&&"undefined"==typeof n&&t.constructor===e)return t;var i=t,a=n;return Y.regex(t)?(i=ne.Call(un,t),a="undefined"==typeof n?ne.Call(on,t):n,new e(i,a)):(r&&(i=t.source,a="undefined"==typeof n?t.flags:n),new cn(t,n))}}();ve(cn,ln,{$input:!0}),RegExp=ln,w.redefine(j,"RegExp",ln)}if(l){var fn={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};p(o(fn),function(e){e in RegExp&&!(fn[e]in RegExp)&&w.getter(RegExp,fn[e],function(){return RegExp[e]})})}we(RegExp);var pn=1/Number.EPSILON,dn=function(e){return e+pn-pn},hn=Math.pow(2,-23),gn=Math.pow(2,127)*(2-hn),yn=Math.pow(2,-126),mn=Math.E,vn=Math.LOG2E,bn=Math.LOG10E,wn=Number.prototype.clz;delete Number.prototype.clz;var xn={acosh:function(e){var t=Number(e);return B(t)||1>e?0/0:1===t?0:t===1/0?t:q(t/mn+R(t+1)*R(t-1)/mn)+1},asinh:function e(t){var n=Number(t);return 0!==n&&S(n)?0>n?-e(-n):q(n+R(n*n+1)):n},atanh:function(e){var t=Number(e);return B(t)||-1>t||t>1?0/0:-1===t?-(1/0):1===t?1/0:0===t?t:.5*q((1+t)/(1-t))},cbrt:function(e){var t=Number(e);if(0===t)return t;var n,r=0>t;return r&&(t=-t),t===1/0?n=1/0:(n=L(q(t)/3),n=(t/(n*n)+2*n)/3),r?-n:n},clz32:function(e){var t=Number(e),n=ne.ToUint32(t);return 0===n?32:wn?ne.Call(wn,n):31-F(q(n+.5)*vn)},cosh:function(e){var t=Number(e);return 0===t?1:B(t)?0/0:S(t)?(0>t&&(t=-t),t>21?L(t)/2:(L(t)+L(-t))/2):1/0},expm1:function(e){var t=Number(e);if(t===-(1/0))return-1;if(!S(t)||0===t)return t;if(D(t)>.5)return L(t)-1;for(var n=t,r=0,o=1;r+n!==r;)r+=n,o+=1,n*=t/o;return r},hypot:function(){for(var e=0,t=0,n=0;n<arguments.length;++n){var r=D(Number(arguments[n]));r>t?(e*=t/r*(t/r),e+=1,t=r):e+=r>0?r/t*(r/t):r}return t===1/0?1/0:t*R(e)},log2:function(e){return q(e)*vn},log10:function(e){return q(e)*bn},log1p:function(e){var t=Number(e);return-1>t||B(t)?0/0:0===t||t===1/0?t:-1===t?-(1/0):1+t-1===0?t:t*(q(1+t)/(1+t-1))},sign:U,sinh:function(e){var t=Number(e);return S(t)&&0!==t?D(t)<1?(Math.expm1(t)-Math.expm1(-t))/2:(L(t-1)-L(-t-1))*mn/2:t},tanh:function(e){var t=Number(e);return B(t)||0===t?t:t>=20?1:-20>=t?-1:(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function(e){var t=Number(e);return 0>t?-F(-t):F(t)},imul:function(e,t){var n=ne.ToUint32(e),r=ne.ToUint32(t),o=n>>>16&65535,i=65535&n,a=r>>>16&65535,s=65535&r;return i*s+(o*s+i*a<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||t===1/0||t===-(1/0)||B(t))return t;var n=U(t),r=D(t);if(yn>r)return n*dn(r/yn/hn)*yn*hn;var o=(1+hn/Number.EPSILON)*r,i=o-(o-r);return i>gn||B(i)?n*(1/0):n*i}};m(Math,xn),y(Math,"log1p",xn.log1p,-1e-17!==Math.log1p(-1e-17)),y(Math,"asinh",xn.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),y(Math,"tanh",xn.tanh,-2e-17!==Math.tanh(-2e-17)),y(Math,"acosh",xn.acosh,Math.acosh(Number.MAX_VALUE)===1/0),y(Math,"cbrt",xn.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8),y(Math,"sinh",xn.sinh,-2e-17!==Math.sinh(-2e-17));var Tn=Math.expm1(10);y(Math,"expm1",xn.expm1,Tn>22025.465794806718||22025.465794806718>Tn);var On=Math.round,jn=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(-.5+Number.EPSILON/3.99),Sn=pn+1,kn=2*pn-1,Cn=[Sn,kn].every(function(e){return Math.round(e)===e});y(Math,"round",function(e){var t=F(e),n=-1===t?-0:t+1;return.5>e-t?t:n},!jn||!Cn),w.preserveToString(Math.round,On);var An=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=xn.imul,w.preserveToString(Math.imul,An)),2!==Math.imul.length&&Q(Math,"imul",function(){return ne.Call(An,Math,arguments)});var En=function(){var e=j.setTimeout;if("function"==typeof e||"object"===("undefined"==typeof e?"undefined":_typeof(e))){ne.IsPromise=function(e){return ne.TypeIsObject(e)?"undefined"==typeof e._promise?!1:!0:!1};var t,r=function(e){if(!ne.IsConstructor(e))throw new TypeError("Bad promise constructor");var t=this,n=function(e,n){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=n};if(t.resolve=void 0,t.reject=void 0,t.promise=new e(n),!ne.IsCallable(t.resolve)||!ne.IsCallable(t.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&ne.IsCallable(window.postMessage)&&(t=function(){var e=[],t="zero-timeout-message",n=function(n){N(e,n),window.postMessage(t,"*")},r=function(n){if(n.source===window&&n.data===t){if(n.stopPropagation(),0===e.length)return;var r=I(e);r()}};return window.addEventListener("message",r,!0),n});var o,i,a=function(){var e=j.Promise,t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}},s=ne.IsCallable(j.setImmediate)?j.setImmediate:"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick?process.nextTick:a()||(ne.IsCallable(t)?t():function(t){e(t,0)}),u=function(e){return e},c=function(e){throw e},l=0,f=1,p=2,d=0,h=1,g=2,y={},v=function(e,t,n){s(function(){b(e,t,n)})},b=function(e,t,n){var r,o;if(t===y)return e(n);try{r=e(n),o=t.resolve}catch(e){r=e,o=t.reject}o(r)},w=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(v(n.fulfillReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;r>o;o++,i+=3)v(n[i+d],n[i+g],t),e[i+d]=void 0,e[i+h]=void 0,e[i+g]=void 0;n.result=t,n.state=f,n.reactionLength=0},x=function(e,t){var n=e._promise,r=n.reactionLength;if(r>0&&(v(n.rejectReactionHandler0,n.reactionCapability0,t),n.fulfillReactionHandler0=void 0,n.rejectReactions0=void 0,n.reactionCapability0=void 0,r>1))for(var o=1,i=0;r>o;o++,i+=3)v(n[i+h],n[i+g],t),e[i+d]=void 0,e[i+h]=void 0,e[i+g]=void 0;n.result=t,n.state=p,n.reactionLength=0},T=function(e){var t=!1,n=function(n){var r;if(!t){if(t=!0,n===e)return x(e,new TypeError("Self resolution"));if(!ne.TypeIsObject(n))return w(e,n);try{r=n.then}catch(t){return x(e,t)}return ne.IsCallable(r)?void s(function(){S(e,n,r)}):w(e,n)}},r=function(n){return t?void 0:(t=!0,x(e,n))};return{resolve:n,reject:r}},O=function(e,t,r,o){e===i?n(e,t,r,o,y):n(e,t,r,o)},S=function(e,t,n){var r=T(e),o=r.resolve,i=r.reject;try{O(n,t,o,i)}catch(e){i(e)}},k=function(){var e=function(t){if(!(this instanceof e))throw new TypeError('Constructor Promise requires "new"');

if(this&&this._promise)throw new TypeError("Bad construction");if(!ne.IsCallable(t))throw new TypeError("not a valid resolver");var n=je(this,e,o,{_promise:{result:void 0,state:l,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),r=T(n),i=r.reject;try{t(r.resolve,i)}catch(e){i(e)}return n};return e}();o=k.prototype;var C=function(e,t,n,r){var o=!1;return function(i){if(!o&&(o=!0,t[e]=i,0===--r.count)){var a=n.resolve;a(t)}}},A=function(e,t,n){for(var r,o,i=e.iterator,a=[],s={count:1},u=0;;){try{if(r=ne.IteratorStep(i),r===!1){e.done=!0;break}o=r.value}catch(t){throw e.done=!0,t}a[u]=void 0;var c=t.resolve(o),l=C(u,a,n,s);s.count+=1,O(c.then,c,l,n.reject),u+=1}if(0===--s.count){var f=n.resolve;f(a)}return n.promise},E=function(e,t,n){for(var r,o,i,a=e.iterator;;){try{if(r=ne.IteratorStep(a),r===!1){e.done=!0;break}o=r.value}catch(t){throw e.done=!0,t}i=t.resolve(o),O(i.then,i,n.resolve,n.reject)}return n.promise};return m(k,{all:function(e){var t=this;if(!ne.TypeIsObject(t))throw new TypeError("Promise is not object");var n,o,i=new r(t);try{return n=ne.GetIterator(e),o={iterator:n,done:!1},A(o,t,i)}catch(e){var a=e;if(o&&!o.done)try{ne.IteratorClose(n,!0)}catch(e){a=e}var s=i.reject;return s(a),i.promise}},race:function(e){var t=this;if(!ne.TypeIsObject(t))throw new TypeError("Promise is not object");var n,o,i=new r(t);try{return n=ne.GetIterator(e),o={iterator:n,done:!1},E(o,t,i)}catch(e){var a=e;if(o&&!o.done)try{ne.IteratorClose(n,!0)}catch(e){a=e}var s=i.reject;return s(a),i.promise}},reject:function(e){var t=this;if(!ne.TypeIsObject(t))throw new TypeError("Bad promise constructor");var n=new r(t),o=n.reject;return o(e),n.promise},resolve:function(e){var t=this;if(!ne.TypeIsObject(t))throw new TypeError("Bad promise constructor");if(ne.IsPromise(e)){var n=e.constructor;if(n===t)return e}var o=new r(t),i=o.resolve;return i(e),o.promise}}),m(o,{catch:function(e){return this.then(null,e)},then:function(e,t){var n=this;if(!ne.IsPromise(n))throw new TypeError("not a promise");var o,i=ne.SpeciesConstructor(n,k),a=arguments.length>2&&arguments[2]===y;o=a&&i===k?y:new r(i);var s,m=ne.IsCallable(e)?e:u,b=ne.IsCallable(t)?t:c,w=n._promise;if(w.state===l){if(0===w.reactionLength)w.fulfillReactionHandler0=m,w.rejectReactionHandler0=b,w.reactionCapability0=o;else{var x=3*(w.reactionLength-1);w[x+d]=m,w[x+h]=b,w[x+g]=o}w.reactionLength+=1}else if(w.state===f)s=w.result,v(m,o,s);else{if(w.state!==p)throw new TypeError("unexpected Promise state");s=w.result,v(b,o,s)}return o.promise}}),y=new r(k),i=o.then,k}}();if(j.Promise&&(delete j.Promise.accept,delete j.Promise.defer,delete j.Promise.prototype.chain),"function"==typeof En){m(j,{Promise:En});var Nn=T(j.Promise,function(e){return e.resolve(42).then(function(){})instanceof e}),Pn=!a(function(){j.Promise.reject(42).then(null,5).then(null,$)}),In=a(function(){j.Promise.call(3,$)}),_n=function(e){var t=e.resolve(5);t.constructor={};var n=e.resolve(t);try{n.then(null,$).then(null,$)}catch(e){return!0}return t===n}(j.Promise),Mn=l&&function(){var e=0,t=Object.defineProperty({},"then",{get:function(){e+=1}});return Promise.resolve(t),1===e}(),Fn=function e(t){var n=new Promise(t);t(3,function(){}),this.then=n.then,this.constructor=e};Fn.prototype=Promise.prototype,Fn.all=Promise.all;var Dn=s(function(){return!!Fn.all([1,2])});if(Nn&&Pn&&In&&!_n&&Mn&&!Dn||(Promise=En,Q(j,"Promise",En)),1!==Promise.all.length){var Ln=Promise.all;Q(Promise,"all",function(){return ne.Call(Ln,this,arguments)})}if(1!==Promise.race.length){var qn=Promise.race;Q(Promise,"race",function(){return ne.Call(qn,this,arguments)})}if(1!==Promise.resolve.length){var Rn=Promise.resolve;Q(Promise,"resolve",function(){return ne.Call(Rn,this,arguments)})}if(1!==Promise.reject.length){var Hn=Promise.reject;Q(Promise,"reject",function(){return ne.Call(Hn,this,arguments)})}xt(Promise,"all"),xt(Promise,"race"),xt(Promise,"resolve"),xt(Promise,"reject"),we(Promise)}var $n=function(e){var t=o(d(e,function(e,t){return e[t]=!0,e},{}));return e.join(":")===t.join(":")},zn=$n(["z","a","bb"]),Wn=$n(["z",1,"a","3",2]);if(l){var Bn=function(e){return zn?"undefined"==typeof e||null===e?"^"+ne.ToString(e):"string"==typeof e?"$"+e:"number"==typeof e?Wn?e:"n"+e:"boolean"==typeof e?"b"+e:null:null},Vn=function(){return Object.create?Object.create(null):{}},Un=function(e,t,o){if(r(o)||Y.string(o))p(o,function(e){if(!ne.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");t.set(e[0],e[1])});else if(o instanceof e)n(e.prototype.forEach,o,function(e,n){t.set(n,e)});else{var i,a;if(null!==o&&"undefined"!=typeof o){if(a=t.set,!ne.IsCallable(a))throw new TypeError("bad map");i=ne.GetIterator(o)}if("undefined"!=typeof i)for(;;){var s=ne.IteratorStep(i);if(s===!1)break;var u=s.value;try{if(!ne.TypeIsObject(u))throw new TypeError("Iterator value "+u+" is not an entry object");n(a,t,u[0],u[1])}catch(e){throw ne.IteratorClose(i,!0),e}}}},Gn=function(e,t,o){if(r(o)||Y.string(o))p(o,function(e){t.add(e)});else if(o instanceof e)n(e.prototype.forEach,o,function(e){t.add(e)});else{var i,a;if(null!==o&&"undefined"!=typeof o){if(a=t.add,!ne.IsCallable(a))throw new TypeError("bad set");i=ne.GetIterator(o)}if("undefined"!=typeof i)for(;;){var s=ne.IteratorStep(i);if(s===!1)break;var u=s.value;try{n(a,t,u)}catch(e){throw ne.IteratorClose(i,!0),e}}}},Xn={Map:function(){var e={},t=function(e,t){this.key=e,this.value=t,this.next=null,this.prev=null};t.prototype.isRemoved=function(){return this.key===e};var r=function(e){return!!e._es6map},o=function(e,t){if(!ne.TypeIsObject(e)||!r(e))throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ne.ToString(e))},i=function(e,t){o(e,"[[MapIterator]]"),this.head=e._head,this.i=this.head,this.kind=t};i.prototype={next:function(){var e=this.i,t=this.kind,n=this.head;if("undefined"==typeof this.i)return ze();for(;e.isRemoved()&&e!==n;)e=e.prev;for(var r;e.next!==n;)if(e=e.next,!e.isRemoved())return r="key"===t?e.key:"value"===t?e.value:[e.key,e.value],this.i=e,ze(r);return this.i=void 0,ze()}},xe(i.prototype);var a,s=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var n=je(this,e,a,{_es6map:!0,_head:null,_storage:Vn(),_size:0}),r=new t(null,null);return r.next=r.prev=r,n._head=r,arguments.length>0&&Un(e,n,arguments[0]),n};return a=s.prototype,w.getter(a,"size",function(){if("undefined"==typeof this._size)throw new TypeError("size method called on incompatible Map");return this._size}),m(a,{get:function(e){o(this,"get");var t=Bn(e);if(null!==t){var n=this._storage[t];return n?n.value:void 0}for(var r=this._head,i=r;(i=i.next)!==r;)if(ne.SameValueZero(i.key,e))return i.value},has:function(e){o(this,"has");var t=Bn(e);if(null!==t)return"undefined"!=typeof this._storage[t];for(var n=this._head,r=n;(r=r.next)!==n;)if(ne.SameValueZero(r.key,e))return!0;return!1},set:function(e,n){o(this,"set");var r,i=this._head,a=i,s=Bn(e);if(null!==s){if("undefined"!=typeof this._storage[s])return this._storage[s].value=n,this;r=this._storage[s]=new t(e,n),a=i.prev}for(;(a=a.next)!==i;)if(ne.SameValueZero(a.key,e))return a.value=n,this;return r=r||new t(e,n),ne.SameValue(-0,e)&&(r.key=0),r.next=this._head,r.prev=this._head.prev,r.prev.next=r,r.next.prev=r,this._size+=1,this},delete:function(t){o(this,"delete");var n=this._head,r=n,i=Bn(t);if(null!==i){if("undefined"==typeof this._storage[i])return!1;r=this._storage[i].prev,delete this._storage[i]}for(;(r=r.next)!==n;)if(ne.SameValueZero(r.key,t))return r.key=r.value=e,r.prev.next=r.next,r.next.prev=r.prev,this._size-=1,!0;return!1},clear:function(){o(this,"clear"),this._size=0,this._storage=Vn();for(var t=this._head,n=t,r=n.next;(n=r)!==t;)n.key=n.value=e,r=n.next,n.next=n.prev=t;t.next=t.prev=t},keys:function(){return o(this,"keys"),new i(this,"key")},values:function(){return o(this,"values"),new i(this,"value")},entries:function(){return o(this,"entries"),new i(this,"key+value")},forEach:function(e){o(this,"forEach");for(var t=arguments.length>1?arguments[1]:null,r=this.entries(),i=r.next();!i.done;i=r.next())t?n(e,t,i.value[1],i.value[0],this):e(i.value[1],i.value[0],this)}}),xe(a,a.entries),s}(),Set:function(){var e,t=function(e){return e._es6set&&"undefined"!=typeof e._storage},r=function(e,n){if(!ne.TypeIsObject(e)||!t(e))throw new TypeError("Set.prototype."+n+" called on incompatible receiver "+ne.ToString(e))},i=function t(){if(!(this instanceof t))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var n=je(this,t,e,{_es6set:!0,"[[SetData]]":null,_storage:Vn()});if(!n._es6set)throw new TypeError("bad set");return arguments.length>0&&Gn(t,n,arguments[0]),n};e=i.prototype;var a=function(e){var t=e;if("^null"===t)return null;if("^undefined"===t)return void 0;var n=t.charAt(0);return"$"===n?E(t,1):"n"===n?+E(t,1):"b"===n?"btrue"===t:+t},s=function(e){if(!e["[[SetData]]"]){var t=e["[[SetData]]"]=new Xn.Map;p(o(e._storage),function(e){var n=a(e);t.set(n,n)}),e["[[SetData]]"]=t}e._storage=null};return w.getter(i.prototype,"size",function(){return r(this,"size"),this._storage?o(this._storage).length:(s(this),this["[[SetData]]"].size)}),m(i.prototype,{has:function(e){r(this,"has");var t;return this._storage&&null!==(t=Bn(e))?!!this._storage[t]:(s(this),this["[[SetData]]"].has(e))},add:function(e){r(this,"add");var t;return this._storage&&null!==(t=Bn(e))?(this._storage[t]=!0,this):(s(this),this["[[SetData]]"].set(e,e),this)},delete:function(e){r(this,"delete");var t;if(this._storage&&null!==(t=Bn(e))){var n=H(this._storage,t);return delete this._storage[t]&&n}return s(this),this["[[SetData]]"].delete(e)},clear:function(){r(this,"clear"),this._storage&&(this._storage=Vn()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return r(this,"values"),s(this),this["[[SetData]]"].values()},entries:function(){return r(this,"entries"),s(this),this["[[SetData]]"].entries()},forEach:function(e){r(this,"forEach");var t=arguments.length>1?arguments[1]:null,o=this;s(o),this["[[SetData]]"].forEach(function(r,i){t?n(e,t,i,i,o):e(i,i,o)})}}),y(i.prototype,"keys",i.prototype.values,!0),xe(i.prototype,i.prototype.values),i}()};if(j.Map||j.Set){var Jn=s(function(){return 2===new Map([[1,2]]).get(1)});if(!Jn){var Yn=j.Map;j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new Yn;return arguments.length>0&&Un(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,j.Map.prototype),t},j.Map.prototype=x(Yn.prototype),y(j.Map.prototype,"constructor",j.Map,!0),w.preserveToString(j.Map,Yn)}var Qn=new Map,Zn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);return e.set(-0,e),e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}(),Kn=Qn.set(1,2)===Qn;if(!Zn||!Kn){var er=Map.prototype.set;Q(Map.prototype,"set",function(e,t){return n(er,this,0===e?0:e,t),this})}if(!Zn){var tr=Map.prototype.get,nr=Map.prototype.has;m(Map.prototype,{get:function(e){return n(tr,this,0===e?0:e)},has:function(e){return n(nr,this,0===e?0:e)}},!0),w.preserveToString(Map.prototype.get,tr),w.preserveToString(Map.prototype.has,nr)}var rr=new Set,or=function(e){return e.delete(0),e.add(-0),!e.has(0)}(rr),ir=rr.add(1)===rr;if(!or||!ir){var ar=Set.prototype.add;Set.prototype.add=function(e){return n(ar,this,0===e?0:e),this},w.preserveToString(Set.prototype.add,ar)}if(!or){var sr=Set.prototype.has;Set.prototype.has=function(e){return n(sr,this,0===e?0:e)},w.preserveToString(Set.prototype.has,sr);var ur=Set.prototype.delete;Set.prototype.delete=function(e){return n(ur,this,0===e?0:e)},w.preserveToString(Set.prototype.delete,ur)}var cr=T(j.Map,function(e){var t=new e([]);return t.set(42,42),t instanceof e}),lr=Object.setPrototypeOf&&!cr,fr=function(){try{return!(j.Map()instanceof j.Map)}catch(e){return e instanceof TypeError}}();if(0!==j.Map.length||lr||!fr){var pr=j.Map;j.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new pr;return arguments.length>0&&Un(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Map.prototype=pr.prototype,y(j.Map.prototype,"constructor",j.Map,!0),w.preserveToString(j.Map,pr)}var dr=T(j.Set,function(e){var t=new e([]);return t.add(42,42),t instanceof e}),hr=Object.setPrototypeOf&&!dr,gr=function(){try{return!(j.Set()instanceof j.Set)}catch(e){return e instanceof TypeError}}();if(0!==j.Set.length||hr||!gr){var yr=j.Set;j.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');var t=new yr;return arguments.length>0&&Gn(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},j.Set.prototype=yr.prototype,y(j.Set.prototype,"constructor",j.Set,!0),w.preserveToString(j.Set,yr)}var mr=new j.Map,vr=!s(function(){return mr.keys().next().done});if(("function"!=typeof j.Map.prototype.clear||0!==(new j.Set).size||0!==mr.size||"function"!=typeof j.Map.prototype.keys||"function"!=typeof j.Set.prototype.keys||"function"!=typeof j.Map.prototype.forEach||"function"!=typeof j.Set.prototype.forEach||u(j.Map)||u(j.Set)||"function"!=typeof mr.keys().next||vr||!cr)&&m(j,{Map:Xn.Map,Set:Xn.Set},!0),j.Set.prototype.keys!==j.Set.prototype.values&&y(j.Set.prototype,"keys",j.Set.prototype.values,!0),xe(Object.getPrototypeOf((new j.Map).keys())),xe(Object.getPrototypeOf((new j.Set).keys())),f&&"has"!==j.Set.prototype.has.name){var br=j.Set.prototype.has;Q(j.Set.prototype,"has",function(e){return n(br,this,e)})}}m(j,Xn),we(j.Map),we(j.Set)}var wr=function(e){if(!ne.TypeIsObject(e))throw new TypeError("target must be an object")},xr={apply:function(){return ne.Call(ne.Call,null,arguments)},construct:function(e,t){if(!ne.IsConstructor(e))throw new TypeError("First argument must be a constructor.");var n=arguments.length>2?arguments[2]:e;if(!ne.IsConstructor(n))throw new TypeError("new.target must be a constructor.");return ne.Construct(e,t,n,"internal")},deleteProperty:function(e,t){if(wr(e),l){var n=Object.getOwnPropertyDescriptor(e,t);if(n&&!n.configurable)return!1}return delete e[t]},has:function(e,t){return wr(e),t in e}};Object.getOwnPropertyNames&&Object.assign(xr,{ownKeys:function(e){wr(e);var t=Object.getOwnPropertyNames(e);return ne.IsCallable(Object.getOwnPropertySymbols)&&P(t,Object.getOwnPropertySymbols(e)),t}});var Tr=function(e){return!a(e)};if(Object.preventExtensions&&Object.assign(xr,{isExtensible:function(e){return wr(e),Object.isExtensible(e)},preventExtensions:function(e){return wr(e),Tr(function(){Object.preventExtensions(e)})}}),l){var Or=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(!r){var o=Object.getPrototypeOf(e);return null===o?void 0:Or(o,t,n)}return"value"in r?r.value:r.get?ne.Call(r.get,n):void 0},jr=function(e,t,r,o){var i=Object.getOwnPropertyDescriptor(e,t);if(!i){var a=Object.getPrototypeOf(e);if(null!==a)return jr(a,t,r,o);i={value:void 0,writable:!0,enumerable:!0,configurable:!0}}if("value"in i){if(!i.writable)return!1;if(!ne.TypeIsObject(o))return!1;var s=Object.getOwnPropertyDescriptor(o,t);return s?ee.defineProperty(o,t,{value:r}):ee.defineProperty(o,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}return i.set?(n(i.set,o,r),!0):!1};Object.assign(xr,{defineProperty:function(e,t,n){return wr(e),Tr(function(){Object.defineProperty(e,t,n)})},getOwnPropertyDescriptor:function(e,t){return wr(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){wr(e);var n=arguments.length>2?arguments[2]:e;return Or(e,t,n)},set:function(e,t,n){wr(e);var r=arguments.length>3?arguments[3]:e;return jr(e,t,n,r)}})}if(Object.getPrototypeOf){var Sr=Object.getPrototypeOf;xr.getPrototypeOf=function(e){return wr(e),Sr(e)}}if(Object.setPrototypeOf&&xr.getPrototypeOf){var kr=function(e,t){for(var n=t;n;){if(e===n)return!0;n=xr.getPrototypeOf(n)}return!1};Object.assign(xr,{setPrototypeOf:function(e,t){if(wr(e),null!==t&&!ne.TypeIsObject(t))throw new TypeError("proto must be an object or null");return t===ee.getPrototypeOf(e)?!0:ee.isExtensible&&!ee.isExtensible(e)?!1:kr(e,t)?!1:(Object.setPrototypeOf(e,t),!0)}})}var Cr=function(e,t){if(ne.IsCallable(j.Reflect[e])){var n=s(function(){return j.Reflect[e](1),j.Reflect[e](0/0),j.Reflect[e](!0),!0});n&&Q(j.Reflect,e,t)}else y(j.Reflect,e,t)};Object.keys(xr).forEach(function(e){Cr(e,xr[e])});var Ar=j.Reflect.getPrototypeOf;if(f&&Ar&&"getPrototypeOf"!==Ar.name&&Q(j.Reflect,"getPrototypeOf",function(e){return n(Ar,j.Reflect,e)}),j.Reflect.setPrototypeOf&&s(function(){return j.Reflect.setPrototypeOf(1,{}),!0})&&Q(j.Reflect,"setPrototypeOf",xr.setPrototypeOf),j.Reflect.defineProperty&&(s(function(){var e=!j.Reflect.defineProperty(1,"test",{value:1}),t="function"!=typeof Object.preventExtensions||!j.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})||Q(j.Reflect,"defineProperty",xr.defineProperty)),j.Reflect.construct&&(s(function(){var e=function(){};return j.Reflect.construct(function(){},[],e)instanceof e})||Q(j.Reflect,"construct",xr.construct)),"Invalid Date"!==String(new Date(0/0))){var Er=Date.prototype.toString,Nr=function(){var e=+this;return e!==e?"Invalid Date":ne.Call(Er,this)};Q(Date.prototype,"toString",Nr)}var Pr={anchor:function(e){return ne.CreateHTML(this,"a","name",e)},big:function(){return ne.CreateHTML(this,"big","","")},blink:function(){return ne.CreateHTML(this,"blink","","")},bold:function(){return ne.CreateHTML(this,"b","","")},fixed:function(){return ne.CreateHTML(this,"tt","","")},fontcolor:function(e){return ne.CreateHTML(this,"font","color",e)},fontsize:function(e){return ne.CreateHTML(this,"font","size",e)},italics:function(){return ne.CreateHTML(this,"i","","")},link:function(e){return ne.CreateHTML(this,"a","href",e)},small:function(){return ne.CreateHTML(this,"small","","")},strike:function(){return ne.CreateHTML(this,"strike","","")},sub:function(){return ne.CreateHTML(this,"sub","","")},sup:function(){return ne.CreateHTML(this,"sup","","")}};p(Object.keys(Pr),function(e){var t=String.prototype[e],r=!1;if(ne.IsCallable(t)){var o=n(t,"",' " '),i=A([],o.match(/"/g)).length;r=o!==o.toLowerCase()||i>2}else r=!0;r&&Q(String.prototype,e,Pr[e])});var Ir=function(){if(!Z)return!1;var e="object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if("undefined"!=typeof e(z()))return!0;if("[null]"!==e([z()]))return!0;var t={a:z()};return t[z()]=!0,"{}"!==e(t)?!0:!1}(),_r=s(function(){return Z?"{}"===JSON.stringify(Object(z()))&&"[{}]"===JSON.stringify([Object(z())]):!0});if(Ir||!_r){var Mr=JSON.stringify;Q(JSON,"stringify",function(e){if("symbol"!==("undefined"==typeof e?"undefined":_typeof(e))){var t;arguments.length>1&&(t=arguments[1]);var o=[e];if(r(t))o.push(t);else{var i=ne.IsCallable(t)?t:null,a=function(e,t){var r=i?n(i,this,e,t):t;return"symbol"!==("undefined"==typeof r?"undefined":_typeof(r))?Y.symbol(r)?Ot({})(r):r:void 0};o.push(a)}return arguments.length>2&&o.push(arguments[2]),Mr.apply(this,o)}})}return j}),define("jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){return 1===this.length&&this[0]instanceof Text?[this[0]]:Array.from(this.add(this.contents().add(this.find("*").contents())).filter(function(){return this instanceof Text})).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},prevTextNode:function(){var e=this.first()[0],t=this.parent();if(!t.length)return null;var n=t.textNodes().filter(function(t){var n=t.compareDocumentPosition(e);return 4&n&&!(8&n)});return n=n[n.length-1],n?n:t.prevTextNode()},nextTextNode:function(){var e=this.last()[0],t=this.parent();if(!t.length)return null;var n=t.textNodes().filter(function(t){var n=t.compareDocumentPosition(e);return 2&n&&!(8&n)})[0];return n?n:t.nextTextNode()}})}),function(){function e(){for(var e=0;e<arguments.length;e++)for(var t in arguments[e])this[t]=arguments[e][t]}function t(e,t){e.childAt=e.childAt||{};for(var n=t.start;n<t.end;n+=1)e.childAt[n]=t}function n(e,t,n,r){return!(e.canFollow&&!(e.canFollow.indexOf(n&&n.type)>-1)||e.cannotFollow&&(-1!==e.cannotFollow.indexOf(n&&n.type)||e.cannotFollow.indexOf("text")>-1&&r)||e.peek&&e.peek!==t.slice(0,e.peek.length))}function r(e){for(var t=e.innerText,r=[],i=0,s=i,u=t.length,c=null;u>i;){for(var l=t.slice(i),f=(r.length?r[0]:e).innerMode,p=0,d=f.length;d>p;p+=1){var h=a[f[p]];if(n(h,l,c,i>s)&&h.pattern.test(l)){var g=h.pattern.exec(l),y=h.fn(g),m=!1,v=0;if(y.matches){for(;v<r.length;v+=1){var b=r[v].type;if(b in y.matches){m=!0;break}0===b.indexOf("verbatim")&&(b="verbatimOpener"),y.cannotCross&&y.cannotCross.indexOf(b)>-1&&(v=r.length-1)}if(v>=r.length&&!y.isFront)continue}i>s&&e.addChild({type:"text",text:t.slice(s,i),innerMode:f}),c=e.addChild(y),i+=c.text.length,s=i,m&&(o(e,c,r[v]),r=r.slice(v+1)),c.isFrontToken()&&r.unshift(c);break}}p===d&&(i+=1,null===c&&(c={type:"text"}))}for(i>s&&e.addChild({type:"text",text:t.slice(s,i),innerMode:(r.length?r[0]:e).innerMode});r.length>0;)r.shift().demote();return e}function o(e,n,r){var o=e.children.indexOf(n),i=e.children.indexOf(r);n.children=e.children.splice(i+1,o-(i+1)),n.children.forEach(function(e){t(n,e)}),n.type=n.matches[r.type],n.innerText="";for(var a=0,s=n.children.length;s>a;a++)n.innerText+=n.children[a].text;n.start=r.start,n.text=r.text+n.innerText+n.text,Object.keys(r).forEach(function(e){Object.hasOwnProperty.call(n,e)||(n[e]=r[e])}),n.isFront&&(n.isFront=!1),e.children.splice(i,1),t(e,n)}var i=void 0,a={};e.prototype={constructor:e,addChild:function(n){var o=this.lastChildEnd(),i=new e({start:o,end:n.text&&o+n.text.length,children:[]},n);return i.innerText&&r(i),this.children.push(i),t(this,i),i},lastChild:function(){return this.children?this.children[this.children.length-1]||null:null},lastChildEnd:function(){var e=this.lastChild();return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.childAt)return this.childAt[e]&&this.childAt[e].tokenAt(e)||this;if(this.children.length)for(var t=0;t<this.children.length;t+=1){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];if(this.childAt)return(this.childAt[e]&&this.childAt[e].pathAt(e)||[]).concat(this);var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1){var r=this.children[n].pathAt(e);if(r.length){t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(e){return e<this.start||e>=this.end?null:this.children?this.children.reduce(function(t,n){return t||(e>=n.start&&e<n.end?n:null)},null):this},everyLeaf:function e(t){if(!this.children||0===this.children.length)return!!t(this);var n=void 0;return this.children.everyLeaf(function(){n=n&&!!e(t)})},isWhitespace:function(){return this.everyLeaf(function(e){return"whitespace"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return"matches"in this},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&this.children.length>0&&(e+="["+this.children+"]"),e}},i={lex:function(t,n){return r(new e({type:"root",start:n||0,end:t.length,text:t,innerText:t,children:[],childAt:{},innerMode:i.startMode}))},rules:a},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=i:"function"==typeof define&&define.amd?define("lexer",[],function(){return i}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=i):this.TwineLexer=i}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){function e(t){return t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))?(Object.keys(t).forEach(function(n){t[n]=e(t[n])}),t):(t+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function t(){return"[^"+Array.apply(0,arguments).map(e).join("")+"]*"}function n(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=void 0,o=n("?:"),i=n("?!"),a=n("?="),s="[ \\f\\t\\v\xa0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]*",u=s.replace("*","+"),c="\\b",l="\\\\\\n\\\\?|\\n\\\\",f="\\n(?!\\\\)",p="[\\w\\-\xc0-\xde\xdf-\xff\u0150\u0170\u0151\u0171]",d="[\\w\xc0-\xde\xdf-\xff\u0150\u0170\u0151\u0171]",h=o("\\n","$"),g="("+o(l,"[^\\n]")+"+)",y="\\*",m=s+"("+y+"+)"+u+g+h,v="(?:0\\.)",b=s+"("+v+"+)"+u+g+h,w=s+"-{3,}"+s+h,x=s+"(#{1,6})"+s+g+h,T=s+"(==+>|<=+|=+><=+|<==+>)"+s+h,O={opener:"\\[\\[(?!\\[)",text:"("+t("]")+")",rightSeparator:o("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+o("[^\\|\\]]","\\]"+i("\\]"))+"+)"},j=p.replace("\\-","")+"*"+p.replace("\\-","").replace("\\w","a-zA-Z")+p.replace("\\-","")+"*",S="\\$("+j+")",k="'s"+u+"("+j+")",C="("+j+")"+u+"of"+c+i("it"+c),A="'s"+u,E="of"+c,N=o("it","time")+c,P="its"+u+"("+j+")",I="its"+u,_="("+j+")"+u+"of"+u+"it"+c,M="of"+c+u+"it"+c,F={opener:"\\(",name:"("+o(p.replace("]","\\/]")+p+"*",S)+"):",closer:"\\)"},D="<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",L={name:"[a-zA-Z][\\w\\-]*",attrs:"(?:\"[^\"]*\"|'[^']*'|[^'\">])*?"},q="\\|("+p.replace("]","_]")+"*)>",R="<("+p.replace("]","_]")+"*)\\|",H="\\b(\\d+(?:\\.\\d+)?(?:[eE][+\\-]?\\d+)?|NaN)"+i("m?s")+"\\b";O.main=O.opener+o(O.text+O.rightSeparator,O.text.replace("*","*?")+O.leftSeparator)+O.text,r={upperLetter:"[A-Z\xc0-\xde\u0150\u0170]",lowerLetter:"[a-z0-9_\\-\xdf-\xff\u0151\u0171]",anyLetter:p,anyLetterStrict:d,whitespace:u,escapedLine:l,br:f,commentFront:"<!--",commentBack:"-->",tag:"<\\/?"+L.name+L.attrs+">",tagPeek:"<",scriptStyleTag:"<("+o("script","style")+")"+L.attrs+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+o("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:y,hr:w,heading:x,align:T,bulleted:m,numbered:b,delOpener:e("~~"),italicOpener:e("//"),boldOpener:e("''"),supOpener:e("^^"),strongFront:e("**"),strongBack:e("**"),emFront:e("*"),emBack:e("*"),verbatimOpener:"`+",collapsedFront:"{",collapsedBack:"}",hookAppendedFront:"\\[",hookPrependedFront:q+"\\[",hookAnonymousFront:"\\[",hookBack:"\\]"+i(R),hookAppendedBack:"\\]"+R,passageLink:O.main+O.closer,passageLinkPeek:"[[",legacyLink:O.opener+O.legacyText+O.legacySeparator+O.legacyText+O.closer,legacyLinkPeek:"[[",simpleLink:O.opener+O.legacyText+O.closer,simpleLinkPeek:"[[",macroFront:F.opener+a(F.name),macroFrontPeek:"(",macroName:F.name,groupingFront:"\\("+i(F.name),groupingFrontPeek:"(",groupingBack:"\\)",twine1Macro:D,twine1MacroPeek:"<<",property:k,propertyPeek:"'s",belongingProperty:C,possessiveOperator:A,belongingOperator:E,belongingOperatorPeek:"of",itsOperator:I,itsOperatorPeek:"its",belongingItOperator:M,belongingItOperatorPeek:"of",variable:S,variablePeek:"$",hookRef:"\\?("+p+"+)\\b",hookRefPeek:"?",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)"+c,colour:o(o("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),number:H,boolean:o("true","false")+c,identifier:N,itsProperty:P,itsPropertyPeek:"its",belongingItProperty:_,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',is:"is"+i(" not"," in")+c,isNot:"is not"+c,and:"and"+c,or:"or"+c,not:"not"+c,inequality:o("<(?!=)","<=",">(?!=)",">="),isIn:"is in"+c,contains:"contains"+c,addition:e("+")+i("="),subtraction:e("-")+i("="),multiplication:e("*")+i("="),division:o("/","%")+i("="),comma:",",spread:"\\.\\.\\."+i("\\."),to:o("to"+c,"="),into:"into"+c,augmentedAssign:o("\\+","\\-","\\*","\\/","%")+"="},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=r:"function"==typeof define&&define.amd?define("patterns",[],function(){return r}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=r):this.Patterns=r}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){function e(e){function t(e){return e=e||"innerText",function(t){var n=t.reduceRight(function(e,t,n){return e||(n?t:"")},""),r={};return r[e]=n,r}}function r(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}function o(e,t){return Object.keys(t).forEach(function(n){var r=t[n].fn;t[n].fn=function(t){var o=r(t);return o.text||(o.text=t[0]),o.type||(o.type=n),o.innerMode||(o.innerMode=e),o}}),t}var i=Object.bind(0,null),a=[],s=[],u=o(a,{hr:{fn:i},bulleted:{fn:function(e){return{depth:e[1].length,innerText:e[2]}}},numbered:{fn:function(e){return{depth:e[1].length/2,innerText:e[2]}}},heading:{fn:function(e){return{depth:e[1].length,innerText:e[2]}}},align:{fn:function(e){var t=void 0,n=e[1],r=n.indexOf("><");return~r?(t=Math.round(r/(n.length-2)*50),25===t&&(t="center")):"<"===n[0]&&">"===n.slice(-1)?t="justify":n.indexOf(">")>-1?t="right":n.indexOf("<")>-1&&(t="left"),{align:t}}}});Object.keys(u).forEach(function(e){u[e].canFollow=[null,"br","hr","bulleted","numbered","heading","align"],u[e].cannotFollow=["text"]});var c=o(a,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1 and SugarCube macros."}}},br:{fn:i},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:r("boldOpener","bold")},italicOpener:{fn:r("italicOpener","italic")},delOpener:{fn:r("delOpener","del")},supOpener:{fn:r("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:i},tag:{fn:i},url:{fn:i},passageLink:{fn:function(e){var t=e[1],n=e[2],r=e[3];return{type:"twineLink",innerText:n?r:t,passage:t?r:n}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[1]}}},hookPrependedFront:{fn:function(e){return{name:e[1],isFront:!0,tagPosition:"prepended"}}},hookAnonymousFront:{fn:function(){return{isFront:!0,demote:function(){this.error("This tagged hook doesn't have a matching ].")}}},canFollow:["macro","variable"]},hookAppendedFront:{fn:function(){return{isFront:!0}},cannotFollow:["macro","variable"]},hookBack:{fn:function(){return{type:"hookAppendedBack",matches:{hookPrependedFront:"hook",hookAnonymousFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[1],tagPosition:"appended",matches:{hookAppendedFront:"hook"},cannotCross:["verbatimOpener"]}}},verbatimOpener:{fn:function(e){var t=e[0].length,n={};return n["verbatim"+t]="verbatim",{type:"verbatim"+t,isFront:!0,matches:n}}},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:i},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2]}}}}),l=o(s,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},hookRef:{fn:t("name")},variable:{fn:t("name")},whitespace:{fn:i,cannotFollow:"text"}}),f=o(s,Object.assign({macroName:{canFollow:["macroFront"],fn:function(e){return e[2]?{isMethodCall:!0,innerText:e[2]}:{isMethodCall:!1}}},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:t("name"),canFollow:["variable","hookRef","property","itsProperty","belongingItProperty","macro","grouping","string","boolean","number"]
},possessiveOperator:{fn:i},itsProperty:{cannotFollow:["text"],fn:t("name")},itsOperator:{cannotFollow:["text"],fn:i},belongingItProperty:{cannotFollow:["text"],fn:t("name")},belongingItOperator:{cannotFollow:["text"],fn:i},belongingProperty:{cannotFollow:["text"],fn:t("name")},belongingOperator:{cannotFollow:["text"],fn:i},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"}}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"}}}},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},colour:{cannotFollow:["text"],fn:function(e){var t,n=e[0].toLowerCase(),r={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return t=Object.hasOwnProperty.call(r,n)?"#"+r[n]:n,{colour:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},addition:{fn:i},subtraction:{fn:i},multiplication:{fn:i},division:{fn:i},inequality:{fn:function(e){return{operator:e[0]}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:t("name"),cannotFollow:["text"]}},["boolean","is","to","into","and","or","not","isNot","contains","isIn"].reduce(function(e,t){return e[t]={fn:i,cannotFollow:["text"]},e},{}),["comma","spread","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:i},e},{})));a.push.apply(a,_toConsumableArray(Object.keys(u)).concat(_toConsumableArray(Object.keys(c)),_toConsumableArray(Object.keys(l)))),s.push.apply(s,_toConsumableArray(Object.keys(l)).concat(_toConsumableArray(Object.keys(f))));var p=Object.assign({},u,c,l,f);return Object.keys(p).forEach(function(e){var t=n[e];p[e].pattern="string"!=typeof t?t:new RegExp("^(?:"+t+")","i"),n[e+"Peek"]&&(p[e].peek=n[e+"Peek"])}),Object.assign(e.rules,p),e.startMode=a,e}function t(t){var r=Object.freeze({lex:e(t).lex,Patterns:n});return r}var n=void 0;Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},"object"===("undefined"==typeof module?"undefined":_typeof(module))?(n=require("patterns"),module.exports=t(require("lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(e,r){return n=r,t(e)}):this&&this.loaded&&this.modules?(n=this.modules.Patterns,this.modules.Markup=t(this.modules.Lexer)):(n=this.Patterns,this.TwineMarkup=t(this.TwineLexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),define("utils/selectors",[],function(){return Object.freeze({passage:"tw-passage",story:"tw-story",sidebar:"tw-sidebar",internalLink:"tw-link",brokenLink:"tw-broken-link",hook:"tw-hook",pseudoHook:"tw-pseudo-hook",enchantment:"tw-enchantment",expression:"tw-expression",enchanter:"[enchanter]",script:"[role=script]",stylesheet:"[role=stylesheet]",storyData:"tw-storydata",passageData:"tw-passagedata",whitespace:"tw-char[char=space], tw-char[char=tab], br",collapsed:"tw-collapsed"})}),define("utils/customelements",[],function(){if(document.registerElement){var e={};return function t(n){for(var r=Object.create(HTMLElement.prototype),o={},i=arguments.length,a=Array(i>1?i-1:0),s=1;i>s;s++)a[s-1]=arguments[s];a.forEach(function(e){o[e]={value:null}}),Object.defineProperties(r,o);var u=document.registerElement(n,{prototype:r});return e[n]=u,t}("tw-storydata","storyname","startnode","creator","creator-version","options")("tw-passagedata","name","pid","position")("tw-story")("tw-debugger")("tw-passage")("tw-link","passage-name")("tw-broken-link","passage-name")("tw-expression","type","name","js")("tw-sidebar")("tw-icon")("tw-align")("tw-collapsed")("tw-verbatim")("tw-hook","name","source")("tw-pseudo-hook")("tw-transition-container")("tw-error")("tw-error-explanation")("tw-error-explanation-button")("tw-notifier","message"),Object.freeze(e)}}),define("utils",["jquery","markup","utils/selectors","utils/customelements"],function(e,t,n){var r={configurable:0,writable:0},o={"transition-in":Object.create(null),"transition-out":Object.create(null)},i="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage".split(","),a="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error".split(","),s=["audio"],u=void 0,c={lockProperties:function(e){for(var t=Object.keys(e),n={},o=0;o<t.length;o++)n[t[o]]=r;return Object.defineProperties(e,n)},lockProperty:function(e,t,n){var o=Object.create(r);return n&&(o.value=n),Object.defineProperty(e,t,o),e},getInheritedPropertyDescriptor:function(e,t){for(;e&&!e.hasOwnProperty(t);)e=Object.getPrototypeOf(e);return e&&Object.getOwnPropertyDescriptor(e,t)||null},toJSLiteral:JSON.stringify,toTSStringLiteral:function(e){var t=Math.max.apply(Math,_toConsumableArray((e.match(/(`+)/g)||[]).map(function(e){return e.length}).concat(0)))+1;return"`".repeat(t)+e+"`".repeat(t)},cssTimeUnit:function(e){if("string"==typeof e){if(e=e.toLowerCase(),"ms"===e.slice(-2))return+e.slice(0,-2)||0;if("s"===e.slice(-1))return 1e3*+e.slice(0,-1)||0}else if(Array.isArray(e)){var t=function(){var t=[];return e.forEach(function(e){var n=c.cssTimeUnit(e);n>0&&t.push(n)}),{v:t}}();if("object"===("undefined"==typeof t?"undefined":_typeof(t)))return t.v}return 0},nth:function(e){var t=(e+"").slice(-1);return e+("1"===t?"st":"2"===t?"nd":"3"===t?"rd":"th")},plural:function(e,t){return e+" "+t+(e>1?"s":"")},unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},wrapHTMLTag:function(e,t){return"<"+t+">"+e+"</"+t+">"},findAndFilter:function(t,n){return t=e(t||c.storyElement),t.filter(n).add(t.find(n))},closestHookSpan:function(e){var t=e.closest(n.hook+","+n.pseudoHook);return t.length?t:e},childrenProbablyInline:function(e){var t=[];return Array.prototype.every.call(e.find("*"),function(e){return e.hidden||/none|inline/.test(e.style.display)?!0:i.indexOf(e.tagName.toLowerCase())>-1||/none|inline/.test(e.style.display)?!1:a.indexOf(e.tagName.toLowerCase())>-1?!0:(t.push(e),!0)})&&t.every(function(e){return/none|inline/.test(e.style.display)})},transitionReplace:function(t,n,r){t=c.closestHookSpan(t);var o=e("<tw-transition-container>").css("position","relative");o.insertBefore(t.first());var i=void 0;n&&(i=e("<tw-transition-container>").appendTo(o),n.appendTo(i));var a=e("<tw-transition-container>").css("position","absolute").prependTo(o);t.detach().appendTo(a),c.transitionOut(a,r),n&&c.transitionIn(i,r,function(){i.unwrap().children().first().unwrap()})},transitionOut:function(e,t){function n(){e.remove()}var r=c.childrenProbablyInline(e),o=e.length>1||!r||-1===["tw-hook","tw-passage"].indexOf(e.tag());o&&(e=e.wrapAll("<tw-transition-container>").parent()),e.attr("data-t8n",t).addClass("transition-out"),c.childrenProbablyInline(e)&&e.css("display","inline-block");var i=c.transitionTime(t,"transition-out");i?window.setTimeout(n,i):n()},transitionIn:function(e,t){function n(){var t=0===c.findAndFilter(e,s.join(",")).length;o&&t?e.contents().unwrap():e.removeClass("transition-in").removeAttr("data-t8n")}var r=c.childrenProbablyInline(e),o=e.length>1||!r||-1===["tw-hook","tw-passage"].indexOf(e.tag());o&&(e=e.wrapAll("<tw-transition-container>").parent()),e.attr("data-t8n",t).addClass("transition-in"),c.childrenProbablyInline(e)&&e.css("display","inline-block");var i=c.transitionTime(t,"transition-in");i?window.setTimeout(n,i):n()},transitionTime:function(t,n){var r=o[n];if(!r[t]){var i=e("<p>").appendTo(document.body).attr("data-t8n",t).addClass(n);r[t]=c.cssTimeUnit(i.css("animation-duration"))+c.cssTimeUnit(i.css("animation-delay")),i.remove()}return r[t]},$:function(t,n){return e(t,n||c.storyElement).not(".transition-out, .transition-out *")},log:function(e){window.console&&console.log(e)},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},assert:function(e){window.console&&(e||console.error("Assertion failed!"))},assertMustHave:function(e,t){if(window.console)for(var n=0;n<t.length;n+=1)t[n]in e||console.error("Assertion failed: "+e+" lacks property "+t[n])},assertOnlyHas:function(e,t){if(window.console)for(var n in e)-1===t.indexOf(n)&&console.error("Assertion failed: "+e+" had unexpected property '"+n+"'!")},get storyElement(){return u}};return e(function(){return u=e(n.story)}),Object.freeze(c)}),define("twinescript/compiler",["utils"],function(e){function t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];for(var o=0;o<e.length;o+=1)if(n.indexOf(e[o].type)>-1)return o;return 0/0}function n(e){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];return e.length-1-t.apply(void 0,[[].concat(_toConsumableArray(e)).reverse()].concat(r))}function r(e,a){if(!e)return"";e=[].concat(e);var s=e[0];if(1===e.length){if("identifier"===s.type)return a?"TwineError.create('keyword','I can\\'t use \\'"+s.text+"\\' in this position.') ":" Operations.Identifiers."+s.text.toLowerCase()+" ";if("variable"===s.type)return"VarRef.create(State.variables,"+o(s.name)+")"+(a?"":".get()");if("hookRef"===s.type)return a?"VarRef.create(section.selectHook('?"+s.name+"'), 'TwineScript_Assignee')":" section.selectHook('?"+s.name+"') ";if("string"===s.type)return s.text.replace(/\n/g,"\\n");if("colour"===s.type)return"Colour.create("+o(s.colour)+")";if("root"===s.type)return r(s.children)}var u=void 0,c=void 0,l=void 0,f=void 0,p=void 0,d=void 0,h=void 0,g=void 0,y=!0,m=!0,v=!1;return(u=t(e,"comma"))>-1?(p=",",m=!1):(u=t(e,"spread"))>-1?(p="Operations.makeSpreader(",f=r(e.splice(u+1))+")",y=!1):(u=t(e,"to"))>-1?(h="to",l="Operations.setIt("+r(e.slice(0,u),"varRef")+")"):(u=t(e,"into"))>-1?(h="into",f=r(e.slice(0,u),"varRef"),l="Operations.setIt("+r(e.slice(u+1),"varRef")+")"):(u=t(e,"augmentedAssign"))>-1?(h=e[u].operator,l=r(e.slice(0,u),"varRef"),f="Operations['"+h+"']("+(r(e.slice(0,u))+","+r(e.splice(u+1)))+")"):(u=t(e,"and","or"))>-1?d=e[u].type:(u=t(e,"is","isNot"))>-1?(v=!0,d=e[u].type):(u=t(e,"contains","isIn"))>-1?(v=!0,d=e[u].type):(u=t(e,"inequality"))>-1?(v=!0,d=e[u].operator):(u=t(e,"addition","subtraction"))>-1?(d=e[u].text,l=r(e.slice(0,u)),l.trim()||(l="0")):(u=t(e,"multiplication","division"))>-1?d=e[u].text:(u=t(e,"not"))>-1?(p="Operations.not(",f=r(e.splice(u+1))+")",y=!1):(u=t(e,"belongingProperty"))>-1?(f="VarRef.create("+r(e.slice(u+1),"varref")+","+o(e[u].name)+")"+(a?"":".get()"),p=" ",y=m=!1):(u=t(e,"belongingOperator","belongingItOperator"))>-1?(e[u].type.includes("It")&&(f="Operations.Identifiers.it",m=!1),g="belonging"):(u=n(e,"property"))>-1?(l="VarRef.create("+r(e.slice(0,u),"varref")+","+o(e[u].name)+")"+(a?"":".get()"),p=" ",y=m=!1):(u=n(e,"itsProperty"))>-1||(u=t(e,"belongingItProperty"))>-1?(l="VarRef.create(Operations.Identifiers.it,"+o(e[u].name)+").get()",p=" ",y=m=!1):(u=n(e,"possessiveOperator","itsOperator"))>-1?(e[u].type.includes("it")&&(l="Operations.Identifiers.it",y=!1),g="possessive"):(u=t(e,"macro"))>-1?(c=e[u].children[0],i("macroName"===c.type),p="Macros.run("+(c.isMethodCall?r(c.children):'"'+e[u].name+'"')+", [section,"+r(e[u].children.slice(1))+"])",y=m=!1):(u=t(e,"grouping"))>-1&&(p="("+r(e[u].children,a)+")",y=m=!1),u>-1?(d&&(a=!1),l=l||r(e.slice(0,u),a).trim(),f=f||r(e.splice(u+1)).trim(),v&&!l&&(l=" Operations.Identifiers.it "),y&&!l||m&&!f?"TwineError.create('operation','I need some code to be "+(y?"left ":"")+(y&&m?"and ":"")+(m?"right ":"")+'of "'+e[u].text+"\"')":p?l+p+f:h?"Operations.makeAssignmentRequest("+[l,f,o(h)]+")":g?"VarRef.create("+("belonging"===g?f:l)+",{computed:true,value:"+("belonging"===g?l:f)+"})"+(a?"":".get()"):d?" Operations["+o(d)+"]("+l+","+f+") ":""):1===e.length?((s.value||s.text)+"").trim()||" ":e.reduce(function(e,t){return e+r(t,a)},"")}var o=e.toJSLiteral,i=e.assert;return r}),define("internaltypes/twineerror",["jquery","utils"],function(e,t){var n=t.impossible,r=t.assert,o=t.escape,i={syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to use an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",keyword:"I was given a keyword in a way that I didn't understand.",changer:"This is a command to change a hook, but it isn't being used correctly.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",javascript:"This error message was reported by your browser's Javascript engine. I don't understand it either, but it usually means that an expression was badly written."},a={create:function(e,t,o){return t||n("TwineError.create","called with only 1 string."),r(o||e in i),Object.assign(Object.create(this),{type:e,message:t,explanation:o})},fromError:function(e){return a.create("javascript","\u2615 "+e.message)},containsError:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e?e:t instanceof Error?t:a.isPrototypeOf(t)?t:Array.isArray(t)?a.containsError.apply(a,_toConsumableArray(t)):!1},!1)},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){t=t||"";var n=e("<tw-error class='"+("javascript"===this.type?"javascript ":"")+(this.warning?"warning":"error")+"' title='"+o(t)+"'>"+o(this.message)+"</tw-error>"),r=e("<tw-error-explanation>").text(this.explanation||i[this.type]).hide(),a=e("<tw-error-explanation-button tabindex=0>").html("<span class='folddown-arrowhead'>&#9658;</span>");return a.on("click",function(){r.toggle(),a.children(".folddown-arrowhead").css("transform","rotate("+(r.is(":visible")?"90deg":"0deg")+")")}),n.append(a).append(r),n}};return a}),define("renderer",["utils","markup","twinescript/compiler","internaltypes/twineerror"],function(e,t,n,r){function o(e,t){var n=c.render(e.children);return n&&i(n,t)}var i=e.wrapHTMLTag,a=e.escape,s=e.impossible,u=e.toJSLiteral,c=void 0,l="text-align: center; max-width:50%; ";return c={options:{},exec:function(){var e=void 0,n=void 0;return function(r){return"string"!=typeof r?(s("Renderer.exec","source was not a string, but "+("undefined"==typeof r?"undefined":_typeof(r))),""):r===e?n:(e=r,n=c.render(t.lex(r).children))}}(),render:function e(s){var f="";if(!s)return f;for(var p=s.length,d=0;p>d;d+=1){var h=s[d];switch(h.type){case"error":f+=r.create("syntax",h.message).render(a(h.text))[0].outerHTML;break;case"numbered":case"bulleted":var g="numbered"===h.type?"ol":"ul";f+="<"+g+">";for(var y=1;p>d&&s[d]&&s[d].type===h.type;)f+=("<"+g+">").repeat(Math.max(0,s[d].depth-y)),f+=("</"+g+">").repeat(Math.max(0,y-s[d].depth)),y=s[d].depth,f+=o(s[d],"li"),d+=1;d-=1,f+=("</"+g+">").repeat(y+1);break;case"align":for(;h&&"align"===h.type;){var m="",v="",b=h.align,w=d+=1;if("left"===b){d-=1;break}for(;p>d&&s[d]&&"align"!==s[d].type;)d+=1;switch(v+=e(s.slice(w,d)),b){case"center":m+=l+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":m+="text-align: "+b+";";break;default:+b&&(m+=l+"margin-left: "+b+"%;")}f+="<tw-align "+(m?'style="'+m+'"':"")+(c.options.debug?' title="'+h.text+'"':"")+">"+v+"</tw-align>\n",h=s[d]}break;case"heading":f+=o(h,"h"+h.depth);break;case"br":case"hr":f+="<"+h.type+">";break;case"escapedLine":case"comment":break;case"inlineUrl":f+='<a class="link" href="'+a(h.text)+'">'+h.text+"</a>";break;case"scriptStyleTag":case"tag":f+=h.text.startsWith("</")?h.text:h.text.replace(/>$/," data-raw>");break;case"sub":case"sup":case"del":case"strong":case"em":f+=o(h,h.type);break;case"bold":f+=o(h,"b");break;case"italic":f+=o(h,"i");break;case"twineLink":var x=t.lex("(link-goto:"+u(h.innerText)+","+u(h.passage)+")");f+=e(x.children);break;case"hook":f+="<tw-hook "+(h.name?'name="'+h.name+'"':"")+(c.options.debug&&h.name?' title="Hook: ?'+h.name+'"':"")+' source="'+a(h.innerText)+'"></tw-hook>';break;case"verbatim":f+=i(a(h.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":f+=o(h,"tw-collapsed");break;case"hookRef":case"variable":case"macro":f+='<tw-expression type="'+h.type+'" name="'+a(h.name||h.text)+'"'+(c.options.debug?' title="'+a(h.text)+'"':"")+' js="'+a(n(h))+'"></tw-expression>';break;default:f+=h.children&&h.children.length?e(h.children):h.text}}return f}},Object.freeze(c)}),define("passages",["jquery","utils","utils/selectors"],function(e,t,n){function r(e){return Object.assign(new Map([["source",o(e.html())],["tags",(e.attr("tags")||"").split(/\s/)],["name",e.attr("name")]]),{TwineScript_TypeName:"passage datamap",TwineScript_ObjectName:"a passage datamap"})}var o=t.unescape,i=Object.assign(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(e){var t=[];return this.forEach(function(n){var r=n instanceof Map&&n.get("tags");Array.isArray(r)&&r.indexOf(e)>-1&&t.push(n)}),t.sort(function(e,t){return e.get("name")>t.get("name")})},create:r});return e(function(){Array.from(e(n.storyData+" > "+n.passageData)).forEach(function(t){t=e(t),i.set(t.attr("name"),new r(t))})}),i}),define("utils/naturalsort",[],function(){return function(e){return function t(n,r){var o,i,a,s,u=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,c=/(^[ ]*|[ ]*$)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,f=/^0x[0-9a-f]+$/i,p=/^0/,d=function(e){return t.insensitive&&(""+e).toLowerCase()||""+e},h=d(n).replace(c,"")||"",g=d(r).replace(c,"")||"",y=h.replace(u,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),m=g.replace(u,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),v=parseInt(h.match(f))||1!==y.length&&h.match(l)&&Date.parse(h),b=parseInt(g.match(f))||v&&g.match(l)&&Date.parse(g)||null;if(e&&window.Intl&&window.Intl.Collator&&(a=window.Intl.Collator(e)),b){if(b>v)return-1;if(v>b)return 1}for(var w=0,x=Math.max(y.length,m.length);x>w;w++){if(o=!(y[w]||"").match(p)&&parseFloat(y[w])||y[w]||0,i=!(m[w]||"").match(p)&&parseFloat(m[w])||m[w]||0,isNaN(o)!==isNaN(i))return isNaN(o)?1:-1;if(("undefined"==typeof o?"undefined":_typeof(o))!==("undefined"==typeof i?"undefined":_typeof(i)))o+="",i+="";else if("string"==typeof o&&a&&(s=a.compare(o,i),0!==s))return s;if(i>o)return-1;if(o>i)return 1}return 0}}}),define("utils/operationutils",["utils","internaltypes/twineerror"],function(e,t){function n(e){return!!e&&("object"===("undefined"==typeof e?"undefined":_typeof(e))||"function"==typeof e)}function r(e){return Array.isArray(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))?"object":""}function o(e,n){if(d(e instanceof Map),"string"!=typeof n&&"number"!=typeof n)return t.create("property","Only strings and numbers can be used as data names for "+u(e)+", not "+u(n)+".");var r="string"==typeof n?+n:""+n;return!Number.isNaN(r)&&e.has(r)?t.create("property","You mustn't use both "+u(n)+" and "+u(r)+" as data names in the same datamap."):!0}function i(e){return"string"==typeof e||Array.isArray(e)}function a(e){if(!n(e))return e;if("function"==typeof e.TwineScript_Clone)return e.TwineScript_Clone();if(Array.isArray(e))return[].concat(_toConsumableArray(e));if(e instanceof Map)return Object.assign(new Map(e),e);if(e instanceof Set)return Object.assign(new Set(e),e);if("function"==typeof e)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return Object.assign({},e);case null:return Object.assign(Object.create(null),e)}return h("OperationUtils.clone","The value "+(e.toSource?e.toSource():e)+" cannot be cloned!"),e}function s(e,t,r){return"string"==typeof t&&n(r)&&"TwineScript_ToString"in r?e(t,r.TwineScript_ToString()):"string"==typeof r&&n(t)&&"TwineScript_ToString"in t?e(t.TwineScript_ToString(),r):!1}function u(e){return n(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:Array.isArray(e)?"an array":e instanceof Map?"a datamap":e instanceof Set?"a dataset":"boolean"==typeof e?"the logic value '"+e+"'":"string"==typeof e||"number"==typeof e?"the "+("undefined"==typeof e?"undefined":_typeof(e))+" "+g(e):void 0===e?"an empty variable":"...whatever this is"}function c(e){return e.innerType?"either"===e.pattern?(d(Array.isArray(e.innerType)),e.innerType.map(c).join(" or ")):"optional"===e.pattern?"(an optional) "+c(e.innerType):c(e.innerType):e===String||e===Number||e===Boolean?"a "+_typeof(e()):e===Map?"a datamap":e===Set?"a dataset":e===Array?"an array":n(e)&&"TwineScript_TypeName"in e?e.TwineScript_TypeName:u(e)}function l(e,t){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))&&"object"!==("undefined"==typeof t?"undefined":_typeof(t))?e===t:Array.isArray(e)&&Array.isArray(t)?e.length!==t.length?!1:e.every(function(e,n){return l(t[n],e)}):e instanceof Map&&t instanceof Map?l(Array.from(e.entries()).sort(),Array.from(t.entries()).sort()):e instanceof Set&&t instanceof Set?l(Array.from(e.values()),Array.from(t.values())):e&&"function"==typeof e.TwineScript_is?e.TwineScript_is(t):e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))&&Object.getPrototypeOf(e)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype?l(Object.getOwnPropertyNames(e).map(function(t){return[t,e[t]]}),Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]})):Object.is(e,t)}function f(e,t){if(e){if("string"==typeof e)return e.indexOf(t)>-1;if(Array.isArray(e))return e.some(function(e){return l(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return l(e,t)})}return l(e,t)}function p(e,n,o){if(!n||!o)return t.create("macrocall","The sub"+r(e)+" index values must not be 0 or NaN.");if(0>n&&(n=e.length+n+1),0>o&&(o=e.length+o+1),n>o)return p(e,o,n);var i="string"==typeof e;i&&(e=Array.from(e));var a=e.slice(n>0?n-1:n,o);return i?a.join(""):a}var d=e.assert,h=e.impossible,g=e.toJSLiteral,y=Object.freeze({isObject:n,isValidDatamapName:o,collectionType:r,isSequential:i,clone:a,coerceToString:s,objectName:u,typeName:c,is:l,contains:f,subset:p,numericIndex:/^(?:[1-9]\d*|0)$/});return y}),define("macros",["jquery","utils/naturalsort","utils","utils/operationutils","internaltypes/twineerror"],function(e,t,n,r,o){function i(e){return function(n){n=n.reduce(function(e,n){if(n&&n.spreader===!0)if(Array.isArray(n.value)||"string"==typeof n.value)for(var r=0;r<n.value.length;r++)e.push(n.value[r]);else e.push(n.value instanceof Set?Array.from(n.value).sort(t("en")):o.create("operation","I can't spread out "+h(n.value)+", which is not a string, dataset or array."));else e.push(n);return e},[]);var r=o.containsError(n);return r?r:e.apply(void 0,_toConsumableArray(n))}}function a(e,t){if(null===t)return void 0===e;if(t.innerType){if("optional"===t.pattern||"zero or more"===t.pattern)return void 0===e?!0:a(e,t.innerType);if("either"===t.pattern)return t.innerType.some(function(t){return a(e,t)});if("wrapped"===t.pattern)return a(e,t.innerType)}return void 0!==t&&void 0===e?!1:t!==y.TypeSignature.Any||void 0===e||e.TwineScript_Unobservable?t===String?"string"==typeof e:t===Boolean?"boolean"==typeof e:t===Number?"number"==typeof e:t===Array?Array.isArray(e):t===Map||t===Set?e instanceof t:Object.isPrototypeOf.call(t,e):!0}function s(e,t,n){if(!n)return t;n=[].concat(n),e="("+(Array.isArray(e)&&e.length>1?e[0]:e)+":)";var r=void 0;return r=n.length>0?"The "+e+" macro must only be given "+n.map(g).reduce(function(e,t,n,r){return e+(0===n?"":n<r.length-1?", ":", and ")+t},"")+(n.length>1?", in that order":"."):"The macro must not be given any data - just write "+e+".",function(i){for(var s=arguments.length,u=Array(s>1?s-1:0),c=1;s>c;c++)u[c-1]=arguments[c];for(var p=void 0,d=0,m=Math.max(u.length,n.length);m>d;d+=1){var v=n[d],b=u[d];if(d>=n.length&&!p)return o.create("typesignature",u.length-n.length+" too many values were given to this "+e+" macro.",r);if(v||(v=p),!v.innerType||"rest"!==v.pattern&&"zero or more"!==v.pattern||(p=v.innerType,"rest"===v.pattern&&(v=v.innerType)),!a(b,v))return void 0===b?o.create("typesignature","The "+e+" macro needs "+f(n.length-d,"more value")+".",r):b&&b.TwineScript_Unobservable&&v===y.TypeSignature.Any?o.create("typesignature",e+"'s "+l(d+1)+" value is not valid data for this macro.",r):o.create("typesignature",e+"'s "+l(d+1)+" value is "+h(b)+", but should be "+g(v)+".",v.message||r)}return t.apply(void 0,[i].concat(u))}}function u(e,t,n){Array.isArray(e)?e.forEach(function(e){return d(m,c(e),n)}):d(m,c(e),n)}var c=n.insensitiveName,l=n.nth,f=n.plural,p=n.assert,d=n.lockProperty,h=r.objectName,g=r.typeName,y=void 0,m={},v={};return y={has:function(e){return e=c(e),m.hasOwnProperty(e)},get:function(e){return e=c(e),m.hasOwnProperty(e)&&m[e]},add:function e(t,n,r){return u(t,"value",i(s(t,n,r))),e},addChanger:function e(t,n,r,o){return p(r),u(t,"changer",i(s(t,n,o))),v[Array.isArray(t)?t[0]:t]=r,e},getChangerFn:function(e){return v[e]},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"}},run:function(e,t){return o.containsError(e)?e:y.has(e)?y.get(e)(t):o.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.")}},Object.freeze(y)}),define("datatypes/changercommand",["utils","macros","utils/operationutils"],function(e,t,n){var r=e.assert,o=n.is,i={changer:!0,TwineScript_TypeName:"a changer command",TwineScript_Print:function(){return"[A '"+this.macroName+"' command]"},create:function(e,t,n){return r(void 0===t||Array.isArray(t)),Object.assign(Object.create(this),{macroName:e,params:t,next:n||null,TwineScript_ObjectName:"a ("+e+":) command"})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return i.isPrototypeOf(e)?this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next):void 0},TwineScript_Clone:function(){return this.create(this.macroName,this.params,this.next)},run:function(e){t.getChangerFn(this.macroName).apply(void 0,[e].concat(_toConsumableArray(this.params))),this.next&&this.next.run(e)}};return Object.freeze(i)}),define("state",["utils","passages","datatypes/changercommand","internaltypes/twineerror","utils/operationutils"],function(e,t,n,r,o){var i=e.impossible,a=o.objectName,s={TwineScript_ObjectName:"this story's variables",TwineScript_Writeproof:[]},u={passage:"",variables:s,create:function(e,t){var n=Object.create(u);return n.passage=e||"",n.variables=Object.assign(Object.create(this.variables),t),n}},c=[],l=-1,f=u.create(),p=void 0,d=Object.assign({get passage(){return f.passage},get variables(){return f.variables},get pastLength(){return l},get futureLength(){return c.length-1-l},passageNameVisited:function(e){var n=0;if(!t.get(e))return 0;for(var r=0;l>=r;r++)n+=+(e===c[r].passage);return n},passageNameLastVisited:function(e){if(!t.get(e))return 1/0;if(e===f.passage)return 0;for(var n=l;n>0;n--)if(c[n].passage===e)return l-n+1;return 1/0},pastPassageNames:function(){for(var e=[],t=l-1;t>=0;t--)e.unshift(c[t].passage);return e},newPresent:function(e){f=(c[l]||u).create(e)},play:function(e){f||i("State.play","present is undefined!"),f.passage=e,c=c.slice(0,l+1).concat(f),l+=1,this.newPresent(e)},rewind:function(e){var t=1,n=!1;if(e)if("string"==typeof e){if(t=this.passageNameLastVisited(e),t===1/0)return}else"number"==typeof e&&(t=e);for(;t>0&&l>0;t--)n=!0,l-=1;return n&&this.newPresent(c[l].passage),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);t>0&&c.length>0;t--)n=!0,l+=1;return n&&this.newPresent(c[l].passage),n},reset:function(){window.jasmine&&(c=[],l=-1,f=u.create(),p=void 0)}},function(){function e(t){return"number"==typeof t||"boolean"==typeof t||"string"==typeof t||null===t||Array.isArray(t)&&t.every(e)||t instanceof Set&&Array.from(t).every(e)||t instanceof Map&&Array.from(t.values()).every(e)||n.isPrototypeOf(t)}function t(e,t){return t instanceof Set?{"(dataset:)":Array.from(t)}:t instanceof Map?{"(datamap:)":Array.from(t)}:n.isPrototypeOf(t)?{changer:{name:t.macroName,params:t.params,next:t.next}}:t}function o(e,t){if(t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))){if(Array.isArray(t["(dataset:)"]))return new Set(t["(dataset:)"]);if(Array.isArray(t["(datamap:)"]))return new Map(t["(datamap:)"]);if(t.changer&&"object"===_typeof(t.changer)){var r=t.changer,o=r.name,i=r.params,a=r.next;return n.create(o,i,a)}}return t}function i(){var n=c.slice(0,l+1),o=n.map(function(t){return Object.keys(t.variables).filter(function(n){return t.variables[n]&&!e(t.variables[n])}).map(function(e){return[e,t.variables[e]]})});if(p||(p=o.reduce(function(e,t,n){var r=_slicedToArray(t,2),o=r[0],i=r[1];return e||o&&[o,i,n+1]},void 0)),p){var i=p,s=_slicedToArray(i,3),u=s[0],f=s[1],d=s[2];return r.create("saving","The variable $"+u+" holds "+a(f)+" (which is, or contains, a complex data value) on turn "+d+"; the game can no longer be saved.")}try{return JSON.stringify(n,t)}catch(e){return!1}}function f(e){var t=void 0,n=s;try{t=JSON.parse(e,o)}catch(e){return!1}return Array.isArray(t)?(t=t.map(function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))&&e.hasOwnProperty("passage")&&e.hasOwnProperty("variables")?(e.variables=Object.assign(Object.create(n),e.variables),n=e.variables,Object.assign(Object.create(u),e)):!1})).indexOf(!1)>-1?!1:(c=t,l=c.length-1,void this.newPresent(c[l].passage)):!1}return{serialise:i,deserialise:f}}());return Object.seal(u),Object.freeze(d)}),define("datatypes/colour",["utils","jquery"],function(e,t){function n(e){if(e in u)return u[e];var n=t("<p>").css("background-color",e).css("background-color");return n=n.startsWith("rgb")?n.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},u[e]=n,n}function r(e){return"string"!=typeof e?e:(e=e.replace("#",""),e=e.replace(a,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}var o=e.assert,i=/^([\da-fA-F])$/,a=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,s=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,u=Object.create(null),c=Object.freeze({colour:!0,TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour","TwineScript_+":function(e){var t=this,n=e;return c.create({r:Math.min(Math.round(.6*(t.r+n.r)),255),g:Math.min(Math.round(.6*(t.g+n.g)),255),b:Math.min(Math.round(.6*(t.b+n.b)),255)})},TwineScript_Print:function(){return"<tw-colour style='background-color:rgb("+[this.r,this.g,this.b].join(",")+");'></span>"},TwineScript_is:function(e){return c.isPrototypeOf(e)&&e.r===this.r&&e.g===this.g&&e.b===this.b},TwineScript_Clone:function(){return c.create(this)},toHexString:function(){return o(this!==c),"#"+this.r.toString(16).replace(i,"0$1")+this.g.toString(16).replace(i,"0$1")+this.b.toString(16).replace(i,"0$1")},create:function(e){return"string"==typeof e?this.create(c.isHexString(e)?r(e):n(e)):Object.assign(Object.create(this),e);

},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(a)||e.slice(1).match(s))}});return c}),define("utils/hookutils",["jquery","utils/selectors"],function(e,t){function n(e,t,n){var r=e.textContent.length;if(!(t>=r)){var o=void 0,i=[o=0===t?e:e.splitText(t)];return n&&(0>=n&&(n=r-n),r>n&&i.push(o.splitText(n-t))),i}}function r(e,t){var o=[],i="",a=[];if(!e.length||!t)return a;for(;e.length>0;){o.push(e[0]),i+=e[0].textContent,e.shift();var s=i.indexOf(t);if(s>-1){for(var u,c=i.length-(s+t.length);s>=o[0].textContent.length;)s-=o[0].textContent.length,o.shift();if(1===o.length){var l=n(o[0],s,s+t.length);a.push(l[0]),l[1]&&e.unshift(l[1]);break}a.push(n(o[0],s,o[0].length)[0]),(u=a).push.apply(u,_toConsumableArray(o.slice(1,-1)));var f=n(o[o.length-1],0,o[o.length-1].textContent.length-c);a.push(f[0]),f[1]&&e.unshift(f[1]),a=a.filter(Boolean);break}}return[a].concat(_toConsumableArray(r(e,t)))}var o={wrapTextNodes:function(t,n,o){var i=r(n.textNodes(),t),a=e();return i.forEach(function(t){a=a.add(e(t).wrapAll(o))}),a},selectorType:function(e){if(e&&"string"==typeof e){var t=/\?(\w*)/.exec(e);return t&&t.length?"hookRef":"<"===e[0]&&">"===e[e.length-1]?"html":"string"}return"undefined"},hookToSelector:function(e){return e=e.replace(/"/g,"&quot;"),t.hook+'[name="'+e+'"]'}};return Object.freeze(o)}),define("datatypes/hookset",["jquery","utils/hookutils"],function(e,t){function n(){return this.section.$(o(this.selector.slice(1)))}function r(e){for(var t=n.call(this),r=arguments.length,o=Array(r>1?r-1:0),i=1;r>i;i++)o[i-1]=arguments[i];return e in t&&t[e].apply(t,o)}var o=t.hookToSelector,i=Object.freeze({forEach:function(t){return r.call(this,"each",function(n){t(e(this),n)})},text:function(){return r.call(this,"text")},TwineScript_ToString:function(){return this.text()},TwineScript_Print:function(){return this.text()},get TwineScript_ObjectName(){return this.selector+" (a hook reference)"},TwineScript_TypeName:"a hook reference (like ?this)",set TwineScript_Assignee(e){this.section.renderInto(e,n.call(this),{append:"replace"})},get TwineScript_Assignee(){return this},TwineScript_AssignValue:function(){return r.call(this,"text")},TwineScript_DeleteValue:function(e){"TwineScript_Assignee"===e&&r.call(this,"text","")},create:function(e,t){var n=Object.create(this);return n.section=e,n.selector=t,Object.freeze(n)}});return i}),define("internaltypes/varref",["state","internaltypes/twineerror","utils/operationutils","datatypes/hookset"],function(e,t,n,r){function o(e,n){var r=void 0;if(e instanceof Map&&(r=t.containsError(b(e,n))))return r;if(g(e)){var o=void 0;if("number"==typeof n)n-=1;else if("string"==typeof n&&(o=/(\d+)(?:st|[nr]d|th)last/i.exec(n)))n=-o[1]+"";else if("string"==typeof n&&(o=/(\d+)(?:st|[nr]d|th)/i.exec(n)))n=o[1]-1+"";else if("last"===n)n=-1;else if("length"!==n)return t.create("property","You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.) and 'length' of "+y(e)+", not "+y(n)+".")}else if(e instanceof Set){if("length"!==n)return t.create("property","You can only get the 'length' of a "+y(e)+".","To check contained values, use the 'contains' operator.");n="size"}else if("number"==typeof e||"boolean"==typeof e)return t.create("property","You can't get data values from "+y(e)+".");return n}function i(e,n){var r=n.reduce(function(r,i,a){i.computed&&(i=i.value),i=Array.isArray(i)?i.map(function(t){return o(e,t)}):o(e,i);var s=void 0;return(s=t.containsError(r,i))?s:(a<n.length-1&&(e=p(e,i)),r.push(i),r)},[]);return{compiledPropertyChain:r,deepestObject:e}}function a(e,t){return void 0===e?e:e instanceof Map?e.get(t):(g(e)&&0>t-0&&(t=e.length+(t-0)),e[t])}function s(e){return e.computed?"("+y(e.value)+")":"'"+e+"'"}function u(e,n){if(Array.isArray(n))return n.map(function(t){return u(e,t)});var r="I won't add "+s(n)+" to "+y(e)+" because it's one of my special system collections.",o="I can't modify '"+s(n)+"' because it holds one of my special system collections.";if(e instanceof Map)return e.TwineScript_Sealed&&!e.has(n)?t.create("operation",r):e.TwineScript_Writeproof&&e.TwineScript_Writeproof.indexOf(n)>-1?t.create("operation",o):!0;if(g(e)){if("length"===n)return t.create("operation","I can't forcibly alter the length of "+y(e)+".");if(+n!==(0|n))return t.create("property",y(e)+" can only have position keys ('3rd', '1st', (5), etc.), not "+s(n)+".")}return!e.TwineScript_Sealed||n in e?e.TwineScript_Writeproof&&e.TwineScript_Writeproof.indexOf(n)>-1?t.create("operation",o):"number"==typeof e||"boolean"==typeof e?t.create("operation","You can't alter the data values of "+y(e)+"."):!0:t.create("operation",r)}function c(e,t,n){e instanceof Map?e.set(t,n):(g(e)&&0>t-0&&(t=e.length+(t-0)),e[t]=n)}function l(e,t){g(e)&&0>t-0&&(t=e.length+(t-0)),Array.isArray(e)&&v.exec(t)?e.splice(t,1):e instanceof Map||e instanceof Set?e.delete(t):e.TwineScript_DeleteValue?e.TwineScript_DeleteValue(t):delete e[t]}function f(e){function t(){return e}return{get:t,set:t,delete:t}}function p(n,r,o){if(Array.isArray(r))return r.map(function(e){return p(n,e,e)})["string"==typeof n?"join":"valueOf"]("");"string"==typeof n&&(n=[].concat(_toConsumableArray(n)));var i=a(n,r);return void 0===i?n===e.variables?w:t.create("property","I can't find a "+s(o)+" data name in "+y(n)):i}function d(e,n){var r=this,o=this.compiledPropertyChain.reduce(function(e,t){var n=void 0;return n=0===e.length?r.object:p.apply(void 0,_toConsumableArray(e[e.length-1])),e.push([n,t])&&e},[]).reduceRight(e,n);return t.containsError(o)?o:void 0}var h=n.isObject,g=n.isSequential,y=n.objectName,m=n.clone,v=n.numericIndex,b=n.isValidDatamapName,w=0,x=Object.freeze({varref:!0,get:function(){return p(this.deepestObject,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},set:function(e){return e&&e.TwineScript_AssignValue&&(e=e.TwineScript_AssignValue()),d.call(this,function(e,n,o){var i=_slicedToArray(n,2),a=i[0],s=i[1],l=void 0;if(l=t.containsError(e,a,s)||t.containsError(h(a)&&u(a,s)))return l;if(r.isPrototypeOf(a)&&"string"!=typeof e)return t.create("datatype","You can only set hook references to strings, not "+y(e)+".");if("string"==typeof a){var f=function(){if("string"!=typeof e||e.length!==(Array.isArray(s)?s.length:1))return{v:t.create("datatype","I can't put this non-string value, "+y(e)+", in a string.")};a=[].concat(_toConsumableArray(a));var n=[].concat(_toConsumableArray(e));[].concat(s).forEach(function(e){0>0+e&&(e=a.length+(0+e)),a=[].concat(_toConsumableArray(a.slice(0,e)),[n.shift()],_toConsumableArray(a.slice(e+1)))}),a=a.join("")}();if("object"===("undefined"==typeof f?"undefined":_typeof(f)))return f.v}else h(a)&&(Array.isArray(s)&&g(e)?("string"==typeof e&&(e=[].concat(_toConsumableArray(e))),s.map(function(t,n){return[t,e[n]]}).forEach(function(e){var t=_slicedToArray(e,2),n=t[0],r=t[1];return c(a,n,r)})):c(a,s,e));return o>0&&(a=m(a)),a},e)},delete:function(){return d.call(this,function(e,n,r){var o=_slicedToArray(n,2),i=o[0],a=o[1],s=void 0;return(s=t.containsError(e,i,a)||t.containsError(h(i)&&u(i,a)))?s:(r>0&&(i=m(i)),null===e?h(i)&&(Array.isArray(a)?a.forEach(function(e){return l(i,e)}):l(i,a)):c(i,a,e),i)},null)},create:function(e,n){var r=void 0;if(r=t.containsError(e))return f(r);n=[].concat(n),x.isPrototypeOf(e)&&(n=e.propertyChain.concat(n),e=e.object);var o=i(e,n),a=o.compiledPropertyChain,s=o.deepestObject;return(r=t.containsError(a,s))?f(r):Object.assign(Object.create(x),{object:e,propertyChain:n,compiledPropertyChain:a,deepestObject:s})},get TwineScript_ObjectName(){return(this.object===e.variables?"$":y(this.object)+"'s ")+this.propertyChain.reduce(function(e,t){return e+"'s "+s(t)})}});return x}),define("internaltypes/assignmentrequest",["utils"],function(e){var t=e.assert,n=Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"an assignment operation",TwineScript_ObjectName:"an assignment operation",TwineScript_Unobservable:!0,create:function(e,n,r){return t("propertyChain"in e&&"object"in e),Object.assign(Object.create(this),{dest:e,src:n,operator:r})}});return n}),define("twinescript/operations",["state","datatypes/colour","internaltypes/assignmentrequest","utils/operationutils","internaltypes/twineerror"],function(e,t,n,r,o){function i(e,t,n,r){return n=n||"do this to",function(i,a){1===t.length&&(a=i);var s=void 0;return(s=o.containsError(i,a))?s:("undefined"==typeof i?"undefined":_typeof(i))!==e||("undefined"==typeof a?"undefined":_typeof(a))!==e?o.create("operation","I can only "+n+" "+e+"s, not "+d(("undefined"==typeof i?"undefined":_typeof(i))!==e?i:a)+".",r):t(i,a)}}function a(e){return function(t,n){var r=void 0;return(r=o.containsError(t,n))?r:t&&t.varref?o.create("operation","I can't give an expression a new value."):("undefined"==typeof t?"undefined":_typeof(t))!==("undefined"==typeof n?"undefined":_typeof(n))||c(t)!==c(n)?l(e,t,n)||o.create("operation",d(t)+" isn't the same type of data as "+d(n)):e(t,n)}}function s(e){return function(t,n){var r=void 0;return(r=o.containsError(t,n))?r:(g=t,e(t,n))}}var u=r.isObject,c=r.collectionType,l=r.coerceToString,f=r.is,p=r.contains,d=r.objectName,h=void 0,g=0,y="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.";return h={create:function(e){var t=Object.create(this);return t.Identifiers={get it(){return g},get time(){return Date.now()-e.timestamp}},t},and:i("boolean",a(function(e,t){return e&&t}),"use 'and' to join",y),or:i("boolean",a(function(e,t){return e||t}),"use 'or' to join",y),not:i("boolean",function(e){return!e},"use 'not' to invert",y),"+":a(function(e,t){if(Array.isArray(e))return[].concat(_toConsumableArray(e),_toConsumableArray(t));var n=void 0;return e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?(n=new Set(e),t.forEach(function(e){return n.add(e)}),n):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes("undefined"==typeof e?"undefined":_typeof(e))?e+t:o.create("operation","I can't use + on "+d(e)+".")}),"-":a(function(e,t){if(Array.isArray(e))return e.filter(function(e){return-1===t.indexOf(e)});var n=void 0;return e instanceof Set?(n=new Set(e),t.forEach(function(e){return n.delete(e)}),n):"string"==typeof e?e.split(t).join(""):"number"==typeof e?e-t:o.create("operation","I can't use - on "+d(e)+".")}),"*":i("number",a(function(e,t){return e*t}),"multiply"),"/":i("number",a(function(e,t){return 0===t?o.create("operation","I can't divide "+d(e)+" by zero."):e/t}),"divide"),"%":i("number",a(function(e,t){return 0===t?o.create("operation","I can't modulo "+d(e)+" by zero."):e%t}),"modulus"),"<":s(i("number",a(function(e,t){return t>e}),"do < to")),">":s(i("number",a(function(e,t){return e>t}),"do > to")),"<=":s(i("number",a(function(e,t){return t>=e}),"do <= to")),">=":s(i("number",a(function(e,t){return e>=t}),"do >= to")),is:s(f),isNot:s(function(e,t){return!h.is(e,t)}),contains:s(p),isIn:s(function(e,t){return p(t,e)}),makeSpreader:function(e){return{value:e,spreader:!0}},makeAssignmentRequest:function(e,t,r){var i=o.containsError(e,t);return i?i:t&&t.TwineScript_Unobservable?o.create("operation","That type of value can't be stored."):u(e)&&"propertyChain"in e?n.create(e,t,r):o.create("operation","I can't store a new value inside "+d(e)+".")},setIt:function(e){return o.containsError(e)?e:e.varref?(g=e.get(),e):o.create("operation","I can't put a new value into "+d(e)+".")}},Object.freeze(h)}),define("twinescript/environ",["macros","state","utils","datatypes/colour","internaltypes/varref","internaltypes/twineerror","twinescript/operations"],function(Macros,State,Utils,Colour,VarRef,TwineError,OperationsProto){return function(section){"object"===("undefined"==typeof section?"undefined":_typeof(section))&&section||Utils.impossible("TwineScript.environ","no Section argument was given!");var Operations=OperationsProto.create(section);return section.eval=function(){try{return eval(Array.from(arguments).join(""))}catch(e){return Utils.log(e),Utils.log(Array.from(arguments).join("")),e}},section}}),define("internaltypes/pseudohookset",["jquery","utils/hookutils"],function(e,t){var n=t.wrapTextNodes,r=Object.freeze({forEach:function(t){var r=n(this.selector,this.section.dom,"<tw-pseudo-hook>").parent();r.each(function(n){t(e(this),n)}),r.contents().unwrap().parent().each(function(){this.normalize()})},create:function(e,t){var n=Object.create(this);return n.section=e,n.selector=t,n}});return r}),define("internaltypes/changedescriptor",["jquery","utils","renderer"],function(e,t,n){var r=t.assertOnlyHas,o=t.impossible,i=t.transitionIn,a=n.exec,s=void 0,u={source:"",enabled:!0,target:null,append:"append",transition:"instant",transitionTime:0,styles:null,attr:null,data:null,section:null,create:function(e,t){var n=Object.assign(Object.create(this),{attr:[].concat(this.attr||[]),styles:[].concat(this.styles||[])},e);return t&&t.run(n),n},update:function(){var e=this,t=this.target;Array.isArray(this.styles)&&setTimeout(function(){return t.css(Object.assign.apply(Object,_toConsumableArray([{}].concat(e.styles))))}),this.attr&&this.attr.forEach(function(e){return t.attr(e)}),this.data&&t.data(this.data)},render:function(){var t=this.target,n=this.source,u=this.transition,c=this.enabled,l=this.append;if(r(this,s),!t||!c)return e();if(!(l in t)){if("replace"!==l)return void o("Section.render","The target jQuery doesn't have a '"+l+"' method.");t.empty(),l="append"}var f=e(n&&e.parseHTML(a(n),document,!0));return t[l](f.length?f:void 0),this.update(),u&&i("replace"===l?t:f,u),f}};return s=Object.keys(u),Object.seal(u)}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return r}),define("section",["jquery","utils","utils/selectors","renderer","twinescript/environ","state","utils/hookutils","datatypes/hookset","internaltypes/pseudohookset","internaltypes/changedescriptor","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,o,i,a,s,u,c,l,f){function p(e,r){var o=e.next(n.hook);if(r&&r.changer)if(o.length){var i=this.renderInto(o.popAttr("source"),o,r);if(!i)return e.addClass("false"),void("elseif"!==t.insensitiveName(e.attr("name"))&&(this.stack[0].lastHookShown=!1))}else e.replaceWith(l.create("changer","The ("+r.macroName+":) command should be assigned to a variable or attached to a hook.","Macros like this should usually be touching the left side of a hook: "+e.attr("title")+"[Some text]").render(e.attr("title")));else if(r&&r.live)g.call(this,o,r.delay,r.event);else if((r===!1||null===r||void 0===r)&&(o.removeAttr("source"),e.addClass("false"),o.length))return void(this.stack[0].lastHookShown=!1);o.length&&(this.stack[0].lastHookShown=!0)}function d(t){var n=this.eval(t.popAttr("js")||"");if(l.containsError(n))n instanceof Error&&(n=l.fromError(n)),t.replaceWith(n.render(t.attr("title"),t));else if(f.isPrototypeOf(n))t.append(n.render());else if(n&&n.TwineScript_Print&&!n.changer){if(n=n.TwineScript_Print(),n.earlyExit)return!1;n instanceof e?t.append(n):l.containsError(n)?(n instanceof Error&&(n=l.fromError(n)),t.replaceWith(n.render(t.attr("title"),t))):this.renderInto(n,t)}else"string"==typeof n||"number"==typeof n||"object"===("undefined"==typeof n?"undefined":_typeof(n))&&n&&n.toString!==Object.prototype.toString?this.renderInto(n+"",t):p.call(this,t,n)}function h(n){function r(t){return 0===e(this||t).parentsUntil("tw-collapsed").filter("tw-verbatim, tw-expression, [collapsing=false]").length}var o=n.prevTextNode();e(o).parents("tw-collapsed").length||(o=null);var i=n.nextTextNode();e(i).parents("tw-collapsed").length||(i=null),t.findAndFilter(n,"br:not([data-raw])").filter(r).replaceWith(document.createTextNode(" "));var a=n.textNodes(),s=0;a.reduce(function(e,t){return r(t)?(t.textContent=t.textContent.replace(/\s+/g," ")," "!==t.textContent[0]||e&&e.textContent&&!(e.textContent.search(/\s$/)>-1)||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},o),[].concat(_toConsumableArray(a)).reverse().every(function(e){return r(e)?e.textContent.match(/^\s*$/)?(s+=e.textContent.length,e.textContent="",!0):(e.textContent=e.textContent.replace(/\s+$/,function(e){return s+=e.length,""}),!1):!1}),s>0&&i&&(a[a.length-1].textContent+=" "),n[0]&&m()&&n[0].normalize()}function g(e,t){var r=this,o=e.popAttr("source")||"";t=void 0===t?20:t;var i=function i(){r.inDOM()&&(r.renderInto(o,e,{append:"replace"}),e.find(n.expression+"[name='stop']").length||r.inDOM()&&setTimeout(i,t))};setTimeout(i,t)}var y=void 0,m=function(){var t=void 0;return function(){if(void 0!==t)return t;var n=e("<p>");return n[0].normalize?(n.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),t=1===n.contents().length):t=!1}}();return y={create:function(n){t.assert(n instanceof e&&1===n.length);var r=Object.assign(Object.create(this),{timestamp:Date.now(),dom:n||t.storyElement,stack:[],enchantments:[]});return r=o(r)},inDOM:function(){return e(t.storyElement).find(this.dom).length>0},$:function(e){return t.$(e,this.dom)},evaluateTwineMarkup:function(t){var n=e("<p>");this.renderInto(t,n);var r=void 0;return(r=n.find("tw-error")).length>0?r:n.text()},selectHook:function(e){if(s.isPrototypeOf(e)||u.isPrototypeOf(e))return e;switch(a.selectorType(e)){case"hookRef":return s.create(this,e);case"html":return t.findAndFilter(this.dom.add(t.storyElement),e.slice(1,-1));case"string":return u.create(this,e)}return null},renderInto:function(r,o,i){var a=c.create({target:o,source:r});if(a.section=this,i&&[].concat(i).forEach(function(e){e&&e.changer?e.run(a):Object.assign(a,e)}),"string"==typeof a.target&&(a.target=this.selectHook(a.target)),!a.target)return t.impossible("Section.renderInto","ChangeDescriptor has source but not a target!"),!1;var s=e();this.stack.length>=50?s=l.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(o.attr("title")).replaceAll(o):a.target instanceof e?s=a.render():a.target.forEach(function(e){s=s.add(a.create({target:e}).render())}),this.stack.unshift(Object.create(null));var u=this;return t.findAndFilter(s,n.hook+","+n.expression).each(function(){var t=e(this);switch(t.tag()){case n.hook:t.attr("source")&&(u.renderInto(t.attr("source"),t),t.removeAttr("source"));break;case n.expression:return d.call(u,t)}}),s.length&&o instanceof e&&o.is(n.hook)&&o.parents("tw-collapsed").length>0&&h(s),t.findAndFilter(s,n.collapsed).each(function(){h(e(this))}),this.stack.shift(),0===this.stack.length&&this.updateEnchantments(),a.enabled},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})}},Object.preventExtensions(y)}),define("engine",["jquery","utils","utils/selectors","state","section","passages"],function(e,t,n,r,o,i){function a(){var t=e("<tw-passage><tw-sidebar>"),o=t.children(n.sidebar);g.permalink&&r.save&&o.append('<tw-icon tabindex=0 class="permalink" title="Permanent link to this passage"><a href="#'+r.save()+'">&sect;');var i=e('<tw-icon tabindex=0 class="undo" title="Undo">&#8630;</tw-icon>').click(h.goBack),a=e('<tw-icon tabindex=0 class="redo" title="Redo">&#8631;</tw-icon>').click(h.goForward);return r.pastLength<=0&&i.css("visibility","hidden"),r.futureLength<=0&&a.css("visibility","hidden"),o.append(i).append(a),t}function s(e,t){return"<tw-include type="+e+" title='"+c(t.get("name"))+"'>"+t.get("source")+"</tw-include>"}function u(u,c){var h="instant",y=i.get(u),m=t.storyElement,v=m.parent();v.is(n.enchantment)&&(v=m.unwrap().parent()),y&&y instanceof Map&&y.has("source")||l("Engine.showPassage","There's no passage with the name \""+u+'"!'),m.detach();var b=t.$(m.children(f));!c&&h&&p(b,h);var w=a().appendTo(m);d(w.length>0);var x=o.create(w),T=y.get("source");T=(g.debug?i.getTagged("debug-header").map(s.bind(0,"debug-header")).join(""):"")+i.getTagged("header").map(s.bind(0,"header")).join("")+T+i.getTagged("footer").map(s.bind(0,"footer")).join("")+(g.debug?i.getTagged("debug-footer").map(s.bind(0,"debug-footer")).join(""):""),r.pastLength<=0&&(g.debug&&(T=i.getTagged("debug-startup").map(s.bind(0,"debug-startup")).join("")+T),T=i.getTagged("startup").map(s.bind(0,"startup")).join("")+T),x.renderInto(T,w,[{transition:"dissolve"}]),e("html").append(m.parent().length?m.parent():m),scroll(0,c?w.offset().top-.05*e(window).height():v.offset().top)}var c=t.escape,l=t.impossible,f=t.passageSelector,p=t.transitionOut,d=t.assert,h=void 0,g=Object.create(null);return h={goBack:function(){r.rewind()&&u(r.passage)},goForward:function(){r.fastForward()&&u(r.passage)},goToPassage:function(e,t){r.play(e),u(e,t)},showPassage:u,options:g},Object.freeze(h)}),define("macrolib/values",["macros","utils/operationutils","internaltypes/twineerror"],function(e,t,n){function r(e){return function(t){var r=e.apply(void 0,_toConsumableArray(t));return"number"!=typeof r||isNaN(r)?n.create("macrocall","This mathematical expression doesn't compute!"):r}}function o(){var e;return e=~~(Math.random()*arguments.length),arguments.length<=e?void 0:arguments[e]}var i=t.subset,a=t.objectName,s=e.TypeSignature,u=s.rest,c=s.zeroOrMore,l=s.Any;e.add(["text","string"],function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];return t.join("")},[c(e.TypeSignature.either(String,Number,Boolean,Array))])("substring",function(e,t,n,r){return i(t,n,r)},[String,Number,Number])(["num","number"],function(e,t){return Number.isNaN(+t)?n.create("macrocall","I couldn't convert "+a(t)+" to a number."):+t},[String]),{weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12,n=e.getHours()%12||12,r=(e.getMinutes()<10?"0":"")+e.getMinutes();return n+":"+r+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[Math.min,u(Number)],max:[Math.max,u(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[Math.floor,Number],round:[Math.round,Number],ceil:[Math.ceil,Number],pow:[r(Math.pow),Number,Number],exp:[Math.exp,Number],sqrt:[r(Math.sqrt),Number],log:[r(Math.log),Number],log10:[r(Math.log10),Number],log2:[r(Math.log2),Number],random:[function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e!==(0|e)||t!==(0|t))return n.create("macrocall","(random:) only accepts whole numbers, not "+a(e!==(0|e)?e:t));var r=void 0,o=void 0;return t?(r=Math.min(e,t),o=Math.max(e,t)):(r=0,o=e),o+=1,~~(Math.random()*(o-r))+r},[Number,e.TypeSignature.optional(Number)]],either:[o,u(l)],alert:[function(e){return window.alert(e||"")||""},String],prompt:[function(e,t){return window.prompt(e||"",t||"")||""},String,String],confirm:[function(e){return window.confirm(e||"")},String],openURL:[function(e){return window.open(e)&&""},String],reload:[function(){return window.location.reload()||""},null],gotoURL:[function(){return window.location.assign()||""},String],pageURL:[function(){return window.location.href},null],"":function(){var t=this;Object.keys(this).forEach(function(n){n&&!function(){var r=t[n][0],o=t[n][1];e.add(n,function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];return r.apply(void 0,t)},o)}()})}}[""]()}),function(e){!function(){if(!e.requestAnimationFrame){if(e.webkitRequestAnimationFrame)return e.requestAnimationFrame=e.webkitRequestAnimationFrame,void(e.cancelAnimationFrame=e.webkitCancelAnimationFrame||e.webkitCancelRequestAnimationFrame);var t=0;e.requestAnimationFrame=function(n){var r=(new Date).getTime(),o=Math.max(0,16-(r-t)),i=e.setTimeout(function(){n(r+o)},o);return t=r+o,i},e.cancelAnimationFrame=function(e){clearTimeout(e)}}}(),"function"==typeof define&&define("requestAnimationFrame",[],function(){return e.requestAnimationFrame})}(window),define("macrolib/commands",["requestAnimationFrame","macros","utils","state","passages","engine","internaltypes/twineerror","utils/operationutils"],function(e,t,n,r,o,i,a,s){function u(e){return"("+e+" "+i.options.ifid+") "}var c=n.toJSLiteral,l=n.unescape,f=s.isObject,p=t.TypeSignature,d=p.Any,h=p.optional,g=!!localStorage&&function(){try{return localStorage.setItem("test","1"),localStorage.removeItem("test"),!0}catch(e){return!1}}();t.add("display",function(e,t){return{TwineScript_ObjectName:"a (display: "+c(t)+") command",TwineScript_TypeName:"a (display:) command",TwineScript_Print:function(){return o.has(t)?l(o.get(t).get("source")):a.create("macrocall","I can't (display:) the passage '"+t+"' because it doesn't exist.")}}},[String])("print",function e(t,n){if(a.containsError(n))return n;if(n&&"function"==typeof n.TwineScript_Print)n=n.TwineScript_Print();else if(n instanceof Map){if(n=Array.from(n.entries()),a.containsError(n))return n;n=n.reduce(function(n,r){return n+"<tr><td>"+e(t,r[0]).TwineScript_Print()+"</td><td>"+e(t,r[1]).TwineScript_Print()+"</td></tr>"},"<table class=datamap>")+"</table>"}else if(n instanceof Set)n=Array.from(n.values());else if(Array.isArray(n))n+="";else{if(f(n))throw new TypeError("I don't know how to print this value yet.");n+=""}return{TwineScript_ObjectName:"a (print: "+c(n)+") command",TwineScript_TypeName:"a (print:) command",TwineScript_Print:function(){return n}}},[d])("goto",function(t,n){return{TwineScript_ObjectName:"a (go-to: "+c(n)+") command",TwineScript_TypeName:"a (go-to:) command",TwineScript_Print:function(){return o.has(n)?(e(i.goToPassage.bind(i,n,!1)),{earlyExit:1}):a.create("macrocall","I can't (go-to:) the passage '"+n+"' because it doesn't exist.")}}},[String])("live",function(e,t){return{TwineScript_ObjectName:"a (live: "+t+") command",TwineScript_TypeName:"a (live:) command",live:!0,delay:t}},[h(Number)])("stop",function(){return{TwineScript_ObjectName:"a (stop:) command",TwineScript_TypeName:"a (stop:) command",TwineScript_Print:function(){return""}}},[])("savegame",function(e,t,n){if(n=n||"",!g)return!1;var o=r.serialise();if(a.containsError(o))return o;try{return localStorage.setItem(u("Saved Game")+t,o),localStorage.setItem(u("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,h(String)])("loadgame",function(t,n){return{TwineScript_ObjectName:"a (load-game:) command",TwineScript_TypeName:"a (load-game:) command",TwineScript_Print:function(){var t=localStorage.getItem(u("Saved Game")+n);return t?(r.deserialise(t),e(i.showPassage.bind(i,r.passage,!1)),{earlyExit:1}):a.create("saving","I can't find a save slot named '"+n+"'!")}}},[String])}),define("macrolib/datastructures",["jquery","utils/naturalsort","macros","utils/operationutils","state","engine","passages","internaltypes/assignmentrequest","internaltypes/twineerror","internaltypes/twinenotifier"],function(e,t,n,r,o,i,a,s,u,c){var l=r.objectName,f=r.subset,p=r.collectionType,d=r.isValidDatamapName,h=n.TypeSignature,g=h.optional,y=h.rest,m=h.zeroOrMore,v=h.Any;n.add("set",function(){for(var e="",t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=arguments.length<=t+1?void 0:arguments[t+1];if("into"===n.operator)return u.create("macrocall","Please say 'to' when using the (set:) macro.");var r=n.dest.set(n.src);if(u.isPrototypeOf(r))return r;i.options.debug&&(e+=(e?"; ":"")+l(n.dest)+" is now "+l(n.src))}return{TwineScript_TypeName:"a (set:) operation",TwineScript_ObjectName:"a (set:) operation",TwineScript_Unobservable:!0,TwineScript_Print:function(){return e&&c.create(e).render()}}},[y(s)])("put",function(){for(var e="",t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return u.create("macrocall","Please say 'into' when using the (put:) macro.");var r=n.dest.set(n.src);if(u.isPrototypeOf(r))return r;i.options.debug&&(e+=(e?"; ":"")+l(n.dest)+" is now "+l(n.src))}return{TwineScript_TypeName:"a (put:) operation",TwineScript_ObjectName:"a (put:) operation",TwineScript_Unobservable:!0,TwineScript_Print:function(){return e&&c.create(e).render()}}},[y(s)])("move",function(e,t){if("into"!==t.operator)return u.create("macrocall","Please say 'into' when using the (move:) macro.");if(t.src&&t.src.varref){var n=t.src.get(),r=void 0;if(r=u.containsError(n))return r;t.dest.set(n),t.src.delete()}else t.dest.set(t.src),t.src.TwineScript_DeleteValue&&t.src.TwineScript_DeleteValue();return{TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unobservable:!0,TwineScript_Print:""}},[y(s)])(["a","array"],function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];return t},m(v))("range",function e(t,n,r){if(n>r)return e(t,r,n);var o=[n];for(r-=n;r-->0;)o.push(++n);return o},[Number,Number])("subarray",function(e,t,n,r){return f(t,n,r)},[Array,Number,Number])("shuffled",function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];return t.reduce(function(e,t,n){var r=Math.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[])},[v,y(v)])("sorted",function(){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return n.sort(t("en"))},[String,y(String)])("rotated",function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;n>o;o++)r[o-2]=arguments[o];return t*=-1,0===t?u.create("macrocall","I can't rotate these values by 0 positions."):Math.abs(t)>=r.length?u.create("macrocall","I can't rotate these "+r.length+" values by "+t+" positions."):r.slice(t).concat(r.slice(0,t))},[v,v,y(v)])("datanames",function(e,n){return Array.from(n.keys()).sort(t("en"))},[Map])("datavalues",function(e,n){return Array.from(n.entries()).sort(function(e,n){return[e[0],n[0]].sort(t("en"))[0]===e[0]?-1:1}).map(function(e){return e[1]})},[Map])("history",function(){return o.pastPassageNames()},[])("passage",function(e,t){return a.get(t||o.passage)||u.create("macrocall","There's no passage named '"+t+"' in this story.")},[g(String)])("savedgames",function(){function e(e){return"("+e+" "+i.options.ifid+") "}var t=0,n=void 0,r=new Map;do{n=localStorage.key(t),t+=1;var o=e("Saved Game");n&&n.startsWith(o)&&(n=n.slice(o.length),r.set(n,localStorage.getItem(e("Saved Game Filename")+n)))}while(n);return r},[])("datamap",function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];var r=void 0,o=new Map,i=t.reduce(function(e,t){var n=void 0;if(u.containsError(e))return e;if(void 0===r)r=t;else{if(n=u.containsError(d(o,r)))return n;if(o.has(r))return u.create("macrocall","You used the same data name ("+l(r)+") twice in the same (datamap:) call.");o.set(r,t),r=void 0}return e},!0);return u.containsError(i)?i:void 0!==r?u.create("macrocall","This datamap has a data name without a value."):o},m(v))("dataset",function(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];return new Set(t)},m(v))("count",function(e,t,n){switch(p(t)){case"dataset":case"datamap":return+t.has(name);case"string":return"string"!=typeof n?new TypeError(l(t)+" can't contain  "+l(n)+" because it isn't a string."):t.split(n).length-1;case"array":return t.reduce(function(e,t){return e+(t===n)},0)}},[v,v])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/selectors","datatypes/colour","datatypes/changercommand","internaltypes/twineerror"],function(e,t,n,r,o,i,a){var s=n.insensitiveName,u=n.assert,c=n.childrenProbablyInline,l=t.TypeSignature,f=l.either,p=l.wrapped,d=[p(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')];t.addChanger("if",function(e,t){return i.create("if",[t]);

},function(e,t){return e.enabled=e.enabled&&t},d)("unless",function(e,t){return i.create("unless",[!t])},function(e,t){return e.enabled=e.enabled&&t},d)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?i.create("elseif",[e.stack[0].lastHookShown===!1&&!!t]):a.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},d)("else",function(e){return"lastHookShown"in e.stack[0]?i.create("else",[e.stack[0].lastHookShown===!1]):a.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)(["hook"],function(e,t){return i.create("hook",[t])},function(e,t){return e.attr.push({name:t})},[String])(["transition","t8n"],function(e,t){var n=["dissolve","shudder","pulse"];return t=s(t),-1===n.indexOf(t)?a.create("macrocall","'"+t+'" is not a valid (transition:)',"Only the following names are recognised (capitalisation and hyphens ignored): "+n.join(", ")):i.create("transition",[t])},function(e,t){return e.transition=t,e},[String])("font",function(e,t){return i.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=void 0,r=t.indexOf("><");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(t))return a.create("macrocall",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"');if(~r){var o=Math.round(r/(t.length-2)*50);n=Object.assign({"text-align":"center","max-width":"50%"},25===o?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":o+"%"})}else n="<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"};return n.display="block",i.create("align",[n])},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return t&&t.colour&&(t=t.toHexString(t)),i.create("text-colour",[t])},function(e,t){return e.styles.push({color:t}),e},[f(String,o)])("text-rotate",function(e,t){return i.create("text-rotate",[t])},function(t,n){return t.styles.push({display:"inline-block",transform:function(){var t=e(this).css("transform")||"";return"none"===t&&(t=""),t+" rotate("+n+"deg)"}}),t},[Number])("background",function(e,t){return t&&t.colour&&(t=t.toHexString(t)),i.create("background",[t])},function(t,n){var r=void 0;return r=o.isHexString(n)?{"background-color":n}:{"background-size":"cover","background-image":"url("+n+")"},t.styles.push(r,{display:function(){return c(e(this))?"initial":"block"}}),t},[f(String,o)]).apply(void 0,_toConsumableArray(function(){var t={color:"transparent"},n=Object.assign(Object.create(null),{bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},strike:{"text-decoration":"line-through"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite",display:"inline-block"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var t=e(this).css("color");return"-1px -1px 0 "+t+", 1px -1px 0 "+t+",-1px  1px 0 "+t+", 1px  1px 0 "+t}},{color:function(){for(var t=e(this);t.length&&t[0]!==document;t=t.parent()){var n=t.css("background-color");if("transparent"!==n&&!n.match(/^\w+a\(.+?,\s*0\s*\)$/))return n}return"#fff"}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+e(this).css("color")}},emboss:{"text-shadow":function(){return"0.08em 0.08em 0em "+e(this).css("color")}},smear:[{"text-shadow":function(){var t=e(this).css("color");return"0em   0em 0.02em "+t+",-0.2em 0em  0.5em "+t+", 0.2em 0em  0.5em "+t}},t],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+e(this).css("color")}},t],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+e(this).css("color")},"user-select":"none"},t],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite",display:"inline-block"}});return["text-style",function(e,t){return t=s(t),t in n?i.create("text-style",[t]):a.create("macrocall","'"+t+'" is not a valid (textstyle:)',"Only the following names are recognised (capitalisation and hyphens ignored): "+Object.keys(n).join(", "))},function(e,t){return u(t in n),e.styles=e.styles.concat(n[t]),e}]}()).concat([[String]]))("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),i.create("css",[t])},function(t,n){return t.attr.push({style:function(){return(e(this).attr("style")||"")+n}}),t},[String])}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor"],function(e,t,n){var r={create:function(n){return t.assertOnlyHas(n,["scope","attr","data","changer"]),Object.assign(Object.create(this),{enchantments:e()},n)},enchantScope:function(){var t=this,r=this.attr,o=this.data,i=this.changer,a=this.scope;a instanceof e&&(a=Array.prototype.map.call(a,function(t){return e(t)})),this.enchantments=e(),a.forEach(function(e){var a=e.wrapAll("<tw-enchantment>").parent();if(r&&a.attr(r),o&&a.data(o),i){var s=n.create({target:a});i.run(s),s.update()}e.is("tw-story")&&a.css({width:"100%",height:"100%"}),t.enchantments=t.enchantments.add(a)})},disenchant:function(){this.enchantments.each(function(){e(this).contents().unwrap()})}};return Object.freeze(r)}),define("macrolib/enchantments",["jquery","utils","macros","datatypes/hookset","datatypes/changercommand","internaltypes/enchantment","internaltypes/twineerror"],function(e,t,n,r,o,i,a){function s(n,s){return t.assert(n),e(function(){t.storyElement.on(n.event+".enchantment","."+n.classList.replace(/ /g,"."),function(){var t=e(this),n=t.data("enchantmentEvent");n&&n(t)})}),[function(e,t){return t.selector&&(t=t.selector),t?o.create(s,[t]):a.create("datatype","The string given to this ("+s+":) macro was empty.")},function(e,t){e.enabled=!1,n.rerender&&(e.target=t,e.append=n.rerender);var r=i.create({attr:Object.assign({class:n.classList},n.classList.includes("link")?{tabIndex:"0"}:{}),data:{enchantmentEvent:function(){if(n.once){var t=e.section.enchantments.indexOf(r);e.section.enchantments.splice(t,1),r.disenchant()}e.section.renderInto(e.source,null,Object.assign({},e,{enabled:!0}))}},scope:e.section.selectHook(t)});return e.section.enchantments.push(r),r.enchantScope(),e},u(r,String)]}var u=n.TypeSignature.either,c=["replace","append","prepend"];c.forEach(function(t){n.addChanger(t,function(e,n){return n?o.create(t,[n]):a.create("datatype","The string given to this ("+t+":) macro was empty.")},function(n,r){var o=e(n.target.context).parents().filter("tw-collapsed").length>0;return o||(n.attr=[].concat(_toConsumableArray(n.attr),[{collapsing:!1}])),n.target=r,n.append=t,n},u(r,String))});var l=[{name:"click",enchantDesc:{event:"click",once:!0,rerender:"",classList:"link enchantment-link"}},{name:"mouseover",enchantDesc:{event:"mouseenter",once:!0,rerender:"",classList:"enchantment-mouseover"}},{name:"mouseout",enchantDesc:{event:"mouseleave",once:!0,rerender:"",classList:"enchantment-mouseout"}}];l.forEach(function(e){return n.addChanger.apply(n,[e.name].concat(_toConsumableArray(s(e.enchantDesc,e.name))))}),c.forEach(function(e){l.forEach(function(t){var r=Object.assign({},t.enchantDesc,{rerender:e}),o=t.name+"-"+e;n.addChanger.apply(n,[o].concat(_toConsumableArray(s(r,o))))})})}),define("macrolib/links",["jquery","macros","utils","utils/selectors","state","passages","engine","datatypes/changercommand"],function(e,t,n,r,o,i,a,s){var u=t.TypeSignature.optional;e(function(){return e(n.storyElement).on("click.passage-link",r.internalLink,function(){var t=e(this),n=t.parent().data("clickEvent");if(n)return void n(t);var r=t.attr("passage-name");r&&a.goToPassage(r,!1)})}),[["link","link-replace"],["link-reveal"],["link-repeat"]].forEach(function(e){return t.addChanger(e,function(t,n){return s.create(e[0],[n])},function(t,n){var r=t.source;t.source="<tw-link tabindex=0>"+n+"</tw-link>",t.append="link"===e[0]?"replace":"append",t.data={clickEvent:function(n){t.source=r,t.section.renderInto(r+"",null,t),"link-reveal"===e[0]&&n.contents().unwrap()}}},[String])}),t.add(["link-goto"],function(t,r,a){return{TwineScript_TypeName:"a (link-goto: "+n.toJSLiteral(r)+", "+n.toJSLiteral(a)+") command",TwineScript_ObjectName:"a (link-goto:) command",TwineScript_Print:function(){var s=t.evaluateTwineMarkup(n.unescape(a||r));if(s instanceof e)return s;if(!i.has(s))return'<tw-broken-link passage-name="'+n.escape(s)+'">'+(r||a)+"</tw-broken-link>";var u=o.passageNameVisited(s);return"<tw-link tabindex=0 "+(u>0?'class="visited" ':"")+'passage-name="'+n.escape(s)+'">'+(r||a)+"</tw-link>"}}},[String,u(String)])}),define("macrolib",["utils","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/links"],function(e){var t=e.log;t("Loaded the built-in macros.")}),define("repl",["utils","markup","twinescript/compiler","twinescript/environ"],function(e,t,n,r){window.REPL=function(e){var o=n(t.lex("(print:"+e+")"));return console.log(o),r({}).eval(o)},window.LEX=function(e){var n=t.lex(e);return 1===n.length?n[0]:n}}),require.config({paths:{jquery:"../node_modules/jquery/dist/jquery",almond:"../node_modules/almond/almond","es6-shim":"../node_modules/es6-shim/es6-shim",requestAnimationFrame:"../node_modules/requestanimationframe/app/requestAnimationFrame",jqueryplugins:"utils/jqueryplugins",markup:"./markup/markup",lexer:"./markup/lexer",patterns:"./markup/patterns"},deps:["jquery","es6-shim","jqueryplugins"]}),require(["jquery","renderer","state","engine","passages","utils/selectors","macrolib","repl"],function($,Renderer,State,Engine,Passages,Selectors){function _eval(text){return eval(text+"")}function testPlayCleanup(){["_","Backbone","Store","Mn","Marionette","saveAs","FastClick","JSZip","SVG","requestAnimFrame","UUID","XDate","CodeMirror","ui","nwui","AppPref","Passage","StoryFormat","Story","AppPrefCollection","PassageCollection","StoryCollection","StoryFormatCollection","WelcomeView","StoryItemView","StoryListView","PassageItemView","StoryEditView","TwineRouter","TransRegion","TwineApp","app","storyFormat"].forEach(function(e){try{delete window[e]}catch(t){window[e]=void 0}})}var _installHandlers=function(){var e=$(document.documentElement),t="<tw-debugger><button class='show-invisibles'>&#9903; Debug View</button></tw-debugger>";e.on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),Engine.options.debug&&($(document.body).append(t),$(".show-invisibles").click(function(){e.toggleClass("debug-mode").is(".debug-mode")})),_installHandlers=null};!function(e){window.onerror=function(t,n,r,o,i){var a=i&&i.stack&&"\n"+i.stack.replace(/\([^\)]+\)/g,"")+"\n"||"("+t+")\n";alert("Sorry to interrupt, but this page's code has got itself in a mess. "+a+"(This is probably due to a bug in the Twine game engine.)"),window.onerror=e,"function"==typeof e&&e.apply(void 0,arguments)}}(window.onerror),$(function(){var e=$(Selectors.storyData);if(0!==e.length){"TwineApp"in window&&testPlayCleanup();var t=e.attr("options");t&&t.split(/\s/).forEach(function(e){Renderer.options[e]=Engine.options[e]=!0});var n=e.attr("startnode");return Renderer.options.ifid=Engine.options.ifid=e.attr("ifid"),n||(n=[].reduce.call($(Selectors.passageData),function(e,t){var n=t.getAttribute("pid");return e>n?n:e},1/0)),n=$(Selectors.passageData+"[pid="+n+"]").attr("name"),_installHandlers(),$(Selectors.script).each(function(e){try{_eval($(this).html())}catch(t){alert("There is a problem with this story's script (#"+(e+1)+"):\n\n"+t.message)}}),$(Selectors.stylesheet).each(function(e){$(document.head).append('<style data-title="Story stylesheet '+(e+1)+'">'+$(this).html())}),window.location.hash&&!window.location.hash.includes("stories")&&State.load(window.location.hash)?void Engine.showPassage(State.passage):void Engine.goToPassage(n)}})}),define("harlowe",function(){}),require(["harlowe"])}();</script>


</body>
</html>
